<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>第10章 実践：公開APIを活用したミニアプリ - REST API & JSON入門</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700;900&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../../shared/common.css">
    <style>
      :root {
        --primary: #0097A7;
        --primary-dark: #00838F;
        --primary-light: #E0F7FA;
        --primary-lighter: #B2EBF2;
      }
      body { padding-top: 48px; }
      .nav-category-links { display: none; }
      /* 図解用スタイル */
      .visual-diagram {
        margin: 28px 0;
        padding: 28px 20px;
        background: linear-gradient(135deg, #f8fdfe 0%, #e6f7f9 100%);
        border-radius: 16px;
        border: 1px solid #b2ebf2;
      }
      .visual-diagram-title {
        text-align: center;
        font-size: 0.82rem;
        font-weight: 700;
        color: #0097A7;
        margin-bottom: 20px;
        letter-spacing: 0.05em;
      }
      .app-arch {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 14px;
        flex-wrap: wrap;
      }
      .app-box {
        background: white;
        border: 2px solid #b2ebf2;
        border-radius: 14px;
        padding: 18px 14px;
        text-align: center;
        min-width: 110px;
      }
      .app-box.highlight {
        background: #0097A7;
        color: white;
        border-color: #0097A7;
      }
      .app-box .ab-icon { font-size: 2rem; display: block; margin-bottom: 6px; }
      .app-box .ab-label { font-size: 0.8rem; font-weight: 700; display: block; }
      .app-box .ab-sub { font-size: 0.65rem; opacity: 0.7; display: block; margin-top: 2px; }
      .app-arrow {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 2px;
        color: #0097A7;
        font-weight: 700;
      }
      .app-arrow .aa-line { font-size: 1.4rem; }
      .app-arrow .aa-label { font-size: 0.6rem; white-space: nowrap; }
      .best-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 12px;
      }
      @media (max-width: 520px) {
        .best-grid { grid-template-columns: 1fr; }
      }
      .best-item {
        background: white;
        border: 2px solid #b2ebf2;
        border-radius: 12px;
        padding: 16px 12px;
        text-align: center;
      }
      .best-item .bi-icon { font-size: 1.8rem; display: block; margin-bottom: 6px; }
      .best-item .bi-label { font-size: 0.78rem; font-weight: 700; color: #0097A7; display: block; }
      .best-item .bi-desc { font-size: 0.68rem; color: #666; display: block; margin-top: 6px; line-height: 1.4; }
    </style>
</head>
<body>
    <nav class="global-nav"></nav>
    <script src="../../shared/js/nav-rest-api.js"></script>

    <div class="container">
        <header class="chapter-header">
            <div class="chapter-badge"><span class="material-icons">menu_book</span> Chapter</div>
            <div class="chapter-number">10</div>
            <h1 class="chapter-title">実践：公開APIを活用したミニアプリ</h1>
        </header>

        <nav class="toc">
            <h2 class="toc-title"><span class="material-icons">list_alt</span> この章の内容</h2>
            <ul class="toc-list">
                <li class="toc-item"><span class="toc-number">10-1</span><span>プロジェクトの準備</span></li>
                <li class="toc-item"><span class="toc-number">10-2</span><span>天気情報アプリの作成</span></li>
                <li class="toc-item"><span class="toc-number">10-3</span><span>ポケモン図鑑アプリの作成</span></li>
                <li class="toc-item"><span class="toc-number">10-4</span><span>エラーハンドリングとUX</span></li>
                <li class="toc-item"><span class="toc-number">10-5</span><span>API活用のベストプラクティス</span></li>
            </ul>
        </nav>

        <!-- セクション 10-1 -->
        <section class="section">
            <div class="section-header">
                <span class="section-number">Section 10-1</span>
                <h2 class="section-title">プロジェクトの準備</h2>
            </div>

            <div class="intro-text">
                <p>この章では、これまで学んだREST API・JSON・fetchの知識を活用して、実際に動くミニアプリを作成します。まずはHTML/CSS/JavaScriptの基本構成を準備しましょう。</p>
            </div>

            <!-- 図解: ミニアプリのアーキテクチャ -->
            <div class="visual-diagram">
                <div class="visual-diagram-title">APIミニアプリの構成図</div>
                <div class="app-arch">
                    <div class="app-box">
                        <span class="ab-icon">&#128100;</span>
                        <span class="ab-label">ユーザー</span>
                        <span class="ab-sub">検索キーワード入力</span>
                    </div>
                    <div class="app-arrow">
                        <span class="aa-label">操作</span>
                        <span class="aa-line">→</span>
                    </div>
                    <div class="app-box highlight">
                        <span class="ab-icon">&#127760;</span>
                        <span class="ab-label">ブラウザ</span>
                        <span class="ab-sub">HTML + JS + fetch</span>
                    </div>
                    <div class="app-arrow">
                        <span class="aa-label">HTTP Request</span>
                        <span class="aa-line">→</span>
                    </div>
                    <div class="app-box">
                        <span class="ab-icon">&#9729;&#65039;</span>
                        <span class="ab-label">公開API</span>
                        <span class="ab-sub">天気 / ポケモン etc.</span>
                    </div>
                </div>
                <p style="text-align:center;font-size:0.7rem;color:#666;margin-top:14px;">ブラウザから<strong>fetch</strong>で公開APIを呼び出し、JSONデータを受け取って画面に描画</p>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">1.1 HTMLテンプレートの準備</h3>
                <div class="content-block">
                    <p>以下の基本テンプレートを使って、APIを呼び出すミニアプリを構築していきます。</p>

                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-title">基本HTMLテンプレート</span>
                            <span class="code-lang">HTML</span>
                        </div>
                        <pre class="code-content"><code>&lt;!DOCTYPE html&gt;
&lt;html lang="ja"&gt;
&lt;head&gt;
  &lt;meta charset="UTF-8"&gt;
  &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
  &lt;title&gt;APIミニアプリ&lt;/title&gt;
  &lt;style&gt;
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Noto Sans JP', sans-serif;
      background: #f5f5f5;
      padding: 20px;
    }
    .container {
      max-width: 600px;
      margin: 0 auto;
      background: #fff;
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
      color: #333;
    }
    .search-area {
      display: flex;
      gap: 8px;
      margin-bottom: 20px;
    }
    .search-area input {
      flex: 1;
      padding: 10px 14px;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 16px;
    }
    .search-area button {
      padding: 10px 20px;
      background: #0097A7;
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
    }
    #result { margin-top: 16px; }
    .loading { text-align: center; color: #888; }
    .error { color: #d32f2f; text-align: center; }
  &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;div class="container"&gt;
    &lt;h1&gt;APIミニアプリ&lt;/h1&gt;
    &lt;div class="search-area"&gt;
      &lt;input type="text" id="searchInput" placeholder="検索キーワード"&gt;
      &lt;button onclick="search()"&gt;検索&lt;/button&gt;
    &lt;/div&gt;
    &lt;div id="result"&gt;&lt;/div&gt;
  &lt;/div&gt;

  &lt;script src="app.js"&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- セクション 10-2 -->
        <section class="section">
            <div class="section-header">
                <span class="section-number">Section 10-2</span>
                <h2 class="section-title">天気情報アプリの作成</h2>
            </div>

            <div class="intro-text">
                <p>OpenWeatherMap APIを使って、都市名を入力すると現在の天気情報を表示するアプリを作成します。無料プランで十分に利用できます。</p>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">2.1 OpenWeatherMap APIの準備</h3>
                <div class="content-block">
                    <div class="step-list">
                        <div class="step-item">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <h4>APIキーの取得</h4>
                                <p><a href="https://openweathermap.org" target="_blank">OpenWeatherMap</a> にアクセスし、無料アカウントを作成します。ダッシュボードの「API keys」タブからAPIキーを取得します。</p>
                            </div>
                        </div>
                        <div class="step-item">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <h4>fetchで天気データを取得</h4>
                                <p>Current Weather Data APIを使い、都市名から天気情報を取得します。</p>
                            </div>
                        </div>
                        <div class="step-item">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <h4>DOMに描画</h4>
                                <p>取得したJSONデータから必要な情報を抽出し、HTMLに表示します。</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">2.2 天気アプリのHTML</h3>
                <div class="content-block">
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-title">weather.html</span>
                            <span class="code-lang">HTML</span>
                        </div>
                        <pre class="code-content"><code>&lt;div class="container"&gt;
  &lt;h1&gt;天気情報アプリ&lt;/h1&gt;
  &lt;div class="search-area"&gt;
    &lt;input type="text" id="cityInput" placeholder="都市名（例: Tokyo）"&gt;
    &lt;button onclick="getWeather()"&gt;検索&lt;/button&gt;
  &lt;/div&gt;
  &lt;div id="weatherResult"&gt;&lt;/div&gt;
&lt;/div&gt;</code></pre>
                    </div>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">2.3 天気アプリのJavaScript</h3>
                <div class="content-block">
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-title">天気情報を取得して表示する</span>
                            <span class="code-lang">JavaScript</span>
                        </div>
                        <pre class="code-content"><code>const API_KEY = 'あなたのAPIキー'; // OpenWeatherMapのAPIキー

async function getWeather() {
  const city = document.getElementById('cityInput').value.trim();
  const resultDiv = document.getElementById('weatherResult');

  // 入力チェック
  if (!city) {
    resultDiv.innerHTML = '&lt;p class="error"&gt;都市名を入力してください&lt;/p&gt;';
    return;
  }

  // ローディング表示
  resultDiv.innerHTML = '&lt;p class="loading"&gt;取得中...&lt;/p&gt;';

  try {
    // OpenWeatherMap APIを呼び出し
    const url = `https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(city)}&appid=${API_KEY}&units=metric&lang=ja`;
    const response = await fetch(url);

    // エラーチェック
    if (!response.ok) {
      if (response.status === 404) {
        throw new Error('都市が見つかりませんでした');
      }
      throw new Error(`エラー: ${response.status}`);
    }

    const data = await response.json();

    // 結果を表示
    resultDiv.innerHTML = `
      &lt;div style="text-align: center; padding: 20px;"&gt;
        &lt;h2&gt;${data.name}&lt;/h2&gt;
        &lt;img src="https://openweathermap.org/img/wn/${data.weather[0].icon}@2x.png"
             alt="${data.weather[0].description}"&gt;
        &lt;p style="font-size: 48px; font-weight: bold;"&gt;
          ${Math.round(data.main.temp)}°C
        &lt;/p&gt;
        &lt;p&gt;${data.weather[0].description}&lt;/p&gt;
        &lt;p&gt;湿度: ${data.main.humidity}% / 風速: ${data.wind.speed}m/s&lt;/p&gt;
      &lt;/div&gt;
    `;
  } catch (error) {
    resultDiv.innerHTML = `&lt;p class="error"&gt;${error.message}&lt;/p&gt;`;
  }
}</code></pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- セクション 10-3 -->
        <section class="section">
            <div class="section-header">
                <span class="section-number">Section 10-3</span>
                <h2 class="section-title">ポケモン図鑑アプリの作成</h2>
            </div>

            <div class="intro-text">
                <p>PokeAPI（pokeapi.co）は、認証不要で無料で使えるポケモンデータのAPIです。APIキーの取得が不要なため、すぐに試すことができます。</p>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">3.1 ポケモン図鑑のHTML</h3>
                <div class="content-block">
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-title">pokemon.html</span>
                            <span class="code-lang">HTML</span>
                        </div>
                        <pre class="code-content"><code>&lt;div class="container"&gt;
  &lt;h1&gt;ポケモン図鑑&lt;/h1&gt;
  &lt;div class="search-area"&gt;
    &lt;input type="text" id="pokemonInput"
           placeholder="名前 or 番号（例: pikachu, 25）"&gt;
    &lt;button onclick="searchPokemon()"&gt;検索&lt;/button&gt;
  &lt;/div&gt;
  &lt;div id="pokemonResult"&gt;
    &lt;p style="text-align: center; color: #888;"&gt;
      ポケモンの名前（英語）または図鑑番号を入力してください
    &lt;/p&gt;
  &lt;/div&gt;
&lt;/div&gt;</code></pre>
                    </div>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">3.2 ポケモン図鑑のJavaScript</h3>
                <div class="content-block">
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-title">ポケモンを検索して表示する</span>
                            <span class="code-lang">JavaScript</span>
                        </div>
                        <pre class="code-content"><code>async function searchPokemon() {
  const query = document.getElementById('pokemonInput').value.trim().toLowerCase();
  const resultDiv = document.getElementById('pokemonResult');

  // 入力チェック
  if (!query) {
    resultDiv.innerHTML = '&lt;p class="error"&gt;ポケモン名または番号を入力してください&lt;/p&gt;';
    return;
  }

  // ローディング表示
  resultDiv.innerHTML = '&lt;p class="loading"&gt;検索中...&lt;/p&gt;';

  try {
    // PokeAPIを呼び出し（認証不要）
    const response = await fetch(`https://pokeapi.co/api/v2/pokemon/${encodeURIComponent(query)}`);

    if (!response.ok) {
      if (response.status === 404) {
        throw new Error('ポケモンが見つかりませんでした');
      }
      throw new Error(`エラー: ${response.status}`);
    }

    const data = await response.json();

    // タイプを日本語マッピング（簡易版）
    const typeNames = {
      normal: 'ノーマル', fire: 'ほのお', water: 'みず',
      electric: 'でんき', grass: 'くさ', ice: 'こおり',
      fighting: 'かくとう', poison: 'どく', ground: 'じめん',
      flying: 'ひこう', psychic: 'エスパー', bug: 'むし',
      rock: 'いわ', ghost: 'ゴースト', dragon: 'ドラゴン',
      dark: 'あく', steel: 'はがね', fairy: 'フェアリー'
    };

    const types = data.types
      .map(t =&gt; typeNames[t.type.name] || t.type.name)
      .join(' / ');

    // 結果を表示
    resultDiv.innerHTML = `
      &lt;div style="text-align: center; padding: 20px;"&gt;
        &lt;img src="${data.sprites.other['official-artwork'].front_default}"
             alt="${data.name}"
             style="width: 200px; height: 200px; object-fit: contain;"&gt;
        &lt;h2&gt;No.${data.id} ${data.name.toUpperCase()}&lt;/h2&gt;
        &lt;p&gt;タイプ: ${types}&lt;/p&gt;
        &lt;p&gt;高さ: ${data.height / 10}m / 重さ: ${data.weight / 10}kg&lt;/p&gt;
        &lt;div style="margin-top: 12px;"&gt;
          &lt;h3 style="margin-bottom: 8px;"&gt;基本ステータス&lt;/h3&gt;
          ${data.stats.map(s =&gt; `
            &lt;div style="display: flex; align-items: center; gap: 8px; margin: 4px 0;"&gt;
              &lt;span style="width: 100px; text-align: right; font-size: 14px;"&gt;
                ${s.stat.name}
              &lt;/span&gt;
              &lt;div style="flex: 1; background: #eee; border-radius: 4px; height: 16px;"&gt;
                &lt;div style="width: ${Math.min(s.base_stat, 200) / 2}%;
                            background: #0097A7; height: 100%; border-radius: 4px;"&gt;
                &lt;/div&gt;
              &lt;/div&gt;
              &lt;span style="width: 30px; font-size: 14px;"&gt;${s.base_stat}&lt;/span&gt;
            &lt;/div&gt;
          `).join('')}
        &lt;/div&gt;
      &lt;/div&gt;
    `;
  } catch (error) {
    resultDiv.innerHTML = `&lt;p class="error"&gt;${error.message}&lt;/p&gt;`;
  }
}</code></pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- セクション 10-4 -->
        <section class="section">
            <div class="section-header">
                <span class="section-number">Section 10-4</span>
                <h2 class="section-title">エラーハンドリングとUX</h2>
            </div>

            <div class="intro-text">
                <p>APIを使ったアプリでは、通信エラーやデータの不在などさまざまな状況に対応する必要があります。ユーザーに分かりやすいフィードバックを提供しましょう。</p>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">4.1 ローディング表示の実装</h3>
                <div class="content-block">
                    <p>API通信中はローディング表示を出し、ユーザーに処理中であることを伝えます。</p>

                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-title">ローディング表示</span>
                            <span class="code-lang">JavaScript</span>
                        </div>
                        <pre class="code-content"><code>function showLoading(element) {
  element.innerHTML = `
    &lt;div class="loading"&gt;
      &lt;div class="spinner"&gt;&lt;/div&gt;
      &lt;p&gt;データを取得中...&lt;/p&gt;
    &lt;/div&gt;
  `;
}

// CSS（styleタグに追加）
// .spinner {
//   width: 40px; height: 40px;
//   border: 4px solid #ddd;
//   border-top: 4px solid #0097A7;
//   border-radius: 50%;
//   animation: spin 1s linear infinite;
//   margin: 0 auto 12px;
// }
// @keyframes spin {
//   to { transform: rotate(360deg); }
// }</code></pre>
                    </div>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">4.2 エラー表示</h3>
                <div class="content-block">
                    <p>エラーの種類に応じて、ユーザーに適切なメッセージを表示します。</p>

                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-title">エラーハンドリングのパターン</span>
                            <span class="code-lang">JavaScript</span>
                        </div>
                        <pre class="code-content"><code>async function fetchWithErrorHandling(url) {
  try {
    const response = await fetch(url);

    // HTTPステータスに応じたエラー処理
    if (!response.ok) {
      switch (response.status) {
        case 400:
          throw new Error('リクエストの内容に問題があります');
        case 401:
          throw new Error('認証が必要です。APIキーを確認してください');
        case 403:
          throw new Error('アクセスが拒否されました');
        case 404:
          throw new Error('データが見つかりませんでした');
        case 429:
          throw new Error('リクエスト数の上限に達しました。しばらく待ってから再試行してください');
        case 500:
          throw new Error('サーバーでエラーが発生しました');
        default:
          throw new Error(`予期しないエラー（${response.status}）`);
      }
    }

    return await response.json();
  } catch (error) {
    // ネットワークエラー（オフライン等）
    if (error.name === 'TypeError') {
      throw new Error('ネットワーク接続を確認してください');
    }
    throw error;
  }
}</code></pre>
                    </div>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">4.3 空状態の処理</h3>
                <div class="content-block">
                    <p>検索結果が0件の場合や、初期表示のときにユーザーに案内を表示します。</p>

                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-title">空状態の表示</span>
                            <span class="code-lang">JavaScript</span>
                        </div>
                        <pre class="code-content"><code>function showEmptyState(element, message) {
  element.innerHTML = `
    &lt;div style="text-align: center; padding: 40px; color: #888;"&gt;
      &lt;p style="font-size: 48px;"&gt;&#128269;&lt;/p&gt;
      &lt;p&gt;${message}&lt;/p&gt;
    &lt;/div&gt;
  `;
}

// 使用例
const results = data.items;
if (results.length === 0) {
  showEmptyState(resultDiv, '検索結果が見つかりませんでした。別のキーワードで試してください。');
}</code></pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- セクション 10-5 -->
        <section class="section">
            <div class="section-header">
                <span class="section-number">Section 10-5</span>
                <h2 class="section-title">API活用のベストプラクティス</h2>
            </div>

            <div class="intro-text">
                <p>APIを効率的かつ責任を持って利用するためのベストプラクティスを学びましょう。キャッシュ戦略やリトライ処理、API利用のマナーを紹介します。</p>
            </div>

            <!-- 図解: API活用ベストプラクティス -->
            <div class="visual-diagram">
                <div class="visual-diagram-title">API活用 3つのベストプラクティス</div>
                <div class="best-grid">
                    <div class="best-item">
                        <span class="bi-icon">&#128190;</span>
                        <span class="bi-label">キャッシュ</span>
                        <span class="bi-desc">localStorageに保存して同じAPIを何度も呼ばない</span>
                    </div>
                    <div class="best-item">
                        <span class="bi-icon">&#128260;</span>
                        <span class="bi-label">リトライ</span>
                        <span class="bi-desc">指数バックオフで段階的に再試行する</span>
                    </div>
                    <div class="best-item">
                        <span class="bi-icon">&#128220;</span>
                        <span class="bi-label">マナー遵守</span>
                        <span class="bi-desc">レート制限・利用規約を守って安全に利用</span>
                    </div>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">5.1 キャッシュ戦略（localStorage）</h3>
                <div class="content-block">
                    <p>同じデータを何度もAPIに問い合わせないよう、localStorageを使ってキャッシュすることで、レスポンス速度の向上とAPI呼び出し回数の削減ができます。</p>

                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-title">localStorageでキャッシュする</span>
                            <span class="code-lang">JavaScript</span>
                        </div>
                        <pre class="code-content"><code>async function fetchWithCache(url, cacheMinutes = 10) {
  const cacheKey = 'api_cache_' + url;
  const cached = localStorage.getItem(cacheKey);

  // キャッシュが有効ならキャッシュから返す
  if (cached) {
    const { data, timestamp } = JSON.parse(cached);
    const elapsed = (Date.now() - timestamp) / 1000 / 60; // 分
    if (elapsed &lt; cacheMinutes) {
      console.log('キャッシュから取得:', url);
      return data;
    }
  }

  // キャッシュがないか期限切れならAPIを呼び出す
  const response = await fetch(url);
  if (!response.ok) throw new Error(`HTTP ${response.status}`);
  const data = await response.json();

  // キャッシュに保存
  localStorage.setItem(cacheKey, JSON.stringify({
    data: data,
    timestamp: Date.now()
  }));

  console.log('APIから取得:', url);
  return data;
}</code></pre>
                    </div>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">5.2 リトライ処理</h3>
                <div class="content-block">
                    <p>一時的なネットワークエラーやサーバーエラーに対応するため、自動リトライの仕組みを入れると安定性が向上します。</p>

                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-title">リトライ処理の実装</span>
                            <span class="code-lang">JavaScript</span>
                        </div>
                        <pre class="code-content"><code>async function fetchWithRetry(url, maxRetries = 3) {
  for (let attempt = 1; attempt &lt;= maxRetries; attempt++) {
    try {
      const response = await fetch(url);
      if (!response.ok) throw new Error(`HTTP ${response.status}`);
      return await response.json();
    } catch (error) {
      console.log(`試行 ${attempt}/${maxRetries} 失敗:`, error.message);
      if (attempt === maxRetries) throw error;

      // 次のリトライまで待機（指数バックオフ）
      const waitTime = 1000 * Math.pow(2, attempt - 1); // 1秒, 2秒, 4秒...
      console.log(`${waitTime}ms 後にリトライします...`);
      await new Promise(resolve =&gt; setTimeout(resolve, waitTime));
    }
  }
}</code></pre>
                    </div>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">5.3 API利用のマナーとこの講座のまとめ</h3>
                <div class="content-block">
                    <div class="feature-list">
                        <div class="feature-item">
                            <div class="feature-icon">&#128337;</div>
                            <div class="feature-content">
                                <h4>レート制限を遵守する</h4>
                                <p>各APIのレート制限を確認し、上限を超えないようにリクエスト間隔を調整しましょう。レスポンスヘッダーの<code>X-RateLimit-Remaining</code>を確認する習慣をつけてください。</p>
                            </div>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon">&#128161;</div>
                            <div class="feature-content">
                                <h4>不要な呼び出しを削減する</h4>
                                <p>ユーザーがボタンを連打した場合の多重送信防止（デバウンス）や、キャッシュの活用でAPI呼び出し回数を最小限に抑えましょう。</p>
                            </div>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon">&#128220;</div>
                            <div class="feature-content">
                                <h4>利用規約を守る</h4>
                                <p>APIプロバイダーの利用規約を確認し、許可された範囲内で利用しましょう。特にデータの再配布や商用利用に関する規約には注意が必要です。</p>
                            </div>
                        </div>
                    </div>

                    <div class="info-box">
                        <div class="info-box-header">
                            <span class="info-box-icon"><span class="material-icons">lightbulb</span></span>
                            <span class="info-box-title">この講座のまとめ</span>
                        </div>
                        <p>この講座では、APIの基本概念・JSONの構造・HTTPプロトコル・REST設計原則・fetch APIの使い方・テストツール・認証とセキュリティ・APIドキュメントの読み方、そして実践的なミニアプリの作成まで学びました。これらの知識を土台にして、さまざまな公開APIを活用したアプリケーション開発に挑戦してください。</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 練習問題 -->
        <section class="section">
            <div class="section-header">
                <span class="section-number">Exercise</span>
                <h2 class="section-title">10章 練習問題</h2>
            </div>

            <div class="exercise-list">
                <div class="exercise-item">
                    <div class="exercise-number">Q1</div>
                    <div class="exercise-content">
                        <p>APIのレスポンスをlocalStorageにキャッシュする主な目的として、最も適切なものはどれですか？</p>
                        <ol type="A">
                            <li>データのセキュリティを向上させる</li>
                            <li>API呼び出し回数の削減とレスポンス速度の向上</li>
                            <li>サーバー側のデータベースを更新する</li>
                            <li>ブラウザのメモリ使用量を増やす</li>
                        </ol>
                    </div>
                </div>

                <div class="exercise-item">
                    <div class="exercise-number">Q2</div>
                    <div class="exercise-content">
                        <p>API呼び出し時のリトライ処理で「指数バックオフ」を使う理由はどれですか？</p>
                        <ol type="A">
                            <li>リクエストを高速化するため</li>
                            <li>サーバーへの負荷を段階的に軽減しながら再試行するため</li>
                            <li>レスポンスのJSONを自動変換するため</li>
                            <li>認証トークンを自動更新するため</li>
                        </ol>
                    </div>
                </div>

                <div class="exercise-item">
                    <div class="exercise-number">Q3</div>
                    <div class="exercise-content">
                        <p>PokeAPI（pokeapi.co）の特徴として正しいものはどれですか？</p>
                        <ol type="A">
                            <li>有料プランの契約が必須である</li>
                            <li>OAuth 2.0認証が必要である</li>
                            <li>認証不要で無料で利用できる</li>
                            <li>POST / PUT / DELETEメソッドが必要である</li>
                        </ol>
                    </div>
                </div>
            </div>
        </section>

        <!-- 解答 -->
        <section class="section">
            <div class="section-header">
                <span class="section-number">Answer</span>
                <h2 class="section-title">10章 解説・解答</h2>
            </div>

            <div class="answer-list">
                <div class="answer-item">
                    <div class="answer-header">Q1の解答: B</div>
                    <div class="answer-content">
                        <p>localStorageにAPIレスポンスをキャッシュする主な目的は、同じデータに対するAPI呼び出し回数を削減し、キャッシュから即座にデータを返すことでレスポンス速度を向上させることです。ただし、キャッシュには有効期限を設定し、古いデータが表示され続けないよう注意が必要です。</p>
                    </div>
                </div>

                <div class="answer-item">
                    <div class="answer-header">Q2の解答: B</div>
                    <div class="answer-content">
                        <p>指数バックオフ（exponential backoff）は、リトライ間隔を1秒、2秒、4秒と段階的に長くしていく方式です。サーバーが一時的に過負荷の場合、連続してリクエストを送ると更に負荷がかかるため、待機時間を徐々に延ばすことでサーバーの回復を待ちつつ再試行できます。</p>
                    </div>
                </div>

                <div class="answer-item">
                    <div class="answer-header">Q3の解答: C</div>
                    <div class="answer-content">
                        <p>PokeAPIは認証不要で無料で利用できるRESTful APIです。GETリクエストのみで利用でき、ポケモンのデータ（名前、タイプ、ステータスなど）を取得できます。APIキーやOAuth認証は不要で、学習やプロトタイプ開発に最適です。</p>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <div class="page-nav">
        <a href="9api-documentation.html" class="page-nav-btn prev">
            <span>&#8592;</span>
            <div>
                <div class="page-nav-label">前の章</div>
                <div class="page-nav-title">第9章 APIドキュメントの読み方と作り方</div>
            </div>
        </a>
    </div>

    <footer class="global-footer"></footer>
    <script src="../../shared/footer.js"></script>
    <script>
        document.addEventListener('click', function(e) {
            const header = document.querySelector('.global-header');
            const nav = document.querySelector('.tutorial-nav');
            const toggle = document.querySelector('.header-nav-toggle');
            if (header && nav && toggle && !header.contains(e.target) && !nav.contains(e.target) && nav.classList.contains('active')) {
                toggle.classList.remove('active');
                nav.classList.remove('active');
            }
        });
    </script>
    <script src="../../shared/demo.js"></script>
</body>
</html>
