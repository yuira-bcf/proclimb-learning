<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>第16章 例外処理</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700;900&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../../shared/common.css">
    <style>
      :root {
        --primary: #0097A7;
        --primary-dark: #00838F;
        --primary-light: #E0F7FA;
        --primary-lighter: #B2EBF2;
      }
      .nav-category-links { display: none; }
    </style>
</head>
<body>
    <nav class="global-nav"></nav>
    <script src="../../shared/js/nav-java.js"></script>

    <div class="container">
        <header class="chapter-header">
            <div class="chapter-badge"><span class="material-icons">menu_book</span> Chapter</div>
            <div class="chapter-number">16</div>
            <h1 class="chapter-title">例外処理</h1>
        </header>

        <nav class="toc">
            <h2 class="toc-title"><span class="material-icons">list_alt</span> この章の内容</h2>
            <ul class="toc-list">
                <li class="toc-item"><span class="toc-number">16-1</span><span>例外発生の仕組みと例外処理</span></li>
                <li class="toc-item"><span class="toc-number">16-2</span><span>try-catchによる例外のキャッチ</span></li>
                <li class="toc-item"><span class="toc-number">16-3</span><span>try-with-resourcesによるリソースのクローズ</span></li>
                <li class="toc-item"><span class="toc-number">16-4</span><span>throwsによる例外の転送</span></li>
            </ul>
        </nav>

        <!-- セクション 7-1 -->
        <section class="section">
            <div class="section-header">
                <span class="section-number">Section 16-1</span>
                <h2 class="section-title">例外発生の仕組みと例外処理</h2>
            </div>

            <div class="intro-text">
                <p>例外処理は、プログラムの信頼性を高めるために不可欠です。ファイルが見つからない、ネットワーク接続が切れる、ユーザー入力が不正など、予期せぬ事態に適切に対応することで、アプリケーションがクラッシュせずに動作し続けられます。</p>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">1.1 例外の発生</h3>
                <div class="content-block">
                    <p>例外とは、プログラム実行中に発生するエラーのことです。</p>
                    <div class="prompt-box">
                        <div class="prompt-box-header">
                            <span class="prompt-box-icon"><span class="material-icons">chat</span></span>
                            <span class="prompt-box-title">プロンプト</span>
                            <button class="prompt-copy-btn">コピー</button>
                        </div>
                        <div class="prompt-box-content">
                            <pre><code>## 機能
代表的な実行時例外の発生を確認するサンプルプロジェクト

## 生成先
- ディレクトリ: chapter11
- ファイル名: ExceptionDemo.java

## 実装要件
- 配列の範囲外アクセスでArrayIndexOutOfBoundsExceptionを発生させる
- null参照でNullPointerExceptionを発生させる
- ゼロ除算でArithmeticExceptionを発生させる
- 各例外が発生する典型的なケースを示す


- mainメソッドを含め、System.out.printlnで各処理の実行結果を出力して動作確認できるようにする

## 使用するJava構文
- 配列アクセス
- null参照とメソッド呼び出し
- 算術演算（除算）</code></pre>
                        </div>
                    </div>
                    <div class="code-block">
                        <div class="code-header"><span class="code-title">chapter11/ExceptionDemo.java</span><span class="code-lang">Java</span></div>
                        <pre class="code-content"><code>public class ExceptionDemo {
    public static void main(String[] args) {
        // ArrayIndexOutOfBoundsException
        try {
            int[] arr = {1, 2, 3};
            System.out.println(arr[5]);
        } catch (ArrayIndexOutOfBoundsException e) {
            System.out.println("配列範囲外: " + e.getMessage());
        }

        // NullPointerException
        try {
            String str = null;
            str.length();
        } catch (NullPointerException e) {
            System.out.println("null参照: " + e.getMessage());
        }

        // ArithmeticException
        try {
            int result = 10 / 0;
        } catch (ArithmeticException e) {
            System.out.println("ゼロ除算: " + e.getMessage());
        }
    }
}</code></pre>
                    </div>
                    <div style="background: #f8fafc; border: 2px solid #e2e8f0; border-radius: 12px; padding: 16px; margin: 16px 0; text-align: center;">
                        <div id="flow-exception"></div>
                    </div>
                    <div class="syntax-box">
                        <div class="syntax-box-header">
                            <span class="syntax-box-icon"><span class="material-icons">menu_book</span></span>
                            <span class="syntax-box-title">構文説明</span>
                        </div>
                        <div class="syntax-box-content">
                            <div class="syntax-item">
                                <h4>実行時例外（RuntimeException）</h4>
                                <div class="syntax-pattern">// 配列の範囲外アクセス
array[invalidIndex]

// null参照
nullObject.method()

// ゼロ除算
value / 0</div>
                                <p>実行時例外は、プログラム実行中に発生するエラーです。コンパイル時にはチェックされず、try-catchで捕捉しなくてもコンパイルエラーにはなりません。ただし、捕捉しないとプログラムが異常終了します。</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">1.2 例外の種類</h3>
                <div class="content-block">
                    <table class="data-table">
                        <thead>
                            <tr><th>分類</th><th>説明</th><th>例</th></tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>検査例外</strong><br>(Checked)</td>
                                <td>コンパイル時にチェックされる<br>必ずcatchまたはthrows必要</td>
                                <td>IOException<br>SQLException</td>
                            </tr>
                            <tr>
                                <td><strong>非検査例外</strong><br>(Unchecked)</td>
                                <td>RuntimeExceptionのサブクラス<br>catchは任意</td>
                                <td>NullPointerException<br>ArrayIndexOutOfBoundsException</td>
                            </tr>
                            <tr>
                                <td><strong>エラー</strong></td>
                                <td>重大なエラー<br>通常catchしない</td>
                                <td>OutOfMemoryError<br>StackOverflowError</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">1.3 カスタム例外</h3>
                <div class="prompt-box">
                    <div class="prompt-box-header">
                        <span class="prompt-box-icon"><span class="material-icons">chat</span></span>
                        <span class="prompt-box-title">プロンプト</span>
                        <button class="prompt-copy-btn">コピー</button>
                    </div>
                    <div class="prompt-box-content">
                        <pre><code>## 機能
カスタム例外クラス（検査例外と非検査例外）の動作を確認するサンプルプロジェクト

## 生成先
- ディレクトリ: chapter11
- ファイル名: CustomExceptionDemo.java

## 実装要件
- 検査例外：Exceptionを継承したMyCheckedExceptionクラスを作成
- 非検査例外：RuntimeExceptionを継承したMyUncheckedExceptionクラスを作成
- 両方ともメッセージを受け取るコンストラクタを実装
- super()で親クラスのコンストラクタにメッセージを渡す


- mainメソッドを含め、System.out.printlnで各処理の実行結果を出力して動作確認できるようにする

## 使用するJava構文
- extends Exception（検査例外の作成）
- extends RuntimeException（非検査例外の作成）
- super()によるコンストラクタ呼び出し</code></pre>
                    </div>
                </div>
                <div class="code-block">
                    <div class="code-header"><span class="code-title">chapter11/CustomExceptionDemo.java</span><span class="code-lang">Java</span></div>
                    <pre class="code-content"><code>// 検査例外
class MyCheckedException extends Exception {
    public MyCheckedException(String message) {
        super(message);
    }
}

// 非検査例外
class MyUncheckedException extends RuntimeException {
    public MyUncheckedException(String message) {
        super(message);
    }
}

public class CustomExceptionDemo {
    public static void main(String[] args) {
        try {
            throw new MyCheckedException("検査例外が発生");
        } catch (MyCheckedException e) {
            System.out.println(e.getMessage());  // 検査例外が発生
        }

        try {
            throw new MyUncheckedException("非検査例外が発生");
        } catch (MyUncheckedException e) {
            System.out.println(e.getMessage());  // 非検査例外が発生
        }
    }
}</code></pre>
                </div>
                <div class="syntax-box">
                    <div class="syntax-box-header">
                        <span class="syntax-box-icon"><span class="material-icons">menu_book</span></span>
                        <span class="syntax-box-title">構文説明</span>
                    </div>
                    <div class="syntax-box-content">
                        <div class="syntax-item">
                            <h4>カスタム例外クラスの作成（extends Exception）</h4>
                            <div class="syntax-pattern">// 検査例外（Checked Exception）<br>public class カスタム例外名 extends Exception {<br>&nbsp;&nbsp;&nbsp;&nbsp;public カスタム例外名(String message) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(message);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}<br><br>// 非検査例外（Unchecked Exception）<br>public class カスタム例外名 extends RuntimeException {<br>&nbsp;&nbsp;&nbsp;&nbsp;public カスタム例外名(String message) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(message);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}</div>
                            <p>独自の例外クラスを作成するには、Exceptionクラス（検査例外）またはRuntimeExceptionクラス（非検査例外）を継承します。super(message)で親クラスのコンストラクタにメッセージを渡し、例外の詳細情報を設定します。</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- セクション 7-2 -->
        <section class="section">
            <div class="section-header">
                <span class="section-number">Section 16-2</span>
                <h2 class="section-title">try-catchによる例外のキャッチ</h2>
            </div>

            <div class="intro-text">
                <p>try-catch文は例外を「捕捉」して処理する基本構文です。tryブロックで例外が発生する可能性のある処理を実行し、catchブロックで例外発生時の対処を記述します。finallyブロックは例外の有無に関わらず必ず実行されるため、リソースの解放処理に適しています。</p>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">2.1 try-catch-finally</h3>
                <div class="prompt-box">
                    <div class="prompt-box-header">
                        <span class="prompt-box-icon"><span class="material-icons">chat</span></span>
                        <span class="prompt-box-title">プロンプト</span>
                        <button class="prompt-copy-btn">コピー</button>
                    </div>
                    <div class="prompt-box-content">
                        <pre><code>## 機能
try-catch-finally構文を使った基本的な例外処理を確認するサンプルプロジェクト

## 生成先
- ディレクトリ: chapter11
- ファイル名: TryCatchDemo.java

## 実装要件
- tryブロックでゼロ除算が発生する処理を記述
- catchブロックでArithmeticExceptionをキャッチ
- e.getMessage()でエラーメッセージを取得して表示
- finallyブロックで例外発生の有無に関わらず実行される処理を記述


- mainメソッドを含め、System.out.printlnで各処理の実行結果を出力して動作確認できるようにする

## 使用するJava構文
- try-catch-finally構文
- 例外オブジェクトのgetMessage()メソッド
- finallyブロックの使い方</code></pre>
                    </div>
                </div>
                <div class="code-block">
                    <div class="code-header"><span class="code-title">chapter11/TryCatchDemo.java</span><span class="code-lang">Java</span></div>
                    <pre class="code-content"><code>public class TryCatchDemo {
    public static void main(String[] args) {
        try {
            int result = 10 / 0;
            System.out.println(result);
        } catch (ArithmeticException e) {
            System.out.println("0で割ることはできません");
            System.out.println("エラー: " + e.getMessage());
        } finally {
            System.out.println("必ず実行される");
        }
    }
}</code></pre>
                </div>
                <div style="background: #f8fafc; border: 2px solid #e2e8f0; border-radius: 12px; padding: 16px; margin: 16px 0; text-align: center;">
                    <div id="flow-trycatch"></div>
                </div>
                <div class="syntax-box">
                    <div class="syntax-box-header">
                        <span class="syntax-box-icon"><span class="material-icons">menu_book</span></span>
                        <span class="syntax-box-title">構文説明</span>
                    </div>
                    <div class="syntax-box-content">
                        <div class="syntax-item">
                            <h4>try-catch文</h4>
                            <div class="syntax-pattern">try {
    // 例外が発生する可能性のある処理
} catch (例外クラス 変数名) {
    // 例外発生時の処理
}</div>
                            <p>tryブロック内で例外が発生すると、その時点で処理が中断され、対応するcatchブロックにジャンプします。catchの引数には捕捉する例外の型と変数名を指定します。</p>
                        </div>
                        <div class="syntax-item">
                            <h4>try-catch-finally文</h4>
                            <div class="syntax-pattern">try {
    // 例外が発生する可能性のある処理
} catch (例外クラス e) {
    // 例外発生時の処理
} finally {
    // 必ず実行される処理
}</div>
                            <p>finallyブロックは、例外の発生有無に関わらず必ず実行されます。リソースの解放やクリーンアップ処理に使用します。catchブロックでreturnしても、finallyは実行されます。</p>
                        </div>
                    </div>
                </div>
                <div class="info-box">
                    <div class="info-box-header"><span class="info-box-icon"><span class="material-icons">lightbulb</span></span><span class="info-box-title">finallyブロック</span></div>
                    <p>finallyは例外の有無に関わらず必ず実行されます。リソースの解放などに使用します。</p>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">2.2 複数のcatchブロック</h3>
                <div class="prompt-box">
                    <div class="prompt-box-header">
                        <span class="prompt-box-icon"><span class="material-icons">chat</span></span>
                        <span class="prompt-box-title">プロンプト</span>
                        <button class="prompt-copy-btn">コピー</button>
                    </div>
                    <div class="prompt-box-content">
                        <pre><code>## 機能
複数のcatchブロックで異なる種類の例外を個別に処理するサンプルプロジェクト

## 生成先
- ディレクトリ: chapter11
- ファイル名: MultiCatchDemo.java

## 実装要件
- 複数の例外が発生する可能性のある処理をtryブロックに記述
- FileNotFoundExceptionを個別にキャッチ
- IOExceptionを個別にキャッチ
- Exceptionで上記以外のすべての例外をキャッチ
- より具体的な例外から順番に記述する


- mainメソッドを含め、System.out.printlnで各処理の実行結果を出力して動作確認できるようにする

## 使用するJava構文
- 複数のcatchブロック
- 例外の継承関係を考慮した順序（サブクラス→親クラス）
- 例外ごとの個別処理</code></pre>
                    </div>
                </div>
                <div class="code-block">
                    <div class="code-header"><span class="code-title">chapter11/MultiCatchDemo.java</span><span class="code-lang">Java</span></div>
                    <pre class="code-content"><code>public class MultiCatchDemo {
    public static void main(String[] args) {
        try {
            // 処理
        } catch (FileNotFoundException e) {
            System.out.println("ファイルが見つかりません");
        } catch (IOException e) {
            System.out.println("入出力エラー");
        } catch (Exception e) {
            System.out.println("その他のエラー");
        }
    }
}</code></pre>
                </div>
                <div class="syntax-box">
                    <div class="syntax-box-header">
                        <span class="syntax-box-icon"><span class="material-icons">menu_book</span></span>
                        <span class="syntax-box-title">構文説明</span>
                    </div>
                    <div class="syntax-box-content">
                        <div class="syntax-item">
                            <h4>複数のcatchブロック</h4>
                            <div class="syntax-pattern">try {
    // 処理
} catch (具体的な例外クラス1 e) {
    // 例外1の処理
} catch (具体的な例外クラス2 e) {
    // 例外2の処理
} catch (汎用的な例外クラス e) {
    // その他の例外の処理
}</div>
                            <p>複数のcatchブロックを連ねることで、異なる種類の例外に対して個別の処理を行えます。例外は上から順にマッチングされるため、サブクラス（より具体的な例外）を先に、親クラス（より汎用的な例外）を後に記述する必要があります。</p>
                        </div>
                    </div>
                </div>
                <div class="warning-box">
                    <div class="warning-box-header"><span class="warning-box-icon"><span class="material-icons">warning</span></span><span class="warning-box-title">catchの順序</span></div>
                    <p>より具体的な例外（サブクラス）を先に、汎用的な例外（親クラス）を後に記述します。順序を逆にするとコンパイルエラーになります。</p>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">2.3 multi-catch（Java 7以降）</h3>
                <div class="prompt-box">
                    <div class="prompt-box-header">
                        <span class="prompt-box-icon"><span class="material-icons">chat</span></span>
                        <span class="prompt-box-title">プロンプト</span>
                        <button class="prompt-copy-btn">コピー</button>
                    </div>
                    <div class="prompt-box-content">
                        <pre><code>## 機能
multi-catch構文で複数の例外を1つのcatchブロックで処理するサンプルプロジェクト

## 生成先
- ディレクトリ: chapter11
- ファイル名: MultiCatchPipeDemo.java

## 実装要件
- 複数の例外が発生する可能性のある処理をtryブロックに記述
- IOExceptionとSQLExceptionを1つのcatchブロックで処理
- パイプ（|）で例外クラスを連結する
- 共通のエラー処理を1箇所にまとめる


- mainメソッドを含め、System.out.printlnで各処理の実行結果を出力して動作確認できるようにする

## 使用するJava構文
- multi-catch（Java 7以降）
- パイプ演算子（|）による例外クラスの連結
- 共通の例外処理</code></pre>
                    </div>
                </div>
                <div class="code-block">
                    <div class="code-header"><span class="code-title">chapter11/MultiCatchPipeDemo.java</span><span class="code-lang">Java</span></div>
                    <pre class="code-content"><code>public class MultiCatchPipeDemo {
    public static void main(String[] args) {
        try {
            String text = null;
            text.length();  // NullPointerException
        } catch (NullPointerException | ArithmeticException e) {
            // 複数の例外を同じブロックで処理
            System.out.println("エラー: " + e.getMessage());
        }

        try {
            int result = 10 / 0;  // ArithmeticException
        } catch (NullPointerException | ArithmeticException e) {
            System.out.println("エラー: " + e.getMessage());
        }
    }
}</code></pre>
                </div>
                <div class="syntax-box">
                    <div class="syntax-box-header">
                        <span class="syntax-box-icon"><span class="material-icons">menu_book</span></span>
                        <span class="syntax-box-title">構文説明</span>
                    </div>
                    <div class="syntax-box-content">
                        <div class="syntax-item">
                            <h4>マルチキャッチ（catch (E1 | E2 e)）</h4>
                            <div class="syntax-pattern">try {
    // 処理
} catch (例外クラス1 | 例外クラス2 | 例外クラス3 e) {
    // 共通の例外処理
}</div>
                            <p>Java 7以降で導入されたマルチキャッチ構文です。パイプ（|）で複数の例外クラスを連結し、同じcatchブロックで処理できます。継承関係にない例外クラスを指定でき、コードの重複を減らせます。変数eは暗黙的にfinalとなり、再代入できません。</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- セクション 7-3 -->
        <section class="section">
            <div class="section-header">
                <span class="section-number">Section 16-3</span>
                <h2 class="section-title">try-with-resourcesによるリソースのクローズ</h2>
            </div>

            <div class="intro-text">
                <p>ファイルやデータベース接続などのリソースは、使用後に必ずクローズする必要があります。try-with-resources文を使えば、この処理を自動化でき、リソースリークを防げます。Java 7以降の標準的な書き方であり、現代のJava開発では必須の知識です。</p>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">3.1 try-with-resources</h3>
                <div class="content-block">
                    <p>AutoCloseableインタフェースを実装したリソースを自動的にクローズします。</p>
                    <div class="prompt-box">
                        <div class="prompt-box-header">
                            <span class="prompt-box-icon"><span class="material-icons">chat</span></span>
                            <span class="prompt-box-title">プロンプト</span>
                            <button class="prompt-copy-btn">コピー</button>
                        </div>
                        <div class="prompt-box-content">
                            <pre><code>## 機能
try-with-resources構文を使ったリソースの自動クローズを確認するサンプルプロジェクト

## 生成先
- ディレクトリ: chapter11
- ファイル名: TryWithResourcesDemo.java

## 実装要件
- 従来のtry-finally方式とtry-with-resources方式を比較
- BufferedReaderを使ったファイル読み込みの例を示す
- try-with-resourcesでは自動的にclose()が呼ばれることを示す
- 複数リソースを扱う場合の記述方法も示す


- mainメソッドを含め、System.out.printlnで各処理の実行結果を出力して動作確認できるようにする

## 使用するJava構文
- try-with-resources（Java 7以降）
- AutoCloseableインタフェース
- 複数リソースのセミコロン区切り宣言</code></pre>
                        </div>
                    </div>
                    <div class="code-block">
                        <div class="code-header"><span class="code-title">chapter11/TryWithResourcesDemo.java</span><span class="code-lang">Java</span></div>
                        <pre class="code-content"><code>class MyResource implements AutoCloseable {
    private String name;
    public MyResource(String name) {
        this.name = name;
        System.out.println(name + " を開きました");
    }
    public void use() {
        System.out.println(name + " を使用中");
    }
    @Override
    public void close() {
        System.out.println(name + " を閉じました");
    }
}

public class TryWithResourcesDemo {
    public static void main(String[] args) {
        // try-with-resources（Java 7以降）
        try (MyResource resource = new MyResource("リソースA")) {
            resource.use();
        }  // 自動的にclose()が呼ばれる

        System.out.println("---");

        // 複数のリソース（宣言の逆順でクローズ）
        try (
            MyResource r1 = new MyResource("リソース1");
            MyResource r2 = new MyResource("リソース2")
        ) {
            r1.use();
            r2.use();
        }
    }
}</code></pre>
                    </div>
                    <div class="syntax-box">
                        <div class="syntax-box-header">
                            <span class="syntax-box-icon"><span class="material-icons">menu_book</span></span>
                            <span class="syntax-box-title">構文説明</span>
                        </div>
                        <div class="syntax-box-content">
                            <div class="syntax-item">
                                <h4>try-with-resources文（try (Resource r = ...) { }）</h4>
                                <div class="syntax-pattern">// 単一リソース<br>try (リソース型 変数 = new リソース(...)) {<br>&nbsp;&nbsp;&nbsp;&nbsp;// リソースを使った処理<br>}<br>// tryブロック終了時に自動的にclose()が呼ばれる<br><br>// 複数リソース<br>try (<br>&nbsp;&nbsp;&nbsp;&nbsp;リソース型1 r1 = new リソース1(...);<br>&nbsp;&nbsp;&nbsp;&nbsp;リソース型2 r2 = new リソース2(...)<br>) {<br>&nbsp;&nbsp;&nbsp;&nbsp;// 処理<br>}</div>
                                <p>Java 7以降で導入されたリソース自動管理構文です。tryの括弧内でAutoCloseableインタフェースを実装したリソースを宣言すると、tryブロック終了時に自動的にclose()メソッドが呼ばれます。複数リソースはセミコロンで区切り、宣言の逆順でクローズされます。</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">3.2 try-with-resourcesの実行順</h3>
                <div class="content-block">
                    <ol class="numbered-list">
                        <li>tryブロックの処理が実行される</li>
                        <li>リソースのclose()が自動的に呼ばれる（宣言の逆順）</li>
                        <li>catchブロックが実行される（例外があれば）</li>
                        <li>finallyブロックが実行される（あれば）</li>
                    </ol>
                </div>
            </div>
        </section>

        <!-- セクション 7-4 -->
        <section class="section">
            <div class="section-header">
                <span class="section-number">Section 16-4</span>
                <h2 class="section-title">throwsによる例外の転送</h2>
            </div>

            <div class="intro-text">
                <p>すべての例外をその場で処理するのが適切とは限りません。throws宣言を使えば、例外の処理を呼び出し元に委ねることができます。これにより、例外処理の責任を適切な層に配置でき、コードの設計が柔軟になります。Spring Bootでは、Controllerで例外をまとめて処理するパターンがよく使われます。</p>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">4.1 throws</h3>
                <div class="content-block">
                    <p>メソッド内で処理せず、呼び出し元に例外を転送します。</p>
                    <div class="prompt-box">
                        <div class="prompt-box-header">
                            <span class="prompt-box-icon"><span class="material-icons">chat</span></span>
                            <span class="prompt-box-title">プロンプト</span>
                            <button class="prompt-copy-btn">コピー</button>
                        </div>
                        <div class="prompt-box-content">
                            <pre><code>## 機能
throws宣言を使って例外を呼び出し元に転送するサンプルプロジェクト

## 生成先
- ディレクトリ: chapter11
- ファイル名: ThrowsDemo.java

## 実装要件
- ファイルを読み込むreadFile()メソッドを作成
- throws IOExceptionでメソッドが例外をスローする可能性を宣言
- メソッド内では例外をキャッチせず、呼び出し元に委ねる
- 呼び出し側でtry-catchを使って例外を処理


- mainメソッドを含め、System.out.printlnで各処理の実行結果を出力して動作確認できるようにする

## 使用するJava構文
- throws宣言（メソッドシグネチャ）
- 検査例外の転送
- 呼び出し元での例外処理</code></pre>
                        </div>
                    </div>
                    <div class="code-block">
                        <div class="code-header"><span class="code-title">chapter11/ThrowsDemo.java</span><span class="code-lang">Java</span></div>
                        <pre class="code-content"><code>public class ThrowsDemo {
    // throwsで例外を呼び出し元に転送
    public static void validateAge(int age) throws IllegalArgumentException {
        if (age &lt; 0 || age &gt; 150) {
            throw new IllegalArgumentException("不正な年齢: " + age);
        }
        System.out.println("年齢 " + age + " は有効です");
    }

    public static void main(String[] args) {
        // 呼び出し側でtry-catchを使って例外を処理
        try {
            validateAge(25);
            validateAge(-5);
        } catch (IllegalArgumentException e) {
            System.out.println("エラー: " + e.getMessage());
        }
    }
}</code></pre>
                    </div>
                    <div style="background: #f8fafc; border: 2px solid #e2e8f0; border-radius: 12px; padding: 16px; margin: 16px 0; text-align: center;">
                        <div id="flow-throws"></div>
                    </div>
                    <div class="syntax-box">
                        <div class="syntax-box-header">
                            <span class="syntax-box-icon"><span class="material-icons">menu_book</span></span>
                            <span class="syntax-box-title">構文説明</span>
                        </div>
                        <div class="syntax-box-content">
                            <div class="syntax-item">
                                <h4>throws句（メソッド宣言にthrows XException）</h4>
                                <div class="syntax-pattern">アクセス修飾子 戻り値型 メソッド名(引数) throws 例外クラス1, 例外クラス2 {
    // 例外が発生する可能性のある処理
    // catchせずに呼び出し元に転送
}</div>
                                <p>throws句は、メソッドが特定の例外をスローする可能性があることを宣言します。検査例外（Checked Exception）をメソッド内でcatchしない場合、必ずthrows句で宣言する必要があります。複数の例外はカンマで区切って宣言できます。呼び出し側はこの例外をcatchするか、さらにthrowsで転送する必要があります。</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">4.2 throws指定されたメソッドのオーバーライド</h3>
                <div class="content-block">
                    <p>オーバーライド時のthrows制約：</p>
                    <ul class="bullet-list">
                        <li>同じ例外またはそのサブクラスをthrowsできる</li>
                        <li>例外を減らすまたは削除できる</li>
                        <li>新しい検査例外を追加できない</li>
                    </ul>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">4.3 例外の再スロー</h3>
                <div class="prompt-box">
                    <div class="prompt-box-header">
                        <span class="prompt-box-icon"><span class="material-icons">chat</span></span>
                        <span class="prompt-box-title">プロンプト</span>
                        <button class="prompt-copy-btn">コピー</button>
                    </div>
                    <div class="prompt-box-content">
                        <pre><code>## 機能
例外をキャッチした後に再スローするパターンを確認するサンプルプロジェクト

## 生成先
- ディレクトリ: chapter11
- ファイル名: RethrowDemo.java

## 実装要件
- catchブロックで例外をキャッチ後、ログ出力してから再スロー
- throwキーワードで同じ例外を再スロー
- 例外をラップして別の例外として再スローするパターンも示す
- 原因例外（cause）を保持してチェーンを構成


- mainメソッドを含め、System.out.printlnで各処理の実行結果を出力して動作確認できるようにする

## 使用するJava構文
- throw文（再スロー）
- 例外チェーン（cause）
- カスタム例外でのラップ</code></pre>
                    </div>
                </div>
                <div class="code-block">
                    <div class="code-header"><span class="code-title">chapter11/RethrowDemo.java</span><span class="code-lang">Java</span></div>
                    <pre class="code-content"><code>class AppException extends RuntimeException {
    public AppException(String message, Throwable cause) {
        super(message, cause);
    }
}

public class RethrowDemo {
    // 例外をキャッチしてログ出力後に再スロー
    public static void process() {
        try {
            int result = 10 / 0;
        } catch (ArithmeticException e) {
            System.out.println("ログ: " + e.getMessage());
            throw e;  // 再スロー
        }
    }

    // 例外をラップして再スロー（例外チェーン）
    public static void processWrapped() {
        try {
            String s = null;
            s.length();
        } catch (NullPointerException e) {
            throw new AppException("処理に失敗", e);  // 原因を保持
        }
    }

    public static void main(String[] args) {
        try {
            process();
        } catch (ArithmeticException e) {
            System.out.println("再スロー捕捉: " + e.getMessage());
        }

        try {
            processWrapped();
        } catch (AppException e) {
            System.out.println("ラップ例外: " + e.getMessage());
            System.out.println("原因: " + e.getCause().getClass().getSimpleName());
        }
    }
}</code></pre>
                </div>
                <div class="syntax-box">
                    <div class="syntax-box-header">
                        <span class="syntax-box-icon"><span class="material-icons">menu_book</span></span>
                        <span class="syntax-box-title">構文説明</span>
                    </div>
                    <div class="syntax-box-content">
                        <div class="syntax-item">
                            <h4>throw文（throw new Exception()）</h4>
                            <div class="syntax-pattern">// 新しい例外をスロー<br>throw new 例外クラス("エラーメッセージ");<br><br>// キャッチした例外を再スロー<br>catch (Exception e) {<br>&nbsp;&nbsp;&nbsp;&nbsp;// ログ出力などの処理<br>&nbsp;&nbsp;&nbsp;&nbsp;throw e;<br>}<br><br>// 例外をラップして再スロー（例外チェーン）<br>catch (Exception e) {<br>&nbsp;&nbsp;&nbsp;&nbsp;throw new CustomException("メッセージ", e);<br>}</div>
                            <p>throw文は例外を明示的にスローします。キャッチした例外をそのまま再スローする場合は「throw e;」と記述します。別の例外でラップする場合は、コンストラクタの第2引数に原因例外（cause）を渡すことで、例外チェーンを構成できます。これにより、元のスタックトレースを保持したまま、より適切な例外型で伝播できます。</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 練習問題・解答 -->
        <section class="section">
            <div class="section-header"><span class="section-number">Exercise</span><h2 class="section-title">16章 練習問題</h2></div>
            <div class="exercise-list">
                <div class="exercise-item">
                    <div class="exercise-number">Q1</div>
                    <div class="exercise-content">
                        <p>検査例外（Checked Exception）として正しいものはどれですか？</p>
                        <ol type="A"><li>NullPointerException</li><li>ArrayIndexOutOfBoundsException</li><li>IOException</li><li>ArithmeticException</li></ol>
                    </div>
                </div>
                <div class="exercise-item">
                    <div class="exercise-number">Q2</div>
                    <div class="exercise-content">
                        <p>try-with-resourcesで自動的にclose()が呼ばれるために必要なインタフェースは？</p>
                        <ol type="A"><li>Closeable</li><li>AutoCloseable</li><li>Serializable</li><li>Comparable</li></ol>
                    </div>
                </div>
                <div class="exercise-item">
                    <div class="exercise-number">Q3</div>
                    <div class="exercise-content">
                        <p>以下のコードの出力は何ですか？</p>
                        <div class="code-block">
                            <pre class="code-content"><code>try {
    System.out.println("A");
    throw new RuntimeException();
} catch (RuntimeException e) {
    System.out.println("B");
} finally {
    System.out.println("C");
}</code></pre>
                        </div>
                        <ol type="A"><li>A</li><li>A B</li><li>A B C</li><li>A C</li></ol>
                    </div>
                </div>
            </div>
        </section>

        <section class="section">
            <div class="section-header"><span class="section-number">Answer</span><h2 class="section-title">16章 解説・解答</h2></div>
            <div class="answer-list">
                <div class="answer-item">
                    <div class="answer-header">Q1の解答: C</div>
                    <div class="answer-content"><p>IOExceptionは検査例外です。他の選択肢はすべてRuntimeExceptionのサブクラス（非検査例外）です。</p></div>
                </div>
                <div class="answer-item">
                    <div class="answer-header">Q2の解答: B</div>
                    <div class="answer-content"><p>AutoCloseableインタフェースを実装したリソースがtry-with-resourcesで自動クローズされます。CloseableはAutoCloseableを継承しています。</p></div>
                </div>
                <div class="answer-item">
                    <div class="answer-header">Q3の解答: C</div>
                    <div class="answer-content"><p>「A」が出力され、例外がスローされ、catchで「B」が出力され、finallyは必ず実行されるので「C」が出力されます。</p></div>
                </div>
            </div>
        </section>
    </div>

    <footer class="footer"><p>Java Silver 試験対策 教科書</p></footer>

    <div class="page-nav">
        <a href="15java-collection.html" class="page-nav-btn prev"><span>&#8592;</span><div><div class="page-nav-label">前の章</div><div class="page-nav-title">第15章</div></div></a>
        <a href="17java-maven.html" class="page-nav-btn next"><div><div class="page-nav-label">次の章</div><div class="page-nav-title">第17章</div></div><span>&#8594;</span></a>
    </div>

    <script>
        function toggleMenu() {
            const toggle = document.querySelector('.nav-toggle');
            const menu = document.querySelector('.nav-menu');
            toggle.classList.toggle('active');
            menu.classList.toggle('active');
        }
        document.addEventListener('click', function(e) {
            const nav = document.querySelector('.global-nav');
            const toggle = document.querySelector('.nav-toggle');
            const menu = document.querySelector('.nav-menu');
            if (!nav.contains(e.target) && menu.classList.contains('active')) {
                toggle.classList.remove('active');
                menu.classList.remove('active');
            }
        });
    </script>
    <script src="../../shared/demo.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.3.0/raphael.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flowchart/1.17.1/flowchart.min.js"></script>
    <script>
    const flowOpts = {
        'line-width': 2,
        'line-color': '#64748b',
        'element-color': '#64748b',
        'font-family': '"Noto Sans JP", sans-serif',
        'font-size': 14,
        'font-color': '#1e293b',
        'fill': '#dbeafe',
        'yes-text': 'true',
        'no-text': 'false',
        'flowstate': {
            start: { 'fill': '#1e293b', 'font-color': '#fff', 'element-color': '#1e293b' },
            end: { 'fill': '#1e293b', 'font-color': '#fff', 'element-color': '#1e293b' },
            process: { 'fill': '#dbeafe', 'element-color': '#3b82f6', 'font-color': '#1e40af' },
            condition: { 'fill': '#fef3c7', 'element-color': '#f59e0b', 'font-color': '#92400e' },
            output: { 'fill': '#dcfce7', 'element-color': '#22c55e', 'font-color': '#166534' },
            error: { 'fill': '#fef2f2', 'element-color': '#ef4444', 'font-color': '#991b1b' },
            fin: { 'fill': '#f3e8ff', 'element-color': '#a855f7', 'font-color': '#6b21a8' }
        }
    };

    // ExceptionDemo - try-catch flow
    flowchart.parse(`st=>start: 開始|start
op1=>operation: tryブロック実行|process
cond1=>condition: 例外発生？|condition
op2=>operation: 正常終了|output
err1=>operation: ArrayIndexOut
OfBoundsException|error
err2=>operation: NullPointer
Exception|error
err3=>operation: Arithmetic
Exception|error
op3=>operation: catchブロック実行|process
op4=>operation: エラーメッセージ出力|output
e=>end: 次の処理へ|end

st->op1->cond1
cond1(yes)->op3->op4->e
cond1(no)->op2->e`).drawSVG('flow-exception', flowOpts);

    // TryCatchDemo - try-catch-finally flow
    flowchart.parse(`st=>start: 開始|start
op1=>operation: tryブロック実行|process
cond1=>condition: 例外発生？|condition
op2=>operation: 正常処理|output
op3=>operation: catchブロック
例外処理|error
op4=>operation: finallyブロック
（必ず実行）|fin
e=>end: 終了|end

st->op1->cond1
cond1(yes)->op3->op4->e
cond1(no)->op2->op4`).drawSVG('flow-trycatch', flowOpts);

    // ThrowsDemo - throws + validation
    flowchart.parse(`st=>start: main() 開始|start
op1=>operation: try: validateAge(15)|process
cond1=>condition: age < 0 ?|condition
op2=>operation: throw
IllegalArgumentException|error
cond2=>condition: age < 18 ?|condition
op3=>operation: throw
ArithmeticException|error
op4=>operation: println: 有効な年齢|output
op5=>operation: catch: 例外処理|process
e=>end: 終了|end

st->op1->cond1
cond1(yes)->op2->op5->e
cond1(no)->cond2
cond2(yes)->op3->op5->e
cond2(no)->op4->e`).drawSVG('flow-throws', flowOpts);
    </script>
</body>
</html>
