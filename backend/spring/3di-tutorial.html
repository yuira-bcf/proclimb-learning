<!doctype html>
<html lang="ja">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>第3章 Spring Frameworkのコア機能（DI）を知ろう</title>

        <link
            href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700;900&family=JetBrains+Mono:wght@400;500;600&family=M+PLUS+Rounded+1c:wght@400;500;700&display=swap"
            rel="stylesheet"
        />
        <link rel="stylesheet" href="../../shared/common.css" />
        <style>
            :root {
                --primary: #0097A7;
                --primary-dark: #00838F;
                --primary-light: #E0F7FA;
                --primary-lighter: #B2EBF2;
            }
            .nav-category-links { display: none; }
        </style>
    </head>
    <body>
        <!-- グローバルナビゲーション -->
        <nav class="global-nav"></nav>
        <script src="../../shared/js/nav-spring.js"></script>

        <div class="container">
            <!-- ヘッダー -->
            <header class="chapter-header">
                <div class="chapter-badge">📘 Chapter</div>
                <div class="chapter-number">3</div>
                <h1 class="chapter-title">Spring Frameworkの<br />コア機能（DI）を知ろう</h1>
            </header>

            <nav class="toc">
                <h2 class="toc-title">📑 この章で学ぶこと</h2>
                <ul class="toc-list">
                    <li class="toc-item">
                        <span class="toc-number">3-1</span>
                        <span>Spring Frameworkのコア機能の概要</span>
                    </li>
                    <li class="toc-item">
                        <span class="toc-number">3-2</span>
                        <span>DIについて知ろう</span>
                    </li>
                    <li class="toc-item">
                        <span class="toc-number">3-3</span>
                        <span>DIについて知ろう（インスタンス生成）</span>
                    </li>
                    <li class="toc-item">
                        <span class="toc-number">3-4</span>
                        <span>DIについて知ろう（インジェクション）</span>
                    </li>
                </ul>
            </nav>
            <!-- Section 3-2 -->
            <section class="section">
                <div class="section-header">
                    <span class="section-number">Section 3-2</span>
                    <h2 class="section-title">DIについて知ろう</h2>
                </div>

                <p>
                    「<a href="2java_basics.html#section-2-1" style="color: #0ea5e9; text-decoration: underline;">2-1 Javaの基礎知識を復習しよう</a>」では、実装クラス（BクラスやCクラス）を切り替える時の修正箇所について学びました。
                </p>

                <div class="highlight-box" style="background: #fef3c7; border-left: 4px solid #f59e0b;">
                    <p class="no-margin" style="font-size: 0.95em;">
                        <strong>📝 2-1の復習</strong><br />
                        BクラスからCクラスに切り替える場合の修正箇所数：
                    </p>
                    <ul style="margin: 8px 0 0 0; padding-left: 20px; font-size: 0.9em;">
                        <li><strong>クラス依存</strong>：3箇所の修正が必要（変数宣言、インスタンス生成、メソッド引数）</li>
                        <li><strong>インターフェース依存</strong>：1箇所の修正が必要（インスタンス生成部分のみ）</li>
                    </ul>
                </div>

                <p>
                    実は<strong>「Dependency Injection：依存性の注入」</strong>（略して<strong>「DI」</strong>）という仕組みを使うと、<br />
                    なんと修正箇所を<strong style="color: #dc2626; font-size: 1.1em;">「ゼロ」</strong>にすることができます！
                </p>

                <h3>3-2-1 DIコンテナとは何か</h3>

                <p>
                    まず、<strong>「DI（依存性の注入）」</strong>の仕組みを理解するために、具体例で考えてみましょう。
                </p>

                <h4>■ 従来の方法（newを使う場合）</h4>

                <p>
                    これまでは、以下のように<strong>自分で</strong> <code>new</code> を使ってインスタンスを生成していました。
                </p>

                <div class="code-block">
                    <div class="code-header">
                        <div class="code-dots">
                            <span class="code-dot red"></span>
                            <span class="code-dot yellow"></span>
                            <span class="code-dot green"></span>
                        </div>
                        <span class="code-title">従来の方法（newを使う）</span>
                    </div>
                    <div class="code-content">
                        <pre><span class="code-keyword">public class</span> <span class="code-class">GreetingController</span> {
    <span class="code-keyword">private</span> <span class="code-class">Greet</span> greet;

    <span class="code-keyword">public</span> <span class="code-class">GreetingController</span>() {
        <span class="code-keyword">this</span>.greet = <span style="background: #fecaca; color: #dc2626; padding: 2px 6px; border-radius: 4px; font-weight: 600;">new B()</span>;  <span class="code-comment">// ← 自分でBクラスのインスタンスを生成</span>
    }
}</pre>
                    </div>
                </div>

                <div class="highlight-box" style="background: #fef2f2; border-left: 4px solid #dc2626;">
                    <p style="margin: 0 0 12px 0;">
                        <strong style="color: #dc2626;">❌ この方法の問題点</strong>
                    </p>
                    <p style="margin: 0 0 8px 0;">
                        BクラスからCクラスに変更したい場合、<code>new B()</code> の部分を <code>new C()</code> に<strong>書き換える必要があります</strong>。
                    </p>
                    <p class="no-margin" style="font-size: 0.9em; color: #7f1d1d;">
                        <strong>なぜこれが問題なのか？</strong>
                    </p>
                    <ul style="margin: 8px 0 0 0; padding-left: 20px; font-size: 0.9em; color: #7f1d1d;">
                        <li><strong>修正箇所が発生する</strong>：コードを変更する必要があり、修正ミスのリスクがある</li>
                        <li><strong>複数箇所で使っている場合、全て修正が必要</strong>：例えば10個のクラスで使っていたら10箇所の修正</li>
                        <li><strong>再テストが必要</strong>：コードを変更したため、動作確認とテストが必要</li>
                        <li><strong>密結合</strong>：GreetingControllerがBクラスの存在を知っている状態（変更に弱い設計）</li>
                    </ul>
                </div>

                <h4>■ DIを使う方法（インスタンスを渡してもらう）</h4>

                <p>
                    DIでは、インスタンスの生成を<strong>「DIコンテナ」という機能に任せます</strong>。<br />
                    自分では <code>new</code> せず、すでに生成されたインスタンスを<strong>渡してもらう</strong>だけです。
                </p>

                <div class="code-block">
                    <div class="code-header">
                        <div class="code-dots">
                            <span class="code-dot red"></span>
                            <span class="code-dot yellow"></span>
                            <span class="code-dot green"></span>
                        </div>
                        <span class="code-title">DIを使う方法（インスタンスを渡してもらう）</span>
                    </div>
                    <div class="code-content">
                        <pre><span class="code-keyword">public class</span> <span class="code-class">GreetingController</span> {
    <span style="background: #dbeafe; color: #1e40af; padding: 2px 6px; border-radius: 4px; font-weight: 600;">@Autowired</span>  <span class="code-comment">// ← DIコンテナに「インスタンスを渡してください」と依頼</span>
    <span class="code-keyword">private</span> <span class="code-class">Greet</span> greet;

    <span class="code-comment">// コンストラクタで new しない！</span>
    <span class="code-comment">// DIコンテナが自動的にインスタンスをセットしてくれる</span>
}</pre>
                    </div>
                </div>

                <p>
                    この方法なら、BクラスからCクラスに変更したい場合でも、<br />
                    <strong>このクラス（GreetingController）は一切変更不要</strong>です！
                </p>

                <h4>■ DIコンテナの役割</h4>

                <p>
                    <strong>DIコンテナ</strong>とは、Spring Frameworkが提供する<strong>「インスタンス管理機能」</strong>です。<br />
                    以下の2つの役割を自動的に行ってくれます。
                </p>

                <div class="highlight-box">
                    <p>
                        <strong>① インスタンスの生成</strong><br />
                        アプリケーション起動時に、必要なクラスのインスタンスを <code>new</code> で生成してメモリ上に保持する
                    </p>
                    <div style="margin: 12px 0; padding: 12px; background: #f8fafc; border-radius: 6px; border: 1px solid #e2e8f0;">
                        <p style="margin: 0 0 4px 0; font-size: 0.85em; color: #64748b;">イメージ（DIコンテナ内部で実行される処理）</p>
                        <code style="font-size: 0.9em; color: #1e293b;">Greet greet = new B();  // Bクラスのインスタンスを生成</code>
                    </div>
                    <p style="margin-bottom: 0">
                        <strong>② インスタンスの配布</strong><br />
                        <code>@Autowired</code> が付いているフィールドに、①で生成したインスタンスを渡す
                    </p>
                    <div style="margin: 12px 0; padding: 12px; background: #f8fafc; border-radius: 6px; border: 1px solid #e2e8f0;">
                        <p style="margin: 0 0 4px 0; font-size: 0.85em; color: #64748b;">イメージ（DIコンテナ内部で実行される処理）</p>
                        <code style="font-size: 0.9em; color: #1e293b;">controller.greet = greet;  // フィールドに値を入れる</code>
                    </div>
                </div>

                <div class="highlight-box" style="background: #eff6ff; border-left: 4px solid #3b82f6;">
                    <p style="margin: 0 0 12px 0;">
                        <strong style="color: #1e40af;">✅ まとめ：「依存性の注入（DI）」とは？</strong>
                    </p>
                    <p style="margin: 0 0 16px 0; font-size: 0.95em; line-height: 1.8;">
                        他のクラスのインスタンスが必要な箇所に、<br />
                        <strong style="color: #1e40af;">DIコンテナ（Spring Framework）が自動的に値を入れてくれる仕組み</strong>のことです。
                    </p>

                    <div style="background: white; border-radius: 8px; padding: 16px; border: 2px solid #bfdbfe;">
                        <p style="margin: 0 0 8px 0; font-size: 0.9em; font-weight: 600; color: #1e40af;">比較：誰が値を入れるのか？</p>
                        <table style="width: 100%; border-collapse: collapse; font-size: 0.85em;">
                            <tr style="background: #f8fafc;">
                                <th style="padding: 8px; text-align: left; border: 1px solid #e2e8f0; width: 25%;">方法</th>
                                <th style="padding: 8px; text-align: left; border: 1px solid #e2e8f0; width: 35%;">誰が値を入れるか</th>
                                <th style="padding: 8px; text-align: left; border: 1px solid #e2e8f0;">コード例</th>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid #e2e8f0; font-weight: 600;">従来の方法</td>
                                <td style="padding: 8px; border: 1px solid #e2e8f0;"><strong style="color: #dc2626;">自分で</strong>値を入れる</td>
                                <td style="padding: 8px; border: 1px solid #e2e8f0;"><code style="color: #dc2626;">this.greet = new B();</code></td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid #e2e8f0; font-weight: 600;">DIを使う方法</td>
                                <td style="padding: 8px; border: 1px solid #e2e8f0;"><strong style="color: #22c55e;">DIコンテナが</strong>値を入れる</td>
                                <td style="padding: 8px; border: 1px solid #e2e8f0;"><code style="color: #22c55e;">@Autowired private Greet greet;</code></td>
                            </tr>
                        </table>
                    </div>
                </div>

                <div class="info-box" style="background: #E0F7FA; border-left: 4px solid #22c55e; padding: 12px 16px; margin: 16px 0;">
                    <p style="margin: 0 0 12px 0; font-size: 0.95em;">
                        <strong>💡 用語の整理</strong>
                    </p>
                    <div style="margin-bottom: 12px;">
                        <p style="margin: 0 0 4px 0; font-size: 0.9em;"><strong>依存性</strong></p>
                        <p style="margin: 0 0 8px 0; padding-left: 12px; font-size: 0.85em; color: #374151;">
                            あるクラスが別のクラスのインスタンスを使っている状態<br />
                            <span style="color: #64748b;">例：GreetingControllerがGreetインターフェースを使っている</span>
                        </p>
                    </div>
                    <div style="margin-bottom: 12px;">
                        <p style="margin: 0 0 4px 0; font-size: 0.9em;"><strong>注入（インジェクション）</strong></p>
                        <p style="margin: 0 0 4px 0; padding-left: 12px; font-size: 0.85em; color: #374151;">
                            DIコンテナが変数に値を入れること
                        </p>
                        <div class="no-margin" style="padding: 8px 12px; background: #f8fafc; border-radius: 4px; border: 1px solid #e2e8f0;">
                            <p style="margin: 0 0 4px 0; font-size: 0.8em; color: #64748b;">具体的には、こういうイメージ：</p>
                            <code style="font-size: 0.85em; color: #1e293b; display: block; margin-bottom: 2px;">// 自分で入れる場合（従来）</code>
                            <code style="font-size: 0.85em; color: #dc2626; display: block; margin-bottom: 6px;">this.greet = new B();</code>
                            <code style="font-size: 0.85em; color: #1e293b; display: block; margin-bottom: 2px;">// DIコンテナが入れてくれる場合（DI）</code>
                            <code style="font-size: 0.85em; color: #22c55e; display: block;">controller.greet = 生成済みインスタンス;</code>
                            <p style="margin: 6px 0 0 0; font-size: 0.75em; color: #64748b;">
                                ↑ この処理をDIコンテナが自動的にやってくれる
                            </p>
                        </div>
                    </div>
                    <div style="margin-bottom: 0;">
                        <p style="margin: 0 0 4px 0; font-size: 0.9em;"><strong>DIコンテナ</strong></p>
                        <p class="no-margin" style="padding-left: 12px; font-size: 0.85em; color: #374151;">
                            インスタンスを生成・管理・配布する機能<br />
                            <span style="color: #64748b;">Spring Frameworkが提供する「自動的にnewして値を入れてくれる仕組み」</span>
                        </p>
                    </div>
                </div>

                <!-- メモリの観点での図解 -->
                <div class="diagram-container">
                    <div class="diagram-title">図3.3a 従来の方法（自分でnewする）</div>
                    <svg class="diagram-svg" viewBox="0 0 700 270" width="700" height="270">
                        <!-- タイトル -->
                        <text x="350" y="28" text-anchor="middle" font-size="13" font-weight="bold" fill="#dc2626">❌ 問題点：コードに「new B()」が直接書かれている</text>

                        <!-- ステップ1：クラス内でnew -->
                        <rect x="30" y="60" width="200" height="120" rx="8" fill="#fef2f2" stroke="#dc2626" stroke-width="3"/>
                        <text x="130" y="85" text-anchor="middle" font-size="13" font-weight="bold" fill="#dc2626">GreetingController</text>

                        <!-- コード表示 -->
                        <rect x="45" y="95" width="170" height="70" rx="4" fill="white" stroke="#fca5a5" stroke-width="1"/>
                        <text x="130" y="115" text-anchor="middle" font-size="11" font-family="monospace" fill="#1e293b">public class ... {</text>
                        <text x="130" y="132" text-anchor="middle" font-size="11" font-family="monospace" fill="#1e293b">  Greet g = </text>
                        <text x="130" y="148" text-anchor="middle" font-size="12" font-family="monospace" font-weight="bold" fill="#dc2626">new B()</text>
                        <text x="130" y="160" text-anchor="middle" font-size="11" font-family="monospace" fill="#1e293b">}</text>

                        <!-- 問題点の吹き出し -->
                        <rect x="250" y="58" width="180" height="75" rx="8" fill="#fee2e2" stroke="#dc2626" stroke-width="2"/>
                        <text x="340" y="80" text-anchor="middle" font-size="11" font-weight="bold" fill="#dc2626">Bに依存している</text>
                        <text x="340" y="97" text-anchor="middle" font-size="10" fill="#7f1d1d">Cクラスに変更したい場合</text>
                        <text x="340" y="112" text-anchor="middle" font-size="10" fill="#7f1d1d">この部分を修正する必要</text>
                        <text x="340" y="125" text-anchor="middle" font-size="10" font-weight="bold" fill="#dc2626">→ 修正箇所が発生！</text>

                        <!-- 矢印 -->
                        <path d="M230 98 L250 98" stroke="#dc2626" stroke-width="2" fill="none" marker-end="url(#arrowhead-red)"/>

                        <!-- ステップ2：new実行 -->
                        <text x="130" y="205" text-anchor="middle" font-size="11" font-weight="600" fill="#64748b">① 自分でnewを実行</text>
                        <path d="M230 175 L470 175" stroke="#dc2626" stroke-width="3" fill="none" marker-end="url(#arrowhead-red-big)"/>
                        <text x="350" y="165" text-anchor="middle" font-size="12" font-weight="bold" fill="#dc2626">new B()</text>

                        <!-- ヒープメモリ -->
                        <rect x="490" y="60" width="180" height="120" rx="8" fill="#f8fafc" stroke="#64748b" stroke-width="2" stroke-dasharray="4"/>
                        <text x="580" y="82" text-anchor="middle" font-size="11" font-weight="bold" fill="#64748b">ヒープメモリ</text>

                        <!-- インスタンス -->
                        <rect x="510" y="95" width="140" height="60" rx="6" fill="#10b981" stroke="#059669" stroke-width="2"/>
                        <text x="580" y="120" text-anchor="middle" font-size="12" font-weight="bold" fill="white">Bのインスタンス</text>
                        <text x="580" y="140" text-anchor="middle" font-size="10" fill="#d1fae5">アドレス: 0x1234</text>

                        <text x="580" y="205" text-anchor="middle" font-size="11" font-weight="600" fill="#64748b">② g変数に値を入れる</text>

                        <!-- 変数への参照 -->
                        <path d="M130 180 L130 225 L480 225 L480 140 L510 140" stroke="#64748b" stroke-width="2" stroke-dasharray="5,5" fill="none"/>
                        <text x="300" y="245" text-anchor="middle" font-size="10" fill="#64748b">g変数が持つ参照（アドレス）</text>

                        <defs>
                            <marker id="arrowhead-red" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#dc2626"/>
                            </marker>
                            <marker id="arrowhead-red-big" markerWidth="12" markerHeight="9" refX="11" refY="4.5" orient="auto">
                                <polygon points="0 0, 12 4.5, 0 9" fill="#dc2626"/>
                            </marker>
                        </defs>
                    </svg>
                </div>

                <div class="diagram-container">
                    <div class="diagram-title">図3.3b DIを使う方法（DIコンテナに任せる）</div>
                    <svg class="diagram-svg" viewBox="0 0 700 300" width="700" height="300">
                        <!-- タイトル -->
                        <text x="350" y="25" text-anchor="middle" font-size="13" font-weight="bold" fill="#22c55e">✅ 解決：DIコンテナが自動的にインスタンスを生成・配布</text>

                        <!-- DIコンテナ -->
                        <rect x="30" y="50" width="180" height="100" rx="8" fill="#dbeafe" stroke="#3b82f6" stroke-width="3"/>
                        <text x="120" y="75" text-anchor="middle" font-size="13" font-weight="bold" fill="#1d4ed8">DIコンテナ</text>
                        <text x="120" y="93" text-anchor="middle" font-size="10" fill="#1e40af">(Spring Framework)</text>

                        <rect x="45" y="105" width="150" height="35" rx="4" fill="#eff6ff" stroke="#93c5fd" stroke-width="1"/>
                        <text x="120" y="120" text-anchor="middle" font-size="10" fill="#1e40af">@Componentをスキャン</text>
                        <text x="120" y="133" text-anchor="middle" font-size="10" fill="#1e40af">して自動的にnew実行</text>

                        <!-- ステップ1：DIコンテナがnew -->
                        <text x="120" y="170" text-anchor="middle" font-size="11" font-weight="600" fill="#64748b">① DIコンテナがnewを実行</text>
                        <path d="M210 100 L320 100" stroke="#3b82f6" stroke-width="3" fill="none" marker-end="url(#arrowhead-blue-big)"/>
                        <text x="265" y="90" text-anchor="middle" font-size="12" font-weight="bold" fill="#3b82f6">new B()</text>

                        <!-- ヒープメモリ -->
                        <rect x="340" y="50" width="160" height="100" rx="8" fill="#f8fafc" stroke="#64748b" stroke-width="2" stroke-dasharray="4"/>
                        <text x="420" y="72" text-anchor="middle" font-size="11" font-weight="bold" fill="#64748b">ヒープメモリ</text>

                        <!-- インスタンス -->
                        <rect x="360" y="85" width="120" height="50" rx="6" fill="#10b981" stroke="#059669" stroke-width="2"/>
                        <text x="420" y="108" text-anchor="middle" font-size="12" font-weight="bold" fill="white">Bのインスタンス</text>
                        <text x="420" y="125" text-anchor="middle" font-size="10" fill="#d1fae5">0x1234</text>

                        <!-- ステップ2：DIコンテナが値を入れる -->
                        <text x="420" y="170" text-anchor="middle" font-size="11" font-weight="600" fill="#64748b">② DIコンテナが値を入れる</text>

                        <path d="M420 150 L420 180 L540 180" stroke="#22c55e" stroke-width="3" fill="none" marker-end="url(#arrowhead-green-big)"/>
                        <rect x="340" y="185" width="160" height="35" rx="6" fill="#dcfce7" stroke="#22c55e" stroke-width="2"/>
                        <text x="420" y="203" text-anchor="middle" font-size="10" font-weight="bold" fill="#166534">controller.greet</text>
                        <text x="420" y="215" text-anchor="middle" font-size="10" fill="#166534">= 0x1234 を実行</text>

                        <!-- 使う側クラス -->
                        <rect x="560" y="50" width="120" height="170" rx="8" fill="#E0F7FA" stroke="#22c55e" stroke-width="3"/>
                        <text x="620" y="75" text-anchor="middle" font-size="12" font-weight="bold" fill="#166534">Greeting</text>
                        <text x="620" y="90" text-anchor="middle" font-size="12" font-weight="bold" fill="#166534">Controller</text>

                        <!-- コード表示 -->
                        <rect x="572" y="100" width="96" height="110" rx="4" fill="white" stroke="#86efac" stroke-width="1"/>
                        <text x="620" y="118" text-anchor="middle" font-size="10" font-family="monospace" fill="#1e293b">class ... {</text>
                        <text x="620" y="135" text-anchor="middle" font-size="10" font-family="monospace" font-weight="bold" fill="#22c55e">@Autowired</text>
                        <text x="620" y="150" text-anchor="middle" font-size="10" font-family="monospace" fill="#1e293b">Greet g;</text>
                        <text x="620" y="175" text-anchor="middle" font-size="9" fill="#64748b">new不要!</text>
                        <text x="620" y="188" text-anchor="middle" font-size="9" fill="#64748b">DIコンテナが</text>
                        <text x="620" y="200" text-anchor="middle" font-size="9" fill="#64748b">値を入れる</text>

                        <!-- ステップ3：完了 -->
                        <text x="620" y="240" text-anchor="middle" font-size="11" font-weight="600" fill="#64748b">③ 値が入った状態で</text>
                        <text x="620" y="255" text-anchor="middle" font-size="11" font-weight="600" fill="#64748b">使用可能</text>

                        <!-- メリットの吹き出し -->
                        <rect x="30" y="240" width="300" height="50" rx="8" fill="#dcfce7" stroke="#22c55e" stroke-width="2"/>
                        <text x="180" y="260" text-anchor="middle" font-size="11" font-weight="bold" fill="#166534">✅ メリット：BからCに変更する場合</text>
                        <text x="180" y="277" text-anchor="middle" font-size="10" fill="#166534">このクラス（GreetingController）は変更不要！</text>

                        <defs>
                            <marker id="arrowhead-blue-big" markerWidth="12" markerHeight="9" refX="11" refY="4.5" orient="auto">
                                <polygon points="0 0, 12 4.5, 0 9" fill="#3b82f6"/>
                            </marker>
                            <marker id="arrowhead-green-big" markerWidth="12" markerHeight="9" refX="11" refY="4.5" orient="auto">
                                <polygon points="0 0, 12 4.5, 0 9" fill="#22c55e"/>
                            </marker>
                        </defs>
                    </svg>
                </div>

                <div class="highlight-box" style="background: #E0F7FA; border-left: 4px solid #22c55e; padding: 16px 20px; margin: 20px 0;">
                    <p style="margin: 0 0 16px 0;">
                        <strong style="color: #166534; font-size: 1.05em;">✅ DIの最大のメリット</strong>
                    </p>

                    <div style="background: white; border-radius: 8px; padding: 16px; margin-bottom: 16px; border: 2px solid #86efac;">
                        <p style="margin: 0 0 12px 0; font-weight: 600; color: #166534;">DIでは<code>new</code>を使わないため、コードに実装クラス名が登場しない</p>
                        <table style="width: 100%; border-collapse: collapse; font-size: 0.9em;">
                            <tr style="background: #f8fafc;">
                                <th style="padding: 8px; text-align: left; border: 1px solid #e2e8f0; width: 30%;">方法</th>
                                <th style="padding: 8px; text-align: left; border: 1px solid #e2e8f0;">コードに書かれる内容</th>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid #e2e8f0; font-weight: 600;">従来（new使用）</td>
                                <td style="padding: 8px; border: 1px solid #e2e8f0;">
                                    <code style="color: #dc2626;">Greet g = new B();</code><br />
                                    <span style="font-size: 0.85em; color: #64748b;">→ 実装クラス名「B」が直接書かれている</span>
                                </td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid #e2e8f0; font-weight: 600;">DI使用</td>
                                <td style="padding: 8px; border: 1px solid #e2e8f0;">
                                    <code style="color: #22c55e;">@Autowired Greet g;</code><br />
                                    <span style="font-size: 0.85em; color: #64748b;">→ インターフェース名「Greet」のみで、BもCも登場しない</span>
                                </td>
                            </tr>
                        </table>
                    </div>

                    <div style="background: #dcfce7; border-radius: 8px; padding: 14px; border: 2px solid #86efac;">
                        <p style="margin: 0 0 10px 0; font-weight: 600; color: #166534;">🎯 BクラスからCクラスに変更する場合</p>
                        <div style="display: grid; grid-template-columns: auto 1fr; gap: 8px; font-size: 0.9em;">
                            <div style="color: #dc2626; font-weight: 600;">従来の方法：</div>
                            <div style="color: #7f1d1d;">GreetingControllerのコードを修正（<code>new B()</code> → <code>new C()</code>）</div>

                            <div style="color: #22c55e; font-weight: 600;">DIを使う方法：</div>
                            <div style="color: #166534;">
                                <strong>GreetingControllerは変更不要！</strong><br />
                                Bクラスの<code>@Component</code>を削除して、Cクラスに<code>@Component</code>を付けるだけ
                            </div>
                        </div>
                    </div>
                </div>

                <div class="diagram-container">
                    <div class="diagram-title">図3.3c 実装クラスの切り替え（@Componentの付け替えだけ）</div>
                    <svg class="diagram-svg" viewBox="0 0 750 455" width="750" height="455">
                        <!-- タイトル -->
                        <text x="375" y="25" text-anchor="middle" font-size="13" font-weight="bold" fill="#1e293b">BクラスからCクラスに切り替える手順</text>

                        <!-- ========== BEFORE（変更前） ========== -->
                        <rect x="20" y="45" width="710" height="155" rx="8" fill="#fef2f2" stroke="#dc2626" stroke-width="2"/>
                        <text x="35" y="65" font-size="12" font-weight="bold" fill="#dc2626">変更前：Bクラスが使われている状態</text>

                        <!-- GreetingController -->
                        <rect x="40" y="80" width="140" height="100" rx="8" fill="#E0F7FA" stroke="#22c55e" stroke-width="3"/>
                        <text x="110" y="100" text-anchor="middle" font-size="11" font-weight="bold" fill="#166534">GreetingController</text>
                        <rect x="50" y="110" width="120" height="55" rx="4" fill="white" stroke="#86efac" stroke-width="1"/>
                        <text x="110" y="128" text-anchor="middle" font-size="10" font-family="monospace" fill="#22c55e">@Autowired</text>
                        <text x="110" y="145" text-anchor="middle" font-size="10" font-family="monospace" fill="#1e293b">Greet g;</text>
                        <text x="110" y="158" text-anchor="middle" font-size="8" fill="#64748b">変更不要！</text>

                        <!-- 矢印 -->
                        <path d="M180 130 L230 130" stroke="#3b82f6" stroke-width="2" fill="none" marker-end="url(#arrowhead-component-blue)"/>

                        <!-- DIコンテナ -->
                        <rect x="230" y="80" width="120" height="100" rx="8" fill="#dbeafe" stroke="#3b82f6" stroke-width="2"/>
                        <text x="290" y="100" text-anchor="middle" font-size="11" font-weight="bold" fill="#1d4ed8">DIコンテナ</text>
                        <text x="290" y="122" text-anchor="middle" font-size="9" fill="#1e40af">@Componentを</text>
                        <text x="290" y="138" text-anchor="middle" font-size="9" fill="#1e40af">スキャン</text>
                        <text x="290" y="160" text-anchor="middle" font-size="9" fill="#22c55e" font-weight="600">→ B発見</text>

                        <!-- 矢印 -->
                        <path d="M350 130 L400 130" stroke="#3b82f6" stroke-width="2" fill="none" marker-end="url(#arrowhead-component-blue)"/>

                        <!-- Bクラス（有効） -->
                        <rect x="400" y="80" width="150" height="100" rx="8" fill="#10b981" stroke="#059669" stroke-width="3"/>
                        <text x="475" y="100" text-anchor="middle" font-size="11" font-weight="bold" fill="white">Bクラス</text>
                        <rect x="415" y="110" width="120" height="55" rx="4" fill="white" stroke="#86efac" stroke-width="1"/>
                        <text x="475" y="128" text-anchor="middle" font-size="10" font-family="monospace" font-weight="bold" fill="#22c55e">@Component</text>
                        <text x="475" y="143" text-anchor="middle" font-size="9" fill="#1e293b">public class B</text>
                        <text x="475" y="157" text-anchor="middle" font-size="9" fill="#1e293b">implements Greet</text>

                        <circle cx="535" cy="95" r="14" fill="#22c55e" stroke="white" stroke-width="2"/>
                        <text x="535" y="100" text-anchor="middle" font-size="12" font-weight="bold" fill="white">✓</text>

                        <!-- Cクラス（無効） -->
                        <rect x="570" y="80" width="150" height="100" rx="8" fill="#e5e7eb" stroke="#9ca3af" stroke-width="2" stroke-dasharray="4"/>
                        <text x="645" y="100" text-anchor="middle" font-size="11" font-weight="bold" fill="#6b7280">Cクラス</text>
                        <rect x="585" y="110" width="120" height="55" rx="4" fill="#f9fafb" stroke="#d1d5db" stroke-width="1"/>
                        <text x="645" y="128" text-anchor="middle" font-size="10" font-family="monospace" fill="#9ca3af">// @Component</text>
                        <text x="645" y="143" text-anchor="middle" font-size="9" fill="#9ca3af">public class C</text>
                        <text x="645" y="157" text-anchor="middle" font-size="9" fill="#9ca3af">implements Greet</text>

                        <!-- ========== AFTER（変更後） ========== -->
                        <rect x="20" y="290" width="710" height="155" rx="8" fill="#E0F7FA" stroke="#22c55e" stroke-width="2"/>
                        <text x="35" y="310" font-size="12" font-weight="bold" fill="#166534">変更後：Cクラスが使われている状態</text>

                        <!-- GreetingController -->
                        <rect x="40" y="325" width="140" height="100" rx="8" fill="#E0F7FA" stroke="#22c55e" stroke-width="3"/>
                        <text x="110" y="345" text-anchor="middle" font-size="11" font-weight="bold" fill="#166534">GreetingController</text>
                        <rect x="50" y="355" width="120" height="55" rx="4" fill="white" stroke="#86efac" stroke-width="1"/>
                        <text x="110" y="373" text-anchor="middle" font-size="10" font-family="monospace" fill="#22c55e">@Autowired</text>
                        <text x="110" y="390" text-anchor="middle" font-size="10" font-family="monospace" fill="#1e293b">Greet g;</text>
                        <text x="110" y="403" text-anchor="middle" font-size="8" fill="#64748b">変更不要！</text>

                        <!-- 矢印 -->
                        <path d="M180 375 L230 375" stroke="#3b82f6" stroke-width="2" fill="none" marker-end="url(#arrowhead-component-blue)"/>

                        <!-- DIコンテナ -->
                        <rect x="230" y="325" width="120" height="100" rx="8" fill="#dbeafe" stroke="#3b82f6" stroke-width="2"/>
                        <text x="290" y="345" text-anchor="middle" font-size="11" font-weight="bold" fill="#1d4ed8">DIコンテナ</text>
                        <text x="290" y="367" text-anchor="middle" font-size="9" fill="#1e40af">@Componentを</text>
                        <text x="290" y="383" text-anchor="middle" font-size="9" fill="#1e40af">スキャン</text>
                        <text x="290" y="405" text-anchor="middle" font-size="9" fill="#22c55e" font-weight="600">→ C発見</text>

                        <!-- 矢印 -->
                        <path d="M350 375 L570 375" stroke="#3b82f6" stroke-width="2" fill="none" marker-end="url(#arrowhead-component-blue)"/>

                        <!-- Bクラス（無効） -->
                        <rect x="400" y="325" width="150" height="100" rx="8" fill="#e5e7eb" stroke="#9ca3af" stroke-width="2" stroke-dasharray="4"/>
                        <text x="475" y="345" text-anchor="middle" font-size="11" font-weight="bold" fill="#6b7280">Bクラス</text>
                        <rect x="415" y="355" width="120" height="55" rx="4" fill="#f9fafb" stroke="#d1d5db" stroke-width="1"/>
                        <text x="475" y="373" text-anchor="middle" font-size="10" font-family="monospace" fill="#9ca3af">// @Component</text>
                        <text x="475" y="388" text-anchor="middle" font-size="9" fill="#9ca3af">public class B</text>
                        <text x="475" y="402" text-anchor="middle" font-size="9" fill="#9ca3af">implements Greet</text>

                        <!-- Cクラス（有効） -->
                        <rect x="570" y="325" width="150" height="100" rx="8" fill="#10b981" stroke="#059669" stroke-width="3"/>
                        <text x="645" y="345" text-anchor="middle" font-size="11" font-weight="bold" fill="white">Cクラス</text>
                        <rect x="585" y="355" width="120" height="55" rx="4" fill="white" stroke="#86efac" stroke-width="1"/>
                        <text x="645" y="373" text-anchor="middle" font-size="10" font-family="monospace" font-weight="bold" fill="#fbbf24">@Component</text>
                        <text x="645" y="388" text-anchor="middle" font-size="9" fill="#1e293b">public class C</text>
                        <text x="645" y="402" text-anchor="middle" font-size="9" fill="#1e293b">implements Greet</text>

                        <circle cx="705" cy="340" r="14" fill="#22c55e" stroke="white" stroke-width="2"/>
                        <text x="705" y="345" text-anchor="middle" font-size="12" font-weight="bold" fill="white">✓</text>

                        <!-- 矢印（切り替え）- 最前面に表示 -->
                        <path d="M475 180 L475 325" stroke="#f59e0b" stroke-width="3" stroke-dasharray="8,4" fill="none" marker-end="url(#arrowhead-component-orange)"/>
                        <path d="M645 180 L645 325" stroke="#f59e0b" stroke-width="3" stroke-dasharray="8,4" fill="none" marker-end="url(#arrowhead-component-orange)"/>

                        <!-- ========== 切り替え操作（最前面） ========== -->
                        <rect x="450" y="220" width="250" height="55" rx="8" fill="#fef3c7" stroke="#f59e0b" stroke-width="3"/>
                        <text x="575" y="240" text-anchor="middle" font-size="12" font-weight="bold" fill="#b45309">切り替え操作</text>
                        <text x="575" y="257" text-anchor="middle" font-size="10" fill="#92400e">① Bクラスの @Component を削除</text>
                        <text x="575" y="270" text-anchor="middle" font-size="10" fill="#92400e">② Cクラスに @Component を追加</text>

                        <defs>
                            <marker id="arrowhead-component-blue" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#3b82f6"/>
                            </marker>
                            <marker id="arrowhead-component-orange" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#f59e0b"/>
                            </marker>
                        </defs>
                    </svg>
                </div>

                <h3>3-2-2 DIを実現する5つのルール</h3>

                <div class="highlight-box" style="background: #eff6ff; border-left: 4px solid #3b82f6; padding: 16px 20px; margin: 20px 0;">
                    <p style="margin: 0 0 12px 0; font-size: 1.05em; font-weight: 600; color: #1e40af;">
                        🎯 DIの目的：実装クラスの変更時に、呼び出し側のコード修正をゼロにする
                    </p>
                    <div style="background: white; border-radius: 8px; padding: 16px; border: 2px solid #bfdbfe;">
                        <table style="width: 100%; border-collapse: collapse; font-size: 0.9em;">
                            <tr style="background: #f8fafc;">
                                <th style="padding: 8px; text-align: left; border: 1px solid #e2e8f0; width: 25%;">方法</th>
                                <th style="padding: 8px; text-align: left; border: 1px solid #e2e8f0; width: 35%;">修正箇所数</th>
                                <th style="padding: 8px; text-align: left; border: 1px solid #e2e8f0;">具体例</th>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid #e2e8f0; font-weight: 600;">クラス依存</td>
                                <td style="padding: 8px; border: 1px solid #e2e8f0; color: #dc2626; font-weight: 600;">3箇所</td>
                                <td style="padding: 8px; border: 1px solid #e2e8f0; font-size: 0.85em;">変数宣言、生成、メソッド引数</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid #e2e8f0; font-weight: 600;">インターフェース依存</td>
                                <td style="padding: 8px; border: 1px solid #e2e8f0; color: #f59e0b; font-weight: 600;">1箇所</td>
                                <td style="padding: 8px; border: 1px solid #e2e8f0; font-size: 0.85em;"><code>new B()</code> → <code>new C()</code></td>
                            </tr>
                            <tr style="background: #E0F7FA;">
                                <td style="padding: 8px; border: 1px solid #e2e8f0; font-weight: 600;">DI使用</td>
                                <td style="padding: 8px; border: 1px solid #e2e8f0; color: #22c55e; font-weight: 600; font-size: 1.1em;">0箇所！</td>
                                <td style="padding: 8px; border: 1px solid #e2e8f0; font-size: 0.85em;">@Componentの付け替えのみ</td>
                            </tr>
                        </table>
                    </div>
                    <p style="margin: 12px 0 0 0; font-size: 0.9em; color: #475569;">
                        <strong>どうやって実現するのか？</strong><br />
                        以下の5つのルールに従うことで、DIコンテナが自動的にインスタンスを生成・配布し、<br />
                        呼び出し側のクラスは一切修正不要になります。
                    </p>
                </div>

                <!-- クラス関係の図 -->
                <div class="diagram-container">
                    <div class="diagram-title">図3.4 DIの仕組み：5つのルールとクラスの関係</div>
                    <svg class="diagram-svg" viewBox="0 0 750 620" width="750" height="620">
                        <defs>
                            <marker id="arrowhead-blue" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#3b82f6"/>
                            </marker>
                            <marker id="arrowhead-cyan" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#06b6d4"/>
                            </marker>
                            <marker id="arrowhead-green" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#22c55e"/>
                            </marker>
                        </defs>

                        <!-- タイトル -->
                        <text x="375" y="25" text-anchor="middle" font-size="14" font-weight="bold" fill="#1e293b">5つのルールでDIを実現</text>

                        <!-- ========== 上段：インターフェースと実装クラス ========== -->

                        <!-- インターフェース Greet -->
                        <rect x="275" y="60" width="200" height="75" rx="8" fill="#dbeafe" stroke="#3b82f6" stroke-width="3"/>
                        <text x="375" y="85" text-anchor="middle" font-size="11" fill="#3b82f6" font-weight="600">《interface》</text>
                        <text x="375" y="108" text-anchor="middle" font-size="18" font-weight="bold" fill="#1e40af">Greet</text>

                        <!-- ルール① インターフェースを使う -->
                        <circle cx="490" cy="80" r="18" fill="#3b82f6" stroke="white" stroke-width="2.5"/>
                        <text x="490" y="86" text-anchor="middle" font-size="14" fill="white" font-weight="bold">①</text>
                        <rect x="515" y="65" width="210" height="30" rx="6" fill="#eff6ff" stroke="#3b82f6" stroke-width="1.5"/>
                        <text x="620" y="86" text-anchor="middle" font-size="11" fill="#1e40af" font-weight="600">ルール① インターフェースを使う</text>

                        <!-- implements 矢印 -->
                        <path d="M325 135 L325 175 L200 175 L200 210" stroke="#64748b" stroke-width="2" fill="none" stroke-dasharray="4,3"/>
                        <path d="M425 135 L425 175 L550 175 L550 210" stroke="#64748b" stroke-width="2" fill="none" stroke-dasharray="4,3"/>
                        <text x="375" y="170" text-anchor="middle" font-size="10" fill="#64748b" font-style="italic">implements</text>

                        <!-- MorningGreet（有効・@Component付き） -->
                        <rect x="100" y="210" width="200" height="95" rx="8" fill="#10b981" stroke="#059669" stroke-width="3"/>
                        <text x="200" y="235" text-anchor="middle" font-size="14" font-weight="bold" fill="white">MorningGreet</text>
                        <rect x="120" y="245" width="160" height="50" rx="5" fill="white" stroke="#86efac" stroke-width="1.5"/>
                        <text x="200" y="265" text-anchor="middle" font-size="11" font-family="monospace" font-weight="bold" fill="#f59e0b">@Component</text>
                        <text x="200" y="281" text-anchor="middle" font-size="9" fill="#64748b">public class MorningGreet</text>
                        <text x="200" y="294" text-anchor="middle" font-size="9" fill="#64748b">implements Greet</text>

                        <!-- ルール③ @Componentを付ける -->
                        <circle cx="70" cy="245" r="18" fill="#f59e0b" stroke="white" stroke-width="2.5"/>
                        <text x="70" y="251" text-anchor="middle" font-size="14" fill="white" font-weight="bold">③</text>

                        <!-- EveningGreet（無効・@Componentなし） -->
                        <rect x="450" y="210" width="200" height="95" rx="8" fill="#e5e7eb" stroke="#9ca3af" stroke-width="2" stroke-dasharray="6,3"/>
                        <text x="550" y="235" text-anchor="middle" font-size="14" font-weight="bold" fill="#6b7280">EveningGreet</text>
                        <rect x="470" y="245" width="160" height="50" rx="5" fill="#f9fafb" stroke="#d1d5db" stroke-width="1"/>
                        <text x="550" y="265" text-anchor="middle" font-size="11" font-family="monospace" fill="#9ca3af">// @Component</text>
                        <text x="550" y="281" text-anchor="middle" font-size="9" fill="#9ca3af">public class EveningGreet</text>
                        <text x="550" y="294" text-anchor="middle" font-size="9" fill="#9ca3af">implements Greet</text>

                        <!-- ========== 中段：DIコンテナ ========== -->

                        <!-- コンポーネントスキャンの矢印 -->
                        <path d="M200 305 L200 345 L375 345 L375 375" stroke="#06b6d4" stroke-width="3" fill="none" marker-end="url(#arrowhead-cyan)" stroke-dasharray="5,3"/>
                        <text x="287" y="340" font-size="10" fill="#06b6d4" font-weight="600">スキャン</text>

                        <!-- ルール④ コンポーネントスキャン -->
                        <circle cx="155" cy="345" r="18" fill="#06b6d4" stroke="white" stroke-width="2.5"/>
                        <text x="155" y="351" text-anchor="middle" font-size="14" fill="white" font-weight="bold">④</text>

                        <!-- DIコンテナ -->
                        <rect x="280" y="375" width="190" height="60" rx="8" fill="#ecfeff" stroke="#06b6d4" stroke-width="3"/>
                        <text x="375" y="398" text-anchor="middle" font-size="13" font-weight="bold" fill="#0e7490">DIコンテナ</text>
                        <text x="375" y="416" text-anchor="middle" font-size="10" fill="#0e7490">MorningGreetインスタンスを保持</text>
                        <text x="375" y="430" text-anchor="middle" font-size="9" fill="#0891b2" font-style="italic">（自動生成・自動管理）</text>

                        <!-- ========== 下段：呼び出し側クラス ========== -->

                        <!-- 配布矢印 -->
                        <path d="M375 435 L375 485" stroke="#22c55e" stroke-width="3.5" fill="none" marker-end="url(#arrowhead-green)"/>
                        <text x="410" y="462" font-size="11" fill="#22c55e" font-weight="600">インスタンスを渡す</text>

                        <!-- ルール⑤ @Autowiredで受け取る -->
                        <circle cx="330" cy="462" r="18" fill="#22c55e" stroke="white" stroke-width="2.5"/>
                        <text x="330" y="468" text-anchor="middle" font-size="14" fill="white" font-weight="bold">⑤</text>

                        <!-- DiSampleApplication（呼び出し側クラス） -->
                        <rect x="235" y="485" width="280" height="75" rx="8" fill="white" stroke="#8b5cf6" stroke-width="3"/>
                        <text x="375" y="507" text-anchor="middle" font-size="12" font-weight="bold" fill="#6d28d9">DiSampleApplication</text>
                        <text x="375" y="522" text-anchor="middle" font-size="10" fill="#64748b">（呼び出し側クラス）</text>
                        <line x1="250" y1="530" x2="500" y2="530" stroke="#cbd5e1" stroke-width="1"/>
                        <text x="375" y="545" text-anchor="middle" font-size="10" font-family="monospace" font-weight="bold" fill="#f59e0b">@Autowired</text>
                        <text x="375" y="557" text-anchor="middle" font-size="10" font-family="monospace" fill="#3b82f6">private <tspan font-weight="bold">Greet</tspan> greet;</text>

                        <!-- ルール② newを使わない -->
                        <circle cx="530" cy="515" r="18" fill="#8b5cf6" stroke="white" stroke-width="2.5"/>
                        <text x="530" y="521" text-anchor="middle" font-size="14" fill="white" font-weight="bold">②</text>
                        <rect x="555" y="500" width="175" height="30" rx="6" fill="#faf5ff" stroke="#8b5cf6" stroke-width="1.5"/>
                        <text x="642" y="521" text-anchor="middle" font-size="11" fill="#6d28d9" font-weight="600">ルール② newを使わない</text>

                        <!-- 凡例 -->
                        <rect x="30" y="495" width="180" height="75" rx="8" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
                        <text x="120" y="515" text-anchor="middle" font-size="11" font-weight="bold" fill="#b45309">ルール番号の意味</text>
                        <text x="120" y="532" text-anchor="middle" font-size="9" fill="#92400e">①③ 宣言時のルール</text>
                        <text x="120" y="545" text-anchor="middle" font-size="9" fill="#92400e">② newを使わない</text>
                        <text x="120" y="558" text-anchor="middle" font-size="9" fill="#92400e">④⑤ DIコンテナの処理</text>
                    </svg>
                </div>

                <div class="rule-box" style="border-left: 4px solid #3b82f6;">
                    <div class="rule-header">
                        <span class="rule-icon" style="background: #3b82f6;">①</span>
                        <span class="rule-title">インターフェースを使う（呼び出し側）</span>
                    </div>
                    <p class="rule-content">
                        <strong style="color: #1e40af;">なぜ必要？</strong> 実装クラス名（MorningGreetなど）に依存しないため<br />
                        <code>Greet</code> インターフェースを型として使用します。
                    </p>
                    <div style="background: #f1f5f9; padding: 12px; border-radius: 6px; margin-top: 8px;">
                        <code style="display: block; margin-bottom: 4px;">@Autowired private <strong style="color: #3b82f6;">Greet</strong> greet;</code>
                        <span style="color: #64748b; font-size: 0.85em;">→ MorningGreetやEveningGreetという具体的なクラス名は書かない</span>
                    </div>
                </div>

                <div class="rule-box" style="border-left: 4px solid #8b5cf6;">
                    <div class="rule-header">
                        <span class="rule-icon" style="background: #8b5cf6;">②</span>
                        <span class="rule-title">newを使わない（呼び出し側）</span>
                    </div>
                    <p class="rule-content">
                        <strong style="color: #6d28d9;">なぜ必要？</strong> DIコンテナにインスタンス生成を任せるため<br />
                        自分で <code>new</code> を使ってインスタンスを生成しません。
                    </p>
                    <div style="background: #fef2f2; padding: 8px 12px; border-radius: 6px; margin-top: 8px; border: 1px solid #fca5a5;">
                        <span style="color: #dc2626;">❌ 従来の方法</span><br />
                        <code style="text-decoration: line-through; color: #7f1d1d;">Greet greet = new MorningGreet();</code>
                    </div>
                    <div style="background: #E0F7FA; padding: 8px 12px; border-radius: 6px; margin-top: 4px; border: 1px solid #86efac;">
                        <span style="color: #16a34a;">✅ DIを使う方法</span><br />
                        <code style="color: #166534;">@Autowired Greet greet;</code>
                    </div>
                </div>

                <div class="rule-box" style="border-left: 4px solid #f59e0b;">
                    <div class="rule-header">
                        <span class="rule-icon" style="background: #f59e0b;">③</span>
                        <span class="rule-title">@Componentを付ける（実装クラス側）</span>
                    </div>
                    <p class="rule-content">
                        <strong style="color: #b45309;">なぜ必要？</strong> DIコンテナに「このクラスをインスタンス化してください」と伝えるため<br />
                        使いたい実装クラスに <code>@Component</code> を付けます。
                    </p>
                    <div style="background: #f1f5f9; padding: 12px; border-radius: 6px; margin-top: 8px;">
                        <code style="display: block;">
                            <span style="color: #f59e0b; font-weight: 600;">@Component</span> <span style="color: #64748b;">← この目印でDIコンテナが発見</span><br />
                            public class <strong>MorningGreet</strong> implements Greet { ... }
                        </code>
                    </div>
                    <p style="margin: 8px 0 0 0; font-size: 0.85em; color: #64748b;">
                        💡 切り替え時は、この@Componentを付け替えるだけ！
                    </p>
                </div>

                <div class="rule-box" style="border-left: 4px solid #06b6d4;">
                    <div class="rule-header">
                        <span class="rule-icon" style="background: #06b6d4;">④</span>
                        <span class="rule-title">コンポーネントスキャン（自動実行）</span>
                    </div>
                    <p class="rule-content">
                        <strong style="color: #0e7490;">何が起きる？</strong> Spring Framework起動時に自動実行される処理<br />
                        <code>@Component</code> が付いたクラスを探して、自動的に <code>new</code> を実行します。
                    </p>
                    <div style="background: #ecfeff; padding: 12px; border-radius: 6px; margin-top: 8px; border: 1px solid #67e8f9;">
                        <p style="margin: 0 0 8px 0; font-size: 0.9em; font-weight: 600; color: #0e7490;">DIコンテナ内部の処理（自動）</p>
                        <code style="display: block; color: #155e75;">
                            MorningGreet instance = new MorningGreet(); <span style="color: #64748b;">// 自動生成</span>
                        </code>
                    </div>
                    <p style="margin: 8px 0 0 0; font-size: 0.85em; color: #64748b;">
                        ※ 私たちは何もしなくてOK。Spring Frameworkが勝手にやってくれます
                    </p>
                </div>

                <div class="rule-box" style="border-left: 4px solid #22c55e;">
                    <div class="rule-header">
                        <span class="rule-icon" style="background: #22c55e;">⑤</span>
                        <span class="rule-title">@Autowiredで受け取る（呼び出し側）</span>
                    </div>
                    <p class="rule-content">
                        <strong style="color: #166534;">なぜ必要？</strong> DIコンテナに「ここにインスタンスを入れてください」と伝えるため<br />
                        インスタンスを受け取るフィールドに <code>@Autowired</code> を付けます。
                    </p>
                    <div style="background: #f1f5f9; padding: 12px; border-radius: 6px; margin-top: 8px;">
                        <code style="display: block;">
                            <span style="color: #f59e0b; font-weight: 600;">@Autowired</span> <span style="color: #64748b;">← DIコンテナが自動的に値を入れる</span><br />
                            private Greet greet;
                        </code>
                    </div>
                    <div style="background: #dcfce7; padding: 12px; border-radius: 6px; margin-top: 8px; border: 1px solid #86efac;">
                        <p style="margin: 0 0 4px 0; font-size: 0.9em; font-weight: 600; color: #166534;">DIコンテナ内部の処理（自動）</p>
                        <code style="display: block; color: #166534;">
                            yourObject.greet = instance; <span style="color: #64748b;">// 自動で値を入れる</span>
                        </code>
                    </div>
                </div>

                <div class="highlight-box" style="background: #E0F7FA; border-left: 4px solid #22c55e; padding: 16px 20px; margin: 24px 0;">
                    <p style="margin: 0 0 12px 0; font-size: 1.05em; font-weight: 600; color: #166534;">
                        ✅ まとめ：5つのルールの関係
                    </p>
                    <div style="background: white; border-radius: 8px; padding: 16px; border: 2px solid #86efac;">
                        <div style="display: grid; grid-template-columns: auto 1fr; gap: 12px; font-size: 0.9em;">
                            <div style="color: #3b82f6; font-weight: 600;">ルール1, 2:</div>
                            <div>呼び出し側は、インターフェース型で宣言し、newを使わない</div>

                            <div style="color: #f59e0b; font-weight: 600;">ルール3:</div>
                            <div>実装クラス側は、@Componentを付けて「使ってください」とDIコンテナに伝える</div>

                            <div style="color: #06b6d4; font-weight: 600;">ルール4:</div>
                            <div>Spring Frameworkが自動的にインスタンスを生成（コンポーネントスキャン）</div>

                            <div style="color: #22c55e; font-weight: 600;">ルール5:</div>
                            <div>DIコンテナが@Autowiredの付いたフィールドに自動的に値を入れる</div>
                        </div>
                        <p style="margin: 16px 0 0 0; padding-top: 12px; border-top: 1px solid #d1fae5; font-weight: 600; color: #166534;">
                            → この5つが揃うことで、実装クラスを切り替える時に呼び出し側の修正が不要になります！
                        </p>
                    </div>
                </div>

                <div class="diagram-container">
                    <div class="diagram-title">図3.5 「コンポーネントスキャン」の実行</div>
                    <svg class="diagram-svg" viewBox="0 0 720 520" width="720" height="520">
                        <!-- 背景グラデーション -->
                        <defs>
                            <linearGradient id="bg-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#f8fafc"/>
                                <stop offset="100%" style="stop-color:#e2e8f0"/>
                            </linearGradient>
                            <marker id="arrow-cyan" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#0ea5e9"/>
                            </marker>
                            <marker id="arrow-green" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#22c55e"/>
                            </marker>
                            <marker id="arrow-blue" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#3b82f6"/>
                            </marker>
                        </defs>

                        <!-- ① Spring Framework 起動 -->
                        <rect x="20" y="170" width="140" height="80" rx="10" fill="#0ea5e9"/>
                        <text x="90" y="198" text-anchor="middle" font-size="12" font-weight="bold" fill="white">Spring Framework</text>
                        <text x="90" y="218" text-anchor="middle" font-size="10" fill="#bae6fd">コンポーネント</text>
                        <text x="90" y="233" text-anchor="middle" font-size="10" fill="#bae6fd">スキャン実行</text>

                        <!-- 起動バッジ -->
                        <circle cx="20" cy="170" r="18" fill="#f59e0b"/>
                        <text x="20" y="175" text-anchor="middle" font-size="10" fill="white" font-weight="bold">起動</text>

                        <!-- ①番号 -->
                        <circle cx="175" cy="210" r="14" fill="#0ea5e9"/>
                        <text x="175" y="215" text-anchor="middle" font-size="11" fill="white" font-weight="bold">①</text>

                        <!-- スキャン矢印 -->
                        <path d="M190 210 L218 210" stroke="#0ea5e9" stroke-width="3" fill="none" marker-end="url(#arrow-cyan)"/>

                        <!-- パッケージ com.example.demo -->
                        <rect x="230" y="25" width="470" height="420" rx="12" fill="url(#bg-gradient)" stroke="#94a3b8" stroke-width="2"/>
                        <text x="465" y="50" text-anchor="middle" font-size="12" fill="#475569" font-weight="600">com.example.demo パッケージ</text>

                        <!-- パッケージ used -->
                        <rect x="250" y="70" width="210" height="180" rx="8" fill="#fff" stroke="#cbd5e1" stroke-width="2"/>
                        <text x="355" y="90" text-anchor="middle" font-size="10" fill="#64748b" font-weight="500">com.example.demo.used</text>

                        <!-- Greet インターフェース -->
                        <rect x="270" y="105" width="170" height="32" rx="5" fill="#dbeafe" stroke="#3b82f6" stroke-width="1.5"/>
                        <text x="355" y="126" text-anchor="middle" font-size="11" fill="#1d4ed8" font-weight="500">《interface》Greet</text>

                        <!-- implements 矢印 -->
                        <path d="M355 137 L355 148" stroke="#64748b" stroke-width="1" stroke-dasharray="3"/>

                        <!-- MorningGreet (@Component付き) -->
                        <rect x="270" y="148" width="170" height="45" rx="5" fill="#10b981"/>
                        <rect x="277" y="154" width="80" height="16" rx="3" fill="#1e293b"/>
                        <text x="317" y="166" text-anchor="middle" font-size="9" font-family="monospace" fill="#fbbf24">@Component</text>
                        <text x="355" y="183" text-anchor="middle" font-size="11" font-weight="bold" fill="white">MorningGreet</text>

                        <!-- EveningGreet (@Componentなし) -->
                        <rect x="270" y="203" width="170" height="35" rx="5" fill="#f1f5f9" stroke="#cbd5e1" stroke-width="1" stroke-dasharray="4"/>
                        <text x="355" y="225" text-anchor="middle" font-size="11" fill="#94a3b8">EveningGreet</text>
                        <text x="355" y="243" text-anchor="middle" font-size="8" fill="#94a3b8">（@Componentなし）</text>

                        <!-- ②番号（発見） -->
                        <circle cx="458" cy="170" r="14" fill="#22c55e"/>
                        <text x="458" y="175" text-anchor="middle" font-size="11" fill="white" font-weight="bold">②</text>

                        <!-- 発見の矢印 -->
                        <path d="M440 170 L445 170" stroke="#22c55e" stroke-width="2" fill="none"/>
                        <circle cx="430" cy="170" r="10" fill="#22c55e"/>
                        <text x="430" y="174" text-anchor="middle" font-size="12" fill="white" font-weight="bold">✓</text>

                        <!-- DiSampleApplication -->
                        <rect x="490" y="85" width="190" height="100" rx="8" fill="#E0F7FA" stroke="#22c55e" stroke-width="2.5"/>
                        <text x="585" y="110" text-anchor="middle" font-size="11" font-weight="bold" fill="#166534">DiSampleApplication</text>
                        <line x1="505" y1="120" x2="665" y2="120" stroke="#22c55e" stroke-width="1"/>
                        <text x="585" y="140" text-anchor="middle" font-size="10" font-family="monospace" fill="#f59e0b">@Autowired</text>
                        <text x="585" y="157" text-anchor="middle" font-size="10" font-family="monospace" fill="#1e293b">private Greet greet;</text>
                        <rect x="510" y="165" width="150" height="14" rx="3" fill="#dcfce7"/>
                        <text x="585" y="175" text-anchor="middle" font-size="9" fill="#166534">← 参照が渡される</text>

                        <!-- DIコンテナ -->
                        <rect x="250" y="330" width="430" height="100" rx="10" fill="#dbeafe" stroke="#3b82f6" stroke-width="2.5"/>
                        <text x="465" y="355" text-anchor="middle" font-size="12" font-weight="bold" fill="#1d4ed8">DIコンテナ（インスタンス管理）</text>
                        <rect x="290" y="370" width="350" height="45" rx="5" fill="#fff" stroke="#93c5fd" stroke-width="1"/>
                        <text x="465" y="390" text-anchor="middle" font-size="11" font-family="monospace" fill="#1e293b">MorningGreet インスタンス</text>
                        <text x="465" y="407" text-anchor="middle" font-size="10" fill="#64748b">メモリアドレス: 0x1234ABCD</text>

                        <!-- ③番号と矢印（登録）- 下に迂回 -->
                        <path d="M355 193 L355 290 L465 290 L465 330" stroke="#3b82f6" stroke-width="2.5" fill="none" marker-end="url(#arrow-blue)"/>
                        <circle cx="410" cy="290" r="14" fill="#3b82f6"/>
                        <text x="410" y="295" text-anchor="middle" font-size="11" fill="white" font-weight="bold">③</text>
                        <text x="410" y="268" text-anchor="middle" font-size="10" fill="#3b82f6" font-weight="600">登録</text>

                        <!-- ④番号と矢印（参照を渡す） -->
                        <path d="M585 370 L585 215 L585 185" stroke="#22c55e" stroke-width="2.5" fill="none" marker-end="url(#arrow-green)"/>
                        <circle cx="585" cy="290" r="14" fill="#22c55e"/>
                        <text x="585" y="295" text-anchor="middle" font-size="11" fill="white" font-weight="bold">④</text>
                        <text x="615" y="295" text-anchor="start" font-size="10" fill="#22c55e" font-weight="600">参照を渡す</text>
                    </svg>
                </div>

                <div class="highlight-box">
                    <p>
                        <strong>📌 コンポーネントスキャンの流れ（DiSampleApplication 起動時）</strong>
                    </p>
                    <table style="width: 100%; border-collapse: collapse; margin-top: 12px;">
                        <tr>
                            <td style="padding: 8px; vertical-align: top; width: 50px;">
                                <span style="display: inline-block; width: 28px; height: 28px; background: #0ea5e9; color: white; border-radius: 50%; text-align: center; line-height: 28px; font-weight: bold;">①</span>
                            </td>
                            <td style="padding: 8px;">
                                <strong>パッケージをスキャン</strong><br>
                                <code>@SpringBootApplication</code> が付いた <code>DiSampleApplication</code> を起動すると、<br>
                                Spring Framework が <code>com.example.demo</code> パッケージ配下をスキャン
                            </td>
                        </tr>
                        <tr>
                            <td style="padding: 8px; vertical-align: top;">
                                <span style="display: inline-block; width: 28px; height: 28px; background: #22c55e; color: white; border-radius: 50%; text-align: center; line-height: 28px; font-weight: bold;">②</span>
                            </td>
                            <td style="padding: 8px;">
                                <strong>@Component を発見</strong><br>
                                <code>MorningGreet</code> クラスに <code>@Component</code> が付いているため発見<br>
                                <span style="color: #64748b;">（<code>EveningGreet</code> は @Component がないためスキップ）</span>
                            </td>
                        </tr>
                        <tr>
                            <td style="padding: 8px; vertical-align: top;">
                                <span style="display: inline-block; width: 28px; height: 28px; background: #3b82f6; color: white; border-radius: 50%; text-align: center; line-height: 28px; font-weight: bold;">③</span>
                            </td>
                            <td style="padding: 8px;">
                                <strong>DIコンテナに登録</strong><br>
                                <code>MorningGreet</code> のインスタンスを <code>new</code> して<br>
                                DIコンテナ（メモリ上のインスタンス管理領域）に登録
                            </td>
                        </tr>
                        <tr>
                            <td style="padding: 8px; vertical-align: top;">
                                <span style="display: inline-block; width: 28px; height: 28px; background: #22c55e; color: white; border-radius: 50%; text-align: center; line-height: 28px; font-weight: bold;">④</span>
                            </td>
                            <td style="padding: 8px;">
                                <strong>参照を渡す（DI実行）</strong><br>
                                <code>DiSampleApplication</code> の <code>@Autowired</code> が付いた <code>greet</code> フィールドに<br>
                                DIコンテナから <code>MorningGreet</code> インスタンスの参照を渡す
                            </td>
                        </tr>
                    </table>
                </div>

                <h3>3-2-3 DIを利用したプログラムの作成</h3>

                <div class="highlight-box" style="background: #eff6ff; border-left: 4px solid #3b82f6; padding: 20px; margin: 20px 0;">
                    <p style="margin: 0 0 16px 0; font-size: 1.1em; font-weight: 700; color: #1e40af;">
                        🎯 このセクションの学習目的
                    </p>
                    <div style="background: white; border-radius: 8px; padding: 16px; margin-bottom: 12px;">
                        <p style="margin: 0 0 12px 0; font-weight: 600; color: #1e40af;">
                            DIの仕組みを実際のコードで体験し、理解を深めます
                        </p>
                        <ul class="no-margin" style="padding-left: 24px; line-height: 1.8;">
                            <li><strong>5つのルール</strong>が実際のコードでどう使われるかを理解する</li>
                            <li><strong>@Component</strong>と<strong>@Autowired</strong>の役割を体感する</li>
                            <li>実装クラスの切り替えが<strong>呼び出し側の修正なし</strong>で可能なことを確認する</li>
                            <li>DIコンテナがインスタンスを<strong>自動生成・自動配布</strong>する仕組みを見る</li>
                        </ul>
                    </div>
                    <div style="background: #fef3c7; border-left: 3px solid #f59e0b; padding: 12px; border-radius: 6px;">
                        <p class="no-margin" style="font-size: 0.9em;">
                            <strong>💡 ポイント</strong><br />
                            完成系のコードを見るだけでなく、自分の手で<strong>ステップバイステップで作成</strong>することで、DIの動作を深く理解できます。
                        </p>
                    </div>
                </div>

                <div class="highlight-box" style="background: #f8fafc; border: 2px solid #e2e8f0; padding: 20px; margin: 20px 0;">
                    <p style="margin: 0 0 16px 0; font-size: 1.05em; font-weight: 700; color: #1e293b;">
                        📚 作成するプログラムの概要
                    </p>
                    <p style="margin: 0 0 12px 0;">
                        「挨拶」の役割を持つインターフェースと、2種類の実装クラス（朝の挨拶・夕方の挨拶）を作成します。<br />
                        DIのアノテーションを使い、<code>@Component</code>の付け替えだけで挨拶内容を切り替えられることを確認します。
                    </p>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 16px;">
                        <div style="background: white; padding: 12px; border-radius: 6px; border: 2px solid #10b981;">
                            <div style="font-weight: 600; color: #10b981; margin-bottom: 8px;">✅ 実装前（従来の方法）</div>
                            <div style="font-size: 0.85em; color: #64748b;">
                                実装クラスを切り替えるには<br />
                                <code style="color: #dc2626;">new MorningGreet()</code><br />
                                　↓<br />
                                <code style="color: #dc2626;">new EveningGreet()</code><br />
                                <strong>呼び出し側のコード修正が必要</strong>
                            </div>
                        </div>
                        <div style="background: white; padding: 12px; border-radius: 6px; border: 2px solid #3b82f6;">
                            <div style="font-weight: 600; color: #3b82f6; margin-bottom: 8px;">🎉 実装後（DI使用）</div>
                            <div style="font-size: 0.85em; color: #64748b;">
                                実装クラスを切り替えるには<br />
                                <code style="color: #f59e0b;">@Component</code>の付け替えのみ<br />
                                <strong>呼び出し側は一切変更不要！</strong>
                            </div>
                        </div>
                    </div>
                </div>

                <h4>01 プロジェクトの準備</h4>

                <p>
                    Spring Initializrを使用してSpring Bootプロジェクトを作成します。Spring Initializrは、Spring Bootプロジェクトの<strong>雛形を自動生成</strong>してくれる公式ツールです。
                </p>

                <p style="margin-top: 20px; margin-bottom: 12px; font-weight: 600; color: #1e293b;">⚙️ Spring Initializr 設定内容</p>
                <table style="width: 100%; border-collapse: collapse; background: white; border: 2px solid #e2e8f0; border-radius: 8px; overflow: hidden;">
                    <thead>
                        <tr style="background: #64748b;">
                            <th style="padding: 14px 16px; text-align: left; font-weight: 600; color: white; width: 30%;">設定項目</th>
                            <th style="padding: 14px 16px; text-align: left; font-weight: 600; color: white;">設定値</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Spring Initializr へのアクセス -->
                        <tr style="background: #f8fafc;">
                            <td colspan="2" style="padding: 10px 16px; font-weight: 600; color: #1e293b; border-bottom: 2px solid #e2e8f0;">
                                🌐 Spring Initializr へのアクセス
                            </td>
                        </tr>
                        <tr>
                            <td style="padding: 12px 16px; border-bottom: 1px solid #e2e8f0; vertical-align: top;">URL</td>
                            <td style="padding: 12px 16px; border-bottom: 1px solid #e2e8f0; color: #64748b;">
                                <a href="https://start.spring.io/" target="_blank" style="color: #3b82f6; text-decoration: underline;">https://start.spring.io/</a>
                            </td>
                        </tr>
                        <tr>
                            <td style="padding: 12px 16px; border-bottom: 2px solid #e2e8f0; vertical-align: top;">説明</td>
                            <td style="padding: 12px 16px; border-bottom: 2px solid #e2e8f0; color: #64748b;">
                                ブラウザで上記URLにアクセスし、以下の設定を行います
                            </td>
                        </tr>

                        <!-- プロジェクト設定 -->
                        <tr style="background: #f8fafc;">
                            <td colspan="2" style="padding: 10px 16px; font-weight: 600; color: #1e293b; border-bottom: 2px solid #e2e8f0;">
                                ⚙️ プロジェクト設定
                            </td>
                        </tr>
                        <tr>
                            <td style="padding: 12px 16px; border-bottom: 1px solid #e2e8f0; vertical-align: top;">Project</td>
                            <td style="padding: 12px 16px; border-bottom: 1px solid #e2e8f0; color: #64748b;">
                                <strong>Maven</strong>（ビルドツール）
                            </td>
                        </tr>
                        <tr>
                            <td style="padding: 12px 16px; border-bottom: 1px solid #e2e8f0; vertical-align: top;">Language</td>
                            <td style="padding: 12px 16px; border-bottom: 1px solid #e2e8f0; color: #64748b;">
                                <strong>Java</strong>
                            </td>
                        </tr>
                        <tr>
                            <td style="padding: 12px 16px; border-bottom: 1px solid #e2e8f0; vertical-align: top;">Spring Boot</td>
                            <td style="padding: 12px 16px; border-bottom: 1px solid #e2e8f0; color: #64748b;">
                                <strong>3.x.x（最新安定版を選択）</strong>
                            </td>
                        </tr>
                        <tr>
                            <td style="padding: 12px 16px; border-bottom: 1px solid #e2e8f0; vertical-align: top;">Packaging</td>
                            <td style="padding: 12px 16px; border-bottom: 1px solid #e2e8f0; color: #64748b;">
                                <strong>Jar</strong>
                            </td>
                        </tr>
                        <tr>
                            <td style="padding: 12px 16px; border-bottom: 2px solid #e2e8f0; vertical-align: top;">Java</td>
                            <td style="padding: 12px 16px; border-bottom: 2px solid #e2e8f0; color: #64748b;">
                                <strong>21</strong>
                            </td>
                        </tr>

                        <!-- Project Metadata -->
                        <tr style="background: #f8fafc;">
                            <td colspan="2" style="padding: 10px 16px; font-weight: 600; color: #1e293b; border-bottom: 2px solid #e2e8f0;">
                                📝 Project Metadata
                            </td>
                        </tr>
                        <tr>
                            <td style="padding: 12px 16px; border-bottom: 1px solid #e2e8f0; vertical-align: top;">Group</td>
                            <td style="padding: 12px 16px; border-bottom: 1px solid #e2e8f0; color: #64748b;">
                                <strong>com.example</strong>
                            </td>
                        </tr>
                        <tr>
                            <td style="padding: 12px 16px; border-bottom: 1px solid #e2e8f0; vertical-align: top;">Artifact</td>
                            <td style="padding: 12px 16px; border-bottom: 1px solid #e2e8f0; color: #64748b;">
                                <strong>di-sample</strong>
                            </td>
                        </tr>
                        <tr>
                            <td style="padding: 12px 16px; border-bottom: 1px solid #e2e8f0; vertical-align: top;">Name</td>
                            <td style="padding: 12px 16px; border-bottom: 1px solid #e2e8f0; color: #64748b;">
                                <strong>di-sample</strong>
                            </td>
                        </tr>
                        <tr>
                            <td style="padding: 12px 16px; border-bottom: 2px solid #e2e8f0; vertical-align: top;">Package name</td>
                            <td style="padding: 12px 16px; border-bottom: 2px solid #e2e8f0; color: #64748b;">
                                <strong>com.example.demo</strong>
                            </td>
                        </tr>

                        <!-- Dependencies -->
                        <tr style="background: #f8fafc;">
                            <td colspan="2" style="padding: 10px 16px; font-weight: 600; color: #1e293b; border-bottom: 2px solid #e2e8f0;">
                                📦 Dependencies（依存ライブラリ）
                            </td>
                        </tr>
                        <tr>
                            <td style="padding: 12px 16px; vertical-align: top;">追加するもの</td>
                            <td style="padding: 12px 16px; color: #64748b;">
                                <strong>なし</strong>（Spring Boot Starter のみで動作します）
                            </td>
                        </tr>
                    </tbody>
                </table>

                <div style="margin-top: 16px; padding: 12px; background: #E0F7FA; border-left: 3px solid #22c55e; border-radius: 4px;">
                    <p class="no-margin" style="font-size: 0.9em; color: #166534;">
                        💡 今回のDIサンプルは、Spring Bootの基本機能のみで動作するため、追加の依存ライブラリは不要です。
                    </p>
                </div>

                <div class="config-table" style="margin-top: 20px;">
                    <div style="font-weight: 600; margin-bottom: 12px; color: var(--primary)">📥 ダウンロードと展開</div>
                    <div class="config-row">
                        <span class="config-label">手順1</span>
                        <span class="config-value">画面下部の <strong>GENERATE</strong> ボタンをクリック</span>
                    </div>
                    <div class="config-row">
                        <span class="config-label">手順2</span>
                        <span class="config-value"><code>di-sample.zip</code> がダウンロードされるので解凍</span>
                    </div>
                    <div class="config-row">
                        <span class="config-label">手順3</span>
                        <span class="config-value">VSCodeで「ファイル」→「フォルダーを開く」→ 解凍した <code>di-sample</code> フォルダを選択</span>
                    </div>
                    <div class="config-row">
                        <span class="config-label">手順4</span>
                        <span class="config-value">VSCodeがJavaプロジェクトを認識するまで待機（右下に進捗表示）</span>
                    </div>
                </div>

                <h4 style="margin-top: 32px;">02 ファイル構造の理解</h4>

                <p>
                    プロジェクトのファイル構成を理解することは、DIの仕組みを学ぶ上で重要です。<br />
                    各ファイルがどのような役割を持ち、どのように連携するかを把握しましょう。
                </p>

                <div class="highlight-box" style="margin-top: 16px;">
                    <p style="margin: 0 0 12px 0;">
                        <strong>📂 プロジェクト全体の構造</strong>
                    </p>
<pre class="no-margin" style="background: #f8fafc; padding: 16px; border-radius: 8px; font-family: monospace; font-size: 13px; line-height: 1.8;">
di-sample/
├── <strong style="color: #3b82f6;">pom.xml</strong>                                  # プロジェクト設定ファイル
├── src/
│   └── main/
│       └── java/
│           └── com/example/demo/
│               ├── <strong style="color: #10b981;">DiSampleApplication.java</strong>     # 起動クラス（使う側）
│               └── used/                         # 使われる側のパッケージ
│                   ├── <strong style="color: #3b82f6;">Greet.java</strong>                # インターフェース
│                   ├── <strong style="color: #f59e0b;">MorningGreet.java</strong>         # 実装クラス①
│                   └── <strong style="color: #8b5cf6;">EveningGreet.java</strong>         # 実装クラス②
</pre>
                </div>

                <div style="margin-top: 24px;">
                    <p style="margin: 0 0 12px 0; font-weight: 600; color: #1e293b; font-size: 1.05em;">📋 各ファイルの役割</p>
                    <table style="width: 100%; border-collapse: collapse; background: white; border: 2px solid #e2e8f0; border-radius: 8px; overflow: hidden;">
                        <thead>
                            <tr style="background: #64748b;">
                                <th style="padding: 14px 16px; text-align: left; font-weight: 600; color: white; width: 30%;">ファイル名</th>
                                <th style="padding: 14px 16px; text-align: left; font-weight: 600; color: white;">役割</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="padding: 12px 16px; border-bottom: 1px solid #e2e8f0;"><code style="color: #3b82f6; font-weight: 600;">pom.xml</code></td>
                                <td style="padding: 12px 16px; border-bottom: 1px solid #e2e8f0; color: #64748b;">Mavenの設定ファイル。依存ライブラリやビルド設定を定義</td>
                            </tr>
                            <tr>
                                <td style="padding: 12px 16px; border-bottom: 1px solid #e2e8f0;"><code style="color: #10b981; font-weight: 600;">DiSampleApplication</code></td>
                                <td style="padding: 12px 16px; border-bottom: 1px solid #e2e8f0; color: #64748b;"><strong>使う側</strong>：Greetインターフェースを使って挨拶メソッドを呼び出す</td>
                            </tr>
                            <tr>
                                <td style="padding: 12px 16px; border-bottom: 1px solid #e2e8f0;"><code style="color: #3b82f6; font-weight: 600;">Greet</code></td>
                                <td style="padding: 12px 16px; border-bottom: 1px solid #e2e8f0; color: #64748b;"><strong>インターフェース</strong>：挨拶メソッド <code>greeting()</code> を定義</td>
                            </tr>
                            <tr>
                                <td style="padding: 12px 16px; border-bottom: 1px solid #e2e8f0;"><code style="color: #f59e0b; font-weight: 600;">MorningGreet</code></td>
                                <td style="padding: 12px 16px; border-bottom: 1px solid #e2e8f0; color: #64748b;"><strong>実装クラス①</strong>：「おはようございます」を返す</td>
                            </tr>
                            <tr>
                                <td style="padding: 12px 16px;"><code style="color: #8b5cf6; font-weight: 600;">EveningGreet</code></td>
                                <td style="padding: 12px 16px; color: #64748b;"><strong>実装クラス②</strong>：「こんばんは」を返す</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="diagram-container" style="margin-top: 32px;">
                    <div class="diagram-title">図3.6 DIを使ったファイル間の関係と動作の流れ</div>
                    <svg class="diagram-svg" viewBox="0 0 750 480" width="750" height="480">
                        <defs>
                            <marker id="arrow-file-gray" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#64748b"/>
                            </marker>
                            <marker id="arrow-file-blue" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#3b82f6"/>
                            </marker>
                            <marker id="arrow-file-green" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#22c55e"/>
                            </marker>
                            <marker id="arrow-file-cyan" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#06b6d4"/>
                            </marker>
                        </defs>

                        <!-- タイトル -->
                        <text x="375" y="25" text-anchor="middle" font-size="13" font-weight="bold" fill="#1e293b">演習で作成する4つのファイルとDIの動作</text>

                        <!-- ========== 上段：使う側クラス ========== -->

                        <!-- DiSampleApplication -->
                        <rect x="250" y="55" width="250" height="90" rx="10" fill="#d1fae5" stroke="#10b981" stroke-width="3"/>
                        <text x="375" y="80" text-anchor="middle" font-size="14" font-weight="bold" fill="#166534">DiSampleApplication.java</text>
                        <text x="375" y="100" text-anchor="middle" font-size="11" fill="#166534">（使う側クラス）</text>
                        <line x1="265" y1="110" x2="485" y2="110" stroke="#10b981" stroke-width="1"/>
                        <text x="375" y="125" text-anchor="middle" font-size="10" font-family="monospace" fill="#f59e0b" font-weight="600">@Autowired</text>
                        <text x="375" y="139" text-anchor="middle" font-size="10" font-family="monospace" fill="#1e293b">private Greet greet;</text>

                        <!-- ルール①② -->
                        <circle cx="220" cy="80" r="16" fill="#3b82f6" stroke="white" stroke-width="2"/>
                        <text x="220" y="85" text-anchor="middle" font-size="12" fill="white" font-weight="bold">①</text>

                        <circle cx="220" cy="115" r="16" fill="#8b5cf6" stroke="white" stroke-width="2"/>
                        <text x="220" y="120" text-anchor="middle" font-size="12" fill="white" font-weight="bold">②</text>

                        <circle cx="530" cy="100" r="16" fill="#22c55e" stroke="white" stroke-width="2"/>
                        <text x="530" y="105" text-anchor="middle" font-size="12" fill="white" font-weight="bold">⑤</text>

                        <!-- ========== 中段：インターフェース ========== -->

                        <!-- 使用の矢印 -->
                        <path d="M375 145 L375 175" stroke="#3b82f6" stroke-width="2.5" fill="none" marker-end="url(#arrow-file-blue)"/>
                        <text x="395" y="165" font-size="10" fill="#3b82f6" font-weight="600">使用</text>

                        <!-- Greet Interface -->
                        <rect x="275" y="175" width="200" height="60" rx="8" fill="#dbeafe" stroke="#3b82f6" stroke-width="2.5"/>
                        <text x="375" y="197" text-anchor="middle" font-size="11" fill="#3b82f6" font-weight="600">《interface》</text>
                        <text x="375" y="215" text-anchor="middle" font-size="15" font-weight="bold" fill="#1e40af">Greet.java</text>
                        <text x="375" y="230" text-anchor="middle" font-size="9" fill="#1e40af">greeting()</text>

                        <!-- ========== 下段：実装クラス ========== -->

                        <!-- 実装の矢印 -->
                        <path d="M325 235 L325 255 L180 255 L180 280" stroke="#64748b" stroke-width="2" fill="none" marker-end="url(#arrow-file-gray)" stroke-dasharray="4,2"/>
                        <text x="230" y="250" font-size="10" fill="#64748b">実装</text>

                        <path d="M425 235 L425 255 L570 255 L570 280" stroke="#64748b" stroke-width="2" fill="none" marker-end="url(#arrow-file-gray)" stroke-dasharray="4,2"/>
                        <text x="510" y="250" font-size="10" fill="#64748b">実装</text>

                        <!-- MorningGreet -->
                        <rect x="80" y="280" width="200" height="70" rx="8" fill="#10b981" stroke="#059669" stroke-width="2.5"/>
                        <rect x="95" y="295" width="80" height="18" rx="4" fill="#1e293b"/>
                        <text x="135" y="308" text-anchor="middle" font-size="9" font-family="monospace" fill="#fbbf24" font-weight="600">@Component</text>
                        <text x="180" y="325" text-anchor="middle" font-size="13" font-weight="bold" fill="white">MorningGreet.java</text>
                        <text x="180" y="342" text-anchor="middle" font-size="10" fill="#d1fae5">「おはようございます」</text>

                        <!-- ルール③ -->
                        <circle cx="50" cy="305" r="16" fill="#f59e0b" stroke="white" stroke-width="2"/>
                        <text x="50" y="310" text-anchor="middle" font-size="12" fill="white" font-weight="bold">③</text>

                        <!-- EveningGreet -->
                        <rect x="470" y="280" width="200" height="70" rx="8" fill="#e5e7eb" stroke="#9ca3af" stroke-width="2" stroke-dasharray="5,3"/>
                        <rect x="485" y="295" width="95" height="18" rx="4" fill="#f9fafb" stroke="#d1d5db" stroke-width="1"/>
                        <text x="532" y="308" text-anchor="middle" font-size="9" font-family="monospace" fill="#9ca3af">// @Component</text>
                        <text x="570" y="325" text-anchor="middle" font-size="13" font-weight="bold" fill="#6b7280">EveningGreet.java</text>
                        <text x="570" y="342" text-anchor="middle" font-size="10" fill="#9ca3af">「こんばんは」</text>

                        <!-- ========== DIコンテナ ========== -->

                        <!-- コンポーネントスキャンの矢印 -->
                        <path d="M180 350 L180 375 L275 375 L275 390" stroke="#06b6d4" stroke-width="2.5" fill="none" marker-end="url(#arrow-file-cyan)" stroke-dasharray="5,3"/>
                        <text x="215" y="368" font-size="10" fill="#06b6d4" font-weight="600">発見・生成</text>

                        <!-- ルール④ -->
                        <circle cx="135" cy="375" r="16" fill="#06b6d4" stroke="white" stroke-width="2"/>
                        <text x="135" y="380" text-anchor="middle" font-size="12" fill="white" font-weight="bold">④</text>

                        <!-- DIコンテナ -->
                        <rect x="275" y="390" width="200" height="55" rx="8" fill="#ecfeff" stroke="#06b6d4" stroke-width="2.5"/>
                        <text x="375" y="413" text-anchor="middle" font-size="12" font-weight="bold" fill="#0e7490">DIコンテナ</text>
                        <text x="375" y="429" text-anchor="middle" font-size="10" fill="#0891b2">MorningGreet</text>
                        <text x="375" y="441" text-anchor="middle" font-size="9" fill="#0891b2">インスタンスを保持</text>

                        <!-- 自動注入の矢印 -->
                        <path d="M425 390 L425 360 L450 360 L450 125 L500 125" stroke="#22c55e" stroke-width="2.5" fill="none" marker-end="url(#arrow-file-green)"/>
                        <text x="460" y="240" font-size="10" fill="#22c55e" font-weight="600">自動注入</text>

                        <!-- 凡例 -->
                        <rect x="520" y="390" width="210" height="75" rx="8" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
                        <text x="625" y="410" text-anchor="middle" font-size="11" font-weight="bold" fill="#b45309">演習で編集するファイル</text>
                        <text x="625" y="427" text-anchor="middle" font-size="9" fill="#92400e">STEP 1: Greet.java</text>
                        <text x="625" y="441" text-anchor="middle" font-size="9" fill="#92400e">STEP 2-3: Morning/Evening</text>
                        <text x="625" y="455" text-anchor="middle" font-size="9" fill="#92400e">STEP 4-5: DiSampleApplication</text>
                    </svg>
                </div>

                <div class="info-box" style="background: #eff6ff; border-left: 4px solid #3b82f6; padding: 20px; margin: 24px 0;">
                    <p style="margin: 0 0 16px 0; font-size: 1.05em; font-weight: 600; color: #1e40af;">
                        <span class="material-icons">menu_book</span> 図の見方と演習のポイント
                    </p>
                    <div style="background: white; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                        <p style="margin: 0 0 12px 0; font-weight: 600; color: #1e293b;">
                            🔍 図が示していること
                        </p>
                        <ol class="no-margin" style="padding-left: 24px; line-height: 2; color: #64748b;">
                            <li><strong style="color: #1e293b;">ファイルの役割</strong>：4つのJavaファイルがどのように関連しているか</li>
                            <li><strong style="color: #1e293b;">DIの5つのルール</strong>：①〜⑤の番号がどこに適用されるか</li>
                            <li><strong style="color: #1e293b;">DIコンテナの動作</strong>：自動的にインスタンスを生成・配布する流れ</li>
                            <li><strong style="color: #1e293b;">実装クラスの切り替え</strong>：@Componentを付け替えるだけで動作が変わる</li>
                        </ol>
                    </div>

                    <div style="background: white; border-radius: 8px; padding: 16px;">
                        <p style="margin: 0 0 12px 0; font-weight: 600; color: #1e293b;">
                            💡 演習で理解すべきポイント
                        </p>
                        <div style="display: grid; gap: 12px;">
                            <div style="padding: 12px; background: #f8fafc; border-left: 3px solid #3b82f6; border-radius: 4px;">
                                <strong style="color: #1e40af;">① インターフェース型での宣言</strong><br />
                                <span style="font-size: 0.9em; color: #64748b;">
                                    DiSampleApplicationは<code>Greet</code>型で宣言。<br />
                                    MorningGreetやEveningGreetという具体的なクラス名に依存しない
                                </span>
                            </div>
                            <div style="padding: 12px; background: #f8fafc; border-left: 3px solid #8b5cf6; border-radius: 4px;">
                                <strong style="color: #6d28d9;">② newを使わない</strong><br />
                                <span style="font-size: 0.9em; color: #64748b;">
                                    DiSampleApplicationには<code>new MorningGreet()</code>と書かない。<br />
                                    インスタンス生成はDIコンテナに任せる
                                </span>
                            </div>
                            <div style="padding: 12px; background: #f8fafc; border-left: 3px solid #f59e0b; border-radius: 4px;">
                                <strong style="color: #b45309;">③ @Componentで目印をつける</strong><br />
                                <span style="font-size: 0.9em; color: #64748b;">
                                    MorningGreetに<code>@Component</code>を付けることで、DIコンテナが発見できる。<br />
                                    EveningGreetはコメントアウト（灰色）で無効化
                                </span>
                            </div>
                            <div style="padding: 12px; background: #f8fafc; border-left: 3px solid #06b6d4; border-radius: 4px;">
                                <strong style="color: #0e7490;">④ コンポーネントスキャン（自動実行）</strong><br />
                                <span style="font-size: 0.9em; color: #64748b;">
                                    Spring起動時、@Componentが付いたクラスを自動発見し、<br />
                                    <code>new MorningGreet()</code>を実行してDIコンテナに保存
                                </span>
                            </div>
                            <div style="padding: 12px; background: #f8fafc; border-left: 3px solid #22c55e; border-radius: 4px;">
                                <strong style="color: #166534;">⑤ @Autowiredで自動注入</strong><br />
                                <span style="font-size: 0.9em; color: #64748b;">
                                    DIコンテナが<code>@Autowired</code>を見つけると、<br />
                                    保持しているMorningGreetインスタンスを自動的に代入
                                </span>
                            </div>
                        </div>
                    </div>

                    <div style="margin-top: 16px; padding: 14px; background: #fef3c7; border-radius: 6px; border: 1px solid #fbbf24;">
                        <p class="no-margin" style="font-size: 0.9em; color: #92400e;">
                            <strong>🎯 演習のゴール</strong><br />
                            この図の動作の流れ（①〜⑤）を、実際にコードを書いて体験することで、<br />
                            「DIコンテナが自動的にインスタンスを管理してくれる」仕組みを理解する。
                        </p>
                    </div>
                </div>

                <h4 style="margin-top: 32px;">pom.xml について</h4>

                <p>
                    <code>pom.xml</code>（Project Object Model）は、Mavenプロジェクトの設定ファイルです。<br />
                    Spring Initializrが自動生成してくれるので、今回は<strong>内容を確認するだけ</strong>でOKです。
                </p>

                <div class="code-block">
                    <div class="code-header">
                        <div class="code-dots">
                            <span class="code-dot red"></span>
                            <span class="code-dot yellow"></span>
                            <span class="code-dot green"></span>
                        </div>
                        <span class="code-title">pom.xml（主要部分の抜粋）</span>
                    </div>
                    <div class="code-content">
                        <pre><span class="line-num">001:</span> <span class="code-comment">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="line-num">002:</span> &lt;<span class="code-keyword">project</span> ...&gt;
<span class="line-num">003:</span>     <span class="code-comment">&lt;!-- プロジェクトの基本情報 --&gt;</span>
<span class="line-num">004:</span>     &lt;<span class="code-keyword">groupId</span>&gt;com.example&lt;/<span class="code-keyword">groupId</span>&gt;
<span class="line-num">005:</span>     &lt;<span class="code-keyword">artifactId</span>&gt;chapter3-di-sample&lt;/<span class="code-keyword">artifactId</span>&gt;
<span class="line-num">006:</span>     &lt;<span class="code-keyword">version</span>&gt;0.0.1-SNAPSHOT&lt;/<span class="code-keyword">version</span>&gt;
<span class="line-num">007:</span>
<span class="line-num">008:</span>     <span class="code-comment">&lt;!-- 依存ライブラリの定義 --&gt;</span>
<span class="line-num">009:</span>     &lt;<span class="code-keyword">dependencies</span>&gt;
<span class="line-num">010:</span>         <span class="code-comment">&lt;!-- Spring Boot の基本機能（DI、自動設定など） --&gt;</span>
<span class="line-num">011:</span>         &lt;<span class="code-keyword">dependency</span>&gt;
<span class="line-num">012:</span>             &lt;<span class="code-keyword">groupId</span>&gt;org.springframework.boot&lt;/<span class="code-keyword">groupId</span>&gt;
<span class="line-num">013:</span>             &lt;<span class="code-keyword">artifactId</span>&gt;<span class="code-string">spring-boot-starter</span>&lt;/<span class="code-keyword">artifactId</span>&gt;
<span class="line-num">014:</span>         &lt;/<span class="code-keyword">dependency</span>&gt;
<span class="line-num">015:</span>     &lt;/<span class="code-keyword">dependencies</span>&gt;
<span class="line-num">016:</span> &lt;/<span class="code-keyword">project</span>&gt;</pre>
                    </div>
                </div>

                <div class="config-table" style="margin-top: 16px;">
                    <div style="font-weight: 600; margin-bottom: 12px; color: var(--primary)">📦 pom.xml の主要要素</div>
                    <div class="config-row">
                        <span class="config-label">groupId</span>
                        <span class="config-value">プロジェクトを一意に識別するグループID（通常は組織のドメインを逆順に）</span>
                    </div>
                    <div class="config-row">
                        <span class="config-label">artifactId</span>
                        <span class="config-value">プロジェクト名（成果物の名前）</span>
                    </div>
                    <div class="config-row">
                        <span class="config-label">version</span>
                        <span class="config-value">プロジェクトのバージョン番号</span>
                    </div>
                    <div class="config-row">
                        <span class="config-label">dependencies</span>
                        <span class="config-value">使用する外部ライブラリの一覧</span>
                    </div>
                </div>

                <div class="info-box" style="background: #eff6ff; border-left: 4px solid #3b82f6; padding: 12px 16px; margin: 16px 0;">
                    <p class="no-margin" style="font-size: 0.95em;">
                        <strong>💡 spring-boot-starter とは</strong><br />
                        <code>spring-boot-starter</code> は Spring Boot の基本機能を提供するライブラリです。
                        <strong>DI（依存性注入）</strong>、自動設定、ログ機能などが含まれています。
                        今回のDIサンプルでは、このstarterのみで動作します。
                    </p>
                    <p style="margin: 12px 0 0 0; font-size: 0.9em; color: #64748b;">
                        ※ Web アプリケーションを作成する場合は <code>spring-boot-starter-web</code>、<br />
                        　 データベースを使用する場合は <code>spring-boot-starter-data-jpa</code> など、<br />
                        　 用途に応じた starter を追加します。
                    </p>
                </div>

                <h4>STEP 1：インターフェースの作成</h4>

                <p>
                    まず、挨拶機能を定義するインターフェースを作成します。<br />
                    <strong>src/main/java/com/example/demo/used</strong> パッケージに <code>Greet.java</code> を作成し、以下のコードを記述します。
                </p>

                <div class="info-box" style="background: #E0F7FA; border-left: 4px solid #22c55e; padding: 12px; margin: 12px 0;">
                    <p class="no-margin" style="font-size: 0.9em;">
                        <strong>✅ このステップで理解すること</strong><br />
                        インターフェースは<strong>契約（何ができるか）</strong>を定義します。<br />
                        ルール①「インターフェースを使う」の実践です。
                    </p>
                </div>

                <div class="prompt-box">
                    <div class="prompt-box-header">
                        <span class="prompt-box-icon"><span class="material-icons">chat</span></span>
                        <span class="prompt-box-title">プロンプト</span>
                        <button class="prompt-copy-btn">コピー</button>
                    </div>
                    <div class="prompt-box-content">
                        <pre><code>## 機能
DIで使用する挨拶インターフェースの作成

## 実装要件
- パッケージは「com.example.demo.used」
- インターフェース名は「Greet」
- 挨拶を返すメソッド「greeting()」を定義（戻り値String型）
- Javadocコメントを記述

## 使用するSpring構文/アノテーション
- interface キーワード（DI時の型として使用）
- DIではインターフェースを型として使い、実装クラスへの依存を避ける</code></pre>
                    </div>
                </div>
                <div class="code-block">
                    <div class="code-header">
                        <div class="code-dots">
                            <span class="code-dot red"></span>
                            <span class="code-dot yellow"></span>
                            <span class="code-dot green"></span>
                        </div>
                        <span class="code-title">リスト3.1 インターフェース Greet.java</span>
                    </div>
                    <div class="code-content">
                        <pre><span class="line-num">001:</span> <span class="code-keyword">package</span> com.example.demo.used;
<span class="line-num">002:</span>
<span class="line-num">003:</span> <span class="code-comment">/**</span>
<span class="line-num">004:</span> <span class="code-comment"> * 挨拶インターフェース</span>
<span class="line-num">005:</span> <span class="code-comment"> */</span>
<span class="line-num">006:</span> <span class="code-keyword">public interface</span> <span class="code-class">Greet</span> {
<span class="line-num">007:</span>     <span class="code-comment">/**</span>
<span class="line-num">008:</span>     <span class="code-comment"> * 挨拶を返す</span>
<span class="line-num">009:</span>     <span class="code-comment"> * @return 挨拶</span>
<span class="line-num">010:</span>     <span class="code-comment"> */</span>
<span class="line-num">011:</span>     <span class="code-class">String</span> <span class="code-method">greeting</span>();
<span class="line-num">012:</span> }</pre>
                    </div>
                </div>

                <h4>STEP 2：実装クラス①の作成（MorningGreet）</h4>

                <p>
                    Greetインターフェースを実装する1つ目のクラスを作成します。<br />
                    同じ <strong>used</strong> パッケージに <code>MorningGreet.java</code> を作成します。
                </p>

                <div class="info-box" style="background: #fef3c7; border-left: 4px solid #f59e0b; padding: 12px; margin: 12px 0;">
                    <p class="no-margin" style="font-size: 0.9em;">
                        <strong>✅ このステップで理解すること</strong><br />
                        インターフェースの<strong>具体的な処理（実装）</strong>を記述します。<br />
                        ルール②「newを使わない」ため、<strong>まだ @Component は付けません</strong>。
                    </p>
                </div>

                <div class="prompt-box">
                    <div class="prompt-box-header">
                        <span class="prompt-box-icon"><span class="material-icons">chat</span></span>
                        <span class="prompt-box-title">プロンプト</span>
                        <button class="prompt-copy-btn">コピー</button>
                    </div>
                    <div class="prompt-box-content">
                        <pre><code>## 機能
Greetインターフェースを実装した朝の挨拶クラスの作成

## 実装要件
- パッケージは「com.example.demo.used」
- クラス名は「MorningGreet」
- Greetインターフェースを実装
- greeting()メソッドで「おはようございます」を返す
- この段階では@Componentは付けない

## 使用するSpring構文/アノテーション
- implements キーワード（インターフェース実装）
- @Override アノテーション（オーバーライドの明示）</code></pre>
                    </div>
                </div>
                <div class="code-block">
                    <div class="code-header">
                        <div class="code-dots">
                            <span class="code-dot red"></span>
                            <span class="code-dot yellow"></span>
                            <span class="code-dot green"></span>
                        </div>
                        <span class="code-title">リスト3.2 実装クラス MorningGreet.java</span>
                    </div>
                    <div class="code-content">
                        <pre><span class="line-num">001:</span> <span class="code-keyword">package</span> com.example.demo.used;
<span class="line-num">002:</span>
<span class="line-num">003:</span> <span class="code-comment">/**</span>
<span class="line-num">004:</span> <span class="code-comment"> * 朝の挨拶を行う</span>
<span class="line-num">005:</span> <span class="code-comment"> */</span>
<span class="line-num">006:</span> <span class="code-keyword">public class</span> <span class="code-class">MorningGreet</span> <span class="code-keyword">implements</span> <span class="code-class">Greet</span> {
<span class="line-num">007:</span>     <span class="code-annotation">@Override</span>
<span class="line-num">008:</span>     <span class="code-keyword">public</span> <span class="code-class">String</span> <span class="code-method">greeting</span>() {
<span class="line-num">009:</span>         <span class="code-keyword">return</span> <span class="code-string">"おはようございます"</span>;
<span class="line-num">010:</span>     }
<span class="line-num">011:</span> }</pre>
                    </div>
                </div>

                <h4>STEP 3：実装クラス②の作成（EveningGreet）</h4>

                <p>
                    もう1つの実装クラスを作成します。<br />
                    同じ <strong>used</strong> パッケージに <code>EveningGreet.java</code> を作成します。
                </p>

                <div class="info-box" style="background: #f3e8ff; border-left: 4px solid #8b5cf6; padding: 12px; margin: 12px 0;">
                    <p class="no-margin" style="font-size: 0.9em;">
                        <strong>✅ このステップで理解すること</strong><br />
                        同じインターフェースに対して<strong>複数の実装</strong>を用意できます。<br />
                        後で@Componentを付け替えることで、動作を切り替えられます。
                    </p>
                </div>

                <div class="prompt-box">
                    <div class="prompt-box-header">
                        <span class="prompt-box-icon"><span class="material-icons">chat</span></span>
                        <span class="prompt-box-title">プロンプト</span>
                        <button class="prompt-copy-btn">コピー</button>
                    </div>
                    <div class="prompt-box-content">
                        <pre><code>## 機能
Greetインターフェースを実装した夕方の挨拶クラスの作成

## 実装要件
- パッケージは「com.example.demo.used」
- クラス名は「EveningGreet」
- Greetインターフェースを実装
- greeting()メソッドで「こんばんは」を返す
- この段階では@Componentは付けない（切り替え用）

## 使用するSpring構文/アノテーション
- implements キーワード（インターフェース実装）
- @Override アノテーション（オーバーライドの明示）</code></pre>
                    </div>
                </div>
                <div class="code-block">
                    <div class="code-header">
                        <div class="code-dots">
                            <span class="code-dot red"></span>
                            <span class="code-dot yellow"></span>
                            <span class="code-dot green"></span>
                        </div>
                        <span class="code-title">リスト3.3 実装クラス EveningGreet.java</span>
                    </div>
                    <div class="code-content">
                        <pre><span class="line-num">001:</span> <span class="code-keyword">package</span> com.example.demo.used;
<span class="line-num">002:</span>
<span class="line-num">003:</span> <span class="code-comment">/**</span>
<span class="line-num">004:</span> <span class="code-comment"> * 夕方の挨拶を行う</span>
<span class="line-num">005:</span> <span class="code-comment"> */</span>
<span class="line-num">006:</span> <span class="code-keyword">public class</span> <span class="code-class">EveningGreet</span> <span class="code-keyword">implements</span> <span class="code-class">Greet</span> {
<span class="line-num">007:</span>     <span class="code-annotation">@Override</span>
<span class="line-num">008:</span>     <span class="code-keyword">public</span> <span class="code-class">String</span> <span class="code-method">greeting</span>() {
<span class="line-num">009:</span>         <span class="code-keyword">return</span> <span class="code-string">"こんばんは"</span>;
<span class="line-num">010:</span>     }
<span class="line-num">011:</span> }</pre>
                    </div>
                </div>

                <h4>STEP 4：@Componentの付与（ルール③④の実施）</h4>

                <p>
                    ここでDIの重要な仕組みが登場します。<br />
                    <strong>ルール③</strong>「@Componentを付ける」と<strong>ルール④</strong>「コンポーネントスキャン」を実施します。
                </p>

                <div class="info-box" style="background: #eff6ff; border-left: 4px solid #3b82f6; padding: 16px; margin: 16px 0;">
                    <p style="margin: 0 0 12px 0; font-weight: 600; color: #1e40af;">
                        🔍 ここで何が起きるのか？
                    </p>
                    <div style="background: white; border-radius: 6px; padding: 12px;">
                        <p style="margin: 0 0 8px 0; font-size: 0.9em;">
                            ① <code>@Component</code>を付けると、Spring Framework起動時に...<br />
                            ② そのクラスを自動的に発見し（コンポーネントスキャン）<br />
                            ③ <code>new</code>を実行してインスタンスを生成<br />
                            ④ DIコンテナ内に保存される
                        </p>
                        <p style="margin: 12px 0 0 0; padding-top: 12px; border-top: 1px solid #e2e8f0; font-size: 0.85em; color: #64748b;">
                            つまり、私たちが <code>new</code> を書かなくても、Spring Frameworkが自動的にインスタンスを作ってくれます！
                        </p>
                    </div>
                </div>

                <div class="prompt-box">
                    <div class="prompt-box-header">
                        <span class="prompt-box-icon"><span class="material-icons">chat</span></span>
                        <span class="prompt-box-title">プロンプト</span>
                        <button class="prompt-copy-btn">コピー</button>
                    </div>
                    <div class="prompt-box-content">
                        <pre><code>## 機能
@Componentを付与してDIコンテナに登録する朝の挨拶クラス

## 実装要件
- パッケージは「com.example.demo.used」
- クラス名は「MorningGreet」
- Greetインターフェースを実装
- @Componentアノテーションを付与してDIコンテナに登録
- greeting()メソッドで「おはようございます」を返す

## 使用するSpring構文/アノテーション
- @Component（DIコンテナへのBean登録）
- implements キーワード（インターフェース実装）
- @Override アノテーション</code></pre>
                    </div>
                </div>
                <div class="code-block">
                    <div class="code-header">
                        <div class="code-dots">
                            <span class="code-dot red"></span>
                            <span class="code-dot yellow"></span>
                            <span class="code-dot green"></span>
                        </div>
                        <span class="code-title">リスト3.4a MorningGreet.java（@Componentの付与）</span>
                    </div>
                    <div class="code-content">
                        <pre><span class="line-num">001:</span> <span class="code-keyword">package</span> com.example.demo.used;
<span class="line-num">002:</span>
<span class="line-num">003:</span> <span class="code-keyword">import</span> org.springframework.stereotype.Component;
<span class="line-num">004:</span>
<span class="line-num">005:</span> <span class="code-comment">/**</span>
<span class="line-num">006:</span> <span class="code-comment"> * 朝の挨拶を行う</span>
<span class="line-num">007:</span> <span class="code-comment"> */</span>
<span class="line-num">008:</span> <span class="code-annotation">@Component</span>  <span class="code-comment">// ← DIコンテナに登録</span>
<span class="line-num">009:</span> <span class="code-keyword">public class</span> <span class="code-class">MorningGreet</span> <span class="code-keyword">implements</span> <span class="code-class">Greet</span> {
<span class="line-num">010:</span>     <span class="code-annotation">@Override</span>
<span class="line-num">011:</span>     <span class="code-keyword">public</span> <span class="code-class">String</span> <span class="code-method">greeting</span>() {
<span class="line-num">012:</span>         <span class="code-keyword">return</span> <span class="code-string">"おはようございます"</span>;
<span class="line-num">013:</span>     }
<span class="line-num">014:</span> }</pre>
                    </div>
                </div>

                <div class="code-block" style="margin-top: 16px;">
                    <div class="code-header">
                        <div class="code-dots">
                            <span class="code-dot red"></span>
                            <span class="code-dot yellow"></span>
                            <span class="code-dot green"></span>
                        </div>
                        <span class="code-title">リスト3.4b EveningGreet.java（@Componentの付与）</span>
                    </div>
                    <div class="code-content">
                        <pre><span class="line-num">001:</span> <span class="code-keyword">package</span> com.example.demo.used;
<span class="line-num">002:</span>
<span class="line-num">003:</span> <span class="code-keyword">import</span> org.springframework.stereotype.Component;
<span class="line-num">004:</span>
<span class="line-num">005:</span> <span class="code-comment">/**</span>
<span class="line-num">006:</span> <span class="code-comment"> * 夕方の挨拶を行う</span>
<span class="line-num">007:</span> <span class="code-comment"> */</span>
<span class="line-num">008:</span> <span class="code-comment">// @Component</span>  <span class="code-comment">← 初期状態ではコメントアウト</span>
<span class="line-num">009:</span> <span class="code-keyword">public class</span> <span class="code-class">EveningGreet</span> <span class="code-keyword">implements</span> <span class="code-class">Greet</span> {
<span class="line-num">010:</span>     <span class="code-annotation">@Override</span>
<span class="line-num">011:</span>     <span class="code-keyword">public</span> <span class="code-class">String</span> <span class="code-method">greeting</span>() {
<span class="line-num">012:</span>         <span class="code-keyword">return</span> <span class="code-string">"こんばんは"</span>;
<span class="line-num">013:</span>     }
<span class="line-num">014:</span> }</pre>
                    </div>
                </div>

                <div class="info-box" style="background: #fefce8; border-left: 4px solid #eab308; padding: 16px; margin: 16px 0;">
                    <p style="margin: 0 0 12px 0; font-size: 0.95em;">
                        <strong>⚠️ 重要：同じインターフェースに複数の @Component を付けるとエラー</strong>
                    </p>
                    <div style="background: white; border-radius: 6px; padding: 12px;">
                        <p style="margin: 0 0 8px 0; font-size: 0.9em;">
                            <code>Greet</code>インターフェースを実装したクラスが2つ（MorningGreet、EveningGreet）ありますが、<br />
                            <strong>両方に @Component を付けることはできません</strong>。
                        </p>
                        <p style="margin: 8px 0 0 0; font-size: 0.85em; color: #92400e;">
                            理由：DIコンテナが「どちらのインスタンスを使えばいいか」判断できず、エラーになります。
                        </p>
                    </div>
                    <div style="margin-top: 12px; padding: 12px; background: #E0F7FA; border-radius: 6px; border: 1px solid #86efac;">
                        <p class="no-margin" style="font-size: 0.9em; color: #166534;">
                            <strong>✅ 解決策</strong><br />
                            初期状態では <code>MorningGreet</code> のみ有効にし、<br />
                            <code>EveningGreet</code> の @Component は<strong>コメントアウト</strong>しておきます。
                        </p>
                    </div>
                </div>

                <h4>STEP 5：使う側クラスの実装（ルール①②⑤）</h4>

                <p>
                    ここまでで「使われる側」（インターフェースと実装クラス）の準備ができました。<br />
                    次に、これらを「使う側」のクラスを作成します。
                </p>

                <div class="info-box" style="background: #E0F7FA; border-left: 4px solid #10b981; padding: 16px; margin: 16px 0;">
                    <p style="margin: 0 0 12px 0; font-weight: 600; color: #166534;">
                        🔍 ここで実践する3つのルール
                    </p>
                    <div style="background: white; border-radius: 6px; padding: 12px;">
                        <div style="margin-bottom: 8px;">
                            <span style="display: inline-block; width: 24px; height: 24px; background: #3b82f6; color: white; border-radius: 50%; text-align: center; line-height: 24px; font-weight: bold; font-size: 12px;">①</span>
                            <strong style="margin-left: 8px;">インターフェース型で宣言</strong><br />
                            <span style="font-size: 0.85em; color: #64748b; margin-left: 32px;">
                                <code>Greet greet;</code> ← 具体的なクラス名（MorningGreetなど）は使わない
                            </span>
                        </div>
                        <div style="margin-bottom: 8px;">
                            <span style="display: inline-block; width: 24px; height: 24px; background: #8b5cf6; color: white; border-radius: 50%; text-align: center; line-height: 24px; font-weight: bold; font-size: 12px;">②</span>
                            <strong style="margin-left: 8px;">newを使わない</strong><br />
                            <span style="font-size: 0.85em; color: #64748b; margin-left: 32px;">
                                <code style="text-decoration: line-through;">new MorningGreet()</code> ← 書かない！
                            </span>
                        </div>
                        <div>
                            <span style="display: inline-block; width: 24px; height: 24px; background: #22c55e; color: white; border-radius: 50%; text-align: center; line-height: 24px; font-weight: bold; font-size: 12px;">⑤</span>
                            <strong style="margin-left: 8px;">@Autowiredで受け取る</strong><br />
                            <span style="font-size: 0.85em; color: #64748b; margin-left: 32px;">
                                DIコンテナに「ここにインスタンスを入れてください」と伝える
                            </span>
                        </div>
                    </div>
                </div>

                <div class="code-block">
                    <div class="code-header">
                        <div class="code-dots">
                            <span class="code-dot red"></span>
                            <span class="code-dot yellow"></span>
                            <span class="code-dot green"></span>
                        </div>
                        <span class="code-title">リスト3.5 起動クラス DiSampleApplication.java</span>
                    </div>
                    <div class="code-content">
                        <pre><span class="line-num">001:</span> <span class="code-keyword">package</span> com.example.demo;
<span class="line-num">002:</span>
<span class="line-num">003:</span> <span class="code-keyword">import</span> org.springframework.boot.SpringApplication;
<span class="line-num">004:</span> <span class="code-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;
<span class="line-num">005:</span>
<span class="line-num">006:</span> <span class="code-comment">/**</span>
<span class="line-num">007:</span> <span class="code-comment"> * SpringBoot起動クラス</span>
<span class="line-num">008:</span> <span class="code-comment"> */</span>
<span class="line-num">009:</span> <span class="code-annotation">@SpringBootApplication</span>
<span class="line-num">010:</span> <span class="code-keyword">public class</span> <span class="code-class">DiSampleApplication</span> {
<span class="line-num">011:</span>     <span class="code-keyword">public static void</span> <span class="code-method">main</span>(<span class="code-class">String</span>[] args) {
<span class="line-num">012:</span>         SpringApplication.<span class="code-method">run</span>(DiSampleApplication.<span class="code-keyword">class</span>, args);
<span class="line-num">013:</span>     }
<span class="line-num">014:</span> }</pre>
                    </div>
                </div>

                <p style="margin-top: 16px;">
                    Spring Initializrで生成された <code>DiSampleApplication.java</code> に、以下の内容を追加します。
                </p>

                <div class="code-block" style="margin-top: 16px;">
                    <div class="code-header">
                        <div class="code-dots">
                            <span class="code-dot red"></span>
                            <span class="code-dot yellow"></span>
                            <span class="code-dot green"></span>
                        </div>
                        <span class="code-title">リスト3.6 フィールド宣言（追加する部分）</span>
                    </div>
                    <div class="code-content">
                        <pre><span class="line-num">001:</span> <span class="code-comment">/** 注入される箇所(インターフェース) */</span>
<span class="line-num">002:</span> <span class="code-annotation">@Autowired</span>  <span class="code-comment">← ルール⑤：DIコンテナに「ここにインスタンスを入れて」と伝える</span>
<span class="line-num">003:</span> <span class="code-keyword">private</span> <span class="code-class">Greet</span> greet;  <span class="code-comment">← ルール①：インターフェース型で宣言</span></pre>
                    </div>
                </div>

                <div class="code-block">
                    <div class="code-header">
                        <div class="code-dots">
                            <span class="code-dot red"></span>
                            <span class="code-dot yellow"></span>
                            <span class="code-dot green"></span>
                        </div>
                        <span class="code-title">リスト3.9 使う側クラス「DiSampleApplication」（修正後）</span>
                    </div>
                    <div class="code-content">
                        <pre><span class="line-num">001:</span> <span class="code-keyword">package</span> com.example.demo;
<span class="line-num">002:</span>
<span class="line-num">003:</span> <span class="code-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="line-num">004:</span> <span class="code-keyword">import</span> org.springframework.boot.SpringApplication;
<span class="line-num">005:</span> <span class="code-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;
<span class="line-num">006:</span>
<span class="line-num">007:</span> <span class="code-keyword">import</span> com.example.demo.used.Greet;
<span class="line-num">008:</span>
<span class="line-num">009:</span> <span class="code-comment">/**</span>
<span class="line-num">010:</span> <span class="code-comment"> * SpringBoot起動クラス</span>
<span class="line-num">011:</span> <span class="code-comment"> */</span>
<span class="line-num">012:</span> <span class="code-annotation">@SpringBootApplication</span>
<span class="line-num">013:</span> <span class="code-keyword">public class</span> <span class="code-class">DiSampleApplication</span> {
<span class="line-num">014:</span>     <span class="code-comment">/**</span>
<span class="line-num">015:</span>     <span class="code-comment"> * SpringBoot起動</span>
<span class="line-num">016:</span>     <span class="code-comment"> * @param args</span>
<span class="line-num">017:</span>     <span class="code-comment"> */</span>
<span class="line-num">018:</span>     <span class="code-keyword">public static void</span> <span class="code-method">main</span>(<span class="code-class">String</span>[] args) {
<span class="line-num">019:</span>         SpringApplication.<span class="code-method">run</span>(DiSampleApplication.<span class="code-keyword">class</span>, args)
<span class="line-num">020:</span>             .<span class="code-method">getBean</span>(DiSampleApplication.<span class="code-keyword">class</span>).<span class="code-method">execute</span>();
<span class="line-num">021:</span>     }
<span class="line-num">022:</span>
<span class="line-num">023:</span>     <span class="code-comment">/** 注入される箇所(インターフェース) */</span>
<span class="line-num">024:</span>     <span class="code-annotation">@Autowired</span>
<span class="line-num">025:</span>     <span class="code-keyword">private</span> <span class="code-class">Greet</span> greet;
<span class="line-num">026:</span>
<span class="line-num">027:</span>     <span class="code-comment">/**</span>
<span class="line-num">028:</span>     <span class="code-comment"> * 実行</span>
<parameter name="line-num">029:</span>     <span class="code-comment"> */</span>
<span class="line-num">030:</span>     <span class="code-keyword">private void</span> <span class="code-method">execute</span>() {
<span class="line-num">031:</span>         <span class="code-class">String</span> msg = greet.<span class="code-method">greeting</span>();
<span class="line-num">032:</span>         System.out.<span class="code-method">println</span>(msg);
<span class="line-num">033:</span>     }
<span class="line-num">034:</span> }</pre>
                    </div>
                </div>

                <h4>STEP 6：実行と動作確認</h4>

                <p>
                    ここまでで、DIを使ったプログラムが完成しました。<br />
                    実際に実行して、DIコンテナがインスタンスを自動的に生成・配布する様子を確認しましょう。
                </p>

                <div class="info-box" style="background: #eff6ff; border-left: 4px solid #3b82f6; padding: 16px; margin: 16px 0;">
                    <p style="margin: 0 0 12px 0; font-weight: 600; color: #1e40af;">
                        🔍 実行時に何が起きるのか？
                    </p>
                    <div style="background: white; border-radius: 6px; padding: 12px;">
                        <ol class="no-margin" style="padding-left: 24px; line-height: 2;">
                            <li>Spring Framework が起動</li>
                            <li><code>@Component</code>が付いた <code>MorningGreet</code> を発見</li>
                            <li><code>new MorningGreet()</code> を自動実行</li>
                            <li>生成したインスタンスをDIコンテナに保存</li>
                            <li><code>@Autowired</code>が付いたフィールド <code>g</code> にインスタンスを自動代入</li>
                            <li><code>execute()</code> メソッドが実行され、「おはようございます」が表示される</li>
                        </ol>
                    </div>
                </div>

                <div class="info-box" style="background: #E0F7FA; border-left: 4px solid #22c55e; padding: 16px; margin-bottom: 20px;">
                    <p style="margin: 0 0 12px 0; font-size: 0.95em;">
                        <strong>🌱 推奨：Spring Boot Dashboard 拡張機能のインストール</strong><br />
                        VSCodeでSpring Bootアプリケーションを効率的に開発するために、<strong>Spring Boot Dashboard</strong> 拡張機能のインストールを推奨します。
                        この拡張機能を使うと、アプリケーションの起動・停止・デバッグをGUIで簡単に管理できます。
                    </p>
                    <div class="config-table" style="background: white; margin-top: 12px;">
                        <div style="font-weight: 600; margin-bottom: 10px; color: #16a34a;">📥 インストール手順</div>
                        <div class="config-row">
                            <span class="config-label">手順1</span>
                            <span class="config-value">VSCode左側の「拡張機能」アイコン（四角形4つ）をクリック</span>
                        </div>
                        <div class="config-row">
                            <span class="config-label">手順2</span>
                            <span class="config-value">検索ボックスに <code>Spring Boot Dashboard</code> と入力</span>
                        </div>
                        <div class="config-row">
                            <span class="config-label">手順3</span>
                            <span class="config-value">「Spring Boot Dashboard」（VMware 提供）を選択し「インストール」をクリック</span>
                        </div>
                        <div class="config-row">
                            <span class="config-label">手順4</span>
                            <span class="config-value">インストール後、左側のサイドバーに「Spring Boot Dashboard」アイコンが追加される</span>
                        </div>
                    </div>
                    <p style="margin: 12px 0 0 0; font-size: 0.85em; color: #64748b;">
                        ※ 拡張機能ID: <code>vscjava.vscode-spring-boot-dashboard</code><br />
                        ※ 関連する拡張機能（Extension Pack for Java, Spring Boot Extension Pack）も一緒にインストールされる場合があります。
                    </p>
                </div>

                <p>
                    VSCodeで実行する方法は3通りあります。
                </p>

                <table style="width: 100%; border-collapse: collapse; background: white; border: 2px solid #e2e8f0; border-radius: 8px; overflow: hidden; margin-top: 16px;">
                    <thead>
                        <tr style="background: #64748b;">
                            <th style="padding: 14px 16px; text-align: left; font-weight: 600; color: white; width: 35%;">実行方法</th>
                            <th style="padding: 14px 16px; text-align: left; font-weight: 600; color: white;">手順・説明</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="padding: 12px 16px; border-bottom: 1px solid #e2e8f0; vertical-align: top;">
                                <strong style="color: #1e293b;">方法1：Spring Boot Dashboard</strong><br>
                                <span style="font-size: 0.85em; color: #10b981; font-weight: 600;">（推奨）</span>
                            </td>
                            <td style="padding: 12px 16px; border-bottom: 1px solid #e2e8f0; color: #64748b;">
                                <strong>手順1</strong>：左側のサイドバーで「Spring Boot Dashboard」アイコンをクリック<br>
                                <strong>手順2</strong>：表示されるプロジェクト一覧から対象アプリを右クリック → 「Run」を選択<br>
                                <span style="display: inline-block; margin-top: 8px; padding: 4px 8px; background: #E0F7FA; color: #166534; font-size: 0.85em; border-radius: 4px;">
                                    💡 複数プロジェクトの管理、起動状態の確認、停止操作が容易
                                </span>
                            </td>
                        </tr>
                        <tr>
                            <td style="padding: 12px 16px; border-bottom: 1px solid #e2e8f0; vertical-align: top;">
                                <strong style="color: #1e293b;">方法2：エディタから実行</strong>
                            </td>
                            <td style="padding: 12px 16px; border-bottom: 1px solid #e2e8f0; color: #64748b;">
                                <strong>手順1</strong>：<code>DiSampleApplication.java</code> を開く<br>
                                <strong>手順2</strong>：<code>main</code> メソッドの上に表示される「Run」をクリック
                            </td>
                        </tr>
                        <tr>
                            <td style="padding: 12px 16px; vertical-align: top;">
                                <strong style="color: #1e293b;">方法3：ターミナルから実行</strong>
                            </td>
                            <td style="padding: 12px 16px; color: #64748b;">
                                コマンド：<code style="background: #f1f5f9; padding: 2px 6px; border-radius: 3px;">mvn spring-boot:run</code>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <p style="margin-top: 16px;">
                    <code>@Component</code> を付与した <code>MorningGreet</code> クラスのメソッド <code>greeting()</code> が呼ばれ、「おはようございます」が表示されます。
                </p>

                <div class="result-box">
                    <div class="result-title">図3.16 実行結果</div>
                    <div class="result-content">
<span style="color: #94a3b8;">============================</span>
<span style="color: #1e293b; font-weight: 600;">DIサンプル実行結果</span>
<span style="color: #94a3b8;">============================</span>

<span style="color: #10b981; font-weight: 700;">挨拶: おはようございます</span>

<span style="color: #94a3b8;">============================</span>
                    </div>
                </div>

                <h4>STEP 7：実装クラスの切り替え（DIの最大の利点を体験）</h4>

                <p>
                    ここが<strong>DIの真価</strong>を実感できる瞬間です！<br />
                    仕様変更があり、挨拶を「おはようございます」から「こんばんは」に変更したいとします。
                </p>

                <div class="highlight-box" style="background: #fef3c7; border-left: 4px solid #f59e0b; padding: 20px; margin: 20px 0;">
                    <p style="margin: 0 0 12px 0; font-size: 1.1em; font-weight: 700; color: #92400e;">
                        🎯 このステップで確認すること
                    </p>
                    <div style="background: white; border-radius: 8px; padding: 16px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                            <div style="padding: 12px; background: #fef2f2; border-left: 3px solid #dc2626; border-radius: 6px;">
                                <div style="font-weight: 600; color: #dc2626; margin-bottom: 8px;">❌ 従来の方法</div>
                                <div style="font-size: 0.85em; color: #64748b;">
                                    <code>DiSampleApplication.java</code> の<br />
                                    <code style="text-decoration: line-through;">new MorningGreet()</code><br />
                                    を<br />
                                    <code>new EveningGreet()</code><br />
                                    に<strong>書き換える必要がある</strong>
                                </div>
                            </div>
                            <div style="padding: 12px; background: #E0F7FA; border-left: 3px solid #22c55e; border-radius: 6px;">
                                <div style="font-weight: 600; color: #22c55e; margin-bottom: 8px;">✅ DIを使った場合</div>
                                <div style="font-size: 0.85em; color: #64748b;">
                                    <code>@Component</code>を付け替えるだけ！<br />
                                    <code>DiSampleApplication.java</code><br />
                                    <strong>一切変更不要！</strong>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <p style="margin-top: 20px; margin-bottom: 12px; font-weight: 600; color: #1e293b;">📋 切り替え手順</p>
                <table style="width: 100%; border-collapse: collapse; background: white; border: 2px solid #e2e8f0; border-radius: 8px; overflow: hidden;">
                    <thead>
                        <tr style="background: #64748b;">
                            <th style="padding: 14px 16px; text-align: left; font-weight: 600; color: white; width: 15%;">手順</th>
                            <th style="padding: 14px 16px; text-align: left; font-weight: 600; color: white;">内容</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="padding: 12px 16px; border-bottom: 1px solid #e2e8f0; vertical-align: top;">
                                <strong style="color: #1e293b;">手順1</strong>
                            </td>
                            <td style="padding: 12px 16px; border-bottom: 1px solid #e2e8f0; color: #64748b;">
                                <code>MorningGreet.java</code> の <code>@Component</code> を<strong>コメントアウト</strong><br>
                                <span style="font-size: 0.85em; color: #94a3b8;">（または削除）</span>
                            </td>
                        </tr>
                        <tr>
                            <td style="padding: 12px 16px; border-bottom: 1px solid #e2e8f0; vertical-align: top;">
                                <strong style="color: #1e293b;">手順2</strong>
                            </td>
                            <td style="padding: 12px 16px; border-bottom: 1px solid #e2e8f0; color: #64748b;">
                                <code>EveningGreet.java</code> の <code>// @Component</code> の<strong>コメントを外す</strong><br>
                                <span style="font-size: 0.85em; color: #94a3b8;">（<code>@Component</code> を有効化）</span>
                            </td>
                        </tr>
                        <tr style="background: #E0F7FA;">
                            <td style="padding: 12px 16px; border-bottom: 1px solid #e2e8f0; vertical-align: top;">
                                <strong style="color: #166534;">💡 重要</strong>
                            </td>
                            <td style="padding: 12px 16px; border-bottom: 1px solid #e2e8f0;">
                                <strong style="color: #166534;">DiSampleApplication.java は一切触らない！</strong><br>
                                <span style="font-size: 0.85em; color: #64748b;">呼び出し側のコードを変更せずに、動作が切り替わることを確認してください</span>
                            </td>
                        </tr>
                        <tr>
                            <td style="padding: 12px 16px; vertical-align: top;">
                                <strong style="color: #1e293b;">手順3</strong>
                            </td>
                            <td style="padding: 12px 16px; color: #64748b;">
                                再度実行し、<strong>「こんばんは」</strong>が表示されることを確認
                            </td>
                        </tr>
                    </tbody>
                </table>

                <div class="code-block" style="margin-top: 16px;">
                    <div class="code-header">
                        <div class="code-dots">
                            <span class="code-dot red"></span>
                            <span class="code-dot yellow"></span>
                            <span class="code-dot green"></span>
                        </div>
                        <span class="code-title">MorningGreet.java（@Componentをコメントアウト）</span>
                    </div>
                    <div class="code-content">
                        <pre><span class="line-num">001:</span> <span class="code-comment">// @Component  ← コメントアウト</span>
<span class="line-num">002:</span> <span class="code-keyword">public class</span> <span class="code-class">MorningGreet</span> <span class="code-keyword">implements</span> <span class="code-class">Greet</span> {</pre>
                    </div>
                </div>

                <div class="code-block">
                    <div class="code-header">
                        <div class="code-dots">
                            <span class="code-dot red"></span>
                            <span class="code-dot yellow"></span>
                            <span class="code-dot green"></span>
                        </div>
                        <span class="code-title">EveningGreet.java（@Componentを有効化）</span>
                    </div>
                    <div class="code-content">
                        <pre><span class="line-num">001:</span> <span class="code-annotation">@Component</span>  <span class="code-comment">// ← コメントを外す</span>
<span class="line-num">002:</span> <span class="code-keyword">public class</span> <span class="code-class">EveningGreet</span> <span class="code-keyword">implements</span> <span class="code-class">Greet</span> {</pre>
                    </div>
                </div>

                <div class="result-box">
                    <div class="result-title">図3.17 実行結果（切り替え後）</div>
                    <div class="result-content">
<span style="color: #94a3b8;">============================</span>
<span style="color: #1e293b; font-weight: 600;">DIサンプル実行結果</span>
<span style="color: #94a3b8;">============================</span>

<span style="color: #8b5cf6; font-weight: 700;">挨拶: こんばんは</span>

<span style="color: #94a3b8;">============================</span>
                    </div>
                </div>

                <div class="highlight-box" style="margin-top: 16px;">
                    <p>
                        <strong>✅ DIのメリットを確認</strong><br>
                        <code>DiSampleApplication.java</code>（使う側）は<strong>一切変更していない</strong>のに、<br>
                        出力結果が「おはようございます」から「こんばんは」に変わりました。<br><br>
                        これが <strong>DI（参照を渡す仕組み）</strong> のメリットです！
                    </p>
                </div>

                <h3>3-2-4 まとめ</h3>

                <div class="summary-box">
                    <div class="summary-title">📝 この節のまとめ</div>
                    <ul class="summary-list">
                        <li>
                            Spring Frameworkは任意に実装したクラスをインスタンス化する機能を提供します（DIコンテナ）
                        </li>
                        <li>
                            Spring
                            Frameworkを利用したアプリケーションではインスタンスを明示的に生成しません（「new」キーワードを使わない）
                        </li>
                        <li>
                            ステレオタイプアノテーション（ここでは「@Component」）をクラスに付与する事でSpring
                            Frameworkにインスタンスを生成させます
                        </li>
                        <li>
                            生成されたインスタンスを利用したい箇所でフィールドを用意し、アノテーション（ここでは「@Autowired」）を付与することでSpring
                            Frameworkはインタンスが必要なことを判断しインスタンスを注入します
                        </li>
                        <li>
                            インターフェースを利用した依存関係を作り、DIを使用することで「使われる側」クラスを変更する場合、「使う側」クラスの修正をゼロにすることができます
                        </li>
                    </ul>
                </div>

                <div class="highlight-box" style="background: #E0F7FA; border-left: 4px solid #22c55e; padding: 24px; margin: 32px 0;">
                    <p style="margin: 0 0 20px 0; font-size: 1.15em; font-weight: 700; color: #166534;">
                        ✅ 演習のまとめ：DIで実現できたこと
                    </p>

                    <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 16px;">
                        <p style="margin: 0 0 16px 0; font-weight: 600; color: #1e293b; font-size: 1.05em;">
                            📌 修正箇所の比較
                        </p>
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="background: #f8fafc;">
                                    <th style="padding: 12px; border: 2px solid #e2e8f0; text-align: left;">方法</th>
                                    <th style="padding: 12px; border: 2px solid #e2e8f0; text-align: center;">修正箇所</th>
                                    <th style="padding: 12px; border: 2px solid #e2e8f0; text-align: left;">修正内容</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 12px; border: 2px solid #e2e8f0; font-weight: 600;">従来の方法</td>
                                    <td style="padding: 12px; border: 2px solid #e2e8f0; text-align: center; background: #fef2f2; color: #dc2626; font-weight: 700; font-size: 1.2em;">1箇所</td>
                                    <td style="padding: 12px; border: 2px solid #e2e8f0; font-size: 0.9em;">
                                        <code style="text-decoration: line-through;">new MorningGreet()</code> → <code>new EveningGreet()</code><br />
                                        <span style="color: #64748b;">呼び出し側のコード修正が必要</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="padding: 12px; border: 2px solid #e2e8f0; font-weight: 600;">DI使用</td>
                                    <td style="padding: 12px; border: 2px solid #e2e8f0; text-align: center; background: #E0F7FA; color: #22c55e; font-weight: 700; font-size: 1.2em;">0箇所！</td>
                                    <td style="padding: 12px; border: 2px solid #e2e8f0; font-size: 0.9em;">
                                        <code>@Component</code>を付け替えるだけ<br />
                                        <span style="color: #22c55e; font-weight: 600;">DiSampleApplication.java は変更不要</span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div style="background: white; border-radius: 12px; padding: 20px;">
                        <p style="margin: 0 0 16px 0; font-weight: 600; color: #1e293b; font-size: 1.05em;">
                            🎓 この演習で学んだこと
                        </p>
                        <div style="display: grid; gap: 12px;">
                            <div style="display: flex; gap: 12px; align-items: start;">
                                <span style="flex-shrink: 0; width: 32px; height: 32px; background: #3b82f6; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold;">①</span>
                                <div>
                                    <strong>インターフェース型での宣言</strong><br />
                                    <span style="font-size: 0.85em; color: #64748b;">具体的なクラス名に依存しない柔軟な設計</span>
                                </div>
                            </div>
                            <div style="display: flex; gap: 12px; align-items: start;">
                                <span style="flex-shrink: 0; width: 32px; height: 32px; background: #8b5cf6; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold;">②</span>
                                <div>
                                    <strong>newを使わない</strong><br />
                                    <span style="font-size: 0.85em; color: #64748b;">インスタンス生成をDIコンテナに任せる</span>
                                </div>
                            </div>
                            <div style="display: flex; gap: 12px; align-items: start;">
                                <span style="flex-shrink: 0; width: 32px; height: 32px; background: #f59e0b; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold;">③</span>
                                <div>
                                    <strong>@Componentでクラスをマーク</strong><br />
                                    <span style="font-size: 0.85em; color: #64748b;">DIコンテナに「このクラスを管理して」と伝える</span>
                                </div>
                            </div>
                            <div style="display: flex; gap: 12px; align-items: start;">
                                <span style="flex-shrink: 0; width: 32px; height: 32px; background: #06b6d4; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold;">④</span>
                                <div>
                                    <strong>コンポーネントスキャン</strong><br />
                                    <span style="font-size: 0.85em; color: #64748b;">Spring起動時に自動的にクラスを発見・インスタンス化</span>
                                </div>
                            </div>
                            <div style="display: flex; gap: 12px; align-items: start;">
                                <span style="flex-shrink: 0; width: 32px; height: 32px; background: #22c55e; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold;">⑤</span>
                                <div>
                                    <strong>@Autowiredで自動注入</strong><br />
                                    <span style="font-size: 0.85em; color: #64748b;">DIコンテナが適切なインスタンスを自動で渡してくれる</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div style="margin-top: 16px; padding: 16px; background: #fef3c7; border-radius: 8px; border: 1px solid #fbbf24;">
                        <p class="no-margin" style="font-size: 0.95em; color: #92400e;">
                            <strong>💡 最も重要なポイント</strong><br />
                            DIを使うことで、<strong>呼び出し側のコードを一切変更することなく</strong>、実装クラスを切り替えることができます。<br />
                            これにより、コードの<strong>保守性</strong>と<strong>拡張性</strong>が大幅に向上します！
                        </p>
                    </div>
                </div>

                <div class="column">
                    <div class="column-header">
                        <span class="column-badge">Column</span>
                        <span class="column-title">DIコンテナを現実世界の例で考える</span>
                    </div>
                    <p>
                        あなたが旅行を計画しているとします。しかし、飛行機のチケット、ホテルの予約、観光ツアーなど、全てを自分で手配するのは大変です。そこで、旅行会社に行き、彼らにあなたの旅行計画の手配を依頼します。
                    </p>
                    <p>
                        ここでの「旅行会社」は「DIコンテナ」に相当します。旅行会社はあなたの旅行に必要な全ての要素（飛行機のチケット、ホテル、ツアー）つまりは「インスタンス」を提供します。あなたは、それらの詳細を自分で手配する必要はありません。
                    </p>
                    <p style="margin-bottom: 0">
                        旅行会社を利用することで、旅の各要素を自分で管理する複雑さが取り除かれます。プログラムでは、DIを使用することで、クラスはその実装の詳細（どのデータベースを使用するか、どのサービスに接続するかなど）から分離されます。
                    </p>
                </div>
            </section>

            <!-- Section 3-3 -->
            <section class="section">
                <div class="section-header">
                    <span class="section-number">Section 3-3</span>
                    <h2 class="section-title">DIについて知ろう<br />（インスタンス生成）</h2>
                </div>

                <p>
                    ここではDIについて深堀します。引き続き見慣れない言葉が出てきますが「そうなんだ」位の気持ちで学習してください。まずは「Bean」という言葉から説明します。
                </p>

                <h3>3-3-1 Beanとは？</h3>

                <p>
                    Spring Frameworkは、「DIコンテナ」という<strong>メモリ上でインスタンスを管理する領域</strong>を持っています。
                </p>

                <div class="highlight-box">
                    <p><strong>📦 DIコンテナの動作（メモリの視点）</strong></p>
                    <table style="width: 100%; border-collapse: collapse; margin-top: 8px;">
                        <tr>
                            <td style="padding: 8px; vertical-align: top; width: 80px;">
                                <span style="display: inline-block; width: 24px; height: 24px; background: #3b82f6; color: white; border-radius: 50%; text-align: center; line-height: 24px; font-weight: bold; font-size: 12px;">1</span>
                            </td>
                            <td style="padding: 8px;">
                                <strong>コンポーネントスキャン</strong><br>
                                アプリケーション起動時に <code>@Component</code> が付いたクラスを探す
                            </td>
                        </tr>
                        <tr>
                            <td style="padding: 8px; vertical-align: top;">
                                <span style="display: inline-block; width: 24px; height: 24px; background: #22c55e; color: white; border-radius: 50%; text-align: center; line-height: 24px; font-weight: bold; font-size: 12px;">2</span>
                            </td>
                            <td style="padding: 8px;">
                                <strong>インスタンス生成</strong><br>
                                見つけたクラスを <code>new</code> してメモリ上にインスタンスを生成
                            </td>
                        </tr>
                        <tr>
                            <td style="padding: 8px; vertical-align: top;">
                                <span style="display: inline-block; width: 24px; height: 24px; background: #f59e0b; color: white; border-radius: 50%; text-align: center; line-height: 24px; font-weight: bold; font-size: 12px;">3</span>
                            </td>
                            <td style="padding: 8px;">
                                <strong>DIコンテナに登録</strong><br>
                                生成したインスタンスの<strong>メモリアドレス</strong>をDIコンテナに登録
                            </td>
                        </tr>
                    </table>
                </div>

                <p style="margin-top: 16px;">
                    このようにDIコンテナで管理されているインスタンスのことを「<strong>Bean</strong>」と呼びます。
                </p>

                <p style="margin-top: 20px; margin-bottom: 12px; font-weight: 600; color: #1e293b;">💡 Beanの正体</p>
                <table style="width: 100%; border-collapse: collapse; background: white; border: 2px solid #e2e8f0; border-radius: 8px; overflow: hidden;">
                    <thead>
                        <tr style="background: #64748b;">
                            <th style="padding: 14px 16px; text-align: left; font-weight: 600; color: white; width: 25%;">用語</th>
                            <th style="padding: 14px 16px; text-align: left; font-weight: 600; color: white;">説明</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="padding: 12px 16px; border-bottom: 1px solid #e2e8f0; vertical-align: top;">
                                <strong style="color: #1e293b;">Bean</strong>
                            </td>
                            <td style="padding: 12px 16px; border-bottom: 1px solid #e2e8f0; color: #64748b;">
                                DIコンテナが管理している<strong>メモリ上のインスタンス</strong>
                            </td>
                        </tr>
                        <tr>
                            <td style="padding: 12px 16px; vertical-align: top;">
                                <strong style="color: #1e293b;">取り出す</strong>
                            </td>
                            <td style="padding: 12px 16px; color: #64748b;">
                                DIコンテナから<strong>メモリアドレス（参照）を受け取る</strong>こと
                            </td>
                        </tr>
                    </tbody>
                </table>

                <p style="margin-top: 16px;">
                    簡単に言うと、Springの使い方は「DIコンテナからBeanの参照を受け取って処理をさせる」ことです。<br>
                    <code>@Autowired</code> を付けたフィールドには、DIコンテナから自動的にBeanの参照が渡されます。
                </p>

                <div class="diagram-container">
                    <div class="diagram-title">図3.18 Bean とは</div>
                    <svg class="diagram-svg" viewBox="0 0 700 320" width="700" height="320">
                        <defs>
                            <marker id="arrow-bean-blue" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#3b82f6"/>
                            </marker>
                            <marker id="arrow-bean-green" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#22c55e"/>
                            </marker>
                        </defs>

                        <!-- 左側：@Componentクラス -->
                        <rect x="20" y="30" width="180" height="170" rx="10" fill="#f8fafc" stroke="#cbd5e1" stroke-width="2"/>
                        <text x="110" y="55" text-anchor="middle" font-size="11" fill="#64748b" font-weight="600">@Component が付いたクラス</text>

                        <!-- MorningGreet -->
                        <rect x="40" y="75" width="140" height="45" rx="6" fill="#10b981"/>
                        <rect x="48" y="82" width="75" height="14" rx="3" fill="#1e293b"/>
                        <text x="85" y="92" text-anchor="middle" font-size="8" font-family="monospace" fill="#fbbf24">@Component</text>
                        <text x="110" y="110" text-anchor="middle" font-size="10" font-weight="bold" fill="white">MorningGreet</text>

                        <!-- UserService -->
                        <rect x="40" y="135" width="140" height="45" rx="6" fill="#10b981"/>
                        <rect x="48" y="142" width="75" height="14" rx="3" fill="#1e293b"/>
                        <text x="85" y="152" text-anchor="middle" font-size="8" font-family="monospace" fill="#fbbf24">@Component</text>
                        <text x="110" y="170" text-anchor="middle" font-size="10" font-weight="bold" fill="white">UserService</text>

                        <!-- コンポーネントスキャン矢印 -->
                        <path d="M200 120 L250 120" stroke="#3b82f6" stroke-width="2.5" fill="none" marker-end="url(#arrow-bean-blue)"/>
                        <text x="225" y="108" text-anchor="middle" font-size="9" fill="#3b82f6" font-weight="600">スキャン</text>

                        <!-- 中央：DIコンテナ -->
                        <rect x="260" y="20" width="230" height="200" rx="12" fill="#dbeafe" stroke="#3b82f6" stroke-width="2.5"/>
                        <text x="375" y="48" text-anchor="middle" font-size="13" font-weight="bold" fill="#1d4ed8">DIコンテナ</text>
                        <text x="375" y="65" text-anchor="middle" font-size="10" fill="#3b82f6">（インスタンス管理）</text>

                        <!-- Bean 1 -->
                        <rect x="285" y="85" width="175" height="50" rx="6" fill="#fff" stroke="#22c55e" stroke-width="2"/>
                        <rect x="295" y="92" width="40" height="16" rx="3" fill="#22c55e"/>
                        <text x="315" y="103" text-anchor="middle" font-size="9" fill="white" font-weight="bold">Bean</text>
                        <text x="375" y="103" text-anchor="middle" font-size="10" font-family="monospace" fill="#1e293b">MorningGreet</text>
                        <text x="375" y="123" text-anchor="middle" font-size="9" fill="#64748b">アドレス: 0x1234</text>

                        <!-- Bean 2 -->
                        <rect x="285" y="150" width="175" height="50" rx="6" fill="#fff" stroke="#22c55e" stroke-width="2"/>
                        <rect x="295" y="157" width="40" height="16" rx="3" fill="#22c55e"/>
                        <text x="315" y="168" text-anchor="middle" font-size="9" fill="white" font-weight="bold">Bean</text>
                        <text x="375" y="168" text-anchor="middle" font-size="10" font-family="monospace" fill="#1e293b">UserService</text>
                        <text x="375" y="188" text-anchor="middle" font-size="9" fill="#64748b">アドレス: 0x5678</text>

                        <!-- 右側：使う側 -->
                        <rect x="520" y="70" width="160" height="100" rx="8" fill="#E0F7FA" stroke="#22c55e" stroke-width="2"/>
                        <text x="600" y="95" text-anchor="middle" font-size="10" font-weight="bold" fill="#166534">DiSampleApplication</text>
                        <line x1="535" y1="105" x2="665" y2="105" stroke="#22c55e" stroke-width="1"/>
                        <text x="600" y="125" text-anchor="middle" font-size="9" font-family="monospace" fill="#f59e0b">@Autowired</text>
                        <text x="600" y="142" text-anchor="middle" font-size="9" font-family="monospace" fill="#1e293b">private Greet greet;</text>
                        <text x="600" y="160" text-anchor="middle" font-size="8" fill="#64748b">（使う側）</text>

                        <!-- 取り出す矢印 -->
                        <path d="M490 120 L520 120" stroke="#22c55e" stroke-width="2.5" fill="none" marker-end="url(#arrow-bean-green)"/>
                        <text x="505" y="108" text-anchor="middle" font-size="9" fill="#22c55e" font-weight="600">参照</text>

                        <!-- 下部の説明 -->
                        <rect x="20" y="240" width="660" height="65" rx="8" fill="#fef3c7" stroke="#f59e0b" stroke-width="1.5"/>
                        <text x="40" y="265" font-size="11" fill="#92400e" font-weight="bold">💡 Beanとは</text>
                        <text x="40" y="285" font-size="10" fill="#78350f">DIコンテナで管理されている<tspan font-weight="bold">インスタンス</tspan>のこと。</text>
                        <text x="40" y="300" font-size="10" fill="#78350f">必要なときに取り出して処理をさせるのが Spring の使い方。</text>
                    </svg>
                </div>

                <h3>3-3-2 Bean定義とは？</h3>

                <p>
                    Spring
                    Frameworkに「このクラスをBeanにします」と指示することを「Beanを定義する」と言います。Beanを定義する主要な方法には、下記の3つがあります。
                </p>

                <div class="highlight-box">
                    <p><strong>① クラスにアノテーションを付加する</strong></p>
                    <p><strong>② Java Configクラスにメソッドを作成する</strong></p>
                    <p style="margin-bottom: 0"><strong>③ XML設定ファイルに記述する</strong></p>
                </div>

                <!-- ① アノテーションによるBean定義の解説 -->
                <h4 style="margin-top: 24px;">① クラスにアノテーションを付加する</h4>

                <p>
                    3-2節で学んだ方法です。クラスに <code>@Component</code> などのアノテーションを付与することで、
                    Spring が自動的にそのクラスをBeanとしてDIコンテナに登録します。
                </p>

                <div class="code-block">
                    <div class="code-header">
                        <div class="code-dots">
                            <span class="code-dot red"></span>
                            <span class="code-dot yellow"></span>
                            <span class="code-dot green"></span>
                        </div>
                        <span class="code-title">アノテーションによるBean定義の例</span>
                    </div>
                    <div class="code-content">
                        <pre><span class="line-num">001:</span> <span class="code-annotation">@Component</span>  <span class="code-comment">// このアノテーションでBeanとして登録される</span>
<span class="line-num">002:</span> <span class="code-keyword">public class</span> <span class="code-class">MorningGreet</span> <span class="code-keyword">implements</span> <span class="code-class">Greet</span> {
<span class="line-num">003:</span>     <span class="code-comment">// ...</span>
<span class="line-num">004:</span> }</pre>
                    </div>
                </div>

                <p style="margin-top: 20px; margin-bottom: 12px; font-weight: 600; color: #1e293b;">📋 Bean定義に使用できる主なアノテーション</p>
                <table style="width: 100%; border-collapse: collapse; background: white; border: 2px solid #e2e8f0; border-radius: 8px; overflow: hidden;">
                    <thead>
                        <tr style="background: #64748b;">
                            <th style="padding: 14px 16px; text-align: left; font-weight: 600; color: white; width: 25%;">アノテーション</th>
                            <th style="padding: 14px 16px; text-align: left; font-weight: 600; color: white;">説明</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="padding: 12px 16px; border-bottom: 1px solid #e2e8f0; vertical-align: top;">
                                <code style="color: #3b82f6; font-weight: 600;">@Component</code>
                            </td>
                            <td style="padding: 12px 16px; border-bottom: 1px solid #e2e8f0; color: #64748b;">
                                汎用的なコンポーネント（基本のアノテーション）
                            </td>
                        </tr>
                        <tr>
                            <td style="padding: 12px 16px; border-bottom: 1px solid #e2e8f0; vertical-align: top;">
                                <code style="color: #10b981; font-weight: 600;">@Service</code>
                            </td>
                            <td style="padding: 12px 16px; border-bottom: 1px solid #e2e8f0; color: #64748b;">
                                ビジネスロジック層のクラス（@Componentの特殊化）
                            </td>
                        </tr>
                        <tr>
                            <td style="padding: 12px 16px; border-bottom: 1px solid #e2e8f0; vertical-align: top;">
                                <code style="color: #f59e0b; font-weight: 600;">@Repository</code>
                            </td>
                            <td style="padding: 12px 16px; border-bottom: 1px solid #e2e8f0; color: #64748b;">
                                データアクセス層のクラス（@Componentの特殊化）
                            </td>
                        </tr>
                        <tr>
                            <td style="padding: 12px 16px; vertical-align: top;">
                                <code style="color: #8b5cf6; font-weight: 600;">@Controller</code>
                            </td>
                            <td style="padding: 12px 16px; color: #64748b;">
                                プレゼンテーション層のクラス（@Componentの特殊化）
                            </td>
                        </tr>
                    </tbody>
                </table>

                <div class="info-box" style="background: #eff6ff; border-left: 4px solid #3b82f6; padding: 12px 16px; margin: 16px 0;">
                    <p class="no-margin" style="font-size: 0.95em;">
                        <strong>💡 @Component と派生アノテーションの違い</strong><br />
                        <strong style="color: #1e40af;">基本的な動作は全て同じです。</strong>
                        <code>@Service</code>、<code>@Repository</code>、<code>@Controller</code> のいずれも <code>@Component</code> と同様に<strong>DIコンテナへBeanとして登録</strong>されます。<br />
                        主な違いは、クラスの役割（層）を明示することで<strong>コードの可読性を向上</strong>させる点です。<br />
                        <span style="font-size: 0.9em; color: #64748b;">
                            ※ <code>@Repository</code> は例外変換などの追加機能を持つ場合がありますが、基本的なDI機能に差はありません。
                        </span>
                    </p>
                </div>

                <!-- ② Java Configの解説（次のセクションで詳しく説明するため簡潔に） -->
                <h4>② Java Configクラスにメソッドを作成する</h4>

                <p>
                    <code>@Configuration</code> を付けた設定クラス内で、<code>@Bean</code> を付けたメソッドを作成することで
                    Beanを定義します。アノテーション方式と異なり、<strong>外部ライブラリのクラス</strong>や<strong>複雑な初期化が必要なクラス</strong>も
                    Beanとして登録できます。詳細は次の「3-3-3 Java Configを使用したプログラム」で解説します。
                </p>

                <!-- ③ XMLの解説（主流でないことを説明） -->
                <h4>③ XML設定ファイルに記述する</h4>

                <p>
                    XML形式の設定ファイル（例：<code>applicationContext.xml</code>）にBean定義を記述する方法です。
                    Spring の初期バージョンから存在する伝統的な方法ですが、<strong>現在は主流ではありません</strong>。
                </p>

                <div class="code-block">
                    <div class="code-header">
                        <div class="code-dots">
                            <span class="code-dot red"></span>
                            <span class="code-dot yellow"></span>
                            <span class="code-dot green"></span>
                        </div>
                        <span class="code-title">XML設定の例（参考）</span>
                    </div>
                    <div class="code-content">
                        <pre><span class="line-num">001:</span> <span class="code-comment">&lt;!-- applicationContext.xml --&gt;</span>
<span class="line-num">002:</span> &lt;<span class="code-keyword">beans</span>&gt;
<span class="line-num">003:</span>     &lt;<span class="code-keyword">bean</span> <span class="code-annotation">id</span>=<span class="code-string">"greet"</span> <span class="code-annotation">class</span>=<span class="code-string">"com.example.MorningGreet"</span> /&gt;
<span class="line-num">004:</span> &lt;/<span class="code-keyword">beans</span>&gt;</pre>
                    </div>
                </div>

                <div class="info-box" style="background: #fef3c7; border-left: 4px solid #f59e0b; padding: 12px 16px; margin: 16px 0;">
                    <p style="margin: 0 0 8px 0; font-size: 0.95em;">
                        <strong>📝 XML設定が使われなくなった理由</strong>
                    </p>
                    <p style="margin: 0 0 8px 0; font-size: 0.9em; color: #374151;">
                        以前はXMLファイルでBean定義を行っていましたが、以下の問題点がありました。
                    </p>
                    <ul style="margin: 8px 0 0 0; padding-left: 20px; font-size: 0.9em; color: #374151; line-height: 1.8;">
                        <li><strong>スペルミスに気づけない</strong><br>
                            <span style="font-size: 0.9em; color: #64748b;">クラス名を文字列で書くため、間違えてもコンパイル時にエラーが出ない</span>
                        </li>
                        <li><strong>エディタの便利機能が使えない</strong><br>
                            <span style="font-size: 0.9em; color: #64748b;">自動補完や、クラス名の一括変更などのIDE機能が効かない</span>
                        </li>
                        <li><strong>管理が大変</strong><br>
                            <span style="font-size: 0.9em; color: #64748b;">Javaコードと設定ファイルを別々に編集・管理する必要がある</span>
                        </li>
                    </ul>
                    <p style="margin: 12px 0 0 0; padding: 12px; background: #E0F7FA; border-radius: 6px; font-size: 0.9em; color: #166534;">
                        <strong>✅ 現在の標準的な方法</strong><br>
                        Spring Bootでは<strong>①アノテーション方式（@Component等）</strong>と<strong>②Java Config</strong>がメインです。<br>
                        これらはすべてJavaコードで完結するため、上記の問題が解決されています。
                    </p>
                    <p style="margin: 12px 0 0 0; font-size: 0.85em; color: #64748b;">
                        ※ 古いシステムの保守でXML設定を見ることがあるかもしれませんが、新規開発では①または②を使用してください。
                    </p>
                </div>

                <h3>3-3-3 Java Configを使用したプログラム</h3>

                <p>
                    <strong>Java Config</strong>は、@Componentとは異なる方法でBeanを定義する仕組みです。<br>
                    専用の設定クラスにメソッドを作成することで、より柔軟なBean定義が可能になります。
                </p>

                <div class="highlight-box" style="margin: 20px 0;">
                    <p style="margin: 0 0 12px 0; font-weight: 600; color: #1e293b; font-size: 1.05em;">
                        🔄 @Component と Java Config の違い
                    </p>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-top: 12px;">
                        <div style="background: #E0F7FA; padding: 16px; border-radius: 8px; border: 2px solid #86efac;">
                            <div style="font-weight: 600; color: #166534; margin-bottom: 8px; font-size: 0.95em;">
                                📌 @Component方式
                            </div>
                            <div style="font-size: 0.9em; color: #374151; line-height: 1.7;">
                                <strong>特徴：</strong>クラス自身にアノテーション<br>
                                <code style="background: white; padding: 2px 6px; border-radius: 3px;">@Component</code> をクラスに直接付与
                            </div>
                            <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #86efac;">
                                <div style="font-size: 0.85em; color: #166534; font-weight: 600; margin-bottom: 4px;">✅ 向いている場面</div>
                                <ul class="no-margin" style="padding-left: 20px; font-size: 0.85em; color: #64748b; line-height: 1.6;">
                                    <li>自分で作成したクラス</li>
                                    <li>シンプルなBean定義</li>
                                    <li>特別な初期化が不要</li>
                                </ul>
                            </div>
                        </div>
                        <div style="background: #eff6ff; padding: 16px; border-radius: 8px; border: 2px solid #93c5fd;">
                            <div style="font-weight: 600; color: #1e40af; margin-bottom: 8px; font-size: 0.95em;">
                                ⚙️ Java Config方式
                            </div>
                            <div style="font-size: 0.9em; color: #374151; line-height: 1.7;">
                                <strong>特徴：</strong>設定クラスでメソッド作成<br>
                                <code style="background: white; padding: 2px 6px; border-radius: 3px;">@Bean</code> メソッドで生成・設定を記述
                            </div>
                            <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #93c5fd;">
                                <div style="font-size: 0.85em; color: #1e40af; font-weight: 600; margin-bottom: 4px;">✅ 向いている場面</div>
                                <ul class="no-margin" style="padding-left: 20px; font-size: 0.85em; color: #64748b; line-height: 1.6;">
                                    <li>外部ライブラリのクラス</li>
                                    <li>複雑な初期化処理が必要</li>
                                    <li>条件によって生成を切り替え</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="info-box" style="background: #fef3c7; border-left: 4px solid #f59e0b; padding: 16px; margin: 20px 0;">
                    <p style="margin: 0 0 12px 0; font-weight: 600; color: #92400e;">
                        💡 Java Config の主な利点
                    </p>
                    <div style="background: white; border-radius: 6px; padding: 14px;">
                        <div style="margin-bottom: 14px;">
                            <strong style="color: #1e293b; font-size: 0.95em;">1. 他の人が作ったクラスもBeanにできる</strong><br>
                            <span style="font-size: 0.85em; color: #64748b; line-height: 1.7; display: block; margin-top: 6px;">
                                <strong>問題：</strong>Mavenなどで追加した外部ライブラリのクラスには、私たちが勝手に<code>@Component</code>を書き込めません。<br>
                                <strong>解決：</strong>Java Configなら、設定クラスで「このクラスをBeanにしてください」と指定できます。
                            </span>
                            <div style="background: #f8fafc; padding: 8px 10px; margin-top: 8px; border-radius: 4px; font-size: 0.8em; color: #475569;">
                                💡 例えば、データベースへの接続を管理する<code>DataSource</code>クラスなどは、外部ライブラリなので@Componentが使えません。Java Configで登録します。
                            </div>
                        </div>
                        <div style="margin-bottom: 14px;">
                            <strong style="color: #1e293b; font-size: 0.95em;">2. インスタンスを作る時に細かい設定ができる</strong><br>
                            <span style="font-size: 0.85em; color: #64748b; line-height: 1.7; display: block; margin-top: 6px;">
                                <strong>例：</strong>「接続先URLは〇〇、タイムアウトは30秒、リトライは3回」など、<br>
                                newする時に色々な設定が必要な場合、メソッド内で自由に書けます。
                            </span>
                            <div style="background: #f8fafc; padding: 8px 10px; margin-top: 8px; border-radius: 4px; font-size: 0.8em; color: #475569;">
                                💡 @Componentだけでは難しい「インスタンス生成時の複雑な準備作業」が、メソッド内で普通のJavaコードとして書けます。
                            </div>
                        </div>
                        <div>
                            <strong style="color: #1e293b; font-size: 0.95em;">3. 状況に応じて違うBeanを返せる</strong><br>
                            <span style="font-size: 0.85em; color: #64748b; line-height: 1.7; display: block; margin-top: 6px;">
                                <strong>例：</strong>開発中は「テスト用データベース」に接続、本番環境では「本番用データベース」に接続<br>
                                メソッド内で<code>if</code>文などを使って、返すインスタンスを切り替えられます。
                            </span>
                            <div style="background: #f8fafc; padding: 8px 10px; margin-top: 8px; border-radius: 4px; font-size: 0.8em; color: #475569;">
                                💡 @Componentは「このクラスをBean化」と固定されていますが、Java Configは「状況を見て判断」という柔軟な制御が可能です。
                            </div>
                        </div>
                    </div>
                </div>

                <p style="margin-top: 20px;">
                    それでは、インターフェース「BusinessLogic」、実装クラス「TestLogicImpl」「SampleLogicImpl」を作成し、Java Configクラスを使ってBeanを登録する実践的なプログラムを確認していきましょう。
                </p>

                <div class="diagram-container">
                    <div class="diagram-title">図3.19 Java Config によるBean登録の流れ</div>
                    <svg class="diagram-svg" viewBox="0 0 850 520" width="850" height="520">
                        <defs>
                            <marker id="arrow-config-blue" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#3b82f6"/>
                            </marker>
                            <marker id="arrow-config-green" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#10b981"/>
                            </marker>
                            <marker id="arrow-config-orange" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#f59e0b"/>
                            </marker>
                            <marker id="arrow-config-emerald" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#22c55e"/>
                            </marker>
                        </defs>

                        <!-- ① インターフェースを定義 -->
                        <circle cx="40" cy="70" r="20" fill="#3b82f6"/>
                        <text x="40" y="76" text-anchor="middle" font-size="14" fill="white" font-weight="bold">①</text>
                        <text x="100" y="55" font-size="11" fill="#3b82f6" font-weight="bold">インターフェースを定義</text>

                        <rect x="100" y="65" width="180" height="50" rx="6" fill="#dbeafe" stroke="#3b82f6" stroke-width="2"/>
                        <text x="190" y="87" text-anchor="middle" font-size="10" fill="#64748b">《interface》</text>
                        <text x="190" y="105" text-anchor="middle" font-size="12" fill="#1d4ed8" font-weight="bold">BusinessLogic</text>

                        <!-- ② 実装クラスを作成 -->
                        <circle cx="40" cy="180" r="20" fill="#10b981"/>
                        <text x="40" y="186" text-anchor="middle" font-size="14" fill="white" font-weight="bold">②</text>
                        <text x="100" y="145" font-size="11" fill="#10b981" font-weight="bold">実装クラスを作成（@Component なし）</text>

                        <rect x="100" y="155" width="140" height="50" rx="6" fill="#10b981"/>
                        <text x="170" y="177" text-anchor="middle" font-size="9" fill="#d1fae5">implements BusinessLogic</text>
                        <text x="170" y="195" text-anchor="middle" font-size="11" fill="white" font-weight="bold">TestLogicImpl</text>

                        <rect x="260" y="155" width="150" height="50" rx="6" fill="#10b981"/>
                        <text x="335" y="177" text-anchor="middle" font-size="9" fill="#d1fae5">implements BusinessLogic</text>
                        <text x="335" y="195" text-anchor="middle" font-size="11" fill="white" font-weight="bold">SampleLogicImpl</text>

                        <!-- implements 矢印 -->
                        <path d="M170 155 L170 125 L190 115" stroke="#64748b" stroke-width="1.5" stroke-dasharray="4" fill="none"/>
                        <path d="M335 155 L335 125 L210 115" stroke="#64748b" stroke-width="1.5" stroke-dasharray="4" fill="none"/>

                        <!-- ③ Java ConfigでBean登録 -->
                        <circle cx="40" cy="300" r="20" fill="#f59e0b"/>
                        <text x="40" y="306" text-anchor="middle" font-size="14" fill="white" font-weight="bold">③</text>
                        <text x="100" y="255" font-size="11" fill="#f59e0b" font-weight="bold">Java Config でBean登録</text>

                        <rect x="100" y="265" width="310" height="90" rx="8" fill="#fef3c7" stroke="#f59e0b" stroke-width="2.5"/>
                        <rect x="115" y="275" width="100" height="18" rx="3" fill="#f59e0b"/>
                        <text x="165" y="288" text-anchor="middle" font-size="10" fill="white" font-weight="bold">@Configuration</text>
                        <text x="255" y="288" text-anchor="middle" font-size="12" fill="#92400e" font-weight="bold">AppConfig</text>
                        <line x1="115" y1="300" x2="395" y2="300" stroke="#f59e0b" stroke-width="1"/>

                        <rect x="120" y="310" width="120" height="35" rx="4" fill="#fff" stroke="#f59e0b" stroke-width="1"/>
                        <text x="180" y="325" text-anchor="middle" font-size="9" font-family="monospace" fill="#f59e0b">@Bean("test")</text>
                        <text x="180" y="340" text-anchor="middle" font-size="9" font-family="monospace" fill="#1e293b">return new TestLogicImpl()</text>

                        <rect x="260" y="310" width="135" height="35" rx="4" fill="#fff" stroke="#f59e0b" stroke-width="1"/>
                        <text x="327" y="325" text-anchor="middle" font-size="9" font-family="monospace" fill="#f59e0b">@Bean("sample")</text>
                        <text x="327" y="340" text-anchor="middle" font-size="9" font-family="monospace" fill="#1e293b">return new SampleLogicImpl()</text>

                        <!-- new 矢印 -->
                        <path d="M170 265 L170 205" stroke="#f59e0b" stroke-width="2" fill="none" marker-end="url(#arrow-config-orange)"/>
                        <text x="155" y="238" font-size="9" fill="#f59e0b" font-weight="600">new</text>
                        <path d="M335 265 L335 205" stroke="#f59e0b" stroke-width="2" fill="none" marker-end="url(#arrow-config-orange)"/>
                        <text x="345" y="238" font-size="9" fill="#f59e0b" font-weight="600">new</text>

                        <!-- 右側：DIコンテナ -->
                        <rect x="460" y="100" width="320" height="180" rx="12" fill="#dbeafe" stroke="#3b82f6" stroke-width="2.5"/>
                        <text x="620" y="130" text-anchor="middle" font-size="13" font-weight="bold" fill="#1d4ed8">DIコンテナ</text>
                        <text x="620" y="148" text-anchor="middle" font-size="10" fill="#3b82f6">（メモリ上のインスタンス管理領域）</text>

                        <!-- Bean "test" -->
                        <rect x="485" y="165" width="130" height="50" rx="5" fill="#fff" stroke="#22c55e" stroke-width="2"/>
                        <rect x="495" y="172" width="45" height="16" rx="3" fill="#22c55e"/>
                        <text x="517" y="184" text-anchor="middle" font-size="9" fill="white" font-weight="bold">Bean</text>
                        <text x="550" y="184" text-anchor="middle" font-size="10" font-family="monospace" fill="#64748b">"test"</text>
                        <text x="550" y="205" text-anchor="middle" font-size="10" font-family="monospace" fill="#1e293b">TestLogicImpl</text>

                        <!-- Bean "sample" -->
                        <rect x="635" y="165" width="130" height="50" rx="5" fill="#fff" stroke="#22c55e" stroke-width="2"/>
                        <rect x="645" y="172" width="45" height="16" rx="3" fill="#22c55e"/>
                        <text x="667" y="184" text-anchor="middle" font-size="9" fill="white" font-weight="bold">Bean</text>
                        <text x="710" y="184" text-anchor="middle" font-size="10" font-family="monospace" fill="#64748b">"sample"</text>
                        <text x="700" y="205" text-anchor="middle" font-size="10" font-family="monospace" fill="#1e293b">SampleLogicImpl</text>

                        <!-- Spring起動時の実行を示す -->
                        <rect x="90" y="375" width="330" height="55" rx="6" fill="#eff6ff" stroke="#3b82f6" stroke-width="2" stroke-dasharray="5,3"/>
                        <text x="255" y="395" text-anchor="middle" font-size="11" fill="#1e40af" font-weight="bold">⚡ Spring起動時</text>
                        <text x="255" y="413" text-anchor="middle" font-size="10" fill="#64748b">@Beanメソッドが自動実行され、</text>
                        <text x="255" y="427" text-anchor="middle" font-size="10" fill="#64748b">戻り値がDIコンテナに登録される</text>

                        <!-- 登録矢印 -->
                        <path d="M410 310 L480 240 L520 215" stroke="#3b82f6" stroke-width="2.5" fill="none" marker-end="url(#arrow-config-blue)"/>
                        <text x="440" y="265" font-size="10" fill="#3b82f6" font-weight="600">登録</text>

                        <!-- ④ 参照を受け取る -->
                        <circle cx="500" cy="330" r="20" fill="#22c55e"/>
                        <text x="500" y="336" text-anchor="middle" font-size="14" fill="white" font-weight="bold">④</text>
                        <text x="620" y="310" font-size="11" fill="#22c55e" font-weight="bold">参照を受け取る</text>

                        <rect x="535" y="320" width="240" height="80" rx="8" fill="#E0F7FA" stroke="#22c55e" stroke-width="2.5"/>
                        <text x="655" y="345" text-anchor="middle" font-size="11" fill="#166534" font-weight="bold">JavaConfigSampleApplication</text>
                        <line x1="550" y1="355" x2="760" y2="355" stroke="#22c55e" stroke-width="1"/>
                        <text x="655" y="373" text-anchor="middle" font-size="10" font-family="monospace" fill="#f59e0b">@Autowired @Qualifier("test")</text>
                        <text x="655" y="390" text-anchor="middle" font-size="10" font-family="monospace" fill="#1e293b">private BusinessLogic logic;</text>

                        <!-- 参照矢印 -->
                        <path d="M550 280 L550 320" stroke="#22c55e" stroke-width="2.5" fill="none" marker-end="url(#arrow-config-emerald)"/>
                        <text x="565" y="303" font-size="9" fill="#22c55e" font-weight="600">参照</text>
                    </svg>
                </div>

                <div class="highlight-box" style="margin-top: 16px;">
                    <p><strong>📌 Java Config によるBean登録の流れ</strong></p>
                    <table style="width: 100%; border-collapse: collapse; margin-top: 12px;">
                        <tr>
                            <td style="padding: 8px; vertical-align: top; width: 50px;">
                                <span style="display: inline-block; width: 28px; height: 28px; background: #3b82f6; color: white; border-radius: 50%; text-align: center; line-height: 28px; font-weight: bold;">①</span>
                            </td>
                            <td style="padding: 8px;">
                                <strong>インターフェースを定義</strong><br>
                                <code>BusinessLogic</code> インターフェースで処理の型を定義
                            </td>
                        </tr>
                        <tr>
                            <td style="padding: 8px; vertical-align: top;">
                                <span style="display: inline-block; width: 28px; height: 28px; background: #10b981; color: white; border-radius: 50%; text-align: center; line-height: 28px; font-weight: bold;">②</span>
                            </td>
                            <td style="padding: 8px;">
                                <strong>実装クラスを作成</strong><br>
                                <code>TestLogicImpl</code> と <code>SampleLogicImpl</code> が <code>BusinessLogic</code> を実装<br>
                                <span style="color: #64748b;">※ この方法では <code>@Component</code> を付けない</span>
                            </td>
                        </tr>
                        <tr>
                            <td style="padding: 8px; vertical-align: top;">
                                <span style="display: inline-block; width: 28px; height: 28px; background: #f59e0b; color: white; border-radius: 50%; text-align: center; line-height: 28px; font-weight: bold;">③</span>
                            </td>
                            <td style="padding: 8px;">
                                <strong>Java Config でBean登録</strong><br>
                                <code>@Configuration</code> が付いた <code>AppConfig</code> クラスの <code>@Bean</code> メソッドで <code>new</code> してインスタンスを生成<br>
                                → <strong style="color: #1e40af;">Spring起動時に@Beanメソッドが自動実行され</strong>、戻り値がDIコンテナに <code>"test"</code> と <code>"sample"</code> という名前で登録される
                            </td>
                        </tr>
                        <tr>
                            <td style="padding: 8px; vertical-align: top;">
                                <span style="display: inline-block; width: 28px; height: 28px; background: #22c55e; color: white; border-radius: 50%; text-align: center; line-height: 28px; font-weight: bold;">④</span>
                            </td>
                            <td style="padding: 8px;">
                                <strong>参照を受け取る</strong><br>
                                <code>JavaConfigSampleApplication</code> の <code>@Autowired</code> フィールドにDIコンテナからBeanの参照が渡される<br>
                                <span style="color: #64748b;">※ 同じ型のBeanが複数ある場合は <code>@Qualifier("test")</code> で名前を指定して取得</span>
                            </td>
                        </tr>
                    </table>
                </div>

                <h4>03 「Java Config」クラスの作成</h4>

                <div class="highlight-box" style="margin: 16px 0;">
                    <p style="margin-bottom: 12px;">
                        <strong>📂 プロジェクト構成</strong>
                    </p>
<pre class="no-margin" style="background: #f8fafc; padding: 12px; border-radius: 6px; font-family: monospace; font-size: 13px; line-height: 1.6;">
chapter3-javaconfig-sample/
├── pom.xml
└── src/main/java/com/example/demo/
    ├── <span style="color: #0ea5e9; font-weight: bold;">JavaConfigSampleApplication.java</span>  <span style="color: #64748b;">← 起動クラス（使う側）</span>
    ├── config/
    │   └── <span style="color: #f59e0b; font-weight: bold;">AppConfig.java</span>                  <span style="color: #64748b;">← Java Config（設定クラス）</span>
    └── service/
        ├── <span style="color: #3b82f6; font-weight: bold;">BusinessLogic.java</span>               <span style="color: #64748b;">← インターフェース</span>
        └── impl/
            ├── <span style="color: #10b981; font-weight: bold;">TestLogicImpl.java</span>           <span style="color: #64748b;">← 実装クラス①</span>
            └── <span style="color: #10b981; font-weight: bold;">SampleLogicImpl.java</span>         <span style="color: #64748b;">← 実装クラス②</span>
</pre>
                </div>

                <div class="diagram-container" style="margin: 20px 0;">
                    <div class="diagram-title">Java Config プロジェクトの構成図</div>
                    <svg class="diagram-svg" viewBox="0 0 650 280" width="650" height="280">
                        <defs>
                            <marker id="arrow-folder" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
                                <polygon points="0 0, 8 3, 0 6" fill="#64748b"/>
                            </marker>
                        </defs>

                        <!-- 背景 -->
                        <rect x="10" y="10" width="630" height="260" rx="10" fill="#f8fafc" stroke="#e2e8f0" stroke-width="1"/>

                        <!-- 起動クラス -->
                        <rect x="30" y="40" width="180" height="60" rx="6" fill="#0ea5e9" />
                        <text x="120" y="65" text-anchor="middle" font-size="11" fill="white">起動クラス（使う側）</text>
                        <text x="120" y="85" text-anchor="middle" font-size="12" fill="white" font-weight="bold">JavaConfigSampleApplication</text>

                        <!-- Java Config -->
                        <rect x="240" y="40" width="160" height="60" rx="6" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
                        <text x="320" y="58" text-anchor="middle" font-size="10" fill="#92400e">@Configuration</text>
                        <text x="320" y="75" text-anchor="middle" font-size="12" fill="#92400e" font-weight="bold">AppConfig</text>
                        <text x="320" y="90" text-anchor="middle" font-size="9" fill="#a16207">（Java Config設定クラス）</text>

                        <!-- インターフェース -->
                        <rect x="440" y="40" width="180" height="50" rx="6" fill="#dbeafe" stroke="#3b82f6" stroke-width="2"/>
                        <text x="530" y="60" text-anchor="middle" font-size="10" fill="#1e40af">《interface》</text>
                        <text x="530" y="78" text-anchor="middle" font-size="12" fill="#1e40af" font-weight="bold">BusinessLogic</text>

                        <!-- 実装クラス -->
                        <rect x="420" y="140" width="100" height="50" rx="6" fill="#10b981"/>
                        <text x="470" y="162" text-anchor="middle" font-size="10" fill="white">実装クラス①</text>
                        <text x="470" y="178" text-anchor="middle" font-size="11" fill="white" font-weight="bold">TestLogicImpl</text>

                        <rect x="540" y="140" width="100" height="50" rx="6" fill="#10b981"/>
                        <text x="590" y="162" text-anchor="middle" font-size="10" fill="white">実装クラス②</text>
                        <text x="590" y="178" text-anchor="middle" font-size="11" fill="white" font-weight="bold">SampleLogicImpl</text>

                        <!-- implements 矢印 -->
                        <path d="M470 140 L470 110 L530 90" stroke="#64748b" stroke-width="1.5" stroke-dasharray="4" fill="none"/>
                        <path d="M590 140 L590 110 L540 90" stroke="#64748b" stroke-width="1.5" stroke-dasharray="4" fill="none"/>

                        <!-- Java Config から実装クラスへの矢印 -->
                        <path d="M320 100 L320 165 L420 165" stroke="#f59e0b" stroke-width="2" fill="none" marker-end="url(#arrow-folder)"/>
                        <text x="340" y="155" font-size="10" fill="#f59e0b" font-weight="bold">@Bean で登録</text>

                        <path d="M400 165 L540 165" stroke="#f59e0b" stroke-width="2" fill="none" marker-end="url(#arrow-folder)"/>

                        <!-- 起動クラスからの@Autowired矢印 -->
                        <path d="M120 100 L120 220 L460 220 L460 190" stroke="#0ea5e9" stroke-width="2" fill="none" marker-end="url(#arrow-folder)"/>
                        <text x="280" y="235" text-anchor="middle" font-size="10" fill="#0ea5e9" font-weight="bold">@Autowired + @Qualifier で注入</text>

                        <!-- 凡例 -->
                        <rect x="30" y="120" width="180" height="130" rx="6" fill="white" stroke="#e2e8f0" stroke-width="1"/>
                        <text x="120" y="140" text-anchor="middle" font-size="11" fill="#374151" font-weight="bold">凡例</text>
                        <rect x="45" y="150" width="12" height="12" fill="#0ea5e9"/>
                        <text x="65" y="160" font-size="10" fill="#374151">起動クラス</text>
                        <rect x="45" y="170" width="12" height="12" fill="#fef3c7" stroke="#f59e0b"/>
                        <text x="65" y="180" font-size="10" fill="#374151">Java Config</text>
                        <rect x="45" y="190" width="12" height="12" fill="#dbeafe" stroke="#3b82f6"/>
                        <text x="65" y="200" font-size="10" fill="#374151">インターフェース</text>
                        <rect x="45" y="210" width="12" height="12" fill="#10b981"/>
                        <text x="65" y="220" font-size="10" fill="#374151">実装クラス</text>
                        <line x1="45" y1="236" x2="57" y2="236" stroke="#64748b" stroke-width="1.5" stroke-dasharray="4"/>
                        <text x="65" y="240" font-size="10" fill="#374151">implements</text>
                    </svg>
                </div>

                <p>
                    「Java
                    Config」は、Javaアプリケーションやフレームワークの設定をJavaのクラスで行う方法を指します。「Java
                    Config」は2つのアノテーションを使用します。
                </p>

                <div class="highlight-box">
                    <p>
                        <strong>◆ @Configuration</strong><br />
                        クラスに追加することで、そのクラスが設定クラスであることを示します。
                    </p>
                    <p style="margin-bottom: 0">
                        <strong>◆ @Bean</strong><br />
                        メソッドに追加することで、そのメソッドがBeanを返すことを示します。このBeanはDIコンテナによって管理されます。
                    </p>
                </div>

                <div class="code-block">
                    <div class="code-header">
                        <div class="code-dots">
                            <span class="code-dot red"></span>
                            <span class="code-dot yellow"></span>
                            <span class="code-dot green"></span>
                        </div>
                        <span class="code-title">リスト3.15 AppConfig.java</span>
                    </div>
                    <div class="code-content">
                        <pre><span class="line-num">001:</span> <span class="code-keyword">package</span> com.example.demo.config;
<span class="line-num">002:</span>
<span class="line-num">003:</span> <span class="code-keyword">import</span> org.springframework.context.annotation.Bean;
<span class="line-num">004:</span> <span class="code-keyword">import</span> org.springframework.context.annotation.Configuration;
<span class="line-num">005:</span>
<span class="line-num">006:</span> <span class="code-keyword">import</span> com.example.demo.service.BusinessLogic;
<span class="line-num">007:</span> <span class="code-keyword">import</span> com.example.demo.service.impl.SampleLogicImpl;
<span class="line-num">008:</span> <span class="code-keyword">import</span> com.example.demo.service.impl.TestLogicImpl;
<span class="line-num">009:</span>
<span class="line-num">010:</span> <span class="code-annotation">@Configuration</span>
<span class="line-num">011:</span> <span class="code-keyword">public class</span> <span class="code-class">AppConfig</span> {
<span class="line-num">012:</span>     <span class="code-annotation">@Bean</span>(name = <span class="code-string">"test"</span>)
<span class="line-num">013:</span>     <span class="code-keyword">public</span> <span class="code-class">BusinessLogic</span> <span class="code-method">dataLogic</span>() {
<span class="line-num">014:</span>         <span class="code-keyword">return new</span> <span class="code-class">TestLogicImpl</span>();
<span class="line-num">015:</span>     }
<span class="line-num">016:</span>
<span class="line-num">017:</span>     <span class="code-annotation">@Bean</span>(name = <span class="code-string">"sample"</span>)
<span class="line-num">018:</span>     <span class="code-keyword">public</span> <span class="code-class">BusinessLogic</span> <span class="code-method">viewLogic</span>() {
<span class="line-num">019:</span>         <span class="code-keyword">return new</span> <span class="code-class">SampleLogicImpl</span>();
<span class="line-num">020:</span>     }
<span class="line-num">021:</span> }</pre>
                    </div>
                </div>

                <p>
                    12行目「@Bean(name =
                    "test")」の記述で、メソッドがBeanを返すことを示します。返されるBeanの中身が14行目の「TestLogicImpl」インスタンスです。name属性で設定した「test」は、TestLogicImplインスタンスをDIコンテナに「test」という名前のBeanとして登録します。
                </p>

                <div class="code-block">
                    <div class="code-header">
                        <div class="code-dots">
                            <span class="code-dot red"></span>
                            <span class="code-dot yellow"></span>
                            <span class="code-dot green"></span>
                        </div>
                        <span class="code-title">リスト3.16 JavaConfigSampleApplication.java</span>
                    </div>
                    <div class="code-content">
                        <pre><span class="line-num">001:</span> <span class="code-keyword">package</span> com.example.demo;
<span class="line-num">002:</span>
<span class="line-num">003:</span> <span class="code-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="line-num">004:</span> <span class="code-keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;
<span class="line-num">005:</span> <span class="code-keyword">import</span> org.springframework.boot.SpringApplication;
<span class="line-num">006:</span> <span class="code-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;
<span class="line-num">007:</span>
<span class="line-num">008:</span> <span class="code-keyword">import</span> com.example.demo.service.BusinessLogic;
<span class="line-num">009:</span>
<span class="line-num">010:</span> <span class="code-annotation">@SpringBootApplication</span>
<span class="line-num">011:</span> <span class="code-keyword">public class</span> <span class="code-class">JavaConfigSampleApplication</span> {
<span class="line-num">012:</span>     <span class="code-comment">/** 起動メソッド */</span>
<span class="line-num">013:</span>     <span class="code-keyword">public static void</span> <span class="code-method">main</span>(<span class="code-class">String</span>[] args) {
<span class="line-num">014:</span>         SpringApplication.<span class="code-method">run</span>(JavaConfigSampleApplication.<span class="code-keyword">class</span>, args)
<span class="line-num">015:</span>             .<span class="code-method">getBean</span>(JavaConfigSampleApplication.<span class="code-keyword">class</span>).<span class="code-method">exe</span>();
<span class="line-num">016:</span>     }
<span class="line-num">017:</span>
<span class="line-num">018:</span>     <span class="code-comment">/** DI */</span>
<span class="line-num">019:</span>     <span class="code-annotation">@Autowired</span>
<span class="line-num">020:</span>     <span class="code-annotation">@Qualifier</span>(<span class="code-string">"test"</span>)
<span class="line-num">021:</span>     <span class="code-keyword">private</span> <span class="code-class">BusinessLogic</span> business1; <span class="code-comment">// TestLogicImplのインスタンス</span>
<span class="line-num">022:</span>
<span class="line-num">023:</span>     <span class="code-comment">/** DI */</span>
<span class="line-num">024:</span>     <span class="code-annotation">@Autowired</span>
<span class="line-num">025:</span>     <span class="code-annotation">@Qualifier</span>(<span class="code-string">"sample"</span>)
<span class="line-num">026:</span>     <span class="code-keyword">private</span> <span class="code-class">BusinessLogic</span> business2; <span class="code-comment">// SampleLogicImplのインスタンス</span>
<span class="line-num">027:</span>
<span class="line-num">028:</span>     <span class="code-comment">/** 実行メソッド */</span>
<span class="line-num">029:</span>     <span class="code-keyword">public void</span> <span class="code-method">exe</span>() {
<span class="line-num">030:</span>         business1.<span class="code-method">doLogic</span>();
<span class="line-num">031:</span>         business2.<span class="code-method">doLogic</span>();
<span class="line-num">032:</span>     }
<span class="line-num">033:</span> }</pre>
                    </div>
                </div>

                <div class="highlight-box" style="margin-top: 16px;">
                    <p><strong>◆ @Qualifier アノテーションとは</strong></p>
                    <p style="margin-top: 8px;">
                        同じインターフェースを実装したBeanが<strong>複数ある場合</strong>、どのBeanの参照を受け取るか指定するアノテーションです。
                    </p>
                </div>

                <div class="diagram-container" style="margin-top: 16px;">
                    <div class="diagram-title">@Qualifier が必要な理由</div>
                    <svg class="diagram-svg" viewBox="0 0 700 200" width="700" height="200">
                        <defs>
                            <marker id="arrow-qual" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#ef4444"/>
                            </marker>
                            <marker id="arrow-qual-green" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#22c55e"/>
                            </marker>
                        </defs>

                        <!-- DIコンテナ -->
                        <rect x="20" y="30" width="280" height="150" rx="10" fill="#dbeafe" stroke="#3b82f6" stroke-width="2"/>
                        <text x="160" y="55" text-anchor="middle" font-size="12" font-weight="bold" fill="#1d4ed8">DIコンテナ</text>

                        <!-- Bean "test" -->
                        <rect x="40" y="75" width="110" height="45" rx="5" fill="#fff" stroke="#22c55e" stroke-width="2"/>
                        <rect x="48" y="82" width="40" height="14" rx="2" fill="#22c55e"/>
                        <text x="68" y="92" text-anchor="middle" font-size="8" fill="white" font-weight="bold">Bean</text>
                        <text x="95" y="92" font-size="9" fill="#64748b">"test"</text>
                        <text x="95" y="110" text-anchor="middle" font-size="9" font-family="monospace" fill="#1e293b">TestLogicImpl</text>

                        <!-- Bean "sample" -->
                        <rect x="170" y="75" width="115" height="45" rx="5" fill="#fff" stroke="#22c55e" stroke-width="2"/>
                        <rect x="178" y="82" width="40" height="14" rx="2" fill="#22c55e"/>
                        <text x="198" y="92" text-anchor="middle" font-size="8" fill="white" font-weight="bold">Bean</text>
                        <text x="235" y="92" font-size="9" fill="#64748b">"sample"</text>
                        <text x="227" y="110" text-anchor="middle" font-size="9" font-family="monospace" fill="#1e293b">SampleLogicImpl</text>

                        <!-- 共通インターフェース -->
                        <text x="160" y="145" text-anchor="middle" font-size="10" fill="#3b82f6">両方とも BusinessLogic を実装</text>
                        <text x="160" y="165" text-anchor="middle" font-size="10" fill="#ef4444" font-weight="bold">→ どちらを渡せばいい？</text>

                        <!-- 矢印 -->
                        <path d="M300 100 L350 100" stroke="#ef4444" stroke-width="2" fill="none" marker-end="url(#arrow-qual)"/>
                        <text x="325" y="90" text-anchor="middle" font-size="9" fill="#ef4444">？</text>

                        <!-- フィールド（問題） -->
                        <rect x="360" y="70" width="150" height="60" rx="6" fill="#fef2f2" stroke="#ef4444" stroke-width="2"/>
                        <text x="435" y="92" text-anchor="middle" font-size="9" font-family="monospace" fill="#f59e0b">@Autowired</text>
                        <text x="435" y="108" text-anchor="middle" font-size="9" font-family="monospace" fill="#1e293b">BusinessLogic logic;</text>
                        <text x="435" y="122" text-anchor="middle" font-size="8" fill="#ef4444">← エラーになる</text>

                        <!-- 解決策 -->
                        <rect x="530" y="30" width="160" height="150" rx="8" fill="#E0F7FA" stroke="#22c55e" stroke-width="2"/>
                        <text x="610" y="55" text-anchor="middle" font-size="11" fill="#166534" font-weight="bold">✅ 解決策</text>
                        <text x="610" y="80" text-anchor="middle" font-size="10" fill="#475569">@Qualifier で</text>
                        <text x="610" y="95" text-anchor="middle" font-size="10" fill="#475569">Bean名を指定</text>
                        <rect x="545" y="110" width="130" height="55" rx="4" fill="#fff" stroke="#22c55e" stroke-width="1"/>
                        <text x="610" y="128" text-anchor="middle" font-size="8" font-family="monospace" fill="#f59e0b">@Autowired</text>
                        <text x="610" y="142" text-anchor="middle" font-size="8" font-family="monospace" fill="#22c55e">@Qualifier("test")</text>
                        <text x="610" y="156" text-anchor="middle" font-size="8" font-family="monospace" fill="#1e293b">BusinessLogic logic;</text>
                    </svg>
                </div>

                <div class="config-table" style="margin-top: 16px;">
                    <div style="font-weight: 600; margin-bottom: 12px; color: var(--primary)">📋 コード解説</div>
                    <div class="config-row">
                        <span class="config-label">20行目</span>
                        <span class="config-value"><code>@Qualifier("test")</code> → <code>"test"</code> という名前のBean（TestLogicImpl）を指定</span>
                    </div>
                    <div class="config-row">
                        <span class="config-label">25行目</span>
                        <span class="config-value"><code>@Qualifier("sample")</code> → <code>"sample"</code> という名前のBean（SampleLogicImpl）を指定</span>
                    </div>
                </div>

                <p style="margin-top: 16px;">
                    これにより、同じ <code>BusinessLogic</code> 型のフィールドでも、<code>business1</code> には <code>TestLogicImpl</code> の参照が、<code>business2</code> には <code>SampleLogicImpl</code> の参照が渡されます。
                </p>

                <div class="result-box">
                    <div class="result-title">図3.20 実行結果</div>
                    <div class="result-content">2023-10-21T19:10:19.381+09:00 INFO 13216 テストです サンプルです</div>
                </div>

                <h3>3-3-4 まとめ</h3>

                <div class="diagram-container">
                    <div class="diagram-title">図3.21 「Java Config」クラスの動作</div>
                    <svg class="diagram-svg" viewBox="0 0 750 340" width="750" height="340">
                        <defs>
                            <marker id="arrow-jc-orange" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#f59e0b"/>
                            </marker>
                            <marker id="arrow-jc-blue" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#3b82f6"/>
                            </marker>
                            <marker id="arrow-jc-green" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#22c55e"/>
                            </marker>
                        </defs>

                        <!-- ① AppConfig（Java Config） -->
                        <circle cx="30" cy="90" r="18" fill="#f59e0b"/>
                        <text x="30" y="96" text-anchor="middle" font-size="13" fill="white" font-weight="bold">①</text>

                        <rect x="60" y="30" width="220" height="130" rx="8" fill="#fef3c7" stroke="#f59e0b" stroke-width="2.5"/>
                        <rect x="75" y="40" width="100" height="18" rx="3" fill="#f59e0b"/>
                        <text x="125" y="53" text-anchor="middle" font-size="10" fill="white" font-weight="bold">@Configuration</text>
                        <text x="225" y="53" text-anchor="middle" font-size="12" fill="#92400e" font-weight="bold">AppConfig</text>
                        <line x1="75" y1="65" x2="265" y2="65" stroke="#f59e0b" stroke-width="1"/>

                        <!-- @Bean メソッド -->
                        <rect x="75" y="75" width="90" height="35" rx="4" fill="#fff" stroke="#f59e0b" stroke-width="1"/>
                        <text x="120" y="90" text-anchor="middle" font-size="9" font-family="monospace" fill="#f59e0b">@Bean("test")</text>
                        <text x="120" y="103" text-anchor="middle" font-size="8" font-family="monospace" fill="#1e293b">new TestLogicImpl()</text>

                        <rect x="175" y="75" width="95" height="35" rx="4" fill="#fff" stroke="#f59e0b" stroke-width="1"/>
                        <text x="222" y="90" text-anchor="middle" font-size="9" font-family="monospace" fill="#f59e0b">@Bean("sample")</text>
                        <text x="222" y="103" text-anchor="middle" font-size="8" font-family="monospace" fill="#1e293b">new SampleLogicImpl()</text>

                        <text x="170" y="145" text-anchor="middle" font-size="9" fill="#92400e">設定クラスでBean定義を読み込み</text>

                        <!-- ②矢印 -->
                        <circle cx="170" cy="185" r="18" fill="#3b82f6"/>
                        <text x="170" y="191" text-anchor="middle" font-size="13" fill="white" font-weight="bold">②</text>
                        <path d="M170 160 L170 167" stroke="#3b82f6" stroke-width="2.5" fill="none"/>
                        <path d="M170 203 L170 220" stroke="#3b82f6" stroke-width="2.5" fill="none" marker-end="url(#arrow-jc-blue)"/>

                        <!-- DIコンテナ -->
                        <rect x="60" y="225" width="220" height="100" rx="10" fill="#dbeafe" stroke="#3b82f6" stroke-width="2.5"/>
                        <text x="170" y="250" text-anchor="middle" font-size="12" font-weight="bold" fill="#1d4ed8">DIコンテナ</text>
                        <text x="170" y="265" text-anchor="middle" font-size="9" fill="#3b82f6">（メモリ上のインスタンス管理領域）</text>

                        <!-- Beans -->
                        <rect x="75" y="280" width="85" height="35" rx="4" fill="#fff" stroke="#22c55e" stroke-width="1.5"/>
                        <rect x="80" y="285" width="35" height="14" rx="2" fill="#22c55e"/>
                        <text x="97" y="295" text-anchor="middle" font-size="8" fill="white" font-weight="bold">Bean</text>
                        <text x="120" y="295" font-size="8" fill="#64748b">"test"</text>
                        <text x="117" y="308" text-anchor="middle" font-size="8" font-family="monospace" fill="#1e293b">TestLogicImpl</text>

                        <rect x="175" y="280" width="90" height="35" rx="4" fill="#fff" stroke="#22c55e" stroke-width="1.5"/>
                        <rect x="180" y="285" width="35" height="14" rx="2" fill="#22c55e"/>
                        <text x="197" y="295" text-anchor="middle" font-size="8" fill="white" font-weight="bold">Bean</text>
                        <text x="230" y="295" font-size="8" fill="#64748b">"sample"</text>
                        <text x="220" y="308" text-anchor="middle" font-size="8" font-family="monospace" fill="#1e293b">SampleLogicImpl</text>

                        <!-- ③矢印（参照を渡す） -->
                        <path d="M280 297 L310 297 L310 75 L390 75" stroke="#22c55e" stroke-width="2.5" fill="none" marker-end="url(#arrow-jc-green)"/>
                        <circle cx="310" cy="180" r="18" fill="#22c55e"/>
                        <text x="310" y="186" text-anchor="middle" font-size="13" fill="white" font-weight="bold">③</text>
                        <text x="325" y="140" text-anchor="start" font-size="10" fill="#22c55e" font-weight="600">参照を渡す</text>

                        <!-- JavaConfigSampleApplication -->
                        <rect x="400" y="30" width="220" height="90" rx="8" fill="#E0F7FA" stroke="#22c55e" stroke-width="2.5"/>
                        <text x="510" y="55" text-anchor="middle" font-size="11" fill="#166534" font-weight="bold">JavaConfigSampleApplication</text>
                        <line x1="415" y1="65" x2="605" y2="65" stroke="#22c55e" stroke-width="1"/>
                        <text x="510" y="83" text-anchor="middle" font-size="9" font-family="monospace" fill="#f59e0b">@Autowired @Qualifier("test")</text>
                        <text x="510" y="98" text-anchor="middle" font-size="9" font-family="monospace" fill="#1e293b">private BusinessLogic testLogic;</text>
                        <text x="510" y="113" text-anchor="middle" font-size="8" fill="#64748b">（使う側）</text>

                        <!-- 右側：説明ボックス -->
                        <rect x="400" y="140" width="340" height="185" rx="8" fill="#f8fafc" stroke="#cbd5e1" stroke-width="1.5"/>
                        <text x="420" y="165" font-size="11" fill="#1e293b" font-weight="bold">📌 動作の流れ</text>

                        <circle cx="425" cy="195" r="12" fill="#f59e0b"/>
                        <text x="425" y="200" text-anchor="middle" font-size="10" fill="white" font-weight="bold">①</text>
                        <text x="445" y="193" font-size="10" fill="#475569">@Configuration が付いた AppConfig を</text>
                        <text x="445" y="207" font-size="10" fill="#475569">見つけて、Bean定義を読み込む</text>

                        <circle cx="425" cy="240" r="12" fill="#3b82f6"/>
                        <text x="425" y="245" text-anchor="middle" font-size="10" fill="white" font-weight="bold">②</text>
                        <text x="445" y="238" font-size="10" fill="#475569">@Bean メソッドを実行して new し、</text>
                        <text x="445" y="252" font-size="10" fill="#475569">DIコンテナにBeanとして登録</text>

                        <circle cx="425" cy="290" r="12" fill="#22c55e"/>
                        <text x="425" y="295" text-anchor="middle" font-size="10" fill="white" font-weight="bold">③</text>
                        <text x="445" y="283" font-size="10" fill="#475569">@Autowired + @Qualifier で指定した</text>
                        <text x="445" y="297" font-size="10" fill="#475569">Bean の参照（メモリアドレス）を</text>
                        <text x="445" y="311" font-size="10" fill="#475569">フィールドに渡す</text>
                    </svg>
                </div>
            </section>

            <!-- Section 3-4 -->
            <section class="section">
                <div class="section-header">
                    <span class="section-number">Section 3-4</span>
                    <h2 class="section-title">DIについて知ろう（インジェクション）</h2>
                </div>

                <p>
                    ここでは、Beanの参照を受け取る方法（インジェクション）について深堀します。
                </p>

                <div class="info-box" style="background: #E0F7FA; border-left: 4px solid #22c55e; padding: 16px; margin: 16px 0;">
                    <p style="margin: 0 0 12px 0; font-size: 0.95em;">
                        <strong>🫘 Beanとは？（おさらい）</strong>
                    </p>
                    <p style="margin: 0 0 8px 0; font-size: 0.9em; color: #374151;">
                        <strong>Bean</strong> とは、Spring の <strong>DIコンテナが管理するインスタンス（オブジェクト）</strong>のことです。
                    </p>
                    <div style="background: white; padding: 12px; border-radius: 6px; margin-top: 8px;">
                        <table style="width: 100%; border-collapse: collapse; font-size: 0.85em;">
                            <tr style="border-bottom: 1px solid #e2e8f0;">
                                <td style="padding: 8px; font-weight: bold; color: #64748b; width: 30%;">通常のインスタンス</td>
                                <td style="padding: 8px;"><code>new MorningGreet()</code> で開発者が生成・管理</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; font-weight: bold; color: #22c55e;">Bean</td>
                                <td style="padding: 8px;"><strong>DIコンテナ</strong>が生成・管理し、必要な場所に<strong>自動で渡す（注入する）</strong></td>
                            </tr>
                        </table>
                    </div>
                    <p style="margin: 12px 0 0 0; font-size: 0.85em; color: #64748b;">
                        ※ Beanとして登録するには <code>@Component</code> などのアノテーション、または Java Config で <code>@Bean</code> を使用します。
                    </p>
                </div>

                <!-- メモリの考え方 -->
                <div class="info-box" style="background: #eff6ff; border-left: 4px solid #3b82f6; padding: 16px; margin: 16px 0;">
                    <p style="margin: 0 0 12px 0; font-size: 0.95em;">
                        <strong>🧠 メモリの考え方（補足）</strong>
                    </p>
                    <p style="margin: 0 0 12px 0; font-size: 0.9em; color: #374151;">
                        Javaでインスタンスを生成すると、<strong>メモリ（ヒープ領域）</strong>上にオブジェクトが作られます。
                        変数には、そのオブジェクトが存在する<strong>メモリアドレス（参照）</strong>が格納されます。
                    </p>
                </div>

                <div class="diagram-container" style="margin: 20px 0;">
                    <div class="diagram-title">メモリとインスタンスの関係</div>
                    <svg class="diagram-svg" viewBox="0 0 700 320" width="700" height="320">
                        <defs>
                            <marker id="arrow-mem-blue" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#3b82f6"/>
                            </marker>
                            <marker id="arrow-mem-green" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#22c55e"/>
                            </marker>
                        </defs>

                        <!-- タイトル：通常のnew -->
                        <text x="175" y="25" text-anchor="middle" font-size="12" fill="#64748b" font-weight="bold">❌ 通常の new（DIを使わない場合）</text>

                        <!-- コード部分 -->
                        <rect x="20" y="40" width="310" height="80" rx="6" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
                        <text x="175" y="62" text-anchor="middle" font-size="10" fill="#92400e" font-weight="bold">コード（複数箇所で new）</text>
                        <text x="30" y="85" font-size="11" font-family="monospace" fill="#1e293b">Greet g1 = <tspan fill="#dc2626" font-weight="bold">new</tspan> MorningGreet();</text>
                        <text x="30" y="105" font-size="11" font-family="monospace" fill="#1e293b">Greet g2 = <tspan fill="#dc2626" font-weight="bold">new</tspan> MorningGreet();</text>

                        <!-- メモリ（ヒープ） -->
                        <rect x="380" y="40" width="300" height="80" rx="6" fill="#fee2e2" stroke="#ef4444" stroke-width="2"/>
                        <text x="530" y="62" text-anchor="middle" font-size="10" fill="#dc2626" font-weight="bold">メモリ（ヒープ領域）</text>
                        <rect x="400" y="75" width="100" height="35" rx="4" fill="#ef4444"/>
                        <text x="450" y="90" text-anchor="middle" font-size="9" fill="white">MorningGreet</text>
                        <text x="450" y="103" text-anchor="middle" font-size="8" fill="#fecaca">アドレス: 0x1111</text>

                        <rect x="560" y="75" width="100" height="35" rx="4" fill="#ef4444"/>
                        <text x="610" y="90" text-anchor="middle" font-size="9" fill="white">MorningGreet</text>
                        <text x="610" y="103" text-anchor="middle" font-size="8" fill="#fecaca">アドレス: 0x2222</text>

                        <!-- 矢印 -->
                        <path d="M200 85 L395 85" stroke="#f59e0b" stroke-width="1.5" fill="none" marker-end="url(#arrow-mem-blue)"/>
                        <path d="M200 105 L555 105" stroke="#f59e0b" stroke-width="1.5" fill="none" marker-end="url(#arrow-mem-blue)"/>

                        <!-- 問題点 -->
                        <text x="530" y="138" text-anchor="middle" font-size="10" fill="#dc2626" font-weight="bold">⚠️ newするたびに別のインスタンスが生成される</text>

                        <!-- 区切り線 -->
                        <line x1="20" y1="155" x2="680" y2="155" stroke="#e2e8f0" stroke-width="2" stroke-dasharray="5,5"/>

                        <!-- タイトル：DI -->
                        <text x="175" y="175" text-anchor="middle" font-size="12" fill="#22c55e" font-weight="bold">✅ DIを使った場合</text>

                        <!-- コード部分（DI） -->
                        <rect x="20" y="190" width="310" height="110" rx="6" fill="#E0F7FA" stroke="#22c55e" stroke-width="2"/>
                        <text x="175" y="212" text-anchor="middle" font-size="10" fill="#166534" font-weight="bold">コード（@Autowiredで注入）</text>
                        <text x="30" y="240" font-size="11" font-family="monospace" fill="#1e293b">// ClassA</text>
                        <text x="30" y="258" font-size="11" font-family="monospace" fill="#1e293b"><tspan fill="#7c3aed">@Autowired</tspan> Greet g1;</text>
                        <text x="30" y="280" font-size="11" font-family="monospace" fill="#1e293b">// ClassB</text>
                        <text x="30" y="298" font-size="11" font-family="monospace" fill="#1e293b"><tspan fill="#7c3aed">@Autowired</tspan> Greet g2;</text>

                        <!-- DIコンテナ -->
                        <rect x="380" y="190" width="140" height="110" rx="6" fill="#dbeafe" stroke="#3b82f6" stroke-width="2"/>
                        <text x="450" y="212" text-anchor="middle" font-size="10" fill="#1d4ed8" font-weight="bold">DIコンテナ</text>
                        <rect x="395" y="230" width="110" height="55" rx="4" fill="#22c55e"/>
                        <text x="450" y="252" text-anchor="middle" font-size="10" fill="white" font-weight="bold">MorningGreet</text>
                        <text x="450" y="268" text-anchor="middle" font-size="9" fill="#d1fae5">アドレス: 0x1234</text>
                        <text x="450" y="280" text-anchor="middle" font-size="8" fill="#bbf7d0">（1つだけ）</text>

                        <!-- メモリ説明 -->
                        <rect x="560" y="190" width="120" height="110" rx="6" fill="#E0F7FA" stroke="#22c55e" stroke-width="1"/>
                        <text x="620" y="215" text-anchor="middle" font-size="10" fill="#166534" font-weight="bold">メモリ効率◎</text>
                        <text x="620" y="240" text-anchor="middle" font-size="9" fill="#374151">同じインスタンスの</text>
                        <text x="620" y="255" text-anchor="middle" font-size="9" fill="#374151">参照（アドレス）を</text>
                        <text x="620" y="270" text-anchor="middle" font-size="9" fill="#374151">複数箇所で共有</text>
                        <text x="620" y="290" text-anchor="middle" font-size="10" fill="#22c55e" font-weight="bold">→ シングルトン</text>

                        <!-- 矢印（参照を渡す） -->
                        <path d="M330 250 L393 250" stroke="#22c55e" stroke-width="2" fill="none" marker-end="url(#arrow-mem-green)"/>
                        <path d="M330 290 L393 270" stroke="#22c55e" stroke-width="2" fill="none" marker-end="url(#arrow-mem-green)"/>
                        <text x="360" y="240" text-anchor="middle" font-size="8" fill="#22c55e">同じ参照</text>
                    </svg>
                </div>

                <div class="config-table" style="margin-top: 16px;">
                    <div style="font-weight: 600; margin-bottom: 12px; color: var(--primary)">📝 ポイント：シングルトンとは</div>
                    <div class="config-row">
                        <span class="config-label">シングルトン</span>
                        <span class="config-value">アプリケーション内で<strong>インスタンスが1つだけ</strong>存在するパターン。DIコンテナはデフォルトでBeanをシングルトンとして管理する</span>
                    </div>
                    <div class="config-row">
                        <span class="config-label">参照の共有</span>
                        <span class="config-value">複数の <code>@Autowired</code> フィールドに同じBeanの参照（メモリアドレス）が渡される</span>
                    </div>
                    <div class="config-row">
                        <span class="config-label">メリット</span>
                        <span class="config-value">メモリ効率が良い、状態の一貫性が保てる、インスタンス生成コストが1回で済む</span>
                    </div>
                </div>

                <div class="config-table" style="margin-top: 16px;">
                    <div style="font-weight: 600; margin-bottom: 12px; color: var(--primary)">💡 「付与」と「インジェクション」の違い</div>
                    <div class="config-row">
                        <span class="config-label">付与</span>
                        <span class="config-value"><strong>開発者がコードに書くこと</strong>（例：<code>@Autowired</code> をフィールドに書く）</span>
                    </div>
                    <div class="config-row">
                        <span class="config-label">インジェクション</span>
                        <span class="config-value"><strong>Springが実行時に行うこと</strong>（DIコンテナからBeanの参照を渡す）</span>
                    </div>
                </div>

                <div class="diagram-container" style="margin-top: 16px;">
                    <div class="diagram-title">「付与」と「インジェクション」の関係</div>
                    <svg class="diagram-svg" viewBox="0 0 700 180" width="700" height="180">
                        <defs>
                            <marker id="arrow-inj" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#3b82f6"/>
                            </marker>
                        </defs>

                        <!-- 開発者の作業（コーディング時） -->
                        <rect x="20" y="30" width="200" height="130" rx="8" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
                        <text x="120" y="55" text-anchor="middle" font-size="11" fill="#92400e" font-weight="bold">👨‍💻 開発者の作業（コーディング時）</text>
                        <rect x="35" y="70" width="170" height="75" rx="5" fill="#fff" stroke="#f59e0b" stroke-width="1"/>
                        <text x="120" y="92" text-anchor="middle" font-size="10" fill="#64748b">コードに書く</text>
                        <text x="120" y="115" text-anchor="middle" font-size="11" font-family="monospace" fill="#f59e0b">@Autowired</text>
                        <text x="120" y="132" text-anchor="middle" font-size="10" font-family="monospace" fill="#1e293b">private Greet greet;</text>

                        <!-- 矢印 -->
                        <path d="M220 95 L280 95" stroke="#64748b" stroke-width="2" fill="none" marker-end="url(#arrow-inj)"/>
                        <text x="250" y="85" text-anchor="middle" font-size="9" fill="#64748b">起動</text>

                        <!-- Springの動作（実行時） -->
                        <rect x="290" y="30" width="390" height="130" rx="8" fill="#dbeafe" stroke="#3b82f6" stroke-width="2"/>
                        <text x="485" y="55" text-anchor="middle" font-size="11" fill="#1d4ed8" font-weight="bold">⚙️ Springの動作（実行時）＝ インジェクション</text>

                        <!-- DIコンテナ -->
                        <rect x="305" y="70" width="130" height="75" rx="5" fill="#fff" stroke="#3b82f6" stroke-width="1"/>
                        <text x="370" y="90" text-anchor="middle" font-size="10" fill="#3b82f6" font-weight="500">DIコンテナ</text>
                        <rect x="320" y="100" width="100" height="35" rx="4" fill="#22c55e"/>
                        <text x="370" y="115" text-anchor="middle" font-size="9" fill="white" font-weight="bold">MorningGreet</text>
                        <text x="370" y="128" text-anchor="middle" font-size="8" fill="#d1fae5">0x1234</text>

                        <!-- 矢印（参照を渡す） -->
                        <path d="M435 108 L490 108" stroke="#22c55e" stroke-width="2.5" fill="none" marker-end="url(#arrow-inj)"/>
                        <text x="462" y="100" text-anchor="middle" font-size="9" fill="#22c55e" font-weight="600">参照を渡す</text>

                        <!-- フィールドに格納 -->
                        <rect x="500" y="70" width="165" height="75" rx="5" fill="#E0F7FA" stroke="#22c55e" stroke-width="1"/>
                        <text x="582" y="90" text-anchor="middle" font-size="10" fill="#166534" font-weight="500">フィールドに格納</text>
                        <text x="582" y="112" text-anchor="middle" font-size="10" font-family="monospace" fill="#1e293b">greet = 0x1234</text>
                        <text x="582" y="132" text-anchor="middle" font-size="9" fill="#64748b">（MorningGreetの参照）</text>
                    </svg>
                </div>

                <p style="margin-top: 16px;">
                    つまり、<strong>「フィールドインジェクション」</strong>とは、フィールドに <code>@Autowired</code> を付与することで、Springが実行時にそのフィールドへBeanの参照を渡す方式のことです。<br>
                    Springが参照を渡す方法は大きく分けて3つあります。
                </p>

                <h3>3-4-1 Beanの参照を渡す方法</h3>

                <div class="injection-comparison">
                    <div class="injection-card">
                        <div class="injection-name" style="font-size: 15px; border-bottom: 2px solid #f59e0b; padding-bottom: 8px; margin-bottom: 12px;">
                            <strong>フィールドに渡す</strong><span style="font-size: 12px; color: #64748b; margin-left: 8px;">（フィールドインジェクション）</span>
                        </div>
                        <div class="injection-desc">クラスのフィールド（変数）に直接Beanの参照（メモリアドレス）を渡す方法</div>
                        <div class="table-container">
                            <table style="font-size: 13px">
                                <tr>
                                    <th>記述方法</th>
                                    <td>フィールドに「@Autowired」を付与する</td>
                                </tr>
                                <tr>
                                    <th>Springの動作</th>
                                    <td>DIコンテナからBeanのメモリアドレスを取得し、フィールドに直接代入</td>
                                </tr>
                                <tr>
                                    <th>特徴</th>
                                    <td>コードがシンプルになるが、テスト時にモック化が難しくなる可能性がある</td>
                                </tr>
                            </table>
                        </div>
                        <div class="code-block" style="margin-top: 12px;">
                            <div class="code-header">
                                <div class="code-dots">
                                    <span class="code-dot red"></span>
                                    <span class="code-dot yellow"></span>
                                    <span class="code-dot green"></span>
                                </div>
                                <span class="code-title">フィールドインジェクションの例</span>
                            </div>
                            <div class="code-content">
                                <pre><span class="line-num">001:</span> <span class="code-annotation">@Autowired</span>
<span class="line-num">002:</span> <span class="code-keyword">private</span> <span class="code-class">SomeService</span> someService;
<span class="line-num">003:</span> <span class="code-comment">// ↑ Springが someService = 0x1234 のように参照を代入</span></pre>
                            </div>
                        </div>
                    </div>

                    <div class="injection-card">
                        <div class="injection-name" style="font-size: 15px; border-bottom: 2px solid #3b82f6; padding-bottom: 8px; margin-bottom: 12px;">
                            <strong>セッターメソッド経由で渡す</strong><span style="font-size: 12px; color: #64748b; margin-left: 8px;">（セッターインジェクション）</span>
                        </div>
                        <div class="injection-desc">セッターメソッドを通じてBeanの参照（メモリアドレス）を渡す方法</div>
                        <div class="table-container">
                            <table style="font-size: 13px">
                                <tr>
                                    <th>記述方法</th>
                                    <td>セッターメソッドに「@Autowired」を付与する</td>
                                </tr>
                                <tr>
                                    <th>Springの動作</th>
                                    <td>DIコンテナからBeanの参照を取得し、セッターメソッドを呼び出して渡す</td>
                                </tr>
                                <tr>
                                    <th>特徴</th>
                                    <td>必要なBeanだけを選択的に受け取ることができる</td>
                                </tr>
                            </table>
                        </div>
                        <div class="code-block" style="margin-top: 12px;">
                            <div class="code-header">
                                <div class="code-dots">
                                    <span class="code-dot red"></span>
                                    <span class="code-dot yellow"></span>
                                    <span class="code-dot green"></span>
                                </div>
                                <span class="code-title">セッターインジェクションの例</span>
                            </div>
                            <div class="code-content">
                                <pre><span class="line-num">001:</span> <span class="code-keyword">private</span> <span class="code-class">SomeService</span> someService;
<span class="line-num">002:</span>
<span class="line-num">003:</span> <span class="code-annotation">@Autowired</span>
<span class="line-num">004:</span> <span class="code-keyword">public void</span> <span class="code-method">setSomeService</span>(<span class="code-class">SomeService</span> someService) {
<span class="line-num">005:</span>     <span class="code-keyword">this</span>.someService = someService;
<span class="line-num">006:</span> }
<span class="line-num">007:</span> <span class="code-comment">// ↑ Springがこのメソッドを呼び出して参照を渡す</span></pre>
                            </div>
                        </div>
                    </div>

                    <div class="injection-card recommended" style="background: #E0F7FA;">
                        <div class="injection-name" style="font-size: 15px; border-bottom: 2px solid #22c55e; padding-bottom: 8px; margin-bottom: 12px;">
                            <span style="background: #22c55e; color: white; padding: 4px 12px; border-radius: 4px; font-size: 13px; font-weight: bold; margin-right: 10px;">推奨</span>
                            <strong>コンストラクタ経由で渡す</strong><span style="font-size: 12px; color: #64748b; margin-left: 8px;">（コンストラクタインジェクション）</span>
                        </div>
                        <div class="injection-desc">コンストラクタを通じてBeanの参照（メモリアドレス）を渡す方法</div>
                        <div class="table-container">
                            <table style="font-size: 13px">
                                <tr>
                                    <th>記述方法</th>
                                    <td>コンストラクタに「@Autowired」を付与する</td>
                                </tr>
                                <tr>
                                    <th>Springの動作</th>
                                    <td>インスタンス生成時にコンストラクタ引数としてBeanの参照を渡す</td>
                                </tr>
                                <tr>
                                    <th>特徴</th>
                                    <td><code>final</code>で不変性が保たれ、テスト時にモック化が容易になる</td>
                                </tr>
                            </table>
                        </div>
                        <div class="code-block" style="margin-top: 12px;">
                            <div class="code-header">
                                <div class="code-dots">
                                    <span class="code-dot red"></span>
                                    <span class="code-dot yellow"></span>
                                    <span class="code-dot green"></span>
                                </div>
                                <span class="code-title">コンストラクタインジェクションの例</span>
                            </div>
                            <div class="code-content">
                                <pre><span class="line-num">001:</span> <span class="code-keyword">private final</span> <span class="code-class">SomeService</span> someService;  <span class="code-comment">// finalで変更不可</span>
<span class="line-num">002:</span>
<span class="line-num">003:</span> <span class="code-annotation">@Autowired</span>
<span class="line-num">004:</span> <span class="code-keyword">public</span> <span class="code-method">SomeClass</span>(<span class="code-class">SomeService</span> someService) {
<span class="line-num">005:</span>     <span class="code-keyword">this</span>.someService = someService;
<span class="line-num">006:</span> }
<span class="line-num">007:</span> <span class="code-comment">// ↑ Springがインスタンス生成時に引数へ参照を渡す</span></pre>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="column">
                    <div class="column-header">
                        <span class="column-badge">Column</span>
                        <span class="column-title">なぜコンストラクタ経由が推奨されるのか？</span>
                    </div>
                    <p><strong>結論：「コンストラクタ経由」を使いましょう。</strong></p>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin: 16px 0;">
                        <div style="background: #fef2f2; border: 1px solid #fecaca; border-radius: 8px; padding: 12px;">
                            <div style="font-weight: bold; color: #dc2626; margin-bottom: 8px;">❌ フィールドに渡す（非推奨）</div>
<pre class="no-margin" style="background: #fff; padding: 8px; border-radius: 4px; font-size: 11px;">
@Autowired
private Greet greet;
// 後から greet = null; と
// 書き換えられてしまう可能性あり
</pre>
                        </div>
                        <div style="background: #E0F7FA; border: 1px solid #bbf7d0; border-radius: 8px; padding: 12px;">
                            <div style="font-weight: bold; color: #16a34a; margin-bottom: 8px;">✅ コンストラクタ経由（推奨）</div>
<pre class="no-margin" style="background: #fff; padding: 8px; border-radius: 4px; font-size: 11px;">
private final Greet greet;

public MyClass(Greet greet) {
    this.greet = greet;
}
// final なので書き換え不可！
</pre>
                        </div>
                    </div>

                    <p style="margin-bottom: 8px;"><strong>推奨される理由（シンプルに）：</strong></p>
                    <ul class="no-margin" style="padding-left: 20px;">
                        <li><code>final</code> を付けると値が変わらないので安心</li>
                        <li>必要なBeanが揃わないとインスタンスが作れない → エラーに早く気づける</li>
                        <li>テストコードが書きやすい</li>
                    </ul>

                    <p style="margin-top: 12px; margin-bottom: 0; padding: 8px; background: #f8fafc; border-radius: 4px; font-size: 13px;">
                        💡 <strong>ヒント：</strong>Spring 4.3以降、コンストラクタが1つだけなら <code>@Autowired</code> を省略できます。
                    </p>
                </div>

                <h3>3-4-2 各方法を利用したプログラムの作成</h3>

                <!-- 概要説明 -->
                <div style="background: #f8f9fa; border-left: 4px solid #667eea; padding: 20px; margin: 20px 0; border-radius: 0 8px 8px 0;">
                    <h4 style="margin: 0 0 15px 0; color: #667eea; font-size: 16px;">このサンプルで理解できること</h4>
                    <p style="margin: 0 0 10px 0; line-height: 1.8;">
                        このプログラムでは、<strong>同じ機能（SomeServiceを使う）を5つの異なる方法で実装</strong>することで、
                        Beanの参照を渡す方法の違いを比較できます。
                    </p>
                    <ul style="margin: 10px 0 0 0; padding-left: 20px; line-height: 2;">
                        <li><strong>どの方法でも動作結果は同じ</strong> → 参照の渡し方が違うだけ</li>
                        <li><strong>コードの書き方の違い</strong> → どの方法が簡潔で保守しやすいか</li>
                        <li><strong>推奨される方法</strong> → なぜコンストラクタ経由が推奨されるのか</li>
                    </ul>
                </div>

                <!-- フォルダ構成 -->
                <div class="highlight-box" style="margin: 20px 0;">
                    <p style="margin-bottom: 12px;">
                        <strong>📂 プロジェクト構成</strong>
                    </p>
<pre class="no-margin" style="background: #f8fafc; padding: 12px; border-radius: 6px; font-family: monospace; font-size: 13px; line-height: 1.6;">
chapter3-injection-sample/
├── pom.xml
└── src/main/java/com/example/demo/
    ├── <span style="color: #0ea5e9; font-weight: bold;">InjectionSampleApplication.java</span>   <span style="color: #64748b;">← 起動クラス</span>
    │
    ├── service/                              <span style="color: #64748b;">← 使われる側（注入されるBean）</span>
    │   ├── <span style="color: #3b82f6; font-weight: bold;">SomeService.java</span>               <span style="color: #64748b;">← インターフェース</span>
    │   └── impl/
    │       └── <span style="color: #10b981; font-weight: bold;">SomeServiceImpl.java</span>       <span style="color: #64748b;">← 実装クラス（@Component）</span>
    │
    └── example/                              <span style="color: #64748b;">← 使う側（5つの方法を比較）</span>
        ├── <span style="color: #3b82f6; font-weight: bold;">Example.java</span>                   <span style="color: #64748b;">← インターフェース</span>
        ├── <span style="color: #ef4444; font-weight: bold;">FieldInjectionExample.java</span>     <span style="color: #64748b;">← ❌ フィールドインジェクション</span>
        ├── <span style="color: #f59e0b; font-weight: bold;">SetterInjectionExample.java</span>    <span style="color: #64748b;">← △ セッターインジェクション</span>
        ├── <span style="color: #22c55e; font-weight: bold;">ConstructorInjectionExample.java</span> <span style="color: #64748b;">← ✅ コンストラクタインジェクション</span>
        ├── <span style="color: #22c55e; font-weight: bold;">LombokConstructorExample.java</span>  <span style="color: #64748b;">← ✅ Lombok使用版</span>
        └── <span style="color: #8b5cf6; font-weight: bold;">ConfigBeanExample.java</span>         <span style="color: #64748b;">← Java Config経由</span>
</pre>
                </div>

                <div class="config-table" style="margin: 16px 0;">
                    <div style="font-weight: 600; margin-bottom: 12px; color: var(--primary)">📋 ファイルの役割</div>
                    <div class="config-row">
                        <span class="config-label">service/</span>
                        <span class="config-value"><strong>使われる側</strong>：各Exampleクラスに注入されるBean（SomeService）</span>
                    </div>
                    <div class="config-row">
                        <span class="config-label">example/</span>
                        <span class="config-value"><strong>使う側</strong>：5つの異なる方法でSomeServiceの参照を受け取るクラス</span>
                    </div>
                </div>

                <!-- クラス構成図 -->
                <figure style="margin: 30px 0;">
                    <figcaption style="font-weight: bold; margin-bottom: 15px;">図3.25 サンプルプログラムのクラス構成</figcaption>
                    <svg viewBox="0 0 800 620" style="width: 100%; max-width: 800px; height: auto; display: block; margin: 0 auto;">
                        <defs>
                            <marker id="arrowhead-dep" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#f57c00"/>
                            </marker>
                        </defs>

                        <!-- 背景 -->
                        <rect width="800" height="620" fill="#fafafa" rx="8"/>

                        <!-- ===== 1列目：Example インターフェース ===== -->
                        <g transform="translate(20, 160)">
                            <rect width="150" height="70" fill="#e3f2fd" stroke="#1976d2" stroke-width="2" rx="6"/>
                            <text x="75" y="22" text-anchor="middle" font-size="10" fill="#1976d2">«interface»</text>
                            <text x="75" y="44" text-anchor="middle" font-weight="bold" font-size="14" fill="#1976d2">Example</text>
                            <text x="75" y="60" text-anchor="middle" font-size="10" fill="#666">+ run(): void</text>
                        </g>

                        <!-- ===== 2列目：5つの実装クラス（縦並び） ===== -->
                        <!-- 1. FieldInjectionExample -->
                        <g transform="translate(250, 20)">
                            <rect width="200" height="68" fill="#ffebee" stroke="#c62828" stroke-width="2" rx="6"/>
                            <text x="100" y="16" text-anchor="middle" font-size="9" fill="#c62828">❌ 非推奨</text>
                            <text x="100" y="30" text-anchor="middle" font-size="9" fill="#4caf50">@Component</text>
                            <text x="100" y="46" text-anchor="middle" font-weight="bold" font-size="11" fill="#333">FieldInjectionExample</text>
                            <text x="100" y="61" text-anchor="middle" font-size="8" fill="#c62828">@Autowired フィールド</text>
                        </g>

                        <!-- 2. SetterInjectionExample -->
                        <g transform="translate(250, 98)">
                            <rect width="200" height="68" fill="#fff8e1" stroke="#f9a825" stroke-width="2" rx="6"/>
                            <text x="100" y="16" text-anchor="middle" font-size="9" fill="#f9a825">△ 条件付き</text>
                            <text x="100" y="30" text-anchor="middle" font-size="9" fill="#4caf50">@Component</text>
                            <text x="100" y="46" text-anchor="middle" font-weight="bold" font-size="11" fill="#333">SetterInjectionExample</text>
                            <text x="100" y="61" text-anchor="middle" font-size="8" fill="#f9a825">@Autowired セッター</text>
                        </g>

                        <!-- 3. ConstructorInjectionExample -->
                        <g transform="translate(250, 176)">
                            <rect width="200" height="68" fill="#e8f5e9" stroke="#2e7d32" stroke-width="2" rx="6"/>
                            <text x="100" y="16" text-anchor="middle" font-size="9" fill="#2e7d32">✅ 推奨</text>
                            <text x="100" y="30" text-anchor="middle" font-size="9" fill="#4caf50">@Component</text>
                            <text x="100" y="46" text-anchor="middle" font-weight="bold" font-size="11" fill="#333">ConstructorInjectionExample</text>
                            <text x="100" y="61" text-anchor="middle" font-size="8" fill="#2e7d32">@Autowired コンストラクタ</text>
                        </g>

                        <!-- 4. ConstructorInjectionOmitExample -->
                        <g transform="translate(250, 254)">
                            <rect width="200" height="68" fill="#e8f5e9" stroke="#2e7d32" stroke-width="2" rx="6"/>
                            <text x="100" y="16" text-anchor="middle" font-size="9" fill="#2e7d32">✅ 推奨</text>
                            <text x="100" y="30" text-anchor="middle" font-size="9" fill="#4caf50">@Component</text>
                            <text x="100" y="46" text-anchor="middle" font-weight="bold" font-size="11" fill="#333">ConstructorInjectionOmitExample</text>
                            <text x="100" y="61" text-anchor="middle" font-size="8" fill="#2e7d32">@Autowired 省略</text>
                        </g>

                        <!-- 5. ConstructorInjectionLombokExample -->
                        <g transform="translate(250, 332)">
                            <rect width="200" height="68" fill="#e8f5e9" stroke="#2e7d32" stroke-width="2" rx="6"/>
                            <text x="100" y="16" text-anchor="middle" font-size="9" fill="#2e7d32">✅ 推奨</text>
                            <text x="100" y="30" text-anchor="middle" font-size="8" fill="#4caf50">@Component @RequiredArgsConstructor</text>
                            <text x="100" y="46" text-anchor="middle" font-weight="bold" font-size="11" fill="#333">ConstructorInjectionLombokExample</text>
                            <text x="100" y="61" text-anchor="middle" font-size="8" fill="#2e7d32">Lombok自動生成</text>
                        </g>

                        <!-- ===== 3列目：SomeService, SomeServiceImpl ===== -->
                        <!-- SomeServiceインターフェース -->
                        <g transform="translate(550, 120)">
                            <rect width="160" height="70" fill="#fff3e0" stroke="#f57c00" stroke-width="2" rx="6"/>
                            <text x="80" y="22" text-anchor="middle" font-size="10" fill="#f57c00">«interface»</text>
                            <text x="80" y="44" text-anchor="middle" font-weight="bold" font-size="14" fill="#f57c00">SomeService</text>
                            <text x="80" y="60" text-anchor="middle" font-size="10" fill="#666">+ doService(): void</text>
                        </g>

                        <!-- SomeServiceImpl -->
                        <g transform="translate(550, 220)">
                            <rect width="160" height="60" fill="#fff" stroke="#f57c00" stroke-width="2" rx="6"/>
                            <text x="80" y="22" text-anchor="middle" font-size="10" fill="#4caf50">@Component</text>
                            <text x="80" y="44" text-anchor="middle" font-weight="bold" font-size="13" fill="#333">SomeServiceImpl</text>
                        </g>

                        <!-- SomeServiceImpl → SomeService 実装線 -->
                        <line x1="630" y1="220" x2="630" y2="190" stroke="#666" stroke-width="1.5"/>
                        <polygon points="630,195 625,205 635,205" fill="none" stroke="#666" stroke-width="1.5"/>

                        <!-- ===== 実装線（5つのクラス → Example）===== -->
                        <!-- 各クラスの左端中央からExample右端中央（170, 195）へ、縦線はx=210で重ねる -->
                        <path d="M 250 54 L 210 54 L 210 195 L 170 195" fill="none" stroke="#666" stroke-width="1.5"/>
                        <path d="M 250 132 L 210 132 L 210 195 L 170 195" fill="none" stroke="#666" stroke-width="1.5"/>
                        <path d="M 250 210 L 210 210 L 210 195 L 170 195" fill="none" stroke="#666" stroke-width="1.5"/>
                        <path d="M 250 288 L 210 288 L 210 195 L 170 195" fill="none" stroke="#666" stroke-width="1.5"/>
                        <path d="M 250 366 L 210 366 L 210 195 L 170 195" fill="none" stroke="#666" stroke-width="1.5"/>
                        <!-- 実装の三角矢印（1つだけ） -->
                        <polygon points="175,195 185,190 185,200" fill="none" stroke="#666" stroke-width="1.5"/>

                        <!-- ===== 依存線（5つのクラス → SomeServiceImpl）===== -->
                        <!-- 各クラスの右端中央からSomeServiceImplの左端中央（550, 250）へ、縦線はx=490で重ねる -->
                        <path d="M 450 54 L 490 54 L 490 250 L 550 250" fill="none" stroke="#f57c00" stroke-width="1.5" marker-end="url(#arrowhead-dep)"/>
                        <path d="M 450 132 L 490 132 L 490 250 L 550 250" fill="none" stroke="#f57c00" stroke-width="1.5" marker-end="url(#arrowhead-dep)"/>
                        <path d="M 450 210 L 490 210 L 490 250 L 550 250" fill="none" stroke="#f57c00" stroke-width="1.5" marker-end="url(#arrowhead-dep)"/>
                        <path d="M 450 288 L 490 288 L 490 250 L 550 250" fill="none" stroke="#f57c00" stroke-width="1.5" marker-end="url(#arrowhead-dep)"/>
                        <path d="M 450 366 L 490 366 L 490 250 L 550 250" fill="none" stroke="#f57c00" stroke-width="1.5" marker-end="url(#arrowhead-dep)"/>

                        <!-- ===== ポイント説明 ===== -->
                        <g transform="translate(20, 480)">
                            <rect width="760" height="80" fill="#e8eaf6" stroke="#3f51b5" stroke-width="1" rx="6"/>
                            <text x="20" y="22" font-weight="bold" font-size="13" fill="#3f51b5">ポイント</text>
                            <text x="20" y="42" font-size="11" fill="#333">• 5つのクラスはすべて Example インターフェースを実装 → 同じrun()メソッドを持つ</text>
                            <text x="20" y="58" font-size="11" fill="#333">• すべてのクラスが SomeService の参照を必要とする → 参照の渡し方だけが異なる</text>
                            <text x="20" y="74" font-size="11" fill="#333">• 実行時、SpringがSomeServiceImplのインスタンス（Bean）の参照を各クラスに渡す</text>
                        </g>

                        <!-- ===== 凡例（一番下） ===== -->
                        <g transform="translate(20, 570)">
                            <rect width="760" height="40" fill="#fff" stroke="#ddd" stroke-width="1" rx="6"/>
                            <text x="20" y="26" font-weight="bold" font-size="11" fill="#333">凡例:</text>

                            <line x1="70" y1="20" x2="100" y2="20" stroke="#666" stroke-width="1.5"/>
                            <polygon points="95,15 95,25 105,20" fill="none" stroke="#666" stroke-width="1.5"/>
                            <text x="115" y="24" font-size="10" fill="#333">implements</text>

                            <line x1="200" y1="20" x2="230" y2="20" stroke="#f57c00" stroke-width="1.5" marker-end="url(#arrowhead-dep)"/>
                            <text x="245" y="24" font-size="10" fill="#333">依存（参照を渡す）</text>

                            <rect x="370" y="12" width="30" height="16" fill="#e8f5e9" stroke="#2e7d32" rx="3"/>
                            <text x="408" y="24" font-size="10" fill="#333">推奨</text>

                            <rect x="460" y="12" width="30" height="16" fill="#fff8e1" stroke="#f9a825" rx="3"/>
                            <text x="498" y="24" font-size="10" fill="#333">条件付き</text>

                            <rect x="570" y="12" width="30" height="16" fill="#ffebee" stroke="#c62828" rx="3"/>
                            <text x="608" y="24" font-size="10" fill="#333">非推奨</text>
                        </g>
                    </svg>
                </figure>

                <p>
                    上記の構成で、5つの方法を試すためのインターフェースと実装クラスを作成します。
                </p>

                <!-- 使われる側：SomeService -->
                <h4 style="margin-top: 24px; color: #3b82f6;">使われる側（注入されるBean）</h4>

                <div class="code-block">
                    <div class="code-header">
                        <div class="code-dots">
                            <span class="code-dot red"></span>
                            <span class="code-dot yellow"></span>
                            <span class="code-dot green"></span>
                        </div>
                        <span class="code-title">リスト3.17 SomeService.java（インターフェース）</span>
                    </div>
                    <div class="code-content">
                        <pre><span class="line-num">001:</span> <span class="code-keyword">package</span> com.example.demo.service;
<span class="line-num">002:</span>
<span class="line-num">003:</span> <span class="code-comment">/**</span>
<span class="line-num">004:</span> <span class="code-comment"> * サービスインターフェース</span>
<span class="line-num">005:</span> <span class="code-comment"> */</span>
<span class="line-num">006:</span> <span class="code-keyword">public interface</span> <span class="code-class">SomeService</span> {
<span class="line-num">007:</span>     <span class="code-keyword">void</span> <span class="code-method">doService</span>();
<span class="line-num">008:</span> }</pre>
                    </div>
                </div>

                <div class="code-block" style="margin-top: 16px;">
                    <div class="code-header">
                        <div class="code-dots">
                            <span class="code-dot red"></span>
                            <span class="code-dot yellow"></span>
                            <span class="code-dot green"></span>
                        </div>
                        <span class="code-title">リスト3.18 SomeServiceImpl.java（実装クラス）</span>
                    </div>
                    <div class="code-content">
                        <pre><span class="line-num">001:</span> <span class="code-keyword">package</span> com.example.demo.service.impl;
<span class="line-num">002:</span>
<span class="line-num">003:</span> <span class="code-keyword">import</span> org.springframework.stereotype.Component;
<span class="line-num">004:</span> <span class="code-keyword">import</span> com.example.demo.service.SomeService;
<span class="line-num">005:</span>
<span class="line-num">006:</span> <span class="code-comment">/**</span>
<span class="line-num">007:</span> <span class="code-comment"> * サービス実装クラス</span>
<span class="line-num">008:</span> <span class="code-comment"> */</span>
<span class="line-num">009:</span> <span class="code-annotation">@Component</span>
<span class="line-num">010:</span> <span class="code-keyword">public class</span> <span class="code-class">SomeServiceImpl</span> <span class="code-keyword">implements</span> <span class="code-class">SomeService</span> {
<span class="line-num">011:</span>     <span class="code-annotation">@Override</span>
<span class="line-num">012:</span>     <span class="code-keyword">public void</span> <span class="code-method">doService</span>() {
<span class="line-num">013:</span>         System.out.<span class="code-method">println</span>(<span class="code-string">"SomeServiceが実行されました"</span>);
<span class="line-num">014:</span>     }
<span class="line-num">015:</span> }</pre>
                    </div>
                </div>

                <!-- 使う側：5つの方法 -->
                <h4 style="margin-top: 32px; color: #f59e0b;">使う側（5つのインジェクション方法）</h4>

                <!-- ① フィールドインジェクション -->
                <div style="background: #fef2f2; border-left: 4px solid #ef4444; padding: 12px 16px; margin: 16px 0;">
                    <p class="no-margin" style="font-weight: bold; color: #dc2626;">❌ 方法① フィールドインジェクション（非推奨）</p>
                </div>

                <div class="code-block">
                    <div class="code-header">
                        <div class="code-dots">
                            <span class="code-dot red"></span>
                            <span class="code-dot yellow"></span>
                            <span class="code-dot green"></span>
                        </div>
                        <span class="code-title">リスト3.19 FieldInjectionExample.java</span>
                    </div>
                    <div class="code-content">
                        <pre><span class="line-num">001:</span> <span class="code-keyword">package</span> com.example.demo.example;
<span class="line-num">002:</span>
<span class="line-num">003:</span> <span class="code-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="line-num">004:</span> <span class="code-keyword">import</span> org.springframework.stereotype.Component;
<span class="line-num">005:</span> <span class="code-keyword">import</span> com.example.demo.service.SomeService;
<span class="line-num">006:</span>
<span class="line-num">007:</span> <span class="code-comment">/**</span>
<span class="line-num">008:</span> <span class="code-comment"> * フィールドインジェクションの例（非推奨）</span>
<span class="line-num">009:</span> <span class="code-comment"> */</span>
<span class="line-num">010:</span> <span class="code-annotation">@Component</span>
<span class="line-num">011:</span> <span class="code-keyword">public class</span> <span class="code-class">FieldInjectionExample</span> <span class="code-keyword">implements</span> <span class="code-class">Example</span> {
<span class="line-num">012:</span>
<span class="line-num">013:</span>     <span class="code-comment">// フィールドに直接@Autowiredを付与</span>
<span class="line-num">014:</span>     <span class="code-annotation">@Autowired</span>
<span class="line-num">015:</span>     <span class="code-keyword">private</span> <span class="code-class">SomeService</span> someService;  <span class="code-comment">// finalにできない</span>
<span class="line-num">016:</span>
<span class="line-num">017:</span>     <span class="code-annotation">@Override</span>
<span class="line-num">018:</span>     <span class="code-keyword">public void</span> <span class="code-method">run</span>() {
<span class="line-num">019:</span>         someService.<span class="code-method">doService</span>();
<span class="line-num">020:</span>     }
<span class="line-num">021:</span> }</pre>
                    </div>
                </div>

                <!-- ② セッターインジェクション -->
                <div style="background: #fefce8; border-left: 4px solid #f59e0b; padding: 12px 16px; margin: 16px 0;">
                    <p class="no-margin" style="font-weight: bold; color: #d97706;">△ 方法② セッターインジェクション（条件付き）</p>
                </div>

                <div class="code-block">
                    <div class="code-header">
                        <div class="code-dots">
                            <span class="code-dot red"></span>
                            <span class="code-dot yellow"></span>
                            <span class="code-dot green"></span>
                        </div>
                        <span class="code-title">リスト3.20 SetterInjectionExample.java</span>
                    </div>
                    <div class="code-content">
                        <pre><span class="line-num">001:</span> <span class="code-keyword">package</span> com.example.demo.example;
<span class="line-num">002:</span>
<span class="line-num">003:</span> <span class="code-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="line-num">004:</span> <span class="code-keyword">import</span> org.springframework.stereotype.Component;
<span class="line-num">005:</span> <span class="code-keyword">import</span> com.example.demo.service.SomeService;
<span class="line-num">006:</span>
<span class="line-num">007:</span> <span class="code-comment">/**</span>
<span class="line-num">008:</span> <span class="code-comment"> * セッターインジェクションの例</span>
<span class="line-num">009:</span> <span class="code-comment"> */</span>
<span class="line-num">010:</span> <span class="code-annotation">@Component</span>
<span class="line-num">011:</span> <span class="code-keyword">public class</span> <span class="code-class">SetterInjectionExample</span> <span class="code-keyword">implements</span> <span class="code-class">Example</span> {
<span class="line-num">012:</span>
<span class="line-num">013:</span>     <span class="code-keyword">private</span> <span class="code-class">SomeService</span> someService;  <span class="code-comment">// finalにできない</span>
<span class="line-num">014:</span>
<span class="line-num">015:</span>     <span class="code-comment">// セッターメソッドに@Autowiredを付与</span>
<span class="line-num">016:</span>     <span class="code-annotation">@Autowired</span>
<span class="line-num">017:</span>     <span class="code-keyword">public void</span> <span class="code-method">setSomeService</span>(<span class="code-class">SomeService</span> someService) {
<span class="line-num">018:</span>         <span class="code-keyword">this</span>.someService = someService;
<span class="line-num">019:</span>     }
<span class="line-num">020:</span>
<span class="line-num">021:</span>     <span class="code-annotation">@Override</span>
<span class="line-num">022:</span>     <span class="code-keyword">public void</span> <span class="code-method">run</span>() {
<span class="line-num">023:</span>         someService.<span class="code-method">doService</span>();
<span class="line-num">024:</span>     }
<span class="line-num">025:</span> }</pre>
                    </div>
                </div>

                <!-- ③ コンストラクタインジェクション -->
                <div style="background: #E0F7FA; border-left: 4px solid #22c55e; padding: 12px 16px; margin: 16px 0;">
                    <p class="no-margin" style="font-weight: bold; color: #16a34a;">✅ 方法③ コンストラクタインジェクション（推奨）</p>
                </div>

                <div class="code-block">
                    <div class="code-header">
                        <div class="code-dots">
                            <span class="code-dot red"></span>
                            <span class="code-dot yellow"></span>
                            <span class="code-dot green"></span>
                        </div>
                        <span class="code-title">リスト3.21 ConstructorInjectionExample.java</span>
                    </div>
                    <div class="code-content">
                        <pre><span class="line-num">001:</span> <span class="code-keyword">package</span> com.example.demo.example.impl;
<span class="line-num">002:</span>
<span class="line-num">003:</span> <span class="code-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="line-num">004:</span>
<span class="line-num">005:</span> <span class="code-keyword">import</span> com.example.demo.example.Example;
<span class="line-num">006:</span> <span class="code-keyword">import</span> com.example.demo.service.SomeService;
<span class="line-num">007:</span>
<span class="line-num">008:</span> <span class="code-comment">//@Component</span>
<span class="line-num">009:</span> <span class="code-keyword">public class</span> <span class="code-class">ConstructorInjectionExample</span> <span class="code-keyword">implements</span> <span class="code-class">Example</span> {
<span class="line-num">010:</span>     <span class="code-comment">/** フィールド */</span>
<span class="line-num">011:</span>     <span class="code-keyword">private final</span> <span class="code-class">SomeService</span> someService;
<span class="line-num">012:</span>
<span class="line-num">013:</span>     <span class="code-comment">/** コンストラクタインジェクション */</span>
<span class="line-num">014:</span>     <span class="code-annotation">@Autowired</span>
<span class="line-num">015:</span>     <span class="code-keyword">public</span> <span class="code-method">ConstructorInjectionExample</span>(<span class="code-class">SomeService</span> someService) {
<span class="line-num">016:</span>         <span class="code-keyword">this</span>.someService = someService;
<span class="line-num">017:</span>     }
<span class="line-num">018:</span>
<span class="line-num">019:</span>     <span class="code-comment">/** 実行 */</span>
<span class="line-num">020:</span>     <span class="code-keyword">public void</span> <span class="code-method">run</span>() {
<span class="line-num">021:</span>         someService.<span class="code-method">doService</span>();
<span class="line-num">022:</span>     }
<span class="line-num">023:</span> }</pre>
                    </div>
                </div>

                <!-- ④ コンストラクタインジェクション（Lombok） -->
                <div style="background: #E0F7FA; border-left: 4px solid #22c55e; padding: 12px 16px; margin: 16px 0;">
                    <p class="no-margin" style="font-weight: bold; color: #16a34a;">✅ 方法④ コンストラクタインジェクション + Lombok（推奨・簡潔）</p>
                </div>

                <div class="code-block">
                    <div class="code-header">
                        <div class="code-dots">
                            <span class="code-dot red"></span>
                            <span class="code-dot yellow"></span>
                            <span class="code-dot green"></span>
                        </div>
                        <span class="code-title">リスト3.22 LombokConstructorExample.java（Lombok使用）</span>
                    </div>
                    <div class="code-content">
                        <pre><span class="line-num">001:</span> <span class="code-keyword">package</span> com.example.demo.example;
<span class="line-num">002:</span>
<span class="line-num">003:</span> <span class="code-keyword">import</span> org.springframework.stereotype.Component;
<span class="line-num">004:</span> <span class="code-keyword">import</span> com.example.demo.service.SomeService;
<span class="line-num">005:</span> <span class="code-keyword">import</span> lombok.RequiredArgsConstructor;
<span class="line-num">006:</span>
<span class="line-num">007:</span> <span class="code-comment">/**</span>
<span class="line-num">008:</span> <span class="code-comment"> * Lombokを使用したコンストラクタインジェクションの例（推奨）</span>
<span class="line-num">009:</span> <span class="code-comment"> */</span>
<span class="line-num">010:</span> <span class="code-annotation">@Component</span>
<span class="line-num">011:</span> <span class="code-annotation">@RequiredArgsConstructor</span>  <span class="code-comment">// finalフィールドのコンストラクタを自動生成</span>
<span class="line-num">012:</span> <span class="code-keyword">public class</span> <span class="code-class">LombokConstructorExample</span> <span class="code-keyword">implements</span> <span class="code-class">Example</span> {
<span class="line-num">013:</span>
<span class="line-num">014:</span>     <span class="code-keyword">private final</span> <span class="code-class">SomeService</span> someService;  <span class="code-comment">// finalで不変性を保証</span>
<span class="line-num">015:</span>
<span class="line-num">016:</span>     <span class="code-comment">// コンストラクタは@RequiredArgsConstructorが自動生成</span>
<span class="line-num">017:</span>
<span class="line-num">018:</span>     <span class="code-annotation">@Override</span>
<span class="line-num">019:</span>     <span class="code-keyword">public void</span> <span class="code-method">run</span>() {
<span class="line-num">020:</span>         someService.<span class="code-method">doService</span>();
<span class="line-num">021:</span>     }
<span class="line-num">022:</span> }</pre>
                    </div>
                </div>

                <!-- ⑤ Java Config経由 -->
                <div style="background: #f5f3ff; border-left: 4px solid #8b5cf6; padding: 12px 16px; margin: 16px 0;">
                    <p class="no-margin" style="font-weight: bold; color: #7c3aed;">📦 方法⑤ Java Config経由（外部ライブラリ向け）</p>
                </div>

                <p style="font-size: 14px; color: #64748b; margin-bottom: 12px;">
                    自分で作成したクラスではなく、<strong>外部ライブラリのクラス</strong>をBeanとして登録したい場合に使用します。
                </p>

                <div class="code-block">
                    <div class="code-header">
                        <div class="code-dots">
                            <span class="code-dot red"></span>
                            <span class="code-dot yellow"></span>
                            <span class="code-dot green"></span>
                        </div>
                        <span class="code-title">リスト3.23 AppConfig.java（Java Config設定クラス）</span>
                    </div>
                    <div class="code-content">
                        <pre><span class="line-num">001:</span> <span class="code-keyword">package</span> com.example.demo.config;
<span class="line-num">002:</span>
<span class="line-num">003:</span> <span class="code-keyword">import</span> org.springframework.context.annotation.Bean;
<span class="line-num">004:</span> <span class="code-keyword">import</span> org.springframework.context.annotation.Configuration;
<span class="line-num">005:</span> <span class="code-keyword">import</span> com.example.demo.example.Example;
<span class="line-num">006:</span> <span class="code-keyword">import</span> com.example.demo.example.ConfigBeanExample;
<span class="line-num">007:</span> <span class="code-keyword">import</span> com.example.demo.service.SomeService;
<span class="line-num">008:</span>
<span class="line-num">009:</span> <span class="code-comment">/**</span>
<span class="line-num">010:</span> <span class="code-comment"> * Java Config設定クラス</span>
<span class="line-num">011:</span> <span class="code-comment"> */</span>
<span class="line-num">012:</span> <span class="code-annotation">@Configuration</span>
<span class="line-num">013:</span> <span class="code-keyword">public class</span> <span class="code-class">AppConfig</span> {
<span class="line-num">014:</span>
<span class="line-num">015:</span>     <span class="code-annotation">@Bean</span>
<span class="line-num">016:</span>     <span class="code-keyword">public</span> <span class="code-class">Example</span> <span class="code-method">configBeanExample</span>(<span class="code-class">SomeService</span> someService) {
<span class="line-num">017:</span>         <span class="code-keyword">return new</span> <span class="code-class">ConfigBeanExample</span>(someService);
<span class="line-num">018:</span>     }
<span class="line-num">019:</span> }</pre>
                    </div>
                </div>

                <div class="code-block" style="margin-top: 16px;">
                    <div class="code-header">
                        <div class="code-dots">
                            <span class="code-dot red"></span>
                            <span class="code-dot yellow"></span>
                            <span class="code-dot green"></span>
                        </div>
                        <span class="code-title">リスト3.24 ConfigBeanExample.java（@Componentなし）</span>
                    </div>
                    <div class="code-content">
                        <pre><span class="line-num">001:</span> <span class="code-keyword">package</span> com.example.demo.example;
<span class="line-num">002:</span>
<span class="line-num">003:</span> <span class="code-keyword">import</span> com.example.demo.service.SomeService;
<span class="line-num">004:</span>
<span class="line-num">005:</span> <span class="code-comment">/**</span>
<span class="line-num">006:</span> <span class="code-comment"> * Java Config経由でBean登録される例</span>
<span class="line-num">007:</span> <span class="code-comment"> * ※ @Componentは付けない（AppConfigで登録するため）</span>
<span class="line-num">008:</span> <span class="code-comment"> */</span>
<span class="line-num">009:</span> <span class="code-keyword">public class</span> <span class="code-class">ConfigBeanExample</span> <span class="code-keyword">implements</span> <span class="code-class">Example</span> {
<span class="line-num">010:</span>
<span class="line-num">011:</span>     <span class="code-keyword">private final</span> <span class="code-class">SomeService</span> someService;
<span class="line-num">012:</span>
<span class="line-num">013:</span>     <span class="code-comment">// コンストラクタ（AppConfigから呼ばれる）</span>
<span class="line-num">014:</span>     <span class="code-keyword">public</span> <span class="code-method">ConfigBeanExample</span>(<span class="code-class">SomeService</span> someService) {
<span class="line-num">015:</span>         <span class="code-keyword">this</span>.someService = someService;
<span class="line-num">016:</span>     }
<span class="line-num">017:</span>
<span class="line-num">018:</span>     <span class="code-annotation">@Override</span>
<span class="line-num">019:</span>     <span class="code-keyword">public void</span> <span class="code-method">run</span>() {
<span class="line-num">020:</span>         someService.<span class="code-method">doService</span>();
<span class="line-num">021:</span>     }
<span class="line-num">022:</span> }</pre>
                    </div>
                </div>

                <div class="info-box" style="background: #f5f3ff; border-left: 4px solid #8b5cf6; padding: 12px 16px; margin: 16px 0;">
                    <p class="no-margin" style="font-size: 0.9em;">
                        <strong>💡 Java Configを使う場面</strong><br />
                        ・外部ライブラリのクラス（ソースコードを変更できない）をBean登録したい<br />
                        ・インスタンス生成時に複雑な初期化処理が必要<br />
                        ・条件によって異なる実装クラスを切り替えたい
                    </p>
                </div>

                <!-- @RequiredArgsConstructor 解説 -->
                <div style="background: #f5f5f5; border-radius: 8px; padding: 20px; margin: 20px 0;">
                    <h4 style="margin: 0 0 15px 0; color: #333; font-size: 15px;">@RequiredArgsConstructor の仕組み</h4>

                    <!-- なぜ必要か -->
                    <div style="background: #fff3e0; border-radius: 6px; padding: 15px; margin-bottom: 15px;">
                        <div style="font-weight: bold; margin-bottom: 10px; color: #e65100; font-size: 13px;">なぜ必要なのか？</div>
                        <p style="margin: 0 0 10px 0; font-size: 13px; line-height: 1.8;">
                            コンストラクタ経由でBeanの参照を渡す方法は<strong>推奨されている方法</strong>ですが、依存するBeanが増えるとコンストラクタのコード量も増えてしまいます。
                        </p>
                        <div style="background: #fff; border-radius: 4px; padding: 10px; font-size: 12px;">
                            <pre class="no-margin" style="line-height: 1.5;"><span style="color: #388e3c;">// 依存が3つある場合のコンストラクタ</span>
<span style="color: #7b1fa2;">private final</span> UserService userService;
<span style="color: #7b1fa2;">private final</span> OrderService orderService;
<span style="color: #7b1fa2;">private final</span> EmailService emailService;

<span style="color: #7b1fa2;">public</span> MyController(UserService userService,
                    OrderService orderService,
                    EmailService emailService) {
    <span style="color: #7b1fa2;">this</span>.userService = userService;
    <span style="color: #7b1fa2;">this</span>.orderService = orderService;
    <span style="color: #7b1fa2;">this</span>.emailService = emailService;  <span style="color: #c62828;">← 毎回同じパターンの繰り返し</span>
}</pre>
                        </div>
                        <p style="margin: 10px 0 0 0; font-size: 13px; color: #666;">
                            このような<strong>定型的なコード（ボイラープレート）</strong>を自動生成してくれるのがLombokの<code>@RequiredArgsConstructor</code>です。
                        </p>
                    </div>

                    <p style="margin: 0 0 15px 0; line-height: 1.8;">
                        9行目の<code style="background: #fff3e0; padding: 2px 6px; border-radius: 4px; color: #e65100;">@RequiredArgsConstructor</code>は、<strong>Lombok</strong>が提供するアノテーションです。
                        このアノテーションを付与すると、<code>final</code>フィールドを引数に持つコンストラクタが<strong>自動生成</strong>されます。
                    </p>

                    <!-- コード比較 -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 15px 0;">
                        <!-- 左：通常のコンストラクタ -->
                        <div style="background: #fff; border: 2px solid #ccc; border-radius: 8px; padding: 15px;">
                            <div style="font-weight: bold; margin-bottom: 10px; color: #666; font-size: 13px;">通常の書き方（手動でコンストラクタを記述）</div>
                            <pre class="no-margin" style="font-size: 12px; line-height: 1.6; background: #fafafa; padding: 10px; border-radius: 4px; overflow-x: auto;"><span style="color: #7b1fa2;">private final</span> SomeService someService;

<span style="color: #388e3c;">// コンストラクタを自分で書く</span>
<span style="color: #7b1fa2;">public</span> ConstructorInjectionExample(
        SomeService someService) {
    <span style="color: #7b1fa2;">this</span>.someService = someService;
}</pre>
                        </div>

                        <!-- 右：Lombok使用 -->
                        <div style="background: #fff; border: 2px solid #4caf50; border-radius: 8px; padding: 15px;">
                            <div style="font-weight: bold; margin-bottom: 10px; color: #4caf50; font-size: 13px;">✅ Lombok使用（コンストラクタ自動生成）</div>
                            <pre class="no-margin" style="font-size: 12px; line-height: 1.6; background: #e8f5e9; padding: 10px; border-radius: 4px; overflow-x: auto;"><span style="color: #f57c00;">@RequiredArgsConstructor</span>
<span style="color: #7b1fa2;">public class</span> ...Example {
    <span style="color: #7b1fa2;">private final</span> SomeService someService;

    <span style="color: #388e3c;">// コンストラクタは自動生成される！</span>
}</pre>
                        </div>
                    </div>

                    <!-- 動作の流れ -->
                    <div style="background: #e3f2fd; border-radius: 6px; padding: 15px; margin-top: 15px;">
                        <div style="font-weight: bold; margin-bottom: 10px; color: #1976d2; font-size: 13px;">なぜこれで動くのか？</div>
                        <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
                            <tr>
                                <td style="padding: 8px; border-bottom: 1px solid #bbdefb; width: 30px; text-align: center; font-weight: bold; color: #1976d2;">①</td>
                                <td style="padding: 8px; border-bottom: 1px solid #bbdefb;"><code>@RequiredArgsConstructor</code>により、Lombokがコンパイル時にコンストラクタを自動生成</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border-bottom: 1px solid #bbdefb; text-align: center; font-weight: bold; color: #1976d2;">②</td>
                                <td style="padding: 8px; border-bottom: 1px solid #bbdefb;">生成されるコンストラクタは1つだけ</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; text-align: center; font-weight: bold; color: #1976d2;">③</td>
                                <td style="padding: 8px;">Spring 4.3以降、コンストラクタが1つだけなら<code>@Autowired</code>が不要 → Springが自動でBeanの参照を渡す</td>
                            </tr>
                        </table>
                    </div>
                </div>

                <h3>3-4-3 DIのイメージ</h3>

                <p>最後にDIを現実世界で表すストーリーを話します。DIの理解に繋がるきっかけになれば幸いです。</p>

                <p>
                    あなたは新しい「冷蔵庫」を購入しました。しかし、冷蔵庫は自分で「電気」を生成する機能がありません。電気がないと、冷蔵庫は食品を冷やすことができません。そこで家の電源コンセントに冷蔵庫のプラグを接続します。この電気は、電気会社から供給されています。電気が供給されることで、冷蔵庫はちゃんと食品を冷やすことができるようになります。この例でいうと、
                </p>

                <div class="highlight-box success">
                    <p><strong>◆ 冷蔵庫</strong> → 使うクラス</p>
                    <p><strong>◆ 電気</strong> → 使われるクラス（必要な機能やデータ）</p>
                    <p style="margin-bottom: 0"><strong>◆ 電気会社</strong> → DIコンテナ</p>
                </div>

                <p>
                    つまり、DIとは「必要なもの（電気）を外部から提供してもらう」ことを指します。使うクラス（冷蔵庫）は、自分で必要なものを作るのではなく、外部（電気会社：DIコンテナ）から提供される電気（使われるクラス）を利用します。
                </p>

                <div class="diagram-container">
                    <div class="diagram-title">図3.25 DIのイメージ</div>
                    <svg class="diagram-svg" viewBox="0 0 500 180" width="500" height="180">
                        <!-- 冷蔵庫 -->
                        <rect
                            x="50"
                            y="40"
                            width="100"
                            height="120"
                            rx="8"
                            fill="#dbeafe"
                            stroke="#0ea5e9"
                            stroke-width="2"
                        />
                        <rect x="60" y="50" width="80" height="50" rx="4" fill="white" />
                        <rect x="60" y="105" width="80" height="45" rx="4" fill="white" />
                        <text x="100" y="170" text-anchor="middle" font-size="12" fill="#64748b">冷蔵庫</text>
                        <text x="100" y="183" text-anchor="middle" font-size="10" fill="#64748b">（使うクラス）</text>

                        <!-- 電線 -->
                        <path d="M150 100 L280 100" stroke="#f59e0b" stroke-width="4" fill="none" />
                        <text x="215" y="85" text-anchor="middle" font-size="11" fill="#f59e0b" font-weight="600">
                            電力
                        </text>

                        <!-- 電気会社 -->
                        <rect
                            x="280"
                            y="50"
                            width="120"
                            height="100"
                            rx="8"
                            fill="#fef3c7"
                            stroke="#f59e0b"
                            stroke-width="2"
                        />
                        <text x="340" y="90" text-anchor="middle" font-size="24">⚡</text>
                        <text x="340" y="120" text-anchor="middle" font-size="12" font-weight="600" fill="#1e293b">
                            電気会社
                        </text>
                        <text x="340" y="165" text-anchor="middle" font-size="12" fill="#64748b">DIコンテナ</text>

                        <!-- 発電所 -->
                        <rect x="420" y="60" width="60" height="80" rx="4" fill="#f8fafc" stroke="#64748b" />
                        <text x="450" y="100" text-anchor="middle" font-size="24">🏭</text>
                        <text x="450" y="125" text-anchor="middle" font-size="10" fill="#64748b">発電</text>
                    </svg>
                </div>

                <div class="column">
                    <div class="column-header">
                        <span class="column-badge">Column</span>
                        <span class="column-title">コンストラクタ経由（コンストラクタインジェクション）が推奨される理由</span>
                    </div>
                    <p>コンストラクタ経由（コンストラクタインジェクション）でBeanの参照を渡す方法が推奨される理由を以下に列挙します。</p>
                    <p>
                        <strong>◆ 単一責任の原則</strong><br />
                        オブジェクト指向プログラミングの基本原則の一つで、「一つのクラスは一つの機能だけを持つべき」という考え方です。コンストラクタ経由を使用すると、一つのクラスがたくさんの責任（機能）を持っている場合、その依存関係が多いことに気づきやすくなります。これにより、適切なクラス設計が促進されます。
                    </p>
                    <p>
                        <strong>◆ 不変性（finalフィールド）</strong><br />
                        コンストラクタ経由を使用すると、フィールドに <code>final</code> を付けられるため、参照は生成時に設定され、その後は変更されません。これにより、オブジェクトの状態が予測可能で安定します。
                    </p>
                    <p style="margin-bottom: 0">
                        <strong>◆ 循環依存の早期検出</strong><br />
                        コンストラクタ経由を使用すると、循環依存がある場合、アプリケーションの起動時にエラーが発生します。これにより、問題を早期に発見し、修正することができます。
                    </p>
                </div>
            </section>
        </div>

        <footer class="footer">
            <p>Spring Framework 入門チュートリアル</p>
        </footer>

        <div class="page-nav">
            <a href="2java_basics.html" class="page-nav-btn prev">
                <span>←</span>
                <div>
                    <div class="page-nav-label">前の章</div>
                    <div class="page-nav-title">第2章</div>
                </div>
            </a>

            <a href="4aop-tutorial.html" class="page-nav-btn next">
                <div>
                    <div class="page-nav-label">次の章</div>
                    <div class="page-nav-title">第4章</div>
                </div>
                <span>→</span>
            </a>
        </div>

        <script>
            function toggleMenu() {
                const toggle = document.querySelector(".nav-toggle");
                const menu = document.querySelector(".nav-menu");
                toggle.classList.toggle("active");
                menu.classList.toggle("active");
            }

            document.addEventListener("click", function (e) {
                const nav = document.querySelector(".global-nav");
                const toggle = document.querySelector(".nav-toggle");
                const menu = document.querySelector(".nav-menu");

                if (!nav.contains(e.target) && menu.classList.contains("active")) {
                    toggle.classList.remove("active");
                    menu.classList.remove("active");
                }
            });

            window.addEventListener("resize", function () {
                if (window.innerWidth >= 1024) {
                    const toggle = document.querySelector(".nav-toggle");
                    const menu = document.querySelector(".nav-menu");
                    toggle.classList.remove("active");
                    menu.classList.remove("active");
                }
            });
        </script>
    </body>
</html>
