<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>第8章 Docker Hubとイメージ管理 - Docker構築入門</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700;900&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../../shared/common.css">
    <style>
      :root {
        --primary: #F5A623;
        --primary-dark: #D4891D;
        --primary-light: #FEF7E8;
        --primary-lighter: #FDE4A8;
      }
      body { padding-top: 48px; }
      .nav-category-links { display: none; }
      /* 図解用スタイル */
      .visual-diagram {
        margin: 28px 0; padding: 28px 20px;
        background: linear-gradient(135deg, #fef7e8 0%, #fef7e8 100%);
        border-radius: 16px; border: 1px solid #fde4a8;
      }
      .visual-diagram-title {
        text-align: center; font-size: 0.82rem; font-weight: 700;
        color: #F5A623; margin-bottom: 20px; letter-spacing: 0.05em;
      }
      .vd-flow {
        display: flex; align-items: center; justify-content: center;
        gap: 10px; flex-wrap: wrap;
      }
      .vd-box {
        background: white; border: 2px solid #F5A623; border-radius: 14px;
        padding: 16px 14px; text-align: center; min-width: 110px;
        box-shadow: 0 2px 8px rgba(245,166,35,0.08);
      }
      .vd-box.accent { background: #F5A623; color: white; }
      .vd-box .vd-icon { font-size: 1.6rem; display: block; margin-bottom: 4px; }
      .vd-box .vd-label { font-size: 0.78rem; font-weight: 700; display: block; }
      .vd-box .vd-sub { font-size: 0.68rem; opacity: 0.7; display: block; margin-top: 2px; }
      .vd-arrow { color: #F5A623; font-size: 1.3rem; font-weight: 700; }
      .vd-grid {
        display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 12px;
      }
      .vd-card {
        background: white; border-radius: 12px; padding: 16px; text-align: center;
        border: 2px solid #fef7e8; box-shadow: 0 1px 4px rgba(0,0,0,0.04);
      }
      .vd-card .vd-icon { font-size: 1.8rem; display: block; margin-bottom: 6px; }
      .vd-card .vd-label { font-size: 0.78rem; font-weight: 700; display: block; color: #F5A623; }
      .vd-card .vd-sub { font-size: 0.68rem; color: #666; display: block; margin-top: 4px; }
      .vd-card.green { border-color: #a5d6a7; background: #f1f8e9; }
      .vd-card.red { border-color: #ef9a9a; background: #fce4ec; }
      .vd-card.blue { border-color: #90caf9; background: #e3f2fd; }
      .vd-card.amber { border-color: #ffe082; background: #fff8e1; }
      .vd-card.purple { border-color: #ce93d8; background: #f3e5f5; }
      .vd-bar {
        display: flex; border-radius: 12px; overflow: hidden; margin: 16px 0;
      }
      .vd-bar-seg {
        flex: 1; padding: 14px 8px; text-align: center; font-size: 0.72rem; font-weight: 600; color: white;
      }
      @media (max-width: 560px) {
        .vd-flow { flex-direction: column; }
        .vd-arrow { transform: rotate(90deg); }
        .vd-grid { grid-template-columns: repeat(2, 1fr); }
      }
    </style>
</head>
<body>
    <nav class="global-nav"></nav>
    <script src="../../shared/js/nav-docker.js"></script>

    <div class="container">
        <header class="chapter-header">
            <div class="chapter-badge"><span class="material-icons">menu_book</span> Chapter</div>
            <div class="chapter-number">8</div>
            <h1 class="chapter-title">Docker Hubとイメージ管理</h1>
        </header>

        <nav class="toc">
            <h2 class="toc-title"><span class="material-icons">list_alt</span> この章の内容</h2>
            <ul class="toc-list">
                <li class="toc-item"><span class="toc-number">8-1</span><span>Docker Hubとは</span></li>
                <li class="toc-item"><span class="toc-number">8-2</span><span>イメージのpushとpull</span></li>
                <li class="toc-item"><span class="toc-number">8-3</span><span>タグ戦略とバージョニング</span></li>
                <li class="toc-item"><span class="toc-number">8-4</span><span>プライベートリポジトリ</span></li>
                <li class="toc-item"><span class="toc-number">8-5</span><span>GitHub Container Registry（GHCR）</span></li>
            </ul>
        </nav>

        <!-- セクション 8-1 -->
        <section class="section">
            <div class="section-header">
                <span class="section-number">Section 8-1</span>
                <h2 class="section-title">Docker Hubとは</h2>
            </div>

            <div class="intro-text">
                <p>Docker Hubは、Dockerイメージの保存・共有・配布を行うクラウドベースのレジストリサービスです。GitHubがソースコードのリポジトリであるように、Docker Hubはコンテナイメージのリポジトリとして機能します。</p>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">1.1 Docker Hubの役割</h3>
                <div class="content-block">
                    <ul>
                        <li><strong>公式イメージの提供</strong>: nginx, mysql, node, python等の公式イメージを無料で利用可能</li>
                        <li><strong>イメージの共有</strong>: チームやコミュニティとイメージを共有</li>
                        <li><strong>CI/CDとの連携</strong>: GitHub ActionsなどからのAutomated Builds</li>
                        <li><strong>脆弱性スキャン</strong>: イメージのセキュリティチェック</li>
                    </ul>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">1.2 アカウント作成とログイン</h3>
                <div class="content-block">
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-title">Docker Hubへのログイン</span>
                            <span class="code-lang">Terminal</span>
                        </div>
                        <pre class="code-content"><code># Docker Hubにログイン
docker login

# Username: your-username
# Password: your-password
# Login Succeeded

# ログイン状態の確認
docker info | grep Username

# ログアウト
docker logout</code></pre>
                    </div>

                    <div class="info-box">
                        <div class="info-box-header">
                            <span class="info-box-icon"><span class="material-icons">lightbulb</span></span>
                            <span class="info-box-title">Personal Access Token</span>
                        </div>
                        <p>セキュリティの観点から、パスワードの代わりにPersonal Access Token（PAT）を使用することが推奨されています。Docker Hubの設定画面からトークンを作成できます。CI/CD環境では必ずPATを使用してください。</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- セクション 8-2 -->
        <section class="section">
            <div class="section-header">
                <span class="section-number">Section 8-2</span>
                <h2 class="section-title">イメージのpushとpull</h2>
            </div>

            <div class="intro-text">
                <p>ローカルでビルドしたイメージをDocker Hubにアップロード（push）し、他の環境でダウンロード（pull）する方法を学びます。</p>
            </div>

            <!-- 図解: Docker Hub ワークフロー -->
            <div class="visual-diagram">
                <div class="visual-diagram-title">Docker Hub イメージのpush / pullワークフロー</div>
                <div class="vd-flow">
                    <div class="vd-box">
                        <span class="vd-icon">&#128736;</span>
                        <span class="vd-label">docker build</span>
                        <span class="vd-sub">ローカルでビルド</span>
                    </div>
                    <span class="vd-arrow">&#8594;</span>
                    <div class="vd-box" style="border-color:#43a047;">
                        <span class="vd-icon">&#127991;</span>
                        <span class="vd-label" style="color:#43a047;">docker tag</span>
                        <span class="vd-sub">レジストリ名を付与</span>
                    </div>
                    <span class="vd-arrow">&#8594;</span>
                    <div class="vd-box accent">
                        <span class="vd-icon">&#9650;</span>
                        <span class="vd-label">docker push</span>
                        <span class="vd-sub">レジストリに送信</span>
                    </div>
                    <span class="vd-arrow">&#8594;</span>
                    <div class="vd-box" style="border-color:#e65100;">
                        <span class="vd-icon">&#9660;</span>
                        <span class="vd-label" style="color:#e65100;">docker pull</span>
                        <span class="vd-sub">別環境で取得</span>
                    </div>
                </div>
                <p style="text-align:center;font-size:0.7rem;color:#666;margin-top:14px;"><strong>build</strong> → <strong>tag</strong> → <strong>push</strong> の順序でイメージをレジストリに登録する</p>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">2.1 イメージのタグ付けとpush</h3>
                <div class="content-block">
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-title">イメージをDocker Hubにpush</span>
                            <span class="code-lang">Terminal</span>
                        </div>
                        <pre class="code-content"><code># ローカルでイメージをビルド
docker build -t my-webapp:latest ./backend

# Docker Hub用にタグを付ける
# 形式: docker tag ローカル名 ユーザー名/リポジトリ名:タグ
docker tag my-webapp:latest username/my-webapp:latest
docker tag my-webapp:latest username/my-webapp:1.0.0

# Docker Hubにpush
docker push username/my-webapp:latest
docker push username/my-webapp:1.0.0</code></pre>
                    </div>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">2.2 イメージのpull</h3>
                <div class="content-block">
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-title">Docker Hubからイメージをpull</span>
                            <span class="code-lang">Terminal</span>
                        </div>
                        <pre class="code-content"><code># 最新バージョンを取得
docker pull username/my-webapp:latest

# 特定バージョンを取得
docker pull username/my-webapp:1.0.0

# pullしたイメージで起動
docker run -d -p 3000:3000 username/my-webapp:1.0.0</code></pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- セクション 8-3 -->
        <section class="section">
            <div class="section-header">
                <span class="section-number">Section 8-3</span>
                <h2 class="section-title">タグ戦略とバージョニング</h2>
            </div>

            <div class="intro-text">
                <p>適切なタグ戦略は、イメージの管理とデプロイの信頼性を大きく左右します。セマンティックバージョニングに基づいたタグ付けのベストプラクティスを学びます。</p>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">3.1 タグの命名規則</h3>
                <div class="content-block">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>タグ形式</th>
                                <th>例</th>
                                <th>用途</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>セマンティックバージョン</strong></td>
                                <td>1.2.3</td>
                                <td>本番リリース（推奨）</td>
                            </tr>
                            <tr>
                                <td><strong>メジャー.マイナー</strong></td>
                                <td>1.2</td>
                                <td>パッチは最新を自動取得</td>
                            </tr>
                            <tr>
                                <td><strong>latest</strong></td>
                                <td>latest</td>
                                <td>最新版（本番非推奨）</td>
                            </tr>
                            <tr>
                                <td><strong>Git SHA</strong></td>
                                <td>abc1234</td>
                                <td>CI/CDでのトレーサビリティ</td>
                            </tr>
                            <tr>
                                <td><strong>日付</strong></td>
                                <td>20260207</td>
                                <td>日次ビルド</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="warning-box">
                        <div class="warning-box-header">
                            <span class="warning-box-icon"><span class="material-icons">warning</span></span>
                            <span class="warning-box-title">latestタグの落とし穴</span>
                        </div>
                        <p><code>latest</code>タグは「最新」を意味しますが、自動更新されるわけではなく、明示的にpushされた最後のイメージを指します。本番環境では必ず特定のバージョンタグを使用し、意図しないバージョン変更を防いでください。</p>
                    </div>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">3.2 マルチタグの付与</h3>
                <div class="content-block">
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-title">1つのイメージに複数タグを付ける</span>
                            <span class="code-lang">Terminal</span>
                        </div>
                        <pre class="code-content"><code># ビルド時に複数タグを付与
docker build \
  -t username/my-webapp:1.2.3 \
  -t username/my-webapp:1.2 \
  -t username/my-webapp:latest \
  ./backend

# すべてのタグをpush
docker push username/my-webapp:1.2.3
docker push username/my-webapp:1.2
docker push username/my-webapp:latest</code></pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- セクション 8-4 -->
        <section class="section">
            <div class="section-header">
                <span class="section-number">Section 8-4</span>
                <h2 class="section-title">プライベートリポジトリ</h2>
            </div>

            <div class="intro-text">
                <p>企業やチームで使用するイメージは、外部に公開せずプライベートリポジトリで管理します。Docker Hubの無料プランでも1つのプライベートリポジトリが利用可能です。</p>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">4.1 プライベートリポジトリの作成</h3>
                <div class="content-block">
                    <div class="step-list">
                        <div class="step-item">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <h4>Docker Hubにログイン</h4>
                                <p><a href="https://hub.docker.com" target="_blank">hub.docker.com</a>にアクセスしてログインします。</p>
                            </div>
                        </div>
                        <div class="step-item">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <h4>リポジトリを作成</h4>
                                <p>「Create Repository」をクリックし、Visibility（公開範囲）で「Private」を選択します。</p>
                            </div>
                        </div>
                        <div class="step-item">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <h4>pushする</h4>
                                <p>通常のpushと同じ手順でイメージを送信します。認証済みユーザーのみアクセス可能です。</p>
                            </div>
                        </div>
                    </div>

                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-title">プライベートリポジトリへのpush</span>
                            <span class="code-lang">Terminal</span>
                        </div>
                        <pre class="code-content"><code># ログイン（認証が必要）
docker login

# プライベートリポジトリにpush
docker tag my-webapp:latest username/private-app:1.0.0
docker push username/private-app:1.0.0

# 別の環境でpull（ログインが必要）
docker login
docker pull username/private-app:1.0.0</code></pre>
                    </div>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">4.2 Docker Hubのプラン比較</h3>
                <div class="content-block">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>プラン</th>
                                <th>プライベートリポジトリ</th>
                                <th>Pull制限</th>
                                <th>主な用途</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Free</strong></td>
                                <td>1つ</td>
                                <td>200回/6時間</td>
                                <td>個人学習</td>
                            </tr>
                            <tr>
                                <td><strong>Pro</strong></td>
                                <td>無制限</td>
                                <td>5,000回/日</td>
                                <td>個人開発者</td>
                            </tr>
                            <tr>
                                <td><strong>Team</strong></td>
                                <td>無制限</td>
                                <td>無制限</td>
                                <td>チーム開発</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- セクション 8-5 -->
        <section class="section">
            <div class="section-header">
                <span class="section-number">Section 8-5</span>
                <h2 class="section-title">GitHub Container Registry（GHCR）</h2>
            </div>

            <div class="intro-text">
                <p>GitHub Container Registry（GHCR）は、GitHubが提供するコンテナイメージのレジストリサービスです。GitHubリポジトリとの統合が強みで、GitHub Actionsとのシームレスな連携が可能です。</p>
            </div>

            <!-- 図解: レジストリ比較 -->
            <div class="visual-diagram">
                <div class="visual-diagram-title">コンテナレジストリの比較</div>
                <div class="vd-grid">
                    <div class="vd-card blue">
                        <span class="vd-icon">&#128051;</span>
                        <span class="vd-label">Docker Hub</span>
                        <span class="vd-sub">最も広く使われる</span>
                        <span class="vd-sub">公式イメージが豊富</span>
                        <span class="vd-sub">無料枠: 1 Private</span>
                    </div>
                    <div class="vd-card purple">
                        <span class="vd-icon">&#128025;</span>
                        <span class="vd-label">GHCR</span>
                        <span class="vd-sub">GitHub連携が強力</span>
                        <span class="vd-sub">GitHub Actions統合</span>
                        <span class="vd-sub">無料枠: 500MB</span>
                    </div>
                    <div class="vd-card amber">
                        <span class="vd-icon">&#9729;</span>
                        <span class="vd-label">Amazon ECR</span>
                        <span class="vd-sub">AWS統合</span>
                        <span class="vd-sub">ECS/EKS連携</span>
                        <span class="vd-sub">無料枠: 500MB</span>
                    </div>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">5.1 GHCRの使い方</h3>
                <div class="content-block">
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-title">GHCRへのログインとpush</span>
                            <span class="code-lang">Terminal</span>
                        </div>
                        <pre class="code-content"><code># GHCRにログイン（Personal Access Tokenを使用）
echo $GITHUB_TOKEN | docker login ghcr.io -u USERNAME --password-stdin

# イメージにGHCR用のタグを付ける
docker tag my-webapp:latest ghcr.io/username/my-webapp:1.0.0

# GHCRにpush
docker push ghcr.io/username/my-webapp:1.0.0

# GHCRからpull
docker pull ghcr.io/username/my-webapp:1.0.0</code></pre>
                    </div>

                    <div class="info-box">
                        <div class="info-box-header">
                            <span class="info-box-icon"><span class="material-icons">lightbulb</span></span>
                            <span class="info-box-title">GitHub Actionsとの連携</span>
                        </div>
                        <p>GitHub ActionsのワークフローからGHCRへのpushは、<code>GITHUB_TOKEN</code>を使って自動認証されます。CI/CDパイプラインでのイメージビルド・デプロイが非常にスムーズです。</p>
                    </div>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">5.2 GitHub Actionsでの自動ビルド例</h3>
                <div class="content-block">
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-title">.github/workflows/docker-build.yml</span>
                            <span class="code-lang">YAML</span>
                        </div>
                        <pre class="code-content"><code>name: Build and Push Docker Image

on:
  push:
    branches: [main]
    tags: ['v*']

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write

    steps:
      - uses: actions/checkout@v4

      - name: Login to GHCR
        uses: docker/login-action@v3
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}

      - name: Build and Push
        uses: docker/build-push-action@v5
        with:
          push: true
          tags: |
            ghcr.io/${{ github.repository }}:latest
            ghcr.io/${{ github.repository }}:${{ github.sha }}</code></pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- 練習問題 -->
        <section class="section">
            <div class="section-header">
                <span class="section-number">Exercise</span>
                <h2 class="section-title">8章 練習問題</h2>
            </div>

            <div class="exercise-list">
                <div class="exercise-item">
                    <div class="exercise-number">Q1</div>
                    <div class="exercise-content">
                        <p>Docker Hubにイメージをpushする前に必要な手順として正しいものはどれですか？</p>
                        <ol type="A">
                            <li>docker composeで起動してからpushする</li>
                            <li><code>docker tag</code>でユーザー名/リポジトリ名を含むタグを付ける</li>
                            <li>Dockerfileにpush先のURLを記載する</li>
                            <li>docker-compose.ymlにレジストリ情報を設定する</li>
                        </ol>
                    </div>
                </div>

                <div class="exercise-item">
                    <div class="exercise-number">Q2</div>
                    <div class="exercise-content">
                        <p>本番環境でlatestタグの使用が推奨されない理由はどれですか？</p>
                        <ol type="A">
                            <li>latestタグはパフォーマンスが低いため</li>
                            <li>latestタグのイメージはセキュリティチェックが行われないため</li>
                            <li>同じlatestタグで異なるイメージがpushされ、意図しないバージョンがデプロイされる可能性があるため</li>
                            <li>latestタグは有料プランでしか使えないため</li>
                        </ol>
                    </div>
                </div>

                <div class="exercise-item">
                    <div class="exercise-number">Q3</div>
                    <div class="exercise-content">
                        <p>GHCRにログインする際に使用するレジストリ名はどれですか？</p>
                        <ol type="A">
                            <li>registry.github.com</li>
                            <li>ghcr.io</li>
                            <li>docker.github.com</li>
                            <li>containers.github.com</li>
                        </ol>
                    </div>
                </div>
            </div>
        </section>

        <!-- 解答 -->
        <section class="section">
            <div class="section-header">
                <span class="section-number">Answer</span>
                <h2 class="section-title">8章 解説・解答</h2>
            </div>

            <div class="answer-list">
                <div class="answer-item">
                    <div class="answer-header">Q1の解答: B</div>
                    <div class="answer-content">
                        <p>Docker Hubにpushするには、イメージに<code>ユーザー名/リポジトリ名:タグ</code>の形式でタグを付ける必要があります。<code>docker tag my-webapp:latest username/my-webapp:1.0.0</code>のように、<code>docker tag</code>コマンドでレジストリに対応したタグを付与してからpushします。</p>
                    </div>
                </div>

                <div class="answer-item">
                    <div class="answer-header">Q2の解答: C</div>
                    <div class="answer-content">
                        <p><code>latest</code>タグは新しいイメージがpushされると上書きされます。本番環境で<code>latest</code>を使うと、開発者が意図しないバージョンがデプロイされる可能性があり、再現性の確保が困難になります。本番では必ず<code>1.2.3</code>のようなセマンティックバージョンタグを使用しましょう。</p>
                    </div>
                </div>

                <div class="answer-item">
                    <div class="answer-header">Q3の解答: B</div>
                    <div class="answer-content">
                        <p>GitHub Container Registry（GHCR）のレジストリ名は<code>ghcr.io</code>です。ログイン時は<code>docker login ghcr.io</code>、タグ付け時は<code>ghcr.io/username/image-name:tag</code>の形式で使用します。GitHubのPersonal Access Tokenで認証します。</p>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <div class="page-nav">
        <a href="7docker-webapp.html" class="page-nav-btn prev">
            <span>&#8592;</span>
            <div>
                <div class="page-nav-label">前の章</div>
                <div class="page-nav-title">第7章 実践：Webアプリのコンテナ化</div>
            </div>
        </a>
        <a href="9docker-dev-environment.html" class="page-nav-btn next">
            <div>
                <div class="page-nav-label">次の章</div>
                <div class="page-nav-title">第9章 開発環境の構築</div>
            </div>
            <span>&#8594;</span>
        </a>
    </div>

    <footer class="global-footer"></footer>
    <script src="../../shared/footer.js"></script>
    <script>
        document.addEventListener('click', function(e) {
            const header = document.querySelector('.global-header');
            const nav = document.querySelector('.tutorial-nav');
            const toggle = document.querySelector('.header-nav-toggle');
            if (header && nav && toggle && !header.contains(e.target) && !nav.contains(e.target) && nav.classList.contains('active')) {
                toggle.classList.remove('active');
                nav.classList.remove('active');
            }
        });
    </script>
</body>
</html>