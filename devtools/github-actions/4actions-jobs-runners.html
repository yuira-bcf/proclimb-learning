<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬4ç«  ã‚¸ãƒ§ãƒ–ã¨ãƒ©ãƒ³ãƒŠãƒ¼ - GitHub Actionså…¥é–€</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700;900&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="../../shared/common.css">
    <style>
      :root {
        --primary: #F5A623;
        --primary-dark: #D4891D;
        --primary-light: #FEF7E8;
        --primary-lighter: #FDE4A8;
      }
      body { padding-top: 48px; }
      .nav-category-links { display: none; }
      .visual-diagram {
        margin: 28px 0; padding: 28px 20px;
        background: linear-gradient(135deg, #fef7e8 0%, #fef7e8 100%);
        border-radius: 16px; border: 1px solid #fde4a8;
      }
      .visual-diagram-title {
        text-align: center; font-size: 0.82rem; font-weight: 700;
        color: #F5A623; margin-bottom: 20px; letter-spacing: 0.05em;
      }
      .vd-flow {
        display: flex; align-items: center; justify-content: center;
        gap: 10px; flex-wrap: wrap;
      }
      .vd-box {
        background: white; border: 2px solid #F5A623; border-radius: 14px;
        padding: 16px 14px; text-align: center; min-width: 110px;
        box-shadow: 0 2px 8px rgba(245,166,35,0.08);
      }
      .vd-box.accent { background: #F5A623; color: white; }
      .vd-box .vd-icon { font-size: 1.6rem; display: block; margin-bottom: 4px; }
      .vd-box .vd-label { font-size: 0.78rem; font-weight: 700; display: block; }
      .vd-box .vd-sub { font-size: 0.68rem; opacity: 0.7; display: block; margin-top: 2px; }
      .vd-arrow { color: #F5A623; font-size: 1.3rem; font-weight: 700; }
      .vd-grid {
        display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 12px;
      }
      .vd-card {
        background: white; border-radius: 12px; padding: 16px; text-align: center;
        border: 2px solid #fef7e8; box-shadow: 0 1px 4px rgba(0,0,0,0.04);
      }
      .vd-card .vd-icon { font-size: 1.8rem; display: block; margin-bottom: 6px; }
      .vd-card .vd-label { font-size: 0.78rem; font-weight: 700; display: block; color: #F5A623; }
      .vd-card .vd-sub { font-size: 0.68rem; color: #666; display: block; margin-top: 4px; }
      .vd-card.green { border-color: #a5d6a7; background: #f1f8e9; }
      .vd-card.red { border-color: #ef9a9a; background: #fce4ec; }
      .vd-card.blue { border-color: #90caf9; background: #e3f2fd; }
      .vd-card.amber { border-color: #ffe082; background: #fff8e1; }
      .vd-card.purple { border-color: #ce93d8; background: #f3e5f5; }
      .vd-bar {
        display: flex; border-radius: 12px; overflow: hidden; margin: 16px 0;
      }
      .vd-bar-seg {
        flex: 1; padding: 14px 8px; text-align: center; font-size: 0.72rem; font-weight: 600; color: white;
      }
      @media (max-width: 560px) {
        .vd-flow { flex-direction: column; }
        .vd-arrow { transform: rotate(90deg); }
        .vd-grid { grid-template-columns: repeat(2, 1fr); }
      }
    </style>
</head>
<body>
    <nav class="global-nav"></nav>
    <script src="../../shared/js/nav-github-actions.js"></script>

    <div class="container">
        <header class="chapter-header">
            <div class="chapter-badge"><span class="material-icons">menu_book</span> Chapter</div>
            <div class="chapter-number">4</div>
            <h1 class="chapter-title">ã‚¸ãƒ§ãƒ–ã¨ãƒ©ãƒ³ãƒŠãƒ¼</h1>
            <p class="chapter-lead">ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®å®Ÿè¡Œå˜ä½ã§ã‚ã‚‹ã€Œã‚¸ãƒ§ãƒ–ã€ã®è¨­å®šæ–¹æ³•ã¨ã€ã‚¸ãƒ§ãƒ–ãŒå®Ÿè¡Œã•ã‚Œã‚‹ç’°å¢ƒã€Œãƒ©ãƒ³ãƒŠãƒ¼ã€ã«ã¤ã„ã¦å­¦ã³ã¾ã™ã€‚ä¾å­˜é–¢ä¿‚ã®åˆ¶å¾¡ã‚„ãƒãƒˆãƒªãƒƒã‚¯ã‚¹ãƒ“ãƒ«ãƒ‰ã‚‚ç¿’å¾—ã—ã¾ã—ã‚‡ã†ã€‚</p>
        </header>

        <!-- ã‚»ã‚¯ã‚·ãƒ§ãƒ³1: ã‚¸ãƒ§ãƒ–ã®å®šç¾© -->
        <section class="section" id="job-definition">
            <h2><span class="material-icons">work</span> ã‚¸ãƒ§ãƒ–ã®å®šç¾©</h2>

            <p>ã‚¸ãƒ§ãƒ–ã¯ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ä¸­æ ¸çš„ãªå®Ÿè¡Œå˜ä½ã§ã™ã€‚å„ã‚¸ãƒ§ãƒ–ã¯ç‹¬ç«‹ã—ãŸä»®æƒ³ãƒã‚·ãƒ³ï¼ˆãƒ©ãƒ³ãƒŠãƒ¼ï¼‰ä¸Šã§å®Ÿè¡Œã•ã‚Œã€1ã¤ä»¥ä¸Šã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’å«ã¿ã¾ã™ã€‚</p>

            <h3>åŸºæœ¬æ§‹æ–‡</h3>

            <pre><code>jobs:
  # ã‚¸ãƒ§ãƒ–IDï¼ˆè‹±æ•°å­—ã€ãƒã‚¤ãƒ•ãƒ³ã€ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ãŒä½¿ç”¨å¯èƒ½ï¼‰
  build:
    # ã‚¸ãƒ§ãƒ–ã®è¡¨ç¤ºåï¼ˆActionsã‚¿ãƒ–ã«è¡¨ç¤ºï¼‰
    name: Build Application

    # å®Ÿè¡Œç’°å¢ƒ
    runs-on: ubuntu-latest

    # ã‚¹ãƒ†ãƒƒãƒ—ã®å®šç¾©
    steps:
      - uses: actions/checkout@v4
      - run: npm ci
      - run: npm run build</code></pre>

            <h3>ã‚¸ãƒ§ãƒ–IDã®å‘½åè¦å‰‡</h3>

            <table>
                <thead>
                    <tr>
                        <th>ãƒ«ãƒ¼ãƒ«</th>
                        <th>OKä¾‹</th>
                        <th>NGä¾‹</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>è‹±å­—ã¾ãŸã¯ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ã§å§‹ã¾ã‚‹</td>
                        <td><code>build</code>, <code>_test</code></td>
                        <td><code>1build</code>, <code>-test</code></td>
                    </tr>
                    <tr>
                        <td>è‹±æ•°å­—ã€ãƒã‚¤ãƒ•ãƒ³ã€ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ã®ã¿</td>
                        <td><code>build-app</code>, <code>test_unit</code></td>
                        <td><code>build app</code>, <code>test.unit</code></td>
                    </tr>
                    <tr>
                        <td>ä¸€æ„ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚‹</td>
                        <td><code>build</code> ã¨ <code>test</code></td>
                        <td>åŒã˜ID <code>build</code> ãŒ2ã¤</td>
                    </tr>
                </tbody>
            </table>

            <h3>ã‚¸ãƒ§ãƒ–ãƒ¬ãƒ™ãƒ«ã®ä¸»è¦è¨­å®š</h3>

            <pre><code>jobs:
  build:
    name: Build Application           # è¡¨ç¤ºå
    runs-on: ubuntu-latest             # å®Ÿè¡Œç’°å¢ƒ
    timeout-minutes: 30                # ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ360åˆ†ï¼‰
    continue-on-error: false           # ã‚¨ãƒ©ãƒ¼æ™‚ã«ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å…¨ä½“ã‚’å¤±æ•—ã«ã™ã‚‹ã‹
    concurrency:                       # åŒæ™‚å®Ÿè¡Œåˆ¶å¾¡
      group: build-${{ github.ref }}
      cancel-in-progress: true

    # æ¨©é™è¨­å®š
    permissions:
      contents: read
      packages: write

    # ç’°å¢ƒå¤‰æ•°ï¼ˆã‚¸ãƒ§ãƒ–ãƒ¬ãƒ™ãƒ«ï¼‰
    env:
      NODE_ENV: production

    # æ¡ä»¶å®Ÿè¡Œ
    if: github.ref == 'refs/heads/main'

    steps:
      - uses: actions/checkout@v4
      - run: npm ci && npm run build</code></pre>

            <div class="visual-diagram">
                <div class="visual-diagram-title">ã‚¸ãƒ§ãƒ–ã®ä¸»è¦è¨­å®šé …ç›®</div>
                <div class="vd-grid">
                    <div class="vd-card blue">
                        <span class="vd-icon">ğŸ·ï¸</span>
                        <span class="vd-label">name</span>
                        <span class="vd-sub">è¡¨ç¤ºå<br>UIã«è¡¨ç¤ºã•ã‚Œã‚‹åå‰</span>
                    </div>
                    <div class="vd-card green">
                        <span class="vd-icon">ğŸ–¥ï¸</span>
                        <span class="vd-label">runs-on</span>
                        <span class="vd-sub">å®Ÿè¡Œç’°å¢ƒ<br>ãƒ©ãƒ³ãƒŠãƒ¼ã®æŒ‡å®š</span>
                    </div>
                    <div class="vd-card amber">
                        <span class="vd-icon">ğŸ”—</span>
                        <span class="vd-label">needs</span>
                        <span class="vd-sub">ä¾å­˜é–¢ä¿‚<br>å…ˆè¡Œã‚¸ãƒ§ãƒ–ã®æŒ‡å®š</span>
                    </div>
                    <div class="vd-card purple">
                        <span class="vd-icon">â±ï¸</span>
                        <span class="vd-label">timeout-minutes</span>
                        <span class="vd-sub">ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ<br>æœ€å¤§å®Ÿè¡Œæ™‚é–“</span>
                    </div>
                    <div class="vd-card blue">
                        <span class="vd-icon">ğŸ”’</span>
                        <span class="vd-label">permissions</span>
                        <span class="vd-sub">æ¨©é™è¨­å®š<br>GITHUB_TOKENã®æ¨©é™</span>
                    </div>
                    <div class="vd-card green">
                        <span class="vd-icon">â“</span>
                        <span class="vd-label">if</span>
                        <span class="vd-sub">æ¡ä»¶å®Ÿè¡Œ<br>å¼ãŒtrueã§å®Ÿè¡Œ</span>
                    </div>
                </div>
            </div>

            <div class="exercise">
                <div class="exercise-title"><span class="material-icons">edit</span> æ¼”ç¿’å•é¡Œ 4-1</div>
                <p><strong>å•é¡Œ:</strong> ä»¥ä¸‹ã®ã‚¸ãƒ§ãƒ–å®šç¾©ã§å•é¡Œã®ã‚ã‚‹ç®‡æ‰€ã‚’ã™ã¹ã¦æŒ‡æ‘˜ã—ã¦ãã ã•ã„ã€‚</p>
                <pre><code>jobs:
  1-build:
    runs-on: ubuntu-latest
    steps:
      - run: echo "build"
  test:
    runs-on: ubuntu-latest
    steps:
      - run: echo "test"
  1-build:
    runs-on: ubuntu-latest
    steps:
      - run: echo "deploy"</code></pre>
                <details>
                    <summary>è§£ç­”ä¾‹ã‚’è¦‹ã‚‹</summary>
                    <div class="exercise-answer">
                        <p>å•é¡Œç‚¹ã¯2ã¤ã‚ã‚Šã¾ã™ã€‚</p>
                        <ol>
                            <li><code>1-build</code> â€” ã‚¸ãƒ§ãƒ–IDãŒæ•°å­—ã§å§‹ã¾ã£ã¦ã„ã‚‹ã€‚è‹±å­—ã¾ãŸã¯ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ã§å§‹ã‚ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ˆä¾‹: <code>build-app</code>ï¼‰</li>
                            <li><code>1-build</code>ãŒ2ã¤å®šç¾©ã•ã‚Œã¦ã„ã‚‹ â€” ã‚¸ãƒ§ãƒ–IDã¯ä¸€æ„ã§ãªã‘ã‚Œã°ãªã‚‰ãªã„ã€‚2ã¤ç›®ã¯åˆ¥åï¼ˆä¾‹: <code>deploy</code>ï¼‰ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹</li>
                        </ol>
                    </div>
                </details>
            </div>
        </section>

        <!-- ã‚»ã‚¯ã‚·ãƒ§ãƒ³2: ãƒ©ãƒ³ãƒŠãƒ¼ã®ç¨®é¡ -->
        <section class="section" id="runners">
            <h2><span class="material-icons">dns</span> ãƒ©ãƒ³ãƒŠãƒ¼ã®ç¨®é¡</h2>

            <p><strong>ãƒ©ãƒ³ãƒŠãƒ¼</strong>ã¯ã€ã‚¸ãƒ§ãƒ–ãŒå®Ÿè¡Œã•ã‚Œã‚‹ä»®æƒ³ãƒã‚·ãƒ³ç’°å¢ƒã§ã™ã€‚GitHubãŒæä¾›ã™ã‚‹ã€ŒGitHubãƒ›ã‚¹ãƒ†ãƒƒãƒ‰ãƒ©ãƒ³ãƒŠãƒ¼ã€ã¨ã€è‡ªåˆ†ã§ç”¨æ„ã™ã‚‹ã€Œã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒ†ãƒƒãƒ‰ãƒ©ãƒ³ãƒŠãƒ¼ã€ã®2ç¨®é¡ãŒã‚ã‚Šã¾ã™ã€‚</p>

            <h3>GitHubãƒ›ã‚¹ãƒ†ãƒƒãƒ‰ãƒ©ãƒ³ãƒŠãƒ¼</h3>

            <table>
                <thead>
                    <tr>
                        <th>ãƒ©ãƒ™ãƒ«</th>
                        <th>OS</th>
                        <th>ã‚¹ãƒšãƒƒã‚¯</th>
                        <th>æ¶ˆè²»å€ç‡</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>ubuntu-latest</code></td>
                        <td>Ubuntu 24.04</td>
                        <td>4 vCPU / 16GB RAM</td>
                        <td>1å€</td>
                    </tr>
                    <tr>
                        <td><code>ubuntu-22.04</code></td>
                        <td>Ubuntu 22.04</td>
                        <td>4 vCPU / 16GB RAM</td>
                        <td>1å€</td>
                    </tr>
                    <tr>
                        <td><code>windows-latest</code></td>
                        <td>Windows Server 2022</td>
                        <td>4 vCPU / 16GB RAM</td>
                        <td>2å€</td>
                    </tr>
                    <tr>
                        <td><code>macos-latest</code></td>
                        <td>macOS 14 (Sonoma)</td>
                        <td>3 vCPU / 14GB RAM</td>
                        <td>10å€</td>
                    </tr>
                    <tr>
                        <td><code>macos-13</code></td>
                        <td>macOS 13 (Ventura)</td>
                        <td>4 vCPU / 14GB RAM</td>
                        <td>10å€</td>
                    </tr>
                </tbody>
            </table>

            <div class="visual-diagram">
                <div class="visual-diagram-title">ãƒ©ãƒ³ãƒŠãƒ¼ã®å®Ÿè¡Œæ™‚é–“æ¶ˆè²»å€ç‡ã®æ¯”è¼ƒ</div>
                <div class="vd-grid" style="grid-template-columns: repeat(3, 1fr);">
                    <div class="vd-card green">
                        <span class="vd-icon">ğŸ§</span>
                        <span class="vd-label">Linux</span>
                        <span class="vd-sub">1å€ï¼ˆåŸºæº–ï¼‰<br>10åˆ† = 10åˆ†æ¶ˆè²»<br>æœ€ã‚‚ã‚³ã‚¹ãƒˆåŠ¹ç‡ãŒè‰¯ã„</span>
                    </div>
                    <div class="vd-card amber">
                        <span class="vd-icon">ğŸªŸ</span>
                        <span class="vd-label">Windows</span>
                        <span class="vd-sub">2å€<br>10åˆ† = 20åˆ†æ¶ˆè²»<br>.NET/C#é–‹ç™ºå‘ã‘</span>
                    </div>
                    <div class="vd-card red">
                        <span class="vd-icon">ğŸ</span>
                        <span class="vd-label">macOS</span>
                        <span class="vd-sub">10å€<br>10åˆ† = 100åˆ†æ¶ˆè²»<br>iOS/macOSé–‹ç™ºå‘ã‘</span>
                    </div>
                </div>
            </div>

            <div class="point-box">
                <div class="point-title"><span class="material-icons">lightbulb</span> ã‚³ã‚¹ãƒˆæœ€é©åŒ–ã®ã‚³ãƒ„</div>
                <p>ç‰¹ã«OSã«ä¾å­˜ã—ãªã„å‡¦ç†ï¼ˆãƒ†ã‚¹ãƒˆã€ãƒªãƒ³ãƒˆã€ãƒ“ãƒ«ãƒ‰ç­‰ï¼‰ã¯ <code>ubuntu-latest</code> ã§å®Ÿè¡Œã—ã¾ã—ã‚‡ã†ã€‚Windows/macOSãƒ©ãƒ³ãƒŠãƒ¼ã¯ã€OSå›ºæœ‰ã®ãƒ†ã‚¹ãƒˆãŒå¿…è¦ãªå ´åˆã«ã®ã¿ä½¿ç”¨ã™ã‚‹ã®ãŒãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã§ã™ã€‚</p>
            </div>

            <h3>ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒ†ãƒƒãƒ‰ãƒ©ãƒ³ãƒŠãƒ¼</h3>
            <p>è‡ªå‰ã®ã‚µãƒ¼ãƒãƒ¼ã‚„VMã‚’ãƒ©ãƒ³ãƒŠãƒ¼ã¨ã—ã¦ç™»éŒ²ã—ã€ã‚¸ãƒ§ãƒ–ã‚’å®Ÿè¡Œã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</p>

            <pre><code># ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒ†ãƒƒãƒ‰ãƒ©ãƒ³ãƒŠãƒ¼ã®ä½¿ç”¨
jobs:
  build:
    runs-on: self-hosted  # ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒ†ãƒƒãƒ‰ãƒ©ãƒ³ãƒŠãƒ¼ã§å®Ÿè¡Œ
    steps:
      - uses: actions/checkout@v4
      - run: npm ci && npm run build

# ãƒ©ãƒ™ãƒ«ä»˜ãã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒ†ãƒƒãƒ‰ãƒ©ãƒ³ãƒŠãƒ¼
jobs:
  gpu-test:
    runs-on: [self-hosted, gpu, linux]  # GPUæ­è¼‰ã®Linuxãƒ©ãƒ³ãƒŠãƒ¼
    steps:
      - uses: actions/checkout@v4
      - run: python run_ml_test.py</code></pre>

            <h3>ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒ†ãƒƒãƒ‰ãƒ©ãƒ³ãƒŠãƒ¼ã®ç”¨é€”</h3>
            <ul>
                <li><strong>ç‰¹æ®Šãªãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢</strong>: GPUã€ARM CPUã€å¤§å®¹é‡ãƒ¡ãƒ¢ãƒªç­‰</li>
                <li><strong>ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åˆ¶é™</strong>: ç¤¾å†…ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒå¿…è¦ãªå ´åˆ</li>
                <li><strong>ã‚³ã‚¹ãƒˆå‰Šæ¸›</strong>: å¤§é‡ã®å®Ÿè¡Œæ™‚é–“ãŒå¿…è¦ãªå ´åˆ</li>
                <li><strong>ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£</strong>: ã‚³ãƒ¼ãƒ‰ãŒç¤¾å¤–ã«å‡ºã¦ã¯ã„ã‘ãªã„å ´åˆ</li>
            </ul>
        </section>

        <!-- ã‚»ã‚¯ã‚·ãƒ§ãƒ³3: ã‚¸ãƒ§ãƒ–é–“ã®ä¾å­˜é–¢ä¿‚ -->
        <section class="section" id="job-dependencies">
            <h2><span class="material-icons">account_tree</span> ã‚¸ãƒ§ãƒ–é–“ã®ä¾å­˜é–¢ä¿‚</h2>

            <p>ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã‚¸ãƒ§ãƒ–ã¯<strong>ä¸¦åˆ—</strong>ã«å®Ÿè¡Œã•ã‚Œã¾ã™ãŒã€<code>needs</code>ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ä½¿ã£ã¦å®Ÿè¡Œé †åºã‚’åˆ¶å¾¡ã§ãã¾ã™ã€‚</p>

            <h3>ä¸¦åˆ—å®Ÿè¡Œï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰</h3>

            <pre><code># lint ã¨ test ã¯åŒæ™‚ã«å®Ÿè¡Œã•ã‚Œã‚‹
jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - run: npm run lint

  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - run: npm test</code></pre>

            <h3>ç›´åˆ—å®Ÿè¡Œï¼ˆneedsï¼‰</h3>

            <pre><code># build â†’ test â†’ deploy ã®é †ã«å®Ÿè¡Œ
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - run: npm ci && npm run build

  test:
    needs: build            # build ã®å¾Œã«å®Ÿè¡Œ
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - run: npm ci && npm test

  deploy:
    needs: test             # test ã®å¾Œã«å®Ÿè¡Œ
    runs-on: ubuntu-latest
    steps:
      - run: echo "Deploying..."</code></pre>

            <h3>è¤‡é›‘ãªä¾å­˜ã‚°ãƒ©ãƒ•</h3>

            <pre><code># è¤‡æ•°ã®ã‚¸ãƒ§ãƒ–ã«ä¾å­˜
jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - run: npm run lint

  unit-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - run: npm run test:unit

  e2e-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - run: npm run test:e2e

  deploy:
    # lint, unit-test, e2e-test ã™ã¹ã¦æˆåŠŸå¾Œã«å®Ÿè¡Œ
    needs: [lint, unit-test, e2e-test]
    runs-on: ubuntu-latest
    steps:
      - run: echo "All checks passed! Deploying..."</code></pre>

            <div class="visual-diagram">
                <div class="visual-diagram-title">ã‚¸ãƒ§ãƒ–ä¾å­˜ã‚°ãƒ©ãƒ•ã®ä¾‹</div>
                <div style="text-align: center;">
                    <div style="display: flex; justify-content: center; gap: 16px; flex-wrap: wrap; margin-bottom: 12px;">
                        <div class="vd-box" style="min-width: 100px;">
                            <span class="vd-label">lint</span>
                        </div>
                        <div class="vd-box" style="min-width: 100px;">
                            <span class="vd-label">unit-test</span>
                        </div>
                        <div class="vd-box" style="min-width: 100px;">
                            <span class="vd-label">e2e-test</span>
                        </div>
                    </div>
                    <div style="color: #F5A623; font-size: 1.3rem; font-weight: 700; margin: 8px 0;">â†“ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; â†“ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; â†“</div>
                    <div style="display: flex; justify-content: center; margin-top: 8px;">
                        <div class="vd-box accent" style="min-width: 200px;">
                            <span class="vd-label" style="color: white;">deploy</span>
                            <span class="vd-sub">needs: [lint, unit-test, e2e-test]</span>
                        </div>
                    </div>
                    <div style="font-size: 0.72rem; color: #666; margin-top: 12px;">lint, unit-test, e2e-test ã¯ä¸¦åˆ—å®Ÿè¡Œ â†’ ã™ã¹ã¦æˆåŠŸå¾Œã« deploy ãŒå®Ÿè¡Œ</div>
                </div>
            </div>

            <h3>å¤±æ•—æ™‚ã®æŒ™å‹•</h3>
            <p>ä¾å­˜å…ˆã®ã‚¸ãƒ§ãƒ–ãŒå¤±æ•—ã™ã‚‹ã¨ã€ä¾å­˜ã™ã‚‹ã‚¸ãƒ§ãƒ–ã¯<strong>ã‚¹ã‚­ãƒƒãƒ—</strong>ã•ã‚Œã¾ã™ã€‚</p>

            <pre><code># å¤±æ•—ã—ã¦ã‚‚å¾Œç¶šã‚¸ãƒ§ãƒ–ã‚’å®Ÿè¡Œã™ã‚‹æ–¹æ³•
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - run: npm test

  report:
    needs: test
    # test ãŒå¤±æ•—ã—ã¦ã‚‚å®Ÿè¡Œã™ã‚‹
    if: always()
    runs-on: ubuntu-latest
    steps:
      - run: echo "Test result: ${{ needs.test.result }}"</code></pre>

            <h3>æ¡ä»¶ä»˜ãå®Ÿè¡Œã®ãƒ‘ã‚¿ãƒ¼ãƒ³</h3>
            <table>
                <thead>
                    <tr>
                        <th>æ¡ä»¶å¼</th>
                        <th>æ„å‘³</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>if: always()</code></td>
                        <td>å¸¸ã«å®Ÿè¡Œï¼ˆå¤±æ•—ãƒ»ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã§ã‚‚ï¼‰</td>
                    </tr>
                    <tr>
                        <td><code>if: success()</code></td>
                        <td>å‰ã®ã‚¸ãƒ§ãƒ–ãŒæˆåŠŸæ™‚ã®ã¿ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰</td>
                    </tr>
                    <tr>
                        <td><code>if: failure()</code></td>
                        <td>å‰ã®ã‚¸ãƒ§ãƒ–ãŒå¤±æ•—æ™‚ã®ã¿</td>
                    </tr>
                    <tr>
                        <td><code>if: cancelled()</code></td>
                        <td>ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ™‚ã®ã¿</td>
                    </tr>
                    <tr>
                        <td><code>if: needs.test.result == 'success'</code></td>
                        <td>ç‰¹å®šã‚¸ãƒ§ãƒ–ã®çµæœã§åˆ¤æ–­</td>
                    </tr>
                </tbody>
            </table>

            <div class="exercise">
                <div class="exercise-title"><span class="material-icons">edit</span> æ¼”ç¿’å•é¡Œ 4-2</div>
                <p><strong>å•é¡Œ:</strong> ä»¥ä¸‹ã®è¦ä»¶ã‚’æº€ãŸã™ã‚¸ãƒ§ãƒ–æ§‹æˆã‚’YAMLã§è¨˜è¿°ã—ã¦ãã ã•ã„ï¼ˆsteps ã¯çœç•¥å¯ï¼‰ã€‚</p>
                <ul>
                    <li><code>build</code>: æœ€åˆã«å®Ÿè¡Œ</li>
                    <li><code>test-unit</code>: build å®Œäº†å¾Œã«å®Ÿè¡Œ</li>
                    <li><code>test-integration</code>: build å®Œäº†å¾Œã«å®Ÿè¡Œï¼ˆtest-unit ã¨ä¸¦åˆ—ï¼‰</li>
                    <li><code>deploy</code>: test-unit ã¨ test-integration ã®ä¸¡æ–¹ãŒæˆåŠŸå¾Œã«å®Ÿè¡Œ</li>
                    <li><code>notify</code>: deploy ã®çµæœã«é–¢ã‚ã‚‰ãšå¸¸ã«å®Ÿè¡Œï¼ˆçµæœã‚’é€šçŸ¥ï¼‰</li>
                </ul>
                <details>
                    <summary>è§£ç­”ä¾‹ã‚’è¦‹ã‚‹</summary>
                    <div class="exercise-answer">
                        <pre><code>jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - run: echo "Building..."

  test-unit:
    needs: build
    runs-on: ubuntu-latest
    steps:
      - run: echo "Unit testing..."

  test-integration:
    needs: build
    runs-on: ubuntu-latest
    steps:
      - run: echo "Integration testing..."

  deploy:
    needs: [test-unit, test-integration]
    runs-on: ubuntu-latest
    steps:
      - run: echo "Deploying..."

  notify:
    needs: deploy
    if: always()
    runs-on: ubuntu-latest
    steps:
      - run: echo "Deploy result: ${{ needs.deploy.result }}"</code></pre>
                    </div>
                </details>
            </div>
        </section>

        <!-- ã‚»ã‚¯ã‚·ãƒ§ãƒ³4: ãƒãƒˆãƒªãƒƒã‚¯ã‚¹ãƒ“ãƒ«ãƒ‰ -->
        <section class="section" id="matrix-build">
            <h2><span class="material-icons">grid_view</span> ãƒãƒˆãƒªãƒƒã‚¯ã‚¹ãƒ“ãƒ«ãƒ‰</h2>

            <p><strong>ãƒãƒˆãƒªãƒƒã‚¯ã‚¹ãƒ“ãƒ«ãƒ‰</strong>ã‚’ä½¿ã†ã¨ã€è¤‡æ•°ã®å¤‰æ•°ã®çµ„ã¿åˆã‚ã›ã§ã‚¸ãƒ§ãƒ–ã‚’è‡ªå‹•çš„ã«ä¸¦åˆ—å®Ÿè¡Œã§ãã¾ã™ã€‚ç•°ãªã‚‹OSã€è¨€èªãƒãƒ¼ã‚¸ãƒ§ãƒ³ã€è¨­å®šã®çµ„ã¿åˆã‚ã›ãƒ†ã‚¹ãƒˆã«éå¸¸ã«æœ‰åŠ¹ã§ã™ã€‚</p>

            <h3>åŸºæœ¬æ§‹æ–‡</h3>

            <pre><code>jobs:
  test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        node-version: [18, 20, 22]
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: ${{ matrix.node-version }}
      - run: npm ci
      - run: npm test</code></pre>

            <h3>è¤‡æ•°å¤‰æ•°ã®çµ„ã¿åˆã‚ã›</h3>

            <pre><code>jobs:
  test:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest, windows-latest, macos-latest]
        node-version: [18, 20, 22]
        # 3 OS x 3 Node.js = 9ã‚¸ãƒ§ãƒ–ãŒä¸¦åˆ—å®Ÿè¡Œ
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: ${{ matrix.node-version }}
      - run: npm ci
      - run: npm test</code></pre>

            <div class="visual-diagram">
                <div class="visual-diagram-title">ãƒãƒˆãƒªãƒƒã‚¯ã‚¹ãƒ“ãƒ«ãƒ‰ã®çµ„ã¿åˆã‚ã›å±•é–‹</div>
                <div style="max-width: 480px; margin: 0 auto;">
                    <div class="vd-flow" style="margin-bottom: 12px;">
                        <div class="vd-box" style="min-width: 140px;">
                            <span class="vd-label">os:</span>
                            <span class="vd-sub">ubuntu, windows, macos</span>
                        </div>
                        <span style="font-size: 1.5rem; color: #F5A623; font-weight: 900;">x</span>
                        <div class="vd-box" style="min-width: 140px;">
                            <span class="vd-label">node-version:</span>
                            <span class="vd-sub">18, 20, 22</span>
                        </div>
                    </div>
                    <div style="text-align: center; color: #F5A623; font-weight: 700; font-size: 1.2rem; margin: 12px 0;">â†“ 3 x 3 = 9ã‚¸ãƒ§ãƒ–</div>
                    <div class="vd-grid" style="grid-template-columns: repeat(3, 1fr);">
                        <div class="vd-card green" style="padding: 10px;"><span class="vd-label" style="font-size: 0.68rem;">ubuntu + 18</span></div>
                        <div class="vd-card green" style="padding: 10px;"><span class="vd-label" style="font-size: 0.68rem;">ubuntu + 20</span></div>
                        <div class="vd-card green" style="padding: 10px;"><span class="vd-label" style="font-size: 0.68rem;">ubuntu + 22</span></div>
                        <div class="vd-card amber" style="padding: 10px;"><span class="vd-label" style="font-size: 0.68rem;">windows + 18</span></div>
                        <div class="vd-card amber" style="padding: 10px;"><span class="vd-label" style="font-size: 0.68rem;">windows + 20</span></div>
                        <div class="vd-card amber" style="padding: 10px;"><span class="vd-label" style="font-size: 0.68rem;">windows + 22</span></div>
                        <div class="vd-card purple" style="padding: 10px;"><span class="vd-label" style="font-size: 0.68rem;">macos + 18</span></div>
                        <div class="vd-card purple" style="padding: 10px;"><span class="vd-label" style="font-size: 0.68rem;">macos + 20</span></div>
                        <div class="vd-card purple" style="padding: 10px;"><span class="vd-label" style="font-size: 0.68rem;">macos + 22</span></div>
                    </div>
                </div>
            </div>

            <h3>include: è¿½åŠ ã®çµ„ã¿åˆã‚ã›</h3>
            <p><code>include</code>ã‚’ä½¿ã£ã¦ã€ãƒãƒˆãƒªãƒƒã‚¯ã‚¹ã«å€‹åˆ¥ã®çµ„ã¿åˆã‚ã›ã‚’è¿½åŠ ã§ãã¾ã™ã€‚</p>

            <pre><code>strategy:
  matrix:
    os: [ubuntu-latest, windows-latest]
    node-version: [18, 20]
    include:
      # è¿½åŠ : macOSã§ã®Node.js 22ãƒ†ã‚¹ãƒˆ
      - os: macos-latest
        node-version: 22
      # è¿½åŠ : Ubuntuã«å®Ÿé¨“çš„ãƒ•ãƒ©ã‚°ã‚’ä»˜ä¸
      - os: ubuntu-latest
        node-version: 22
        experimental: true</code></pre>

            <h3>exclude: ç‰¹å®šã®çµ„ã¿åˆã‚ã›ã‚’é™¤å¤–</h3>

            <pre><code>strategy:
  matrix:
    os: [ubuntu-latest, windows-latest, macos-latest]
    node-version: [18, 20, 22]
    exclude:
      # macOSã§Node.js 18ã®ãƒ†ã‚¹ãƒˆã‚’é™¤å¤–ï¼ˆéã‚µãƒãƒ¼ãƒˆç­‰ï¼‰
      - os: macos-latest
        node-version: 18
      # Windowsã§Node.js 22ã®ãƒ†ã‚¹ãƒˆã‚’é™¤å¤–
      - os: windows-latest
        node-version: 22</code></pre>

            <h3>fail-fast ã¨ max-parallel</h3>

            <pre><code>strategy:
  # 1ã¤ã®ã‚¸ãƒ§ãƒ–ãŒå¤±æ•—ã—ãŸã‚‰ä»–ã®å®Ÿè¡Œä¸­ã‚¸ãƒ§ãƒ–ã‚‚ã‚­ãƒ£ãƒ³ã‚»ãƒ«ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: trueï¼‰
  fail-fast: false

  # åŒæ™‚å®Ÿè¡Œæ•°ã®ä¸Šé™ã‚’è¨­å®š
  max-parallel: 3

  matrix:
    os: [ubuntu-latest, windows-latest, macos-latest]
    node-version: [18, 20, 22]</code></pre>

            <div class="visual-diagram">
                <div class="visual-diagram-title">fail-fast ã®å‹•ä½œæ¯”è¼ƒ</div>
                <div class="vd-grid" style="grid-template-columns: repeat(2, 1fr);">
                    <div class="vd-card red">
                        <span class="vd-icon">ğŸ›‘</span>
                        <span class="vd-label">fail-fast: trueï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰</span>
                        <span class="vd-sub">1ã¤å¤±æ•—ã§å…¨ã‚­ãƒ£ãƒ³ã‚»ãƒ«<br>å®Ÿè¡Œæ™‚é–“ã‚’ç¯€ç´„<br>å…¨çµæœã¯å¾—ã‚‰ã‚Œãªã„</span>
                    </div>
                    <div class="vd-card green">
                        <span class="vd-icon">ğŸ”„</span>
                        <span class="vd-label">fail-fast: false</span>
                        <span class="vd-sub">å¤±æ•—ã—ã¦ã‚‚å…¨ã‚¸ãƒ§ãƒ–å®Œèµ°<br>ã™ã¹ã¦ã®çµæœã‚’å–å¾—<br>å®Ÿè¡Œæ™‚é–“ã¯é•·ããªã‚‹</span>
                    </div>
                </div>
            </div>

            <div class="exercise">
                <div class="exercise-title"><span class="material-icons">edit</span> æ¼”ç¿’å•é¡Œ 4-3</div>
                <p><strong>å•é¡Œ:</strong> Pythonãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ†ã‚¹ãƒˆç”¨ãƒãƒˆãƒªãƒƒã‚¯ã‚¹ãƒ“ãƒ«ãƒ‰ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚æ¡ä»¶ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚</p>
                <ul>
                    <li>OS: ubuntu-latest, windows-latest</li>
                    <li>Python: 3.10, 3.11, 3.12</li>
                    <li>Windowsã§Python 3.10ã®çµ„ã¿åˆã‚ã›ã‚’é™¤å¤–</li>
                    <li>1ã¤ã®ã‚¸ãƒ§ãƒ–ãŒå¤±æ•—ã—ã¦ã‚‚ä»–ã¯å®Œèµ°ã™ã‚‹</li>
                    <li>æœ€å¤§ä¸¦åˆ—å®Ÿè¡Œæ•°ã¯4</li>
                </ul>
                <details>
                    <summary>è§£ç­”ä¾‹ã‚’è¦‹ã‚‹</summary>
                    <div class="exercise-answer">
                        <pre><code>jobs:
  test:
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      max-parallel: 4
      matrix:
        os: [ubuntu-latest, windows-latest]
        python-version: ['3.10', '3.11', '3.12']
        exclude:
          - os: windows-latest
            python-version: '3.10'
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: ${{ matrix.python-version }}
      - run: pip install -r requirements.txt
      - run: python -m pytest</code></pre>
                        <p>æ³¨æ„: Python ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯æ–‡å­—åˆ—ã§æŒ‡å®šã—ã¾ã™ã€‚<code>3.10</code>ã‚’æ•°å€¤ã¨ã—ã¦æ›¸ãã¨ <code>3.1</code> ã¨è§£é‡ˆã•ã‚Œã¦ã—ã¾ã†ãŸã‚ã€å¿…ãšå¼•ç”¨ç¬¦ã§å›²ã¿ã¾ã™ã€‚</p>
                    </div>
                </details>
            </div>
        </section>

        <!-- ã‚»ã‚¯ã‚·ãƒ§ãƒ³5: ã‚µãƒ¼ãƒ“ã‚¹ã‚³ãƒ³ãƒ†ãƒŠ -->
        <section class="section" id="service-containers">
            <h2><span class="material-icons">storage</span> ã‚µãƒ¼ãƒ“ã‚¹ã‚³ãƒ³ãƒ†ãƒŠ</h2>

            <p><strong>ã‚µãƒ¼ãƒ“ã‚¹ã‚³ãƒ³ãƒ†ãƒŠ</strong>ã‚’ä½¿ã†ã¨ã€ã‚¸ãƒ§ãƒ–å†…ã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚„ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚µãƒ¼ãƒãƒ¼ãªã©ã®å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã‚’Dockerã‚³ãƒ³ãƒ†ãƒŠã¨ã—ã¦èµ·å‹•ã§ãã¾ã™ã€‚çµ±åˆãƒ†ã‚¹ãƒˆã‚„E2Eãƒ†ã‚¹ãƒˆã«ä¸å¯æ¬ ãªæ©Ÿèƒ½ã§ã™ã€‚</p>

            <h3>åŸºæœ¬æ§‹æ–‡</h3>

            <pre><code>jobs:
  test:
    runs-on: ubuntu-latest

    # ã‚µãƒ¼ãƒ“ã‚¹ã‚³ãƒ³ãƒ†ãƒŠã®å®šç¾©
    services:
      postgres:
        image: postgres:16
        env:
          POSTGRES_USER: testuser
          POSTGRES_PASSWORD: testpass
          POSTGRES_DB: testdb
        ports:
          - 5432:5432
        # ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ï¼ˆæº–å‚™å®Œäº†ã¾ã§å¾…æ©Ÿï¼‰
        options: >-
          --health-cmd pg_isready
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5

    steps:
      - uses: actions/checkout@v4
      - name: Run tests with DB
        run: npm test
        env:
          DATABASE_URL: postgresql://testuser:testpass@localhost:5432/testdb</code></pre>

            <h3>ã‚ˆãä½¿ã†ã‚µãƒ¼ãƒ“ã‚¹ã‚³ãƒ³ãƒ†ãƒŠ</h3>

            <div class="visual-diagram">
                <div class="visual-diagram-title">é »ç¹ã«ä½¿ç”¨ã•ã‚Œã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã‚³ãƒ³ãƒ†ãƒŠ</div>
                <div class="vd-grid">
                    <div class="vd-card blue">
                        <span class="vd-icon">ğŸ˜</span>
                        <span class="vd-label">PostgreSQL</span>
                        <span class="vd-sub">ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒŠãƒ«DB<br>postgres:16</span>
                    </div>
                    <div class="vd-card amber">
                        <span class="vd-icon">ğŸ¬</span>
                        <span class="vd-label">MySQL</span>
                        <span class="vd-sub">ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒŠãƒ«DB<br>mysql:8.0</span>
                    </div>
                    <div class="vd-card red">
                        <span class="vd-icon">ğŸ”´</span>
                        <span class="vd-label">Redis</span>
                        <span class="vd-sub">ã‚­ãƒ£ãƒƒã‚·ãƒ¥/KVS<br>redis:7</span>
                    </div>
                    <div class="vd-card green">
                        <span class="vd-icon">ğŸƒ</span>
                        <span class="vd-label">MongoDB</span>
                        <span class="vd-sub">ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆDB<br>mongo:7</span>
                    </div>
                    <div class="vd-card purple">
                        <span class="vd-icon">ğŸ”</span>
                        <span class="vd-label">Elasticsearch</span>
                        <span class="vd-sub">å…¨æ–‡æ¤œç´¢<br>elasticsearch:8</span>
                    </div>
                    <div class="vd-card blue">
                        <span class="vd-icon">ğŸ“¨</span>
                        <span class="vd-label">RabbitMQ</span>
                        <span class="vd-sub">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚­ãƒ¥ãƒ¼<br>rabbitmq:3</span>
                    </div>
                </div>
            </div>

            <h3>MySQL ã®ä¾‹</h3>

            <pre><code>services:
  mysql:
    image: mysql:8.0
    env:
      MYSQL_ROOT_PASSWORD: rootpass
      MYSQL_DATABASE: testdb
      MYSQL_USER: testuser
      MYSQL_PASSWORD: testpass
    ports:
      - 3306:3306
    options: >-
      --health-cmd="mysqladmin ping"
      --health-interval=10s
      --health-timeout=5s
      --health-retries=5</code></pre>

            <h3>Redis ã®ä¾‹</h3>

            <pre><code>services:
  redis:
    image: redis:7
    ports:
      - 6379:6379
    options: >-
      --health-cmd "redis-cli ping"
      --health-interval 10s
      --health-timeout 5s
      --health-retries 5</code></pre>

            <h3>è¤‡æ•°ã‚µãƒ¼ãƒ“ã‚¹ã®åŒæ™‚åˆ©ç”¨</h3>

            <pre><code>jobs:
  integration-test:
    runs-on: ubuntu-latest
    services:
      postgres:
        image: postgres:16
        env:
          POSTGRES_USER: app
          POSTGRES_PASSWORD: secret
          POSTGRES_DB: myapp_test
        ports:
          - 5432:5432
        options: >-
          --health-cmd pg_isready
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5

      redis:
        image: redis:7
        ports:
          - 6379:6379
        options: >-
          --health-cmd "redis-cli ping"
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5

    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
      - run: npm ci
      - name: Run integration tests
        run: npm run test:integration
        env:
          DATABASE_URL: postgresql://app:secret@localhost:5432/myapp_test
          REDIS_URL: redis://localhost:6379</code></pre>

            <div class="point-box">
                <div class="point-title"><span class="material-icons">warning</span> æ³¨æ„äº‹é …</div>
                <ul>
                    <li>ã‚µãƒ¼ãƒ“ã‚¹ã‚³ãƒ³ãƒ†ãƒŠã¯Linuxãƒ©ãƒ³ãƒŠãƒ¼ï¼ˆ<code>ubuntu-*</code>ï¼‰ã§ã®ã¿åˆ©ç”¨å¯èƒ½ã§ã™</li>
                    <li><code>options</code>ã®ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯è¨­å®šã¯é‡è¦ã§ã™ã€‚è¨­å®šã—ãªã„ã¨DBã®åˆæœŸåŒ–å®Œäº†å‰ã«ãƒ†ã‚¹ãƒˆãŒå§‹ã¾ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™</li>
                    <li>ã‚µãƒ¼ãƒ“ã‚¹ã‚³ãƒ³ãƒ†ãƒŠã¯ã‚¸ãƒ§ãƒ–ã®é–‹å§‹æ™‚ã«èµ·å‹•ã—ã€ã‚¸ãƒ§ãƒ–çµ‚äº†æ™‚ã«è‡ªå‹•çš„ã«åœæ­¢ã—ã¾ã™</li>
                </ul>
            </div>

            <div class="exercise">
                <div class="exercise-title"><span class="material-icons">edit</span> æ¼”ç¿’å•é¡Œ 4-4</div>
                <p><strong>å•é¡Œ:</strong> Ruby on Rails ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®çµ±åˆãƒ†ã‚¹ãƒˆç”¨ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚ä»¥ä¸‹ã®ã‚µãƒ¼ãƒ“ã‚¹ãŒå¿…è¦ã§ã™ã€‚</p>
                <ul>
                    <li>PostgreSQL 16ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼: rails_testã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: passwordã€DBå: myapp_testï¼‰</li>
                    <li>Redis 7</li>
                </ul>
                <details>
                    <summary>è§£ç­”ä¾‹ã‚’è¦‹ã‚‹</summary>
                    <div class="exercise-answer">
                        <pre><code>name: Rails Integration Tests

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    services:
      postgres:
        image: postgres:16
        env:
          POSTGRES_USER: rails_test
          POSTGRES_PASSWORD: password
          POSTGRES_DB: myapp_test
        ports:
          - 5432:5432
        options: >-
          --health-cmd pg_isready
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5
      redis:
        image: redis:7
        ports:
          - 6379:6379
        options: >-
          --health-cmd "redis-cli ping"
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5

    steps:
      - uses: actions/checkout@v4
      - uses: ruby/setup-ruby@v1
        with:
          ruby-version: '3.3'
          bundler-cache: true
      - name: Setup database
        run: bundle exec rails db:setup
        env:
          DATABASE_URL: postgresql://rails_test:password@localhost:5432/myapp_test
          RAILS_ENV: test
      - name: Run tests
        run: bundle exec rails test
        env:
          DATABASE_URL: postgresql://rails_test:password@localhost:5432/myapp_test
          REDIS_URL: redis://localhost:6379
          RAILS_ENV: test</code></pre>
                    </div>
                </details>
            </div>
        </section>

        <!-- ãƒšãƒ¼ã‚¸ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
        <nav class="chapter-nav">
            <a href="3actions-triggers.html" class="prev"><span class="material-icons">arrow_back</span> å‰ã®ç« </a>
            <a href="index.html" class="home"><span class="material-icons">home</span> ç›®æ¬¡</a>
            <a href="5actions-steps-actions.html" class="next">æ¬¡ã®ç«  <span class="material-icons">arrow_forward</span></a>
        </nav>
    </div>

    <footer class="global-footer"></footer>
    <script src="../../shared/footer.js"></script>
</body>
</html>