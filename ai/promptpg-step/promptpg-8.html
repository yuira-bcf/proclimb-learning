<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chapter 8: 編集機能 - プロンプトプログラミング</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="../../shared/common.css">
  <style>
    :root {
      --primary: #AF52DE;
      --primary-dark: #9333EA;
      --primary-light: #FAF5FF;
      --primary-lighter: #E9D5FF;
    }
    .nav-category-links { display: none; }
    .prompt-card { background: linear-gradient(135deg, #4285F4 0%, #9B72CB 50%, #D96570 100%); border-radius: 16px; padding: 24px; color: white; margin: 24px 0; }
    .prompt-card h4 { margin: 0 0 16px 0; font-size: 1.1rem; display: flex; align-items: center; gap: 8px; }
    .prompt-box { background: rgba(0,0,0,0.3); border: 2px solid rgba(255, 255, 255, 0.5); border-radius: 8px; padding: 16px; margin-bottom: 16px; }
    .prompt-box pre { margin: 0; white-space: pre-wrap; word-wrap: break-word; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; line-height: 1.6; color: #e2e8f0; }
    .copy-btn { background: white; color: #AF52DE; border: none; padding: 8px 16px; border-radius: 6px; font-size: 0.85rem; font-weight: 600; cursor: pointer; display: inline-flex; align-items: center; gap: 6px; }
    .copy-btn:hover { background: #f0f0f0; }
    /* コードブロック（spring/style.css準拠） */
    .code-block { background: #1e293b; border-radius: 12px; margin: 16px 0; overflow: hidden; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
    .code-header { background: rgba(255,255,255,0.1); padding: 10px 16px; display: flex; align-items: center; gap: 10px; border-bottom: 1px solid rgba(255,255,255,0.1); }
    .code-dots { display: flex; gap: 6px; }
    .code-dot { width: 12px; height: 12px; border-radius: 50%; }
    .code-dot.red { background: #ff5f56; }
    .code-dot.yellow { background: #ffbd2e; }
    .code-dot.green { background: #27ca40; }
    .code-title { color: rgba(255,255,255,0.7); font-size: 12px; font-family: 'JetBrains Mono', monospace; }
    .code-content { padding: 16px; overflow-x: auto; }
    .code-content pre { margin: 0; font-family: 'JetBrains Mono', monospace; font-size: 13px; line-height: 1.6; color: #e2e8f0; white-space: pre; }
    .code-keyword { color: #c084fc; }
    .code-class { color: #67e8f9; }
    .code-string { color: #86efac; }
    .code-comment { color: #94a3b8; }
    .code-annotation { color: #fbbf24; }

    /* 図解用スタイル */
    .diagram-container {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 16px;
      padding: 24px;
      margin: 24px 0;
    }
    .diagram-title {
      color: white;
      font-size: 1rem;
      font-weight: 700;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .diagram-content {
      background: rgba(255,255,255,0.95);
      border-radius: 12px;
      padding: 24px;
    }
    .flow-diagram {
      display: flex;
      align-items: center;
      justify-content: center;
      flex-wrap: wrap;
      gap: 12px;
    }
    .flow-box {
      background: #f1f5f9;
      border: 2px solid #e2e8f0;
      padding: 12px 16px;
      border-radius: 8px;
      font-size: 0.85rem;
      font-weight: 600;
      text-align: center;
    }
    .flow-box.highlight {
      background: linear-gradient(135deg, #4285F4, #1a73e8);
      color: white;
      border-color: transparent;
    }
    .flow-box.warning {
      background: linear-gradient(135deg, #f59e0b, #d97706);
      color: white;
      border-color: transparent;
    }
    .flow-arrow {
      color: #6366f1;
      font-size: 1.2rem;
    }
  </style>
</head>
<body>
  <nav class="global-nav"></nav>
  <script src="../../shared/js/nav-promptpg-step.js"></script>

  <div class="container">
    <header class="chapter-header">
      <div class="chapter-badge">Chapter</div>
      <div class="chapter-number">8</div>
      <h1 class="chapter-title">編集機能</h1>
      <p class="chapter-subtitle">編集画面を作成し、UPDATE処理を実装</p>
    </header>

    <nav class="toc">
      <h2 class="toc-title">この Chapter の内容</h2>
      <ul class="toc-list">
        <li class="toc-item"><span class="toc-number">8-1</span>編集画面の表示</li>
        <li class="toc-item"><span class="toc-number">8-2</span>更新処理の実装</li>
        <li class="toc-item"><span class="toc-number">8-3</span>完了状態の切り替え</li>
      </ul>
    </nav>

    <section class="section">
      <div class="section-header">
        <span class="section-number">Section 8-1</span>
        <h2 class="section-title">編集画面の表示</h2>
      </div>

      <div class="intro-text">
        <p>既存データを取得し、<strong>編集画面</strong>にフォームの初期値として表示します。</p>
      </div>

      <div class="prompt-card">
        <h4 style="color: white;"><span class="material-icons">smart_toy</span> AIプロンプト</h4>
        <div class="prompt-box">
          <pre>Spring Boot + MyBatisでToDoの編集画面を実装してください。

現在の状態:
- TodoMapper.xml: findAll, insert, deleteById が定義済み
- TodoService: findAll, create, deleteById が実装済み
- list.html: テーブルに操作列（削除ボタン）あり
- フォーム画面: form.html（タイトル入力欄）が存在

要件:
【バックエンド】
- TodoMapper.xmlにSELECT文を追加（idで1件取得: findById）
- TodoMapper.javaにfindById(Long id)メソッドを追加
- TodoServiceにfindById()メソッドを追加
- TodoControllerにGET /todo/{id}/edit を追加

【フロントエンド】
- edit.htmlを新規作成（form.htmlと同様のレイアウト）
- DBから取得したtitleをth:valueでinputに表示
- formのaction先はPOST /todo/{id}/update
- list.htmlの操作列に編集リンクを追加（各行にGET /todo/{id}/edit へのリンク）
- Bootstrap 5の btn-outline-primary btn-sm を使用

Controller、Service、Mapper（Java + XML）、edit.html、list.htmlのコードを示してください。</pre>
        </div>
        <button class="copy-btn" onclick="navigator.clipboard.writeText(this.previousElementSibling.querySelector('pre').textContent)">
          <span class="material-icons">content_copy</span> コピー
        </button>
      </div>

      <!-- Serviceサンプルコード -->
      <div class="code-block">
        <div class="code-header">
          <div class="code-dots">
            <span class="code-dot red"></span>
            <span class="code-dot yellow"></span>
            <span class="code-dot green"></span>
          </div>
          <span class="code-title">TodoService.java（編集画面表示用）</span>
        </div>
        <div class="code-content">
          <pre><span class="code-keyword">public</span> Todo findById(Long id) {
    Todo todo = todoMapper.findById(id);
    <span class="code-keyword">if</span> (todo == <span class="code-keyword">null</span>) {
        <span class="code-keyword">throw new</span> RuntimeException(<span class="code-string">"ToDoが見つかりません: "</span> + id);
    }
    <span class="code-keyword">return</span> todo;
}</pre>
        </div>
      </div>

      <!-- Controllerサンプルコード -->
      <div class="code-block">
        <div class="code-header">
          <div class="code-dots">
            <span class="code-dot red"></span>
            <span class="code-dot yellow"></span>
            <span class="code-dot green"></span>
          </div>
          <span class="code-title">TodoController.java（編集画面表示）</span>
        </div>
        <div class="code-content">
          <pre><span class="code-annotation">@GetMapping</span>(<span class="code-string">"/todo/{id}/edit"</span>)
<span class="code-keyword">public</span> String edit(<span class="code-annotation">@PathVariable</span> Long id, Model model) {
    Todo todo = todoService.findById(id);
    model.addAttribute(<span class="code-string">"todo"</span>, todo);
    <span class="code-keyword">return</span> <span class="code-string">"todo/edit"</span>;
}</pre>
        </div>
      </div>

      <!-- 編集テンプレートサンプルコード -->
      <div class="code-block">
        <div class="code-header">
          <div class="code-dots">
            <span class="code-dot red"></span>
            <span class="code-dot yellow"></span>
            <span class="code-dot green"></span>
          </div>
          <span class="code-title">templates/todo/edit.html</span>
        </div>
        <div class="code-content">
          <pre>&lt;form <span class="code-annotation">th:action</span>=<span class="code-string">"@{/todo/{id}/update(id=${todo.id})}"</span> method=<span class="code-string">"post"</span>&gt;
  <span class="code-comment">&lt;!-- IDを隠しフィールドで保持 --&gt;</span>
  &lt;input type=<span class="code-string">"hidden"</span> name=<span class="code-string">"id"</span> <span class="code-annotation">th:value</span>=<span class="code-string">"${todo.id}"</span>&gt;

  &lt;div class=<span class="code-string">"mb-3"</span>&gt;
    &lt;label class=<span class="code-string">"form-label"</span>&gt;タイトル&lt;/label&gt;
    &lt;input type=<span class="code-string">"text"</span> name=<span class="code-string">"title"</span> class=<span class="code-string">"form-control"</span>
           <span class="code-annotation">th:value</span>=<span class="code-string">"${todo.title}"</span> required&gt;
  &lt;/div&gt;

  &lt;button type=<span class="code-string">"submit"</span> class=<span class="code-string">"btn btn-primary"</span>&gt;更新&lt;/button&gt;
  &lt;a <span class="code-annotation">th:href</span>=<span class="code-string">"@{/todo}"</span> class=<span class="code-string">"btn btn-secondary"</span>&gt;キャンセル&lt;/a&gt;
&lt;/form&gt;</pre>
        </div>
      </div>

      <div class="info-box" style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border: none; margin: 16px 0;">
        <div class="info-box-title"><span class="material-icons">lightbulb</span> コード解説</div>
        <div class="info-box-content">
          <ul style="margin: 0; padding-left: 20px;">
            <li><code>todoMapper.findById(id)</code> - MyBatisでIDを指定して1件取得</li>
            <li><code>th:value="${todo.title}"</code> - 既存値をinputのvalueにセット</li>
            <li><code>type="hidden"</code> - IDを画面に表示せず送信データに含める</li>
            <li><code>th:action="@{/todo/{id}/update(id=${todo.id})}"</code> - URLにIDを埋め込む</li>
          </ul>
        </div>
      </div>

      <div class="highlight-box">
        <h4>編集画面のポイント</h4>
        <ul>
          <li>IDを hidden フィールドで保持</li>
          <li>既存値をフォームの value に設定</li>
          <li>新規作成と編集でテンプレートを共通化可能</li>
        </ul>
      </div>

      <!-- アノテーション図解 -->
      <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 12px; padding: 24px; margin: 24px 0;">
        <h3 style="margin: 0 0 20px 0; color: #334155; display: flex; align-items: center; gap: 8px; font-size: 1rem;">
          <span class="material-icons" style="color: #7c3aed;">label</span> この Chapter で使うアノテーション
        </h3>

        <div style="background: white; border-radius: 8px; padding: 16px; border: 1px solid #e2e8f0;">
          <table style="width: 100%; border-collapse: collapse; font-size: 0.85rem;">
            <thead>
              <tr style="border-bottom: 2px solid #e2e8f0;">
                <th style="text-align: left; padding: 8px 12px; color: #334155;">アノテーション</th>
                <th style="text-align: left; padding: 8px 12px; color: #334155;">付与先</th>
                <th style="text-align: left; padding: 8px 12px; color: #334155;">役割</th>
              </tr>
            </thead>
            <tbody>
              <tr style="border-bottom: 1px solid #f1f5f9;">
                <td style="padding: 8px 12px;"><code style="background: #f1f5f9; padding: 2px 6px; border-radius: 4px; color: #7c3aed;">@GetMapping</code></td>
                <td style="padding: 8px 12px; color: #64748b;">メソッド</td>
                <td style="padding: 8px 12px; color: #334155;">GETリクエストを処理。編集画面の表示に使用</td>
              </tr>
              <tr style="border-bottom: 1px solid #f1f5f9;">
                <td style="padding: 8px 12px;"><code style="background: #f1f5f9; padding: 2px 6px; border-radius: 4px; color: #7c3aed;">@PostMapping</code></td>
                <td style="padding: 8px 12px; color: #64748b;">メソッド</td>
                <td style="padding: 8px 12px; color: #334155;">POSTリクエストを処理。更新データの送信に使用</td>
              </tr>
              <tr style="border-bottom: 1px solid #f1f5f9;">
                <td style="padding: 8px 12px;"><code style="background: #f1f5f9; padding: 2px 6px; border-radius: 4px; color: #7c3aed;">@PathVariable</code></td>
                <td style="padding: 8px 12px; color: #64748b;">引数</td>
                <td style="padding: 8px 12px; color: #334155;">URLの <code>{id}</code> をメソッド引数にマッピング</td>
              </tr>
              <tr>
                <td style="padding: 8px 12px;"><code style="background: #f1f5f9; padding: 2px 6px; border-radius: 4px; color: #7c3aed;">@RequestParam</code></td>
                <td style="padding: 8px 12px; color: #64748b;">引数</td>
                <td style="padding: 8px 12px; color: #334155;">フォームの入力値をメソッド引数にマッピング</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div style="background: #ede9fe; border: 1px solid #c4b5fd; border-radius: 8px; padding: 12px 16px; margin-top: 16px;">
          <p style="margin: 0; color: #5b21b6; font-size: 0.8rem; line-height: 1.7;">
            <strong>ポイント:</strong> 編集機能では <code style="background: #ddd6fe; padding: 2px 6px; border-radius: 4px;">@GetMapping</code>（画面表示）と <code style="background: #ddd6fe; padding: 2px 6px; border-radius: 4px;">@PostMapping</code>（更新実行）の<span style="color: #dc2626; font-weight: 700;">2つのエンドポイント</span>が必要です。画面を見るだけならGET、データを変更するならPOST と使い分けます。
          </p>
        </div>
      </div>

      <!-- edit() メソッドの処理フロー図解 -->
      <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 12px; padding: 24px; margin: 24px 0;">
        <h3 style="margin: 0 0 20px 0; color: #334155; display: flex; align-items: center; gap: 8px; font-size: 1rem;">
          <span class="material-icons" style="color: #7c3aed;">route</span> edit() メソッドの処理フロー ── 編集画面を表示するまで
        </h3>

        <!-- STEP 1 -->
        <div style="display: flex; align-items: flex-start; gap: 16px; margin-bottom: 16px;">
          <div style="background: #3b82f6; color: white; min-width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.9rem; flex-shrink: 0;">1</div>
          <div style="flex: 1;">
            <div style="font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; background: #1e293b; color: #e2e8f0; padding: 10px 16px; border-radius: 8px; margin-bottom: 8px;">
              Todo todo = todoService.<span style="color: #fbbf24; font-weight: 700;">findById</span>(id);
            </div>
            <div style="display: flex; align-items: stretch; gap: 12px; flex-wrap: wrap;">
              <div style="background: #dbeafe; border: 2px solid #3b82f6; border-radius: 8px; padding: 12px; flex: 1; min-width: 140px;">
                <div style="font-weight: 700; color: #1e40af; font-size: 0.8rem; margin-bottom: 6px;">Controller</div>
                <div style="font-size: 0.75rem; color: #334155;">URLの id を使って「このデータをちょうだい」と依頼</div>
              </div>
              <div style="display: flex; align-items: center; color: #94a3b8; font-size: 1.5rem;">→</div>
              <div style="background: #fef3c7; border: 2px solid #f59e0b; border-radius: 8px; padding: 12px; flex: 1; min-width: 140px;">
                <div style="font-weight: 700; color: #92400e; font-size: 0.8rem; margin-bottom: 6px;">Service</div>
                <div style="font-size: 0.75rem; color: #334155;">DBから該当IDの1件を取得して返す</div>
              </div>
              <div style="display: flex; align-items: center; color: #94a3b8; font-size: 1.5rem;">→</div>
              <div style="background: #dcfce7; border: 2px solid #22c55e; border-radius: 8px; padding: 12px; flex: 1; min-width: 140px;">
                <div style="font-weight: 700; color: #166534; font-size: 0.8rem; margin-bottom: 6px;">戻り値</div>
                <div style="font-size: 0.75rem; color: #334155;">Todoオブジェクト1件がControllerに返る</div>
              </div>
            </div>
          </div>
        </div>

        <!-- STEP 2 -->
        <div style="display: flex; align-items: flex-start; gap: 16px; margin-bottom: 16px;">
          <div style="background: #f59e0b; color: white; min-width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.9rem; flex-shrink: 0;">2</div>
          <div style="flex: 1;">
            <div style="font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; background: #1e293b; color: #e2e8f0; padding: 10px 16px; border-radius: 8px; margin-bottom: 8px;">
              model.addAttribute(<span style="color: #86efac;">"todo"</span>, <span style="color: #fbbf24; font-weight: 700;">todo</span>);
            </div>
            <div style="display: flex; align-items: stretch; gap: 12px; flex-wrap: wrap;">
              <div style="background: white; border: 2px solid #e2e8f0; border-radius: 8px; padding: 12px; flex: 1; min-width: 180px;">
                <div style="font-size: 0.75rem; color: #334155; line-height: 1.7;">
                  取得したTodoオブジェクトを<br>
                  <span style="color: #dc2626; font-weight: 700;">"todo"</span> というキー名で Model に格納
                </div>
              </div>
              <div style="display: flex; align-items: center; color: #94a3b8; font-size: 1.5rem;">→</div>
              <div style="background: #f3e8ff; border: 2px solid #a855f7; border-radius: 8px; padding: 12px; flex: 1; min-width: 180px;">
                <div style="font-weight: 700; color: #7e22ce; font-size: 0.8rem; margin-bottom: 6px;">Model（データの入れ物）</div>
                <div style="background: white; border-radius: 4px; padding: 8px; font-family: 'JetBrains Mono', monospace; font-size: 0.7rem;">
                  <span style="color: #dc2626;">"todo"</span> → {id:3, title:"Spring Boot復習", ...}
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- STEP 3 -->
        <div style="display: flex; align-items: flex-start; gap: 16px;">
          <div style="background: #22c55e; color: white; min-width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.9rem; flex-shrink: 0;">3</div>
          <div style="flex: 1;">
            <div style="font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; background: #1e293b; color: #e2e8f0; padding: 10px 16px; border-radius: 8px; margin-bottom: 8px;">
              <span style="color: #c084fc;">return</span> <span style="color: #86efac;">"todo/edit"</span>;
            </div>
            <div style="display: flex; align-items: stretch; gap: 12px; flex-wrap: wrap;">
              <div style="background: white; border: 2px solid #e2e8f0; border-radius: 8px; padding: 12px; flex: 1; min-width: 180px;">
                <div style="font-size: 0.75rem; color: #334155; line-height: 1.7;">
                  edit.html テンプレートを指定<br>
                  <code style="background: #f1f5f9; padding: 2px 6px; border-radius: 4px; color: #7c3aed;">templates/todo/edit.html</code> を表示
                </div>
              </div>
              <div style="display: flex; align-items: center; color: #94a3b8; font-size: 1.5rem;">→</div>
              <div style="background: #dbeafe; border: 2px solid #3b82f6; border-radius: 8px; padding: 12px; flex: 1; min-width: 180px;">
                <div style="font-weight: 700; color: #1e40af; font-size: 0.8rem; margin-bottom: 6px;">Thymeleaf が実行</div>
                <div style="font-size: 0.75rem; color: #334155;"><code style="background: #f1f5f9; padding: 2px 6px; border-radius: 4px;">th:value="${todo.title}"</code> で<br>フォームに既存値がセットされる</div>
              </div>
            </div>
          </div>
        </div>

        <div style="background: #ede9fe; border: 1px solid #c4b5fd; border-radius: 8px; padding: 12px 16px; margin-top: 20px;">
          <p style="margin: 0; color: #5b21b6; font-size: 0.8rem; line-height: 1.7;">
            <strong>Chapter 6 との違い:</strong> Chapter 6 では <code style="background: #ddd6fe; padding: 2px 6px; border-radius: 4px;">findAll()</code> で全件取得してリスト表示でしたが、編集画面では <code style="background: #ddd6fe; padding: 2px 6px; border-radius: 4px;">findById()</code> で<span style="color: #dc2626; font-weight: 700;">1件だけ取得</span>してフォームにセットします。
          </p>
        </div>
      </div>

      <!-- th:value 自動マッピング図解 -->
      <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 12px; padding: 24px; margin: 24px 0;">
        <h3 style="margin: 0 0 20px 0; color: #334155; display: flex; align-items: center; gap: 8px; font-size: 1rem;">
          <span class="material-icons" style="color: #7c3aed;">sync_alt</span> 自動マッピングの仕組み ── DBの値がフォームに表示されるまで
        </h3>

        <div style="display: flex; align-items: stretch; justify-content: center; gap: 16px; flex-wrap: wrap; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">

          <!-- DB側 -->
          <div style="background: #dcfce7; border: 2px solid #22c55e; border-radius: 8px; padding: 16px; min-width: 180px; flex: 1; max-width: 220px;">
            <div style="font-weight: 700; color: #166534; margin-bottom: 10px; text-align: center; font-size: 0.9rem;">DBのデータ</div>
            <div style="background: white; border-radius: 6px; padding: 12px; font-size: 0.75rem; line-height: 2;">
              <div>id = <span style="color: #dc2626; font-weight: 700;">3</span></div>
              <div>title = <span style="color: #dc2626; font-weight: 700;">"Spring Boot復習"</span></div>
              <div>completed = <span style="color: #dc2626; font-weight: 700;">false</span></div>
            </div>
          </div>

          <!-- 矢印1 -->
          <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; min-width: 50px;">
            <div style="font-size: 0.65rem; color: #64748b; text-align: center;">findById()</div>
            <div style="color: #94a3b8; font-size: 2rem; line-height: 1;">→</div>
          </div>

          <!-- Model -->
          <div style="background: #f3e8ff; border: 2px solid #a855f7; border-radius: 8px; padding: 16px; min-width: 200px; flex: 1; max-width: 240px;">
            <div style="font-weight: 700; color: #7e22ce; margin-bottom: 10px; text-align: center; font-size: 0.9rem;">Model</div>
            <div style="background: white; border-radius: 6px; padding: 12px; font-size: 0.75rem; line-height: 2;">
              <div><span style="color: #dc2626;">"todo"</span> → Todoオブジェクト</div>
              <div style="padding-left: 12px; color: #64748b;">.id = 3</div>
              <div style="padding-left: 12px; color: #64748b;">.title = "Spring Boot復習"</div>
            </div>
          </div>

          <!-- 矢印2 -->
          <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; min-width: 50px;">
            <div style="font-size: 0.65rem; color: #64748b; text-align: center;">th:value</div>
            <div style="color: #94a3b8; font-size: 2rem; line-height: 1;">→</div>
          </div>

          <!-- フォーム -->
          <div style="background: #dbeafe; border: 2px solid #3b82f6; border-radius: 8px; padding: 16px; min-width: 220px; flex: 1; max-width: 280px;">
            <div style="font-weight: 700; color: #1e40af; margin-bottom: 10px; text-align: center; font-size: 0.9rem;">edit.html（フォーム）</div>
            <div style="background: white; border-radius: 6px; padding: 12px; font-size: 0.75rem; line-height: 2;">
              <div>&lt;input <span style="color: #7c3aed;">th:value</span>="${todo.<span style="color: #dc2626; font-weight: 700;">id</span>}"&gt;</div>
              <div>&lt;input <span style="color: #7c3aed;">th:value</span>="${todo.<span style="color: #dc2626; font-weight: 700;">title</span>}"&gt;</div>
            </div>
            <div style="text-align: center; margin-top: 8px; font-size: 0.7rem; color: #3b82f6; font-weight: 600;">既存値がフォームに初期表示される</div>
          </div>
        </div>

        <div style="background: #ede9fe; border: 1px solid #c4b5fd; border-radius: 8px; padding: 12px 16px; margin-top: 16px;">
          <p style="margin: 0; color: #5b21b6; font-size: 0.8rem; line-height: 1.7;">
            <strong>ポイント:</strong> Chapter 6 では <code style="background: #ddd6fe; padding: 2px 6px; border-radius: 4px;">th:text</code>（表示用）を使いましたが、編集画面では <code style="background: #ddd6fe; padding: 2px 6px; border-radius: 4px;">th:value</code>（フォーム初期値用）を使います。<code style="background: #ddd6fe; padding: 2px 6px; border-radius: 4px;">th:text</code> はタグの中身を置換、<code style="background: #ddd6fe; padding: 2px 6px; border-radius: 4px;">th:value</code> は input の value 属性をセットするという<span style="color: #dc2626; font-weight: 700;">役割の違い</span>があります。
          </p>
        </div>
      </div>
    </section>

    <section class="section">
      <div class="section-header">
        <span class="section-number">Section 8-2</span>
        <h2 class="section-title">更新処理の実装</h2>
      </div>

      <div class="intro-text">
        <p>編集されたデータを<strong>UPDATE</strong>して、データベースに保存します。</p>
      </div>

      <div class="prompt-card">
        <h4 style="color: white;"><span class="material-icons">smart_toy</span> AIプロンプト</h4>
        <div class="prompt-box">
          <pre>Spring Boot + MyBatisでToDoの更新処理を実装してください。

現在の状態:
- TodoMapper / TodoMapper.xml: findAll, insert, deleteById, findById が定義済み
- TodoService: findAll, create, deleteById, findById が実装済み
- TodoController: GET /todo/{id}/edit で編集画面を表示済み
- edit.html: タイトル入力欄 + 更新ボタン（POST /todo/{id}/update に送信）

要件:
- TodoMapper.xmlにUPDATE文を追加（idでtitleとcompletedを更新）
- TodoMapper.javaにupdate(Todo todo)メソッドを追加
- TodoServiceにupdate()メソッドを追加
- TodoControllerにPOST /todo/{id}/update を追加
- 更新成功後は一覧画面にリダイレクト
- RedirectAttributesで「更新が完了しました」のフラッシュメッセージを表示

Controller、Service、Mapper（Java + XML）のコードを示してください。</pre>
        </div>
        <button class="copy-btn" onclick="navigator.clipboard.writeText(this.previousElementSibling.querySelector('pre').textContent)">
          <span class="material-icons">content_copy</span> コピー
        </button>
      </div>

      <!-- Serviceサンプルコード -->
      <div class="code-block">
        <div class="code-header">
          <div class="code-dots">
            <span class="code-dot red"></span>
            <span class="code-dot yellow"></span>
            <span class="code-dot green"></span>
          </div>
          <span class="code-title">TodoService.java（更新処理）</span>
        </div>
        <div class="code-content">
          <pre><span class="code-keyword">public void</span> update(Long id, String title) {
    Todo todo = findById(id);
    todo.setTitle(title);
    todoMapper.update(todo);
}</pre>
        </div>
      </div>

      <!-- Controllerサンプルコード -->
      <div class="code-block">
        <div class="code-header">
          <div class="code-dots">
            <span class="code-dot red"></span>
            <span class="code-dot yellow"></span>
            <span class="code-dot green"></span>
          </div>
          <span class="code-title">TodoController.java（更新処理）</span>
        </div>
        <div class="code-content">
          <pre><span class="code-annotation">@PostMapping</span>(<span class="code-string">"/{id}/update"</span>)
<span class="code-keyword">public</span> String update(
        <span class="code-annotation">@PathVariable</span> Long id,
        <span class="code-annotation">@RequestParam</span> String title,
        RedirectAttributes redirectAttributes) {

    todoService.update(id, title);
    redirectAttributes.addFlashAttribute(<span class="code-string">"successMessage"</span>, <span class="code-string">"更新が完了しました"</span>);
    <span class="code-keyword">return</span> <span class="code-string">"redirect:/todo"</span>;
}</pre>
        </div>
      </div>

      <div class="info-box" style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border: none; margin: 16px 0;">
        <div class="info-box-title"><span class="material-icons">lightbulb</span> コード解説</div>
        <div class="info-box-content">
          <ul style="margin: 0; padding-left: 20px;">
            <li><code>todoMapper.update(todo)</code> - MyBatisのUPDATE文でDBを更新</li>
            <li><code>findById()</code>で取得 → 値を変更 → <code>update()</code>で保存の流れ</li>
            <li>更新後は一覧画面にリダイレクトしてPRGパターンを実現</li>
            <li><code>RedirectAttributes</code> でフラッシュメッセージを表示</li>
          </ul>
        </div>
      </div>

      <!-- update() メソッドの処理フロー図解 -->
      <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 12px; padding: 24px; margin: 24px 0;">
        <h3 style="margin: 0 0 20px 0; color: #334155; display: flex; align-items: center; gap: 8px; font-size: 1rem;">
          <span class="material-icons" style="color: #7c3aed;">route</span> update() メソッドの処理フロー ── コードの流れを追う
        </h3>

        <!-- STEP 1 -->
        <div style="display: flex; align-items: flex-start; gap: 16px; margin-bottom: 16px;">
          <div style="background: #3b82f6; color: white; min-width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.9rem; flex-shrink: 0;">1</div>
          <div style="flex: 1;">
            <div style="font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; background: #1e293b; color: #e2e8f0; padding: 10px 16px; border-radius: 8px; margin-bottom: 8px;">
              todoService.<span style="color: #fbbf24; font-weight: 700;">update</span>(id, title);
            </div>
            <div style="display: flex; align-items: stretch; gap: 12px; flex-wrap: wrap;">
              <div style="background: #dbeafe; border: 2px solid #3b82f6; border-radius: 8px; padding: 12px; flex: 1; min-width: 120px;">
                <div style="font-weight: 700; color: #1e40af; font-size: 0.8rem; margin-bottom: 6px;">Controller</div>
                <div style="font-size: 0.75rem; color: #334155;">Serviceに「このIDのtitleを更新して」と依頼</div>
              </div>
              <div style="display: flex; align-items: center; color: #94a3b8; font-size: 1.5rem;">→</div>
              <div style="background: #fef3c7; border: 2px solid #f59e0b; border-radius: 8px; padding: 12px; flex: 1; min-width: 120px;">
                <div style="font-weight: 700; color: #92400e; font-size: 0.8rem; margin-bottom: 6px;">Service内部</div>
                <div style="font-size: 0.75rem; color: #334155;">findById() → setTitle() → update()</div>
              </div>
              <div style="display: flex; align-items: center; color: #94a3b8; font-size: 1.5rem;">→</div>
              <div style="background: #fef3c7; border: 2px solid #f59e0b; border-radius: 8px; padding: 12px; flex: 1; min-width: 120px;">
                <div style="font-weight: 700; color: #92400e; font-size: 0.8rem; margin-bottom: 6px;">DB</div>
                <div style="font-size: 0.75rem; color: #334155;">UPDATE todos SET title = ? WHERE id = ?</div>
              </div>
            </div>
          </div>
        </div>

        <!-- STEP 2 -->
        <div style="display: flex; align-items: flex-start; gap: 16px; margin-bottom: 16px;">
          <div style="background: #f59e0b; color: white; min-width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.9rem; flex-shrink: 0;">2</div>
          <div style="flex: 1;">
            <div style="font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; background: #1e293b; color: #e2e8f0; padding: 10px 16px; border-radius: 8px; margin-bottom: 8px;">
              redirectAttributes.addFlashAttribute(<span style="color: #86efac;">"successMessage"</span>, <span style="color: #86efac;">"更新が完了しました"</span>);
            </div>
            <div style="display: flex; align-items: stretch; gap: 12px; flex-wrap: wrap;">
              <div style="background: white; border: 2px solid #e2e8f0; border-radius: 8px; padding: 12px; flex: 1;">
                <div style="font-size: 0.75rem; color: #334155; line-height: 1.7;">
                  更新成功のメッセージを FlashAttribute に格納。リダイレクト先で<span style="color: #dc2626; font-weight: 700;">1回だけ</span>表示される。
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- STEP 3 -->
        <div style="display: flex; align-items: flex-start; gap: 16px;">
          <div style="background: #22c55e; color: white; min-width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.9rem; flex-shrink: 0;">3</div>
          <div style="flex: 1;">
            <div style="font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; background: #1e293b; color: #e2e8f0; padding: 10px 16px; border-radius: 8px; margin-bottom: 8px;">
              <span style="color: #c084fc;">return</span> <span style="color: #86efac;">"redirect:/todo"</span>;
            </div>
            <div style="display: flex; align-items: stretch; gap: 12px; flex-wrap: wrap;">
              <div style="background: white; border: 2px solid #e2e8f0; border-radius: 8px; padding: 12px; flex: 1;">
                <div style="font-size: 0.75rem; color: #334155; line-height: 1.7;">
                  一覧画面にリダイレクト。ブラウザ再読み込みで更新が二重実行されるのを防ぐ（<span style="color: #dc2626; font-weight: 700;">PRGパターン</span>）。
                </div>
              </div>
            </div>
          </div>
        </div>

        <div style="background: #ede9fe; border: 1px solid #c4b5fd; border-radius: 8px; padding: 12px 16px; margin-top: 20px;">
          <p style="margin: 0; color: #5b21b6; font-size: 0.8rem; line-height: 1.7;">
            <strong>削除との比較:</strong> Chapter 7 の delete() と同じく <code style="background: #ddd6fe; padding: 2px 6px; border-radius: 4px;">@PostMapping</code> + <code style="background: #ddd6fe; padding: 2px 6px; border-radius: 4px;">redirect:</code> のパターンです。違いは <code style="background: #ddd6fe; padding: 2px 6px; border-radius: 4px;">@RequestParam String title</code> でフォームの入力値も受け取る点です。<span style="color: #dc2626; font-weight: 700;">@PathVariable はURLから、@RequestParam はフォームから</span>値を取得します。
          </p>
        </div>
      </div>

      <!-- 更新処理フロー図解 -->
      <div class="diagram-container">
        <div class="diagram-title">
          <span class="material-icons">edit</span>
          更新処理フロー
        </div>
        <div class="diagram-content">
          <div class="flow-diagram">
            <div class="flow-box">
              <span class="material-icons" style="font-size: 1.5rem; display: block; margin-bottom: 4px;">touch_app</span>
              編集ボタン<br><small>GET /edit</small>
            </div>
            <span class="flow-arrow">→</span>
            <div class="flow-box highlight">
              <span class="material-icons" style="font-size: 1.5rem; display: block; margin-bottom: 4px;">article</span>
              編集画面<br><small>既存値表示</small>
            </div>
            <span class="flow-arrow">→</span>
            <div class="flow-box">
              <span class="material-icons" style="font-size: 1.5rem; display: block; margin-bottom: 4px;">edit_note</span>
              フォーム編集<br><small>値を変更</small>
            </div>
            <span class="flow-arrow">→</span>
            <div class="flow-box warning">
              <span class="material-icons" style="font-size: 1.5rem; display: block; margin-bottom: 4px;">send</span>
              POST送信<br><small>/update</small>
            </div>
            <span class="flow-arrow">→</span>
            <div class="flow-box highlight">
              <span class="material-icons" style="font-size: 1.5rem; display: block; margin-bottom: 4px;">save</span>
              DB更新<br><small>save()</small>
            </div>
          </div>
        </div>
      </div>

      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>MyBatis UPDATE</th>
              <th>説明</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Mapper XML</td>
              <td><code>&lt;update id="update"&gt;</code> でUPDATE文を定義</td>
            </tr>
            <tr>
              <td>パラメータ</td>
              <td>Todoオブジェクトのフィールドを <code>#{title}</code> 等で参照</td>
            </tr>
            <tr>
              <td>WHERE句</td>
              <td><code>WHERE id = #{id}</code> で更新対象を指定</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section class="section">
      <div class="section-header">
        <span class="section-number">Section 8-3</span>
        <h2 class="section-title">完了状態の切り替え</h2>
      </div>

      <div class="intro-text">
        <p>一覧画面から<strong>ワンクリック</strong>でToDoの完了/未完了を切り替える機能を実装します。</p>
      </div>

      <div class="prompt-card">
        <h4 style="color: white;"><span class="material-icons">smart_toy</span> AIプロンプト</h4>
        <div class="prompt-box">
          <pre>ToDoの完了状態をワンクリックで切り替える機能を実装してください。

現在の状態:
- TodoMapper.xml: update文が定義済み
- list.html: 一覧テーブルに完了状態を表示中

要件:
- TodoServiceにtoggleCompleted(Long id)メソッドを追加
  （findByIdで取得→completed反転→updateで保存）
- TodoControllerにPOST /todo/{id}/toggle を追加
- 切り替え後は一覧画面にリダイレクト
- list.htmlの各行にフォーム送信の切り替えボタンを追加
- 完了したToDoはタイトルに打ち消し線で表示

Controller、Service、テンプレートのコードを示してください。</pre>
        </div>
        <button class="copy-btn" onclick="navigator.clipboard.writeText(this.previousElementSibling.querySelector('pre').textContent)">
          <span class="material-icons">content_copy</span> コピー
        </button>
      </div>

      <!-- Serviceサンプルコード（完了切り替え） -->
      <div class="code-block">
        <div class="code-header">
          <div class="code-dots">
            <span class="code-dot red"></span>
            <span class="code-dot yellow"></span>
            <span class="code-dot green"></span>
          </div>
          <span class="code-title">TodoService.java（完了状態切り替え）</span>
        </div>
        <div class="code-content">
          <pre><span class="code-keyword">public void</span> toggleCompleted(Long id) {
    Todo todo = findById(id);
    todo.setCompleted(!todo.isCompleted());
    todoMapper.update(todo);
}</pre>
        </div>
      </div>

      <!-- Controllerサンプルコード -->
      <div class="code-block">
        <div class="code-header">
          <div class="code-dots">
            <span class="code-dot red"></span>
            <span class="code-dot yellow"></span>
            <span class="code-dot green"></span>
          </div>
          <span class="code-title">TodoController.java（完了状態切り替え）</span>
        </div>
        <div class="code-content">
          <pre><span class="code-annotation">@PostMapping</span>(<span class="code-string">"/todo/{id}/toggle"</span>)
<span class="code-keyword">public</span> String toggleCompleted(<span class="code-annotation">@PathVariable</span> Long id) {
    todoService.toggleCompleted(id);
    <span class="code-keyword">return</span> <span class="code-string">"redirect:/todo"</span>;
}</pre>
        </div>
      </div>

      <!-- テンプレートサンプルコード -->
      <div class="code-block">
        <div class="code-header">
          <div class="code-dots">
            <span class="code-dot red"></span>
            <span class="code-dot yellow"></span>
            <span class="code-dot green"></span>
          </div>
          <span class="code-title">templates/todo/list.html（完了切り替えボタン）</span>
        </div>
        <div class="code-content">
          <pre><span class="code-comment">&lt;!-- 完了状態に応じて打ち消し線表示 --&gt;</span>
&lt;td <span class="code-annotation">th:classappend</span>=<span class="code-string">"${todo.completed} ? 'text-decoration-line-through text-muted'"</span>&gt;
  &lt;span <span class="code-annotation">th:text</span>=<span class="code-string">"${todo.title}"</span>&gt;&lt;/span&gt;
&lt;/td&gt;

<span class="code-comment">&lt;!-- 完了切り替えボタン --&gt;</span>
&lt;td&gt;
  &lt;form <span class="code-annotation">th:action</span>=<span class="code-string">"@{/todo/{id}/toggle(id=${todo.id})}"</span> method=<span class="code-string">"post"</span> class=<span class="code-string">"d-inline"</span>&gt;
    &lt;button type=<span class="code-string">"submit"</span>
            <span class="code-annotation">th:class</span>=<span class="code-string">"${todo.completed} ? 'btn btn-sm btn-outline-secondary' : 'btn btn-sm btn-success'"</span>&gt;
      &lt;span <span class="code-annotation">th:if</span>=<span class="code-string">"${todo.completed}"</span>&gt;未完了に戻す&lt;/span&gt;
      &lt;span <span class="code-annotation">th:unless</span>=<span class="code-string">"${todo.completed}"</span>&gt;完了にする&lt;/span&gt;
    &lt;/button&gt;
  &lt;/form&gt;
&lt;/td&gt;</pre>
        </div>
      </div>

      <div class="info-box" style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border: none; margin: 16px 0;">
        <div class="info-box-title"><span class="material-icons">lightbulb</span> コード解説</div>
        <div class="info-box-content">
          <ul style="margin: 0; padding-left: 20px;">
            <li><code>!todo.isCompleted()</code> - 現在の状態を反転（true↔false）</li>
            <li><code>th:classappend</code> - 完了時にCSSクラスを追加（打ち消し線）</li>
            <li><code>th:class</code> - 条件に応じてボタンの色を切り替え</li>
            <li>POST送信でページ遷移なしで状態を更新</li>
          </ul>
        </div>
      </div>

      <!-- toggleCompleted() のDB状態変化図解 -->
      <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 12px; padding: 24px; margin: 24px 0;">
        <h3 style="margin: 0 0 20px 0; color: #334155; display: flex; align-items: center; gap: 8px; font-size: 1rem;">
          <span class="material-icons" style="color: #7c3aed;">swap_horiz</span> toggleCompleted() ── 実行前後のDB状態変化
        </h3>

        <div style="display: grid; grid-template-columns: 1fr auto 1fr; gap: 16px; align-items: center;">

          <!-- 実行前 -->
          <div style="background: white; border: 2px solid #e2e8f0; border-radius: 8px; overflow: hidden;">
            <div style="background: #f1f5f9; padding: 10px 16px; font-weight: 700; font-size: 0.85rem; color: #334155; text-align: center;">実行前</div>
            <div style="padding: 12px 16px;">
              <table style="width: 100%; border-collapse: collapse; font-size: 0.8rem; font-family: 'JetBrains Mono', monospace;">
                <thead>
                  <tr style="border-bottom: 1px solid #e2e8f0;">
                    <th style="padding: 6px 8px; text-align: left; color: #64748b;">id</th>
                    <th style="padding: 6px 8px; text-align: left; color: #64748b;">title</th>
                    <th style="padding: 6px 8px; text-align: left; color: #64748b;">completed</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td style="padding: 6px 8px;">1</td>
                    <td style="padding: 6px 8px;">買い物リスト</td>
                    <td style="padding: 6px 8px;"><span style="color: #16a34a; font-weight: 700;">true</span></td>
                  </tr>
                  <tr style="background: #fef3c7;">
                    <td style="padding: 6px 8px;">2</td>
                    <td style="padding: 6px 8px;">Spring Boot復習</td>
                    <td style="padding: 6px 8px;"><span style="color: #dc2626; font-weight: 700;">false</span></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- 矢印 -->
          <div style="display: flex; flex-direction: column; align-items: center; gap: 4px;">
            <div style="font-family: 'JetBrains Mono', monospace; font-size: 0.7rem; color: #7c3aed; font-weight: 600; text-align: center;">toggleCompleted(2)</div>
            <div style="color: #6366f1; font-size: 2rem;">→</div>
            <div style="font-size: 0.65rem; color: #64748b; text-align: center;">!false = true</div>
          </div>

          <!-- 実行後 -->
          <div style="background: white; border: 2px solid #22c55e; border-radius: 8px; overflow: hidden;">
            <div style="background: #dcfce7; padding: 10px 16px; font-weight: 700; font-size: 0.85rem; color: #166534; text-align: center;">実行後</div>
            <div style="padding: 12px 16px;">
              <table style="width: 100%; border-collapse: collapse; font-size: 0.8rem; font-family: 'JetBrains Mono', monospace;">
                <thead>
                  <tr style="border-bottom: 1px solid #e2e8f0;">
                    <th style="padding: 6px 8px; text-align: left; color: #64748b;">id</th>
                    <th style="padding: 6px 8px; text-align: left; color: #64748b;">title</th>
                    <th style="padding: 6px 8px; text-align: left; color: #64748b;">completed</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td style="padding: 6px 8px;">1</td>
                    <td style="padding: 6px 8px;">買い物リスト</td>
                    <td style="padding: 6px 8px;"><span style="color: #16a34a; font-weight: 700;">true</span></td>
                  </tr>
                  <tr style="background: #dcfce7;">
                    <td style="padding: 6px 8px;">2</td>
                    <td style="padding: 6px 8px;">Spring Boot復習</td>
                    <td style="padding: 6px 8px;"><span style="color: #16a34a; font-weight: 700;">true ✓</span></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- コード対応 -->
        <div style="background: white; border: 1px solid #e2e8f0; border-radius: 8px; padding: 16px; margin-top: 16px;">
          <div style="font-weight: 700; color: #334155; margin-bottom: 10px; font-size: 0.9rem; display: flex; align-items: center; gap: 6px;">
            <span class="material-icons" style="font-size: 1.1rem; color: #6366f1;">code</span> toggleCompleted() の3行が行っていること
          </div>
          <div style="display: flex; flex-direction: column; gap: 8px; font-size: 0.85rem;">
            <div style="display: flex; align-items: center; gap: 12px;">
              <span style="background: #3b82f6; color: white; min-width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.75rem; flex-shrink: 0;">1</span>
              <code style="background: #f1f5f9; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem;">findById(id)</code>
              <span style="color: #64748b;">→ DBからid=2のTodoを取得</span>
            </div>
            <div style="display: flex; align-items: center; gap: 12px;">
              <span style="background: #f59e0b; color: white; min-width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.75rem; flex-shrink: 0;">2</span>
              <code style="background: #f1f5f9; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem;">setCompleted(!isCompleted())</code>
              <span style="color: #64748b;">→ false を !false = true に反転</span>
            </div>
            <div style="display: flex; align-items: center; gap: 12px;">
              <span style="background: #22c55e; color: white; min-width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.75rem; flex-shrink: 0;">3</span>
              <code style="background: #f1f5f9; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem;">update(todo)</code>
              <span style="color: #64748b;">→ 変更後のTodoをDBに保存</span>
            </div>
          </div>
        </div>

        <div style="background: #ede9fe; border: 1px solid #c4b5fd; border-radius: 8px; padding: 12px 16px; margin-top: 16px;">
          <p style="margin: 0; color: #5b21b6; font-size: 0.8rem; line-height: 1.7;">
            <strong>ポイント:</strong> <code style="background: #ddd6fe; padding: 2px 6px; border-radius: 4px;">!</code>（論理否定演算子）で boolean の値を反転します。<code style="background: #ddd6fe; padding: 2px 6px; border-radius: 4px;">!true → false</code>、<code style="background: #ddd6fe; padding: 2px 6px; border-radius: 4px;">!false → true</code> となるため、ボタンを押すたびに<span style="color: #dc2626; font-weight: 700;">完了 ↔ 未完了が切り替わります</span>。
          </p>
        </div>
      </div>

      <!-- CRUD完成図解 -->
      <div class="diagram-container">
        <div class="diagram-title">
          <span class="material-icons">celebration</span>
          CRUD完成！機能一覧
        </div>
        <div class="diagram-content">
          <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px;">
            <div style="background: #dcfce7; padding: 16px; border-radius: 8px; text-align: center; border: 2px solid #22c55e;">
              <span class="material-icons" style="font-size: 2rem; color: #16a34a;">add_circle</span>
              <div style="font-weight: 700; margin-top: 8px; color: #166534;">Create</div>
              <div style="font-size: 0.8rem; color: #15803d;">新規登録</div>
            </div>
            <div style="background: #dbeafe; padding: 16px; border-radius: 8px; text-align: center; border: 2px solid #3b82f6;">
              <span class="material-icons" style="font-size: 2rem; color: #2563eb;">visibility</span>
              <div style="font-weight: 700; margin-top: 8px; color: #1e40af;">Read</div>
              <div style="font-size: 0.8rem; color: #1d4ed8;">一覧・詳細表示</div>
            </div>
            <div style="background: #fef3c7; padding: 16px; border-radius: 8px; text-align: center; border: 2px solid #f59e0b;">
              <span class="material-icons" style="font-size: 2rem; color: #d97706;">edit</span>
              <div style="font-weight: 700; margin-top: 8px; color: #92400e;">Update</div>
              <div style="font-size: 0.8rem; color: #b45309;">編集・更新</div>
            </div>
            <div style="background: #fef2f2; padding: 16px; border-radius: 8px; text-align: center; border: 2px solid #ef4444;">
              <span class="material-icons" style="font-size: 2rem; color: #dc2626;">delete</span>
              <div style="font-weight: 700; margin-top: 8px; color: #991b1b;">Delete</div>
              <div style="font-size: 0.8rem; color: #b91c1c;">削除</div>
            </div>
          </div>
        </div>
      </div>

      <div class="info-box">
        <div class="info-box-title"><span class="material-icons">celebration</span> 完成！</div>
        <div class="info-box-content">
          <p>これでCRUD（Create, Read, Update, Delete）の基本機能がすべて完成しました。ToDoアプリとして必要な機能が揃いました。次のステップとして、バリデーション、検索、ページネーションなどの機能追加に挑戦してみましょう。</p>
        </div>
      </div>
    </section>

    <section class="section">
      <div class="section-header">
        <span class="section-number">まとめ</span>
        <h2 class="section-title">プロンプトプログラミング 完了</h2>
      </div>

      <div class="feature-list">
        <div class="feature-item">
          <div class="feature-icon" style="background: #34C759;">
            <span class="material-icons" style="color: white;">check</span>
          </div>
          <div class="feature-content">
            <h4>Chapter 1-3: 基本設定</h4>
            <p>プロジェクト作成、画面遷移、フォーム処理</p>
          </div>
        </div>
        <div class="feature-item">
          <div class="feature-icon" style="background: #34C759;">
            <span class="material-icons" style="color: white;">check</span>
          </div>
          <div class="feature-content">
            <h4>Chapter 4-5: データベース</h4>
            <p>DB設定、Model、Mapper、データ登録</p>
          </div>
        </div>
        <div class="feature-item">
          <div class="feature-icon" style="background: #34C759;">
            <span class="material-icons" style="color: white;">check</span>
          </div>
          <div class="feature-content">
            <h4>Chapter 6-8: CRUD完成</h4>
            <p>一覧表示、削除機能、編集機能</p>
          </div>
        </div>
      </div>

      <div class="next-step-box">
        <span class="next-step-badge">次のステップ</span>
        <h3>機能追加編へ</h3>
        <p>基本CRUDが完成したら、バリデーション、検索、ページネーション、認証などの機能を追加しましょう。</p>
        <a href="../../ai/promptpg-function/01_extends-todo.html" class="btn-primary">
          機能追加編へ進む
          <span class="material-icons">arrow_forward</span>
        </a>
      </div>
    </section>
  </div>

  <div class="page-nav">
    <a href="promptpg-7.html" class="page-nav-btn prev">
      <div class="page-nav-label">前へ</div>
      <div class="page-nav-title">Chapter 7: 削除機能</div>
    </a>
    <a href="index.html" class="page-nav-btn next">
      <div class="page-nav-label">トップ</div>
      <div class="page-nav-title">プロンプトプログラミング</div>
    </a>
  </div>

  <footer class="footer">
    <p>プロンプトプログラミング - 職業訓練校教材</p>
  </footer>
</body>
</html>
